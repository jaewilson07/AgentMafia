---
url: https://ai.pydantic.dev/examples/flight-booking/
session_id: pydantic_ai_docs
chunk_number: 3
title: Asynchronous Flight Booking Example
summary: This code snippet demonstrates an asynchronous flight booking agent that takes user input for flight origin, destination, and date. It continuously searches for flights until a suitable option is found or no flights match the criteria. The user is prompted to either purchase the flight or continue searching.
embedding: [-0.051946431398391724, -0.010810044594109058, 0.03990586847066879, -0.02881796285510063, 0.0012735211057588458, 0.018391629680991173, 0.0024378832895308733, 0.05853566154837608, 0.022083187475800514, 0.03461331129074097, 0.005193320102989674, -0.015718888491392136, -0.00897749699652195, -0.04980294406414032, -0.025245489552617073, -0.006016973871737719, -0.01966184377670288, 0.021752402186393738, 0.005563798826187849, 0.04559536278247833, 0.06335188448429108, 0.02232135273516178, 0.010135243646800518, 0.015308716334402561, -0.055413052439689636, -0.000736409449018538, -0.004988233558833599, 0.05498965084552765, -0.014422212727367878, -0.02810346893966198, 0.06292848289012909, -0.027680063620209694, 0.015613038092851639, 0.02467653900384903, -0.0328403040766716, -0.02332693710923195, -0.026396619156003, 0.0274683628231287, 0.003079605521634221, -0.04353126883506775, 0.012549972161650658, -0.04313432425260544, 0.04813579097390175, -0.011756088584661484, -0.05401052534580231, 0.023075541481375694, 0.0047070663422346115, 0.04109669104218483, 0.03937661275267601, -0.0010700884740799665, -0.033396024256944656, -0.021765634417533875, -0.01681709475815296, 0.012556587345898151, -0.030167564749717712, 0.009486905299127102, -0.03252275288105011, 0.0037147123366594315, 0.01339678093791008, -0.015441030263900757, -0.011034977622330189, -0.006238599773496389, -0.0005925181321799755, 0.043372489511966705, -0.02381649799644947, 0.017306655645370483, 0.0274683628231287, 0.018788570538163185, -0.06398699432611465, -0.008693021722137928, -0.0046309856697916985, 0.025338107720017433, -0.007991758175194263, -0.049061987549066544, -0.039403073489665985, -0.00929505005478859, 0.06965002417564392, 0.05922369286417961, -0.011154060252010822, -0.06128779053688049, -0.010419717989861965, 0.006906784605234861, -0.06504550576210022, 0.04686557874083519, -0.04649509862065315, -0.04310786351561546, -0.06229337677359581, 0.01578504592180252, -0.016936177387833595, -0.04128193110227585, -0.03188764676451683, 0.042605068534612656, -0.01737281307578087, 0.019966164603829384, 0.07414869964122772, 0.07922955602407455, -0.001376064377836883, -0.011967790313065052, -0.04032927006483078, 0.01344309002161026, 0.029797086492180824, -0.021620089188218117, -0.0656806081533432, 0.007376499008387327, 0.013615098781883717, -0.057583000510931015, 0.015480724163353443, 0.03781530633568764, -0.020786510780453682, 0.029082590714097023, -0.0549367256462574, 0.005735806655138731, -0.00870625302195549, 0.008633480407297611, -0.019370753318071365, -0.006185674108564854, -0.008176998235285282, -0.06388114392757416, 0.018246084451675415, -0.005325633566826582, -0.07404284924268723, -0.0021054446697235107, 0.013668023981153965, 0.018643025308847427, 0.019767694175243378, 0.018166696652770042, -0.05599523335695267, -0.048373956233263016, -0.03823871165513992, 0.026039371266961098, 0.060917310416698456, -0.00564980274066329, 0.036201078444719315, -0.013013070449233055, -0.057212524116039276, 0.009394285269081593, -0.04451039060950279, -0.006718237418681383, -0.02310200408101082, -0.00022410663950722665, 0.004822840914130211, -0.005616724491119385, 0.020376337692141533, 0.00911642611026764, -0.049591243267059326, 0.0156527329236269, -0.011828861199319363, 0.017690366134047508, -0.05364004895091057, 0.03643924370408058, 0.025430727750062943, -0.04437807574868202, -0.04723605513572693, -0.008038068190217018, 0.0008732716087251902, 0.0048625352792441845, 0.014104659669101238, 0.011861939914524555, 0.017346350476145744, 0.014170817099511623, -0.027362510561943054, 0.008196844719350338, 0.0012222494697198272, -0.04538366198539734, 0.02566889300942421, -0.01958245411515236, -0.019066430628299713, -0.010227862745523453, -0.049458928406238556, -0.029029665514826775, -0.005431484896689653, -0.037682995200157166, -0.006529690232127905, 0.0006818299880251288, 0.013668023981153965, -0.039667703211307526, 0.006814165040850639, -0.018457787111401558, -0.032999083399772644, -0.011180522851645947, -0.013654792681336403, -0.012219186872243881, -0.015586575493216515, -0.03765653073787689, -0.05684204399585724, 0.02310200408101082, -0.0034136981703341007, 0.041573021560907364, 0.022294888272881508, 0.04601876810193062, 0.03307846933603287, 0.030908523127436638, 0.006880322005599737, 0.005646495148539543, -0.03289323300123215, 0.02945307083427906, 0.04691850394010544, -0.03125254064798355, 0.025377802550792694, 0.0057622697204351425, -0.005858197342604399, -1.756001620378811e-05, 0.011650237254798412, 0.008666559122502804, -0.004726913291960955, -0.03879443183541298, -0.0141178909689188, -0.00690016895532608, -0.005752346012741327, 0.03392527997493744, 0.029241368174552917, -0.0344809964299202, 0.0171346478164196, -0.03821225091814995, -0.07234922796487808, -0.028394559398293495, -0.012874140404164791, -0.0027603984344750643, -0.03162301704287529, 0.0052826316095888615, -0.034163445234298706, -0.026780329644680023, 0.02995586208999157, -0.008183613419532776, 0.042922623455524445, 0.040884990245103836, 0.024663306772708893, -0.020640965551137924, -0.014408981427550316, 0.006119517143815756, 0.016486309468746185, -0.009605987928807735, -0.019317826256155968, 0.005464563146233559, 0.036703869700431824, -0.009182583540678024, 0.002899328013882041, -0.023300474509596825, 0.003870181040838361, 0.01421051099896431, -0.007495581638067961, -0.015242558903992176, 0.019701536744832993, -0.008812104351818562, 0.010704193264245987, -0.01245073601603508, -0.03456038609147072, -0.03540719673037529, 0.0190796609967947, 0.027627138420939445, 0.04297554865479469, 0.007508812937885523, -0.01321815699338913, -0.02810346893966198, 0.0013942575315013528, -0.015957053750753403, -0.026687709614634514, -0.010651267133653164, 0.013522478751838207, 0.011564233340322971, -0.026237843558192253, 0.03794762119650841, -0.026277536526322365, 0.05205228179693222, -0.00047178167733363807, -0.04114961624145508, 0.04668033868074417, -0.018021151423454285, -0.006000434514135122, 0.00996985100209713, -0.030485117807984352, 0.004743452649563551, 0.007660973817110062, 0.022347815334796906, -0.06949125230312347, -0.031781796365976334, -0.01600997895002365, 0.007879291661083698, 0.006122824735939503, -0.02638338878750801, -0.03450746089220047, 0.017809448763728142, 0.03265506774187088, -0.023287244141101837, 0.010049239732325077, 0.04321371391415596, 0.05715959891676903, -0.02926783077418804, -0.025007324293255806, 0.06134071573615074, 0.025920290499925613, -0.010155090130865574, -0.001301637850701809, -0.01256320346146822, 0.03987940400838852, 0.012232418172061443, 0.03712727501988411, 0.008772410452365875, 0.015493955463171005, 0.0076345112174749374, 0.030749745666980743, -0.03334309905767441, 0.0008269617683254182, -0.013185078278183937, -0.01804761402308941, 0.025920290499925613, 0.005993818864226341, 0.042102277278900146, 0.04771238565444946, 0.0213289987295866, -0.011676699854433537, 0.07139657437801361, -0.0005987203330732882, -0.019688306376338005, -0.019463371485471725, -0.03598937764763832, 0.06525720655918121, -0.01687001995742321, 0.007938832975924015, -0.04054097458720207, 0.003635323839262128, -0.009010575711727142, 0.03551304712891579, 0.014104659669101238, -0.02201703004539013, -0.04525134712457657, 0.056683268398046494, -0.0035790905822068453, -0.047606535255908966, 0.04035573452711105, -0.039455998688936234, 0.0009824305307120085, 0.004670680034905672, -0.005596877075731754, -0.010790197178721428, 0.002684317994862795, 0.002482539275661111, 0.01984708197414875, 0.039403073489665985, 0.05107316002249718, 0.0055207968689501286, -0.006274986080825329, -0.05300494283437729, -0.015639500692486763, -0.02679356187582016, 4.837726373807527e-05, 0.014779460616409779, 0.01395911443978548, 0.02404143288731575, 0.021778864786028862, -0.008415162563323975, 0.0564715638756752, 0.009744917042553425, 0.04988233372569084, -0.06255800276994705, -0.052343372255563736, 0.008315927349030972, 0.01812700182199478, -0.03612168878316879, -8.590065408498049e-05, -0.0779593363404274, -0.013747412711381912, -0.032866768538951874, -0.003064720192924142, -0.014845618046820164, -0.0010808390798047185, -0.01364156138151884, -0.0038073319010436535, -0.03164948150515556, 0.04800347611308098, 0.06837981194257736, 0.020812973380088806, -0.0519728921353817, -0.006420531310141087, -0.019145818427205086, -0.025973215699195862, -0.020958518609404564, 0.03797408565878868, -0.009175967425107956, 0.035751212388277054, 0.034719161689281464, -0.021434849128127098, -0.03802701085805893, -0.0335547998547554, 0.014713304117321968, 0.016711242496967316, -0.018034381791949272, -0.031279001384973526, -0.004005802795290947, 0.011557617224752903, 0.032046422362327576, -0.060017578303813934, 0.01405173446983099, -0.0025652353651821613, -0.04493379592895508, -0.016248144209384918, 0.041070230305194855, 0.052343372255563736, 0.004429207183420658, -0.01479269191622734, 0.007932216860353947, -0.016221681609749794, 0.024385448545217514, 0.01014847494661808, -0.031464241445064545, 0.03350187465548515, 0.016261376440525055, -0.0013140422524884343, -0.008315927349030972, 0.016803862527012825, 0.04466916620731354, -0.03950892388820648, 0.013211540877819061, 0.013747412711381912, -0.005715959705412388, -0.012199340388178825, -0.027362510561943054, 0.01582474075257778, 0.05305786803364754, 0.035433657467365265, 0.017650671303272247, -0.05128486081957817, 0.03919137269258499, 0.022572748363018036, -0.03199349716305733, 0.036333393305540085, 0.024927934631705284, -0.00996985100209713, 0.046389248222112656, -0.03329017385840416, -0.004181118682026863, -0.010108781047165394, 0.02471623383462429, 0.060599759221076965, -0.03736544027924538, 0.019185513257980347, 0.0030779517255723476, 0.00048211871762759984, 0.0006570211262442172, -0.033448949456214905, -0.005127163138240576, -0.04705081507563591, 0.023353399708867073, 0.04498672112822533, -0.01314538437873125, -0.011584080755710602, -0.03310493379831314, 0.01709495298564434, 0.03164948150515556, 0.008812104351818562, 0.014091428369283676, -0.03368711471557617, -0.03323724865913391, -0.010717424564063549, -0.04832103103399277, -0.02246689796447754, 0.020323412492871284, 0.005927661899477243, 0.10082317888736725, 0.040117569267749786, 0.027865303680300713, 0.04916783794760704, -0.032999083399772644, 0.027097882702946663, -0.004591291770339012, 0.02314169891178608, 0.03482501208782196, 0.0043895128183066845, -0.018695952370762825, 0.01872241497039795, 0.027547750622034073, 0.0009725070558488369, 0.0042869700118899345, -0.008752563036978245, -0.017121415585279465, 0.012642591260373592, 0.02476915903389454, 0.03135839104652405, -0.03776238113641739, -0.004885690286755562, 0.0297706238925457, 0.021858252584934235, 0.016764169558882713, 0.023512177169322968, -0.009089963510632515, 0.02805054374039173, -0.0038734888657927513, -0.014250204898416996, -0.05832396075129509, 0.0019069737754762173, 0.01105482503771782, 0.04421930015087128, 0.015758583322167397, -0.015718888491392136, -0.00899734441190958, -0.050226349383592606, 0.009255356155335903, 0.0072375694289803505, -0.0007843732601031661, -0.04191703721880913, 0.020217562094330788, -0.017293425276875496, -0.009354591369628906, -0.0009468712378293276, 0.03535426780581474, -0.030590970069169998, 0.021765634417533875, -0.022361045703291893, 0.010294020175933838, 0.027865303680300713, -0.010108781047165394, -0.034295760095119476, 0.011504692025482655, 0.0028034003917127848, -0.008196844719350338, 0.004075267352163792, -0.005454639904201031, 0.00297210062853992, -0.036068763583898544, -0.014964699745178223, 0.027706526219844818, -0.041969962418079376, -0.005954124499112368, 0.02679356187582016, -0.0020839436911046505, 0.003790792776271701, -0.0057721929624676704, -0.0164201520383358, 0.004250583704560995, -0.01364156138151884, -0.004587983712553978, 0.009460442699491978, -0.01583797112107277, 0.020760048180818558, -0.031093763187527657, 0.03053804486989975, -0.012768290005624294, 0.007449271623045206, -0.026184916496276855, -0.008917955681681633, 0.003155686194077134, -0.005504257511347532, -0.011947943828999996, -0.048691507428884506, -0.01044618058949709, -0.025364572182297707, 0.03035280480980873, 0.02773299068212509, -0.012993223033845425, -0.023882655426859856, 0.037233125418424606, 0.027759453281760216, 0.020045552402734756, 0.012682286091148853, 0.015176402404904366, 0.032866768538951874, -0.007164796814322472, -0.022877071052789688, 0.028526872396469116, -0.015176402404904366, 0.01039987150579691, -0.02805054374039173, 0.015943823382258415, -0.010353561490774155, -0.02057480812072754, 0.0026876258198171854, -0.001973130740225315, 0.017174342647194862, -0.04424576088786125, -0.02471623383462429, -0.0007922293734736741, -0.003936337772756815, -0.006867090705782175, -0.004445746541023254, 0.035301342606544495, 0.02647600695490837, -0.0015513802645727992, -0.0473683699965477, -0.032681528478860855, 0.026515701785683632, 0.0036650944966822863, -0.003235074458643794, 0.0382651761174202, 0.0030514888931065798, 0.003956185188144445, -0.027574213221669197, 0.004922076594084501, 0.006847243290394545, -0.01935752108693123, 0.005140394438058138, -0.007310342043638229, -0.02224196307361126, 0.0019417061703279614, -0.006939863320440054, -0.02660832181572914, 0.018616562709212303, -0.016049673780798912, 0.020812973380088806, -0.009328128769993782, 0.0267538670450449, 0.026052603498101234, -0.03318432345986366, -0.025430727750062943, -0.002234450774267316, 0.01104820892214775, -0.012186108157038689, 0.03707434982061386, 0.003201995976269245, 0.007793287746608257, 0.019013505429029465, 0.008487935177981853, 0.008223308250308037, -0.006847243290394545, -0.04771238565444946, -0.025060249492526054, 0.0010816659778356552, -0.05191996693611145, -0.0024395373184233904, 0.05991172417998314, -0.02778591588139534, 0.03027341701090336, 4.809299571206793e-05, 0.019926469773054123, 0.0053520966321229935, -0.013615098781883717, -0.033951740711927414, -0.027494825422763824, -0.00929505005478859, 0.015507186762988567, 0.014845618046820164, 0.004845995921641588, 0.04038219526410103, 0.018457787111401558, -0.00830269604921341, -0.034216370433568954, -0.029558921232819557, 0.03315785899758339, -0.030749745666980743, -0.012047179043293, -0.0015439376002177596, 0.01615552417933941, 0.007105255499482155, 0.006708313710987568, -0.01758451573550701, 0.0033095008693635464, 0.006695082411170006, -0.014858849346637726, 0.010042623616755009, 0.04660094901919365, -0.007019251585006714, 0.0036551710218191147, 0.007746977731585503, 0.038132861256599426, 0.01614229381084442, 0.056947894394397736, 0.01673770695924759, -0.018788570538163185, -0.02439868077635765, -0.004164579324424267, 0.005623340141028166, -0.023803267627954483, 0.039085522294044495, 0.023829730227589607, 0.02666124701499939, -0.011742857284843922, 0.008428393863141537, 0.03871504217386246, 0.04014403373003006, 0.048823822289705276, 0.006946478970348835, -0.0057622697204351425, 0.014700071886181831, 0.012622744776308537, -0.0004581368120852858, -0.0039628008380532265, -0.0048559196293354034, 0.025867363438010216, -0.019992627203464508, -0.021368691697716713, 0.042340442538261414, -0.020548345521092415, 0.010353561490774155, -0.03085559792816639, 0.04591291770339012, 0.06398699432611465, -0.04641570895910263, -0.015004394575953484, -0.0017465432174503803, 0.00011587801418500021, 0.03506317734718323, 0.02192441001534462, -0.007680820766836405, 0.012331653386354446, 0.020442495122551918, 0.005553875118494034, 0.0004008697287645191, -0.000627663976047188, 0.02430606074631214, -0.0030713360756635666, -0.04104376584291458, -0.027997616678476334, 0.011154060252010822, 0.02715080790221691, 0.010393255390226841, -0.03022048994898796, -0.026859717443585396, 0.012212571687996387, 0.006972941569983959, 0.020151404663920403, -0.01105482503771782, 0.004349818918853998, 0.02598644606769085, -0.012172876857221127, 0.012477199546992779, -0.032681528478860855, 0.022387508302927017, -0.032866768538951874, 0.01705526001751423, 0.005097392480820417, -0.03577767312526703, -0.018206389620900154, 0.0466538742184639, -0.005163549445569515, -0.009897078387439251, -0.02134222909808159, -0.05430161580443382, -0.01028740406036377, 0.020138172432780266, 0.021276071667671204, 0.030749745666980743, 0.0024841930717229843, -0.022625673562288284, 0.007813135161995888, -0.0041248854249715805, -0.009275203570723534, -0.02660832181572914, -0.05001464858651161, 0.026409851387143135, -0.02760067582130432, 0.006159211043268442, 0.01080342847853899, -0.01436928752809763, -0.00931489747017622, -0.02250659093260765, -0.009268587455153465, -0.015864433720707893, 0.0018143540946766734, 0.014911774545907974, -0.05959417298436165, 0.021236378699541092, -0.028209319338202477, 0.010002929717302322, 0.028897352516651154, -0.03469270095229149, 0.03305200859904289, 0.04678618907928467, 0.009189198724925518, 0.02570858784019947, -0.050676215440034866, 0.024147283285856247, -0.004052112810313702, 0.015017625875771046, -0.024345753714442253, 0.011041593737900257, -0.022347815334796906, 0.0010684345616027713, -0.021236378699541092, -0.01745220087468624, -0.01330416090786457, 0.03874150663614273, -0.011775936000049114, -0.015983516350388527, 0.00208063586615026, 0.023618027567863464, 0.02462361380457878, -0.018550407141447067, -0.01312553696334362, 0.015149939805269241, 0.027627138420939445, -0.008587171323597431, 0.007654358167201281, 0.018801802769303322, -0.001156919519416988, -0.014554526656866074, 0.0034467766527086496, -0.01898704282939434, -0.0017101569101214409, 0.002851364202797413, 0.014263436198234558, -0.013972345739603043, -0.014647146686911583, 0.0030564507469534874, 0.013290929608047009, -0.008673175238072872, -0.009883847087621689, -0.001806084532290697, 0.014647146686911583, -0.10585110634565353, -0.033396024256944656, -0.007283879444003105, 0.02738897316157818, 0.006109593436121941, -0.024703001603484154, 0.04998818412423134, 0.02918844297528267, 0.002986985957249999, -0.014461907558143139, 0.016711242496967316, 0.0039694164879620075, -0.018206389620900154, -0.05364004895091057, 0.025748280808329582, 0.034163445234298706, 0.004032265394926071, 0.0321258120238781, 0.03231104835867882, -0.016486309468746185, -0.013204925693571568, -0.017147880047559738, -0.07997050881385803, 0.03072328306734562, -0.007111871149390936, -0.004604523070156574, -0.017121415585279465, 0.07197875529527664, 0.021950872614979744, 0.0017035412602126598, -0.0042175049893558025, -0.03884735703468323, 0.004697142634540796, 0.008924571797251701, -0.021315766498446465, 0.07197875529527664, 0.0005830080481246114, 0.019727999344468117, 0.021223146468400955, 0.007488965522497892, -0.005715959705412388, 0.015070551075041294, 0.026542164385318756, 0.021077601239085197, 0.04424576088786125, -0.009142889641225338, -0.011584080755710602, -0.028473947197198868, -0.0059342775493860245, 0.00854747649282217, 0.03463977575302124, -0.005904506891965866, -0.0050345431081950665, 0.009705223143100739, 0.013403396122157574, 0.03289323300123215, -0.01696263998746872, 0.0290561281144619, -0.003107722382992506, -0.030432192608714104, 0.024557456374168396, -0.0034136981703341007, 0.014832385815680027, -0.0051536257378757, 0.003340925555676222, -0.0015092052053660154, -0.017716828733682632, -0.007952064275741577, -0.022361045703291893, 0.014514832757413387, -0.01935752108693123, 0.04146717116236687, 0.02241397090256214, -0.016578929498791695, 0.010002929717302322, 0.013668023981153965, 0.0011048208689317107, 0.0172404982149601, -0.008309312164783478, -0.009096579626202583, 0.023340169340372086, -0.031014373525977135, 0.022493360564112663, 0.0021567163057625294, -0.015321947634220123, 0.009050269611179829, 0.007528659887611866, 0.00739634595811367, -0.0034236216451972723, 0.023803267627954483, 0.01690971478819847, 0.002805054420605302, -0.01123344898223877, 0.02606583572924137, -0.013429858721792698, 0.02259921096265316, -0.05178765207529068, 0.0466538742184639, 0.019317826256155968, -0.01556011289358139, 0.026542164385318756, 0.02950599603354931, 0.02945307083427906, 0.0060897464863955975, 0.023750342428684235, 0.033766504377126694, -0.04159948602318764, -0.04795055091381073, -0.020455725491046906, 0.010935742408037186, -0.020138172432780266, -0.004941923543810844, -0.01911935582756996, 0.02842102199792862, -0.03336955979466438, -0.008917955681681633, 0.03495732694864273, 0.018007919192314148, -0.06165827065706253, 0.002302261535078287, 0.006394068244844675, 0.01776975393295288, -0.005090776830911636, 0.023260779678821564, -0.02449129894375801, -0.02958538383245468, -0.03411052003502846, -0.01857686974108219, -0.028606262058019638, -0.010843122377991676, 0.0012545010540634394, 0.009930157102644444, -0.028447484597563744, -0.00436305021867156, 0.01731988787651062, -0.02728312276303768, 0.06012342870235443, -0.016896482557058334, -0.012139799073338509, 0.0015273983590304852, 0.022069955244660378, -0.0028546720277518034, -0.030167564749717712, 0.012086872942745686, -0.03501025214791298, -0.004591291770339012, 0.012298575602471828, 0.001573708257637918, -0.03974708914756775, 0.0596470981836319, 0.003101106733083725, 0.017518358305096626, -0.0023469175212085247, 0.04353126883506775, -0.008805489167571068, 0.028791500255465508, -0.032363977283239365, -0.043002013117074966, 0.02089236117899418, -0.010915894992649555, -0.007654358167201281, 0.030564507469534874, 0.03598937764763832, -0.005540643818676472, 0.008110840804874897, 0.002241066424176097, -0.04379589483141899, 0.013105690479278564, -0.006986172869801521, -0.002785207238048315, -0.029929399490356445, 0.05588938295841217, 0.006860474590212107, -0.03654509410262108, 0.019727999344468117, 0.044404540210962296, 0.027944691479206085, -0.010280788876116276, 0.012708748690783978, 0.06160534545779228, -0.01956922374665737, 0.019185513257980347, 0.011312836781144142, 0.007402961608022451, 0.04628339782357216, 0.011716394685208797, 0.0009691991726867855, 0.0374448299407959, 0.03802701085805893, -0.012735211290419102, 0.04252568259835243, 0.028129931539297104, -0.007925601676106453, 0.044139910489320755, -0.02449129894375801, 0.03704788535833359, 0.03905905783176422, -0.04318724945187569, 0.006569384131580591, -0.0029985634610056877, -0.008038068190217018, 0.028394559398293495, -0.013509247452020645, 0.029797086492180824, -0.015335178934037685, 0.014448676258325577, 0.005421561188995838, 0.0020277102012187243, -0.021725939586758614, -0.001817661919631064, -0.04091145098209381, 0.007918985560536385, 0.000642135797534138, 0.014475138857960701, -0.006695082411170006, 0.001586939673870802, -0.021778864786028862, -0.0229167640209198, -0.038318101316690445, 0.003362426534295082, -0.05890614166855812, -0.0033243861980736256, 0.002424651989713311, 0.014236973598599434, 0.021858252584934235, 0.011484844610095024, -0.0062584467232227325, 0.0011271488619968295, 0.018246084451675415, 0.0244516059756279, -0.0012834446970373392, 0.014607452787458897, 0.018616562709212303, -0.009863999672234058, 0.0048691509291529655, -0.022162575274705887, -0.01046602800488472, -0.023790035396814346, 0.03725958988070488, 0.014911774545907974, -0.0052660927176475525, 0.010267557576298714, 0.0014910120517015457, -0.006159211043268442, 0.04599230736494064, 0.007197875063866377, 0.01337693352252245, 0.034983791410923004, -0.005156933795660734, 0.029744161292910576, 0.035936448723077774, 0.03649216890335083, 0.002383303828537464, 0.006235291715711355, 0.03257567808032036, -0.01587766595184803, -0.018471017479896545, 0.015599806793034077, -0.021011443808674812, -0.022705061361193657, -0.006734776776283979, -0.006294833030551672, -0.01782267913222313, 0.006529690232127905, -0.02310200408101082, -0.007905754260718822, -0.01668477989733219, 0.023710647597908974, 0.015149939805269241, 0.011101135052740574, -0.025735050439834595, -0.016486309468746185, -0.0016274607041850686, 0.0006838974077254534, 0.01328431349247694, -0.009228893555700779, 0.008090994320809841, -0.013985577039420605, -0.024411911144852638, -0.017981456592679024, -0.02349894493818283, 0.018074076622724533, 0.005064313765615225, 0.0056001851335167885, 0.020402800291776657, 0.00481622526422143, 0.012801367789506912, -0.035883523523807526, 0.01157084945589304, -0.018100539222359657, 0.04154656082391739, -0.01014847494661808, 0.00594420125707984, 0.016393689438700676, -0.008898108266294003, -0.009645681828260422, 0.02417374588549137, 0.011921481229364872, -0.018206389620900154, 0.02512640692293644, -0.004071959760040045, 0.031596556305885315, -0.008554092608392239, 0.009897078387439251, 0.038767967373132706, 0.017624208703637123, 0.005927661899477243, -0.020812973380088806, 0.0252190250903368, 0.0099500035867095, -0.026965569704771042, -0.01962214894592762, 0.02210965007543564, -0.00807114690542221, 0.016208451241254807, 0.04326663911342621, -0.01967507414519787, 0.019701536744832993, -0.0027537827845662832, 0.02196410484611988, 0.008944418281316757, 0.0065859234891831875, 0.00253711873665452, 0.022308120504021645, 0.010724039748311043, -0.00981107447296381, 0.008970880880951881, 0.01791529916226864, 0.015123477205634117, -0.038318101316690445, 0.06409284472465515, 0.03747129067778587, 0.0021782172843813896, -0.00580857926979661, -0.04482794180512428, -0.03167594224214554, -0.014250204898416996, -0.01364156138151884, 0.007594816852360964, -0.005381867289543152, -0.023115234449505806, -0.03807993605732918, -0.0001307633356191218, 0.006992788519710302, 0.002454422414302826, -0.005319017916917801, 0.012569818645715714, 0.016115831211209297, 0.04096437618136406, 0.048426881432533264, 0.07970587909221649, 0.028394559398293495, -0.016499541699886322, 0.025457190349698067, 0.019410446286201477, -0.012417658232152462, 0.014091428369283676, 0.03207288682460785, -0.007680820766836405, -0.015771815553307533, -0.013224772177636623, 0.033316634595394135, 0.0007310342043638229, -0.0014761267229914665, -0.00033326560514979064, 0.01956922374665737, 0.02561596781015396, -0.004902229178696871, -0.0033376177307218313, -0.013985577039420605, 0.006139364093542099, 0.05525427684187889, 0.007105255499482155, -0.02115698903799057, -0.007105255499482155, 0.0018441247520968318, 0.0025950060226023197, -0.052660923451185226, 0.018775340169668198, 0.044139910489320755, 0.025179332122206688, -0.02778591588139534, -0.015163171105086803, -0.028262244537472725, -0.01700233481824398, -0.0006251831073313951, 0.011372378095984459, 0.020085247233510017, 0.017663903534412384, 0.015507186762988567, -0.00295390747487545, 0.01479269191622734, -0.003883412340655923, -0.010380024090409279, 0.011021746322512627, 0.03702142462134361, -0.021633319556713104, -0.013707717880606651, 0.014541295357048512, -0.011683315970003605, 0.021130526438355446, 0.03778884559869766, -0.005715959705412388, -0.04072621464729309, -0.0541163794696331, -0.00961260311305523, 0.004151348024606705, 0.029876474291086197, 0.003018410410732031, 0.014038503170013428, -0.03186118230223656, -0.023975275456905365, 0.005758961662650108, 0.04956477880477905, 0.019370753318071365, -0.03686264902353287, 0.0074161929078400135, 0.010313867591321468, -0.011418688111007214, 0.022136112675070763, -0.04136132076382637, -0.04331956431269646, -0.004511903505772352, -0.013118921779096127, 0.02670094184577465, 0.03731251507997513, 0.015414567664265633, -0.03310493379831314, 0.001419893349520862, 0.031914107501506805, -0.00682078069075942, 0.004052112810313702, 0.020786510780453682, -0.0017465432174503803, -0.02110406383872032, -0.04117608070373535, 0.007806519046425819, 0.034295760095119476, -0.0457276776432991, -0.004343203268945217, -0.006139364093542099, -0.0017895452911034226, -0.023194624111056328, -0.002763706259429455, 0.02034987509250641, 0.020535115152597427, -0.014131122268736362, 0.003876796690747142, -0.010657883249223232, 0.005143702030181885, 0.0106644993647933, 0.00493861548602581, -0.03646570444107056, 0.01373418141156435, -0.040038179606199265, 0.0489032119512558, -0.02128930389881134, 0.0028083622455596924, -0.015189633704721928, -0.017147880047559738, -0.01917228102684021, 0.0020889053121209145, -0.00870625302195549, -0.010750503279268742, -0.005801963619887829, -0.0056994203478097916, -0.007131718099117279, 0.002671086462214589, -0.0005627474747598171, -0.022400740534067154, -0.009983082301914692, -0.005871428642421961, -0.013297544792294502, -0.015573344193398952, -0.013496016152203083, 0.01479269191622734, -0.0037147123366594315, -0.001744889304973185, 0.01687001995742321, -0.010876201093196869, -0.0032218429259955883, 0.01817992702126503, -0.0029969094321131706, 0.044192835688591, -0.011464998126029968, 0.01272197999060154, 0.006718237418681383, 0.018113769590854645, 0.0029158671386539936, -0.01660539209842682, -0.015017625875771046, 0.02089236117899418, -0.019026735797524452, -0.057900555431842804, -0.021183453500270844, -0.0085673239082098, 0.020918825641274452, -0.03577767312526703, 0.010082317516207695, 0.025787975639104843, 0.025774743407964706, -0.0040554204024374485, 0.016565697267651558, -0.02142161689698696, 0.022268425673246384, -0.020217562094330788, 0.011782551184296608, -0.043557729572057724, -0.01840486191213131, -0.01758451573550701, -0.018153464421629906, 0.025589505210518837, -0.014104659669101238, 0.003503010142594576, 0.0015513802645727992, 0.015414567664265633, 0.004594599362462759, 0.011848708614706993, -0.006807549390941858, -0.02183178998529911, 0.026687709614634514, -0.039800014346838, 0.008580555208027363, -0.0036882495041936636, 0.012893987819552422, 0.005547259468585253, 0.0038635653909295797, -0.023088771849870682, 0.011683315970003605, -0.013363702222704887, -0.005782116670161486, -0.02971769869327545, 0.022519823163747787, -0.004922076594084501, -0.0032913077156990767, 0.013853263109922409, -0.05141717568039894, -0.006880322005599737, -0.010320482775568962, -0.0036882495041936636, 0.01681709475815296, -0.007158181164413691, -0.004789762664586306, -0.0051040081307291985, 0.018259316682815552, -0.0017548128962516785, -0.010002929717302322, -0.019780924543738365, 0.03164948150515556, 0.051126085221767426, -0.020627735182642937, -0.005398406181484461, -0.0072441850788891315, 0.017968224361538887, -0.0038073319010436535, 0.0009882192825898528, -0.011590695939958096, -0.0029737544246017933, 0.01827254705131054, 0.0274683628231287, 0.004412667825818062, 0.0367303341627121, 0.018457787111401558, -0.020548345521092415, 0.042287517338991165, -0.007667589467018843, 0.035618897527456284, 0.019053198397159576, 0.023287244141101837, -0.01967507414519787, 0.01098205242305994, 0.004501979798078537, -0.013429858721792698, -0.012715363875031471, -0.028341634199023247, 0.021897947415709496, 0.020270487293601036, 0.023578334599733353, -0.012761673890054226, -0.045224886387586594, 0.048162251710891724, 0.006165826693177223, 0.02232135273516178, -0.003160647815093398, 0.01012862753123045, -0.020363107323646545, -0.0057788086123764515, 0.0164201520383358, 0.0328403040766716, 0.00247592362575233, 0.013191694393754005, 0.02278445102274418, -0.032496288418769836, 0.020773280411958694, 0.005123855080455542, 0.016565697267651558, 0.03310493379831314, 0.007813135161995888, -0.012093489058315754, -0.013985577039420605, 0.04006464406847954, -0.028579799458384514, -0.018378397449851036, -0.009414132684469223, 0.019503066316246986, -0.019780924543738365, 0.003387235337868333, -0.021236378699541092, -0.0014207203639671206, -0.0031093761790543795, 0.0262907687574625, -0.004002494737505913, -0.0141178909689188, 0.03164948150515556, 0.01922520622611046, -0.0006040955777280033, -0.008435009978711605, -0.005378559231758118, -0.048823822289705276, 0.011676699854433537, 0.02318139187991619, -0.008474703878164291, -0.008157150819897652, -0.001053549232892692, -0.02499409206211567, -0.020177867263555527, 0.022969689220190048, 0.0006020281580276787, -0.000723178090993315, 0.0072375694289803505, 0.006794318091124296, 0.019767694175243378, -0.0014604144962504506, -0.005504257511347532, -0.005424869246780872, 0.008626865223050117, 0.024914704263210297, 0.016023211181163788, 0.04239336773753166, -0.024980861693620682, 0.0382651761174202, 0.013204925693571568, 0.02336663194000721, -0.0013314083917066455, 0.027256660163402557, -0.001352082472294569, 0.018881190568208694, 8.171416266122833e-05, -0.014964699745178223, -0.013343854807317257, -0.004194349981844425, -0.011015131138265133, 0.05382528901100159, -0.011504692025482655, -0.014977931044995785, -0.014660377986729145, 0.02128930389881134, 0.009923540987074375, -0.01472653541713953, 0.01328431349247694, -0.0018325472483411431, 0.006728161126375198, 0.014289899729192257, 0.006886937655508518, 0.02765360102057457, 0.06081146001815796, -0.0037080964539200068, 0.011782551184296608, -0.023935580626130104, 0.038000546395778656, -0.00682078069075942, 0.011663468554615974, -0.0008046337752602994, -0.040884990245103836, 0.02331370674073696, 0.007092024199664593, 0.012536739930510521, 0.0015455915126949549, 0.04069975018501282, 0.004148040432482958, 0.03458685055375099, 0.010168321430683136, 0.009863999672234058, 0.002289030235260725, -0.006794318091124296, 0.015665963292121887, 0.00947367399930954, 0.008329158648848534, 0.017835911363363266, -0.004968386143445969, 0.012715363875031471, -0.0108695849776268, 0.004386205226182938, 0.025324877351522446, -0.012821215204894543, 0.028182856738567352, -0.009169352240860462, 0.0020161326974630356, -0.022850606590509415, 0.009751533158123493, 0.031067298725247383, 0.025205794721841812, 0.00739634595811367, 0.008712869137525558, -0.005405022297054529, 0.004144732374697924, -0.013185078278183937, -0.010578494518995285, -0.02377680502831936, -0.0038073319010436535, -0.032046422362327576, 0.016843557357788086, 0.01737281307578087, 0.02368418499827385, 0.00021790442406199872, 0.01314538437873125, -0.02263890579342842, -0.022705061361193657, 0.023578334599733353, 0.024650076404213905, 0.04014403373003006, -0.0057788086123764515, 0.01967507414519787, -0.022757988423109055, 0.023287244141101837, 0.006579307839274406, -0.02404143288731575, 0.026595089584589005, -0.0009973158594220877, -0.03503671661019325, -0.005577030126005411, -0.011881786398589611, 0.03418990597128868, -0.008349006064236164, 0.020402800291776657, 0.013112305663526058, 0.0014438752550631762, -0.03276091814041138, -0.03180825710296631]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:18:03.283665", "url_path": "/examples/flight-booking/", "chunk_size": 1933}
updated_dt: 2025-03-15T11:18:03.285200
---
async defmain():
  deps = Deps(
    web_page_text=flights_web_page,
    req_origin='SFO',
    req_destination='ANC',
    req_date=datetime.date(2025, 1, 10),
  )
  message_history: list[ModelMessage] | None = None
  usage: Usage = Usage()
  # run the agent until a satisfactory flight is found
  while True:
    result = await search_agent.run(
      f'Find me a flight from {deps.req_origin} to {deps.req_destination} on {deps.req_date}',
      deps=deps,
      usage=usage,
      message_history=message_history,
      usage_limits=usage_limits,
    )
    if isinstance(result.data, NoFlightFound):
      print('No flight found')
      break
    else:
      flight = result.data
      print(f'Flight found: {flight}')
      answer = Prompt.ask(
        'Do you want to buy this flight, or keep searching? (buy/*search)',
        choices=['buy', 'search', ''],
        show_choices=False,
      )
      if answer == 'buy':
        seat = await find_seat(usage)
        await buy_tickets(flight, seat)
        break
      else:
        message_history = result.all_messages(
          result_tool_return_content='Please suggest another flight'
        )

async deffind_seat(usage: Usage) -> SeatPreference:
  message_history: list[ModelMessage] | None = None
  while True:
    answer = Prompt.ask('What seat would you like?')
    result = await seat_preference_agent.run(
      answer,
      message_history=message_history,
      usage=usage,
      usage_limits=usage_limits,
    )
    if isinstance(result.data, SeatPreference):
      return result.data
    else:
      print('Could not understand seat preference. Please try again.')
      message_history = result.all_messages()

async defbuy_tickets(flight_details: FlightDetails, seat: SeatPreference):
  print(f'Purchasing flight {flight_details=!r}{seat=!r}...')

if __name__ == '__main__':
  importasyncio
  asyncio.run(main())

```

© Pydantic Services Inc. 2024 to present