---
url: https://ai.pydantic.dev/examples/chat-app/
session_id: pydantic_ai_docs
chunk_number: 1
title: Chat App with FastAPI
summary: This documentation introduces a simple chat application built with FastAPI, highlighting features like reusing chat history, serializing messages, and streaming responses. It emphasizes the interaction between the backend logic in `chat_app.py` and the frontend rendering in `chat_app.ts`, and provides guidance on how to run the example.
embedding: [-0.05160289257764816, -0.011202921159565449, 0.038303442299366, -0.025106891989707947, 0.04007842019200325, -0.038869377225637436, -0.011485888622701168, -0.012598463334143162, -0.011948925442993641, 0.0010852428385987878, 0.017428195104002953, -0.03735164552927017, 0.011929632164537907, -0.011736700311303139, -0.029762985184788704, -0.0010024427901953459, -0.008058128878474236, 0.028039459139108658, 0.005948738195002079, 0.0057075731456279755, 0.05162861943244934, -0.0023007148411124945, 0.024348026141524315, -0.008289647288620472, -0.03256693109869957, 0.010855644010007381, -0.009479395113885403, 0.03369879722595215, -0.03495929017663002, -0.04339684918522835, -0.0033763109240680933, -0.00048795732436701655, 0.029762985184788704, 0.011685251258313656, 0.026187309995293617, -0.005546796601265669, 0.018650097772479057, 0.021711288020014763, 0.024309439584612846, -0.017158091068267822, 0.008604769594967365, -0.03506218641996384, 0.016051946207880974, 0.0453004464507103, -0.03305569291114807, 0.02582717128098011, -0.008276784792542458, 0.07665833830833435, 0.02069517783820629, 0.014495627954602242, -0.05685064569115639, -0.0028232389595359564, -0.045377619564533234, 0.00430881604552269, -0.03117782063782215, -0.017646851018071175, -0.055255740880966187, 0.024643855169415474, -0.004881180822849274, -0.004074081778526306, 0.019447552040219307, 0.003665708936750889, -0.03495929017663002, -0.0046721710823476315, -0.022225772961974144, -0.01239266898483038, -0.03439335525035858, 0.02397502399981022, -0.03611687943339348, 0.02020641788840294, 0.02069517783820629, -0.019267480820417404, -0.08216333389282227, -0.05566732957959175, -0.032129619270563126, -0.02665034867823124, -0.0076979887671768665, 0.06400199234485626, 0.003922951873391867, -0.057468026876449585, -0.01184602826833725, 0.035885363817214966, -0.013942556455731392, 0.020502246916294098, -0.033004242926836014, -0.018482889980077744, -0.07912786304950714, -0.028451047837734222, 0.008521165698766708, -0.017646851018071175, -0.014624250121414661, 0.042136359959840775, -0.06924974918365479, -0.005279907025396824, 0.08051697909832001, 0.018367132171988487, -0.019010238349437714, -0.008971340954303741, 0.011923201382160187, -0.01641208678483963, 0.0457892082631588, -0.020823799073696136, -0.04571203514933586, 0.002969545777887106, 0.016553569585084915, -0.010630556382238865, 0.014637111686170101, 0.0015129088424146175, -0.05085688829421997, -0.03526797890663147, -0.05731368064880371, -0.01318369060754776, 0.031923823058605194, 0.015267356298863888, -0.01778833568096161, -0.010238260962069035, 0.01665646769106388, -0.009929569438099861, 0.016206292435526848, -0.019434688612818718, -0.02207142673432827, 0.02208428829908371, -0.021698424592614174, 0.007363573648035526, -0.01105500664561987, -0.012849275022745132, -0.02713910862803459, -0.022830292582511902, -0.030483264476060867, 0.014405593276023865, 0.027036212384700775, -0.03874075785279274, 0.013916832394897938, -0.05685064569115639, -0.021942805498838425, 0.019524723291397095, -0.014341282658278942, -0.013312311843037605, -0.013852521777153015, 0.02201997861266136, 0.010476210154592991, -0.02607155218720436, -0.017055192962288857, -0.0033859575632959604, 0.02177559770643711, -0.005083759780973196, -0.040207039564847946, 0.015177321620285511, -0.022392980754375458, -0.004414928611367941, 0.05443256348371506, 0.027550697326660156, -0.013826797716319561, 0.003942245151847601, 0.004180194344371557, -0.00887487456202507, 0.018765857443213463, 0.03773751109838486, -0.018174199387431145, -0.05170578882098198, -0.027524972334504128, 0.00431524682790041, -0.058548446744680405, -0.052554693073034286, -0.059834662824869156, -0.024669578298926353, -0.006492163520306349, -0.004794361535459757, -0.038354892283678055, -0.039178069680929184, -0.04527472332119942, -0.006797639187425375, -0.0067268977873027325, -0.00753721222281456, 0.039461035281419754, -0.01697802171111107, 0.01387824583798647, -0.07197652012109756, -0.016296327114105225, -0.020900972187519073, -0.00282806227914989, -0.0010193244088441133, -0.03958965837955475, -0.042676571756601334, -0.03802047669887543, -0.03639984875917435, 0.022675948217511177, 0.0074793328531086445, -0.0030097400303930044, 0.012855705805122852, 0.010302571579813957, 0.02262449823319912, 0.007382866460829973, 0.0013336428673937917, -0.005630400497466326, -0.009845965541899204, 0.03984690085053444, -0.02984015829861164, 0.01744105853140354, 0.044245749711990356, 0.0333901084959507, 0.05890858918428421, 0.03789185732603073, -0.028399597853422165, 0.0008271961705759168, -0.02829670161008835, -0.02450237050652504, 0.02097814530134201, -0.0413646325469017, 0.010424762032926083, 0.04584065452218056, -0.05890858918428421, 0.020939558744430542, -0.0030692273285239935, -0.03606543317437172, -0.0370686799287796, -0.04522327333688736, -0.0026335224974900484, -0.03868930786848068, 0.037788957357406616, -0.03717157617211342, 0.0667802169919014, 0.04499175399541855, -0.016206292435526848, 0.01664360612630844, 0.035370875149965286, 0.022714534774422646, -0.015486013144254684, -0.04571203514933586, 0.056387607008218765, 0.02180132269859314, -0.002458275994285941, -0.029788710176944733, -0.03601398319005966, 0.08206043392419815, -0.079539455473423, -6.436093099182472e-05, -0.007903783582150936, -0.006874812301248312, 0.04416857659816742, 0.006688311230391264, 0.01641208678483963, 0.025711411610245705, 0.023524848744273186, 0.027807939797639847, 0.01907454989850521, -0.03128071874380112, -0.0813916027545929, 0.04254794865846634, 0.06472226977348328, 0.037042953073978424, -0.0527862086892128, -0.007267107255756855, -0.0066497246734797955, 0.01144087128341198, -0.03717157617211342, -0.01239266898483038, -0.018354268744587898, -0.005472839344292879, -0.020026346668601036, -0.005013017915189266, 0.039126619696617126, -0.05240034684538841, 0.03421328589320183, 0.012476272881031036, -0.012997189536690712, 0.028605392202734947, -0.01264991145581007, -0.012855705805122852, -0.02236725576221943, 0.00706131337210536, 0.014997251331806183, 0.02578858472406864, 0.009382928721606731, -0.029788710176944733, 0.01827709749341011, -0.03794330358505249, -0.00010023423237726092, 0.03367307409644127, -0.01888161711394787, -0.02069517783820629, 0.010977833531796932, 0.013672451488673687, 0.04108166694641113, -0.0068490877747535706, 0.02821952849626541, 0.02211001329123974, -0.001977553591132164, 0.002096528420224786, -0.002234796294942498, 0.0033473712392151356, 0.05088261514902115, -0.018624374642968178, -0.05134565010666847, 0.046432316303253174, 0.04422002658247948, 0.05407242476940155, 0.026032965630292892, -0.024373749271035194, -0.010495503433048725, 0.0018071302911266685, -0.012804257683455944, 0.013968280516564846, -0.00015424516459461302, -0.006733328569680452, 0.028682565316557884, -0.0012291379971429706, 0.0028891575057059526, 0.030020227655768394, -0.04553196579217911, -0.01293287891894579, 0.04118456318974495, -0.012038960121572018, -0.05731368064880371, -0.055049944669008255, -0.011537336744368076, 0.029145602136850357, -0.0028457478620111942, 0.023216158151626587, -0.023627744987607002, -0.04926198348402977, -0.0004521844966802746, 0.03200099617242813, 0.013402346521615982, -0.03573101758956909, -0.009768793359398842, 0.01547315064817667, -0.0074150217697024345, 0.0034824234899133444, 0.014084040187299252, 0.012206167913973331, -0.04139035567641258, -0.013492382131516933, 0.015305942855775356, 0.01639922522008419, 0.0028779031708836555, -0.046663831919431686, 0.01637350022792816, 0.007710851263254881, 0.07743006199598312, -0.025106891989707947, -0.008771977387368679, -0.06960988789796829, -0.011337974108755589, -0.014354145154356956, 0.0035145790316164494, 0.029119879007339478, 0.030791955068707466, -0.03624550253152847, -0.007517918944358826, -0.0058136857114732265, 0.001906811841763556, 0.036194052547216415, -0.024129368364810944, 0.022753119468688965, -0.00902921985834837, -0.04331967607140541, -0.017068056389689445, -0.03827771916985512, 0.005855487659573555, -0.037814684212207794, -0.004530687816441059, -0.0043859886936843395, -0.033004242926836014, -0.00928003154695034, 0.02713910862803459, -0.03493356332182884, -0.04581493139266968, -0.03688861057162285, -0.030354643240571022, 0.024412335827946663, -0.0018521477468311787, -0.010257554240524769, -0.001789444824680686, -0.04728121683001518, -0.05885713919997215, 0.0010506758699193597, -0.0016375108389183879, -0.0068362257443368435, 0.020939558744430542, 0.02365346997976303, 0.006958416197448969, 0.015511737205088139, -0.0037718217354267836, 0.03043181635439396, 0.019048824906349182, 0.008643356151878834, 0.015048700384795666, -0.012450548820197582, 0.03637412190437317, 0.0451718233525753, -0.047461286187171936, -0.014212661422789097, 0.01561463437974453, 0.03557667136192322, 0.021698424592614174, 0.04144180566072464, -0.017068056389689445, 0.033261485397815704, -0.007222089916467667, 0.005267044994980097, 0.013112948276102543, -0.0018425011076033115, 0.012559876777231693, -0.00956942979246378, 0.00912568625062704, 0.025711411610245705, 4.6047454816289246e-05, 0.03742881864309311, 0.02154408022761345, 0.0356023944914341, -0.048798948526382446, 0.02343481406569481, -0.019151721149683, -0.001636706874705851, -0.0495963990688324, 0.03398176655173302, -0.013138673268258572, 0.03398176655173302, 0.04823301360011101, -0.008714097552001476, -0.08540458977222443, -0.0268818661570549, 0.0012508428189903498, -0.029428569599986076, 0.05736513063311577, 0.03354445472359657, -0.03331293538212776, 0.004318462684750557, -0.01035402063280344, -0.03182092681527138, -0.030586162582039833, 0.03423900902271271, 0.0043892040848731995, 0.0188430305570364, -0.04241932928562164, -0.011807441711425781, 0.017286712303757668, -0.026984764263033867, -0.02634165622293949, 0.005820116959512234, -0.017145229503512383, -0.0037621750961989164, 0.017595402896404266, -0.026778969913721085, -0.020810937508940697, -0.021145353093743324, -0.013903969898819923, 0.00022709710174240172, -0.005463192705065012, -0.028142355382442474, -0.014508490450680256, -0.0010868505341932178, -0.032412584871053696, -0.03043181635439396, -0.057982511818408966, 0.02852821908891201, 0.020296452566981316, 0.03313286602497101, -0.019151721149683, 0.024399474263191223, 0.030200297012925148, -0.011884614825248718, 0.016322052106261253, -0.004392419941723347, -0.01776261068880558, 0.06786063313484192, 0.029171327129006386, 0.03529370203614235, 0.002530625555664301, 0.03925524279475212, 0.02744780108332634, 0.011350835673511028, -0.010778470896184444, -0.03760888800024986, -0.06544255465269089, 0.04733266308903694, 0.03385314345359802, 0.022457290440797806, 0.03712012618780136, 0.031872376799583435, -0.014354145154356956, -0.013711038045585155, -0.003411681856960058, -0.015550323761999607, 0.04843880608677864, -0.014431317336857319, -0.05942307412624359, -0.008501872420310974, -0.002647992456331849, -0.03763461112976074, 0.024540957063436508, 0.017351021990180016, -0.014161212369799614, -0.01744105853140354, -0.022277221083641052, -0.04797577112913132, -0.045094653964042664, 0.011801010929048061, -0.01828995905816555, 0.006559689994901419, -0.01987200230360031, -0.031872376799583435, 0.017145229503512383, 0.004926198627799749, -0.02367919497191906, -0.008707666769623756, 0.023357640951871872, -0.005559658631682396, 0.022714534774422646, -0.03223251551389694, -0.017865508794784546, -0.01021253690123558, 0.01146016363054514, -0.013942556455731392, -0.004498532507568598, -0.028168080374598503, 0.01091352291405201, -0.019306067377328873, -0.0002072009810945019, 0.010662711225450039, 0.005443899426609278, 0.031152095645666122, -0.02066945470869541, 0.005131992511451244, 0.012064684182405472, -0.004826516844332218, -0.014984389767050743, -0.01185245905071497, -0.004225212149322033, 0.04887612164020538, 0.012019666843116283, 0.006144885905086994, -0.012926447205245495, -0.017955543473362923, 0.006064497400075197, -0.00970448274165392, -0.009183566085994244, -0.009858828037977219, -0.025955792516469955, -0.015550323761999607, 0.026470277458429337, -0.008534028194844723, -0.02473388984799385, -0.009537274949252605, 0.004543549846857786, -0.012682067230343819, -0.0053281402215361595, -0.01825137250125408, -0.02068231627345085, 0.0468953512609005, 0.0014871845487505198, 0.013125810772180557, -0.02070804126560688, 0.01830282062292099, 0.011119317263364792, -0.003144792513921857, -0.000605726265348494, 0.01061769388616085, 0.0055146412923932076, 0.023782091215252876, -0.02477247640490532, 0.03202671930193901, 0.007421453017741442, -0.02775649167597294, 0.0236920565366745, 0.02311326004564762, 0.02126111276447773, -0.02935139648616314, 0.00956299901008606, -0.0011825127294287086, -0.013916832394897938, -0.045351896435022354, -0.0055982451885938644, -0.0010643418645486236, -0.03182092681527138, 0.011421578004956245, 0.005212381016463041, -0.04450299218297005, 0.010919954627752304, -0.01467569824308157, -0.019203171133995056, -0.0037878993898630142, 0.023627744987607002, -0.013222277164459229, -0.017955543473362923, -0.019859138876199722, 0.0028071613050997257, 0.005196303129196167, -0.011794579215347767, 0.039280965924263, 0.008913461118936539, -0.008244629949331284, 0.010161087848246098, -0.018457166850566864, 0.0086240628734231, -0.0024180817417800426, 0.0236920565366745, -0.04200774058699608, 0.006369973532855511, 0.019717656075954437, -0.019267480820417404, -0.04524899646639824, 0.008707666769623756, -0.01880444400012493, 0.012341220863163471, 0.002082058461382985, 0.0070227268151938915, -0.03398176655173302, -0.007247813977301121, 0.01533166691660881, 0.025749998167157173, -0.006328171584755182, -0.06626573204994202, 0.01398114301264286, 0.007408590987324715, -0.012302634306252003, 0.014006867073476315, 0.03745454177260399, -0.018624374642968178, -0.017955543473362923, 0.012032529339194298, 0.04658665880560875, 0.031100647523999214, 0.015794703736901283, 0.029454294592142105, -0.023061811923980713, -0.03251548111438751, 0.009048513136804104, -0.002297499217092991, 0.024643855169415474, 0.024849649518728256, 0.04139035567641258, 0.038869377225637436, -0.018920203670859337, 0.005948738195002079, 0.024077920243144035, -0.01373676210641861, -0.020527970045804977, -0.0077622998505830765, -0.0014799496857449412, 0.02014210633933544, 0.026547450572252274, -0.008456855081021786, 0.018971651792526245, 0.0051255617290735245, -0.018740134313702583, 0.0005502583226189017, 0.029274223372340202, 0.0013947379775345325, -0.009890982881188393, -0.03555094823241234, 0.028914084658026695, 0.011878183111548424, 0.00982024148106575, -0.04607217386364937, 0.00417054770514369, -0.029222775250673294, -0.004041926469653845, 0.032669827342033386, -0.028656840324401855, 0.036142606288194656, -0.009466532617807388, 0.02587861940264702, -0.0212353877723217, 0.010173950344324112, -0.007106330711394548, 0.012482703663408756, 0.003321646945551038, 0.007157779298722744, -0.012013236060738564, 0.008669080212712288, 0.037042953073978424, -0.006971278227865696, 0.04355119541287422, -0.01880444400012493, 0.0068362257443368435, -0.030894853174686432, -0.002599759493023157, 0.01453421451151371, -0.013415209017693996, -0.006746191065758467, -0.0773271694779396, 0.007202796638011932, 0.06384764611721039, 0.021878495812416077, 0.003926167264580727, 0.029762985184788704, -0.0058972896076738834, 0.029119879007339478, 0.00032798448228277266, -0.031152095645666122, -0.010392606258392334, -0.007980955764651299, 0.004553196486085653, 0.013942556455731392, -0.017029469832777977, 0.03380169719457626, 0.018148474395275116, -0.009460101835429668, -0.011492319405078888, -0.02584003284573555, 0.016514983028173447, -0.012431255541741848, -0.016746502369642258, -0.003807192435488105, -0.0018457166152074933, 0.006816932465881109, 0.04494030773639679, -0.022444428876042366, -0.028039459139108658, -0.0024823923595249653, -0.025711411610245705, 0.03336438164114952, -0.052889108657836914, 0.015022976323962212, -0.027113385498523712, 0.012379806488752365, 0.024965407326817513, -0.023267606273293495, -0.013222277164459229, 0.015151597559452057, 0.012701360508799553, -0.015704669058322906, 0.01935751549899578, -0.06888960301876068, 0.004263798240572214, 0.05463835969567299, -0.005025879945605993, 0.024939684197306633, -0.024926820769906044, 0.015601771883666515, 0.03627122566103935, -0.02018069289624691, 0.0020322175696492195, -0.012354082427918911, -0.031898099929094315, 0.004045141860842705, -0.015974774956703186, 0.013151534833014011, 0.00034024371416307986, -0.0060805752873420715, -0.019280344247817993, 0.014727147296071053, -0.00557573651894927, -0.00713848602026701, -0.013839659281075, 0.06348750740289688, -0.013608140870928764, 0.027936561033129692, -0.008489010855555534, 0.009498688392341137, -0.031589407473802567, 0.004890827462077141, -0.003239650744944811, 0.014611387625336647, 0.021917080506682396, 0.019589034840464592, -0.056387607008218765, 0.028168080374598503, -0.0130422068759799, 0.0249782707542181, -0.04460589215159416, 0.016322052106261253, -0.018379993736743927, -0.02634165622293949, 0.014264109544456005, -0.03794330358505249, -0.014341282658278942, -0.015691807493567467, -0.023884987458586693, 0.00029341751360334456, -0.01832854561507702, 0.0019598680082708597, 0.039280965924263, -0.05885713919997215, -0.009807378984987736, 0.017029469832777977, 0.057725269347429276, -0.019511861726641655, -0.025917205959558487, 0.0017524661961942911, -0.015756117179989815, 0.005492132622748613, 0.011942493729293346, -0.00666901795193553, -0.024052195250988007, -0.01253415271639824, -0.032386861741542816, -0.010328295640647411, -0.01751822978258133, -0.007723713293671608, -0.016322052106261253, 0.0060837906785309315, 0.013672451488673687, -0.03490784019231796, 0.01800699159502983, -0.07485763728618622, -0.037531714886426926, 0.0005056427326053381, 0.005678633693605661, 0.03663136437535286, -0.012193305417895317, -0.02120966464281082, -0.0074021597392857075, 0.005308846943080425, -0.03256693109869957, 0.015576047822833061, 0.007498625665903091, -0.0038329167291522026, -0.009080668911337852, 0.04229070618748665, -0.003334508975967765, 0.008514734916388988, 0.01387824583798647, 0.041287459433078766, -0.031023474410176277, -0.027833664789795876, 0.024862511083483696, -0.03197527304291725, 0.07002147287130356, -0.017016606405377388, -0.0012428039917722344, -0.012064684182405472, 0.013942556455731392, 0.034058939665555954, -0.0071320547722280025, 0.00019715244707185775, 0.012855705805122852, 0.0022556972689926624, -0.009736637584865093, -0.046972524374723434, 0.07341707497835159, -0.0004638408136088401, 0.012058253400027752, 0.034007489681243896, -0.026187309995293617, -0.010482641868293285, -0.02181418426334858, -0.007434315048158169, 0.020605143159627914, 0.0581883080303669, -0.007337849121540785, -0.048335909843444824, 0.012521290220320225, -0.04568631201982498, -0.008849150501191616, -0.011923201382160187, 0.010534089989960194, -0.003935813903808594, 0.017170952633023262, 0.014752871356904507, 0.05731368064880371, -0.06312736868858337, 0.016836537048220634, 0.0051416391506791115, 0.02963436394929886, 0.009749500080943108, 0.00036958546843379736, 0.008366820402443409, -0.024013610556721687, 0.020952420309185982, -0.01453421451151371, -0.02234153263270855, -0.016759363934397697, -0.029428569599986076, 0.0033280779607594013, 0.0038907963316887617, 0.022122874855995178, 0.012630618177354336, -0.011575923301279545, 0.007376435678452253, 0.051268476992845535, 0.03256693109869957, 0.0185343399643898, 6.782767741242424e-05, -0.010058190673589706, 0.009235014207661152, -0.06667731702327728, 0.028965532779693604, 0.007222089916467667, -0.020913835614919662, -0.01749250665307045, 0.02555706538259983, 0.02020641788840294, 0.0161419827491045, 0.015177321620285511, 0.0397697277367115, 0.003178555518388748, -0.01830282062292099, 0.01198751199990511, -0.021994253620505333, 0.018971651792526245, -0.030534712597727776, 0.013801072724163532, 0.02801373414695263, -0.02232866920530796, 0.026470277458429337, -0.001307114725932479, -0.004067650996148586, -0.0019132428569719195, -0.009640172123908997, 0.013415209017693996, -0.01825137250125408, -0.016334913671016693, 0.004289522767066956, 0.012456979602575302, 0.003826485713943839, -0.012366944923996925, 0.012836412526667118, 0.029711537063121796, -0.053197797387838364, -0.055873122066259384, 0.0727996975183487, -0.021454043686389923, -0.04115884006023407, 0.012051822617650032, -0.003238043049350381, 0.023216158151626587, 0.01592332497239113, -0.009350773878395557, -0.02932567149400711, -0.02632879465818405, -0.014559939503669739, -0.01007105316966772, 0.023023225367069244, -0.033235762268304825, 0.03555094823241234, 0.002992054680362344, 0.004244505427777767, 0.022225772961974144, -0.006424637511372566, -0.005222027655690908, 0.0007025942322798073, -0.02472102642059326, -0.006440714932978153, -0.012881429865956306, 0.00306279631331563, -0.005775099620223045, 0.015691807493567467, -0.014765732921659946, -0.01672077737748623, -0.032952796667814255, 0.014688560739159584, 0.02775649167597294, -0.0021978176664561033, -0.0397697277367115, 0.03683716058731079, -0.0002857806102838367, -0.003922951873391867, 0.02960863895714283, 0.012720653787255287, 0.028631117194890976, -0.03066333383321762, -0.04298526048660278, -0.032721277326345444, -0.02180132269859314, 0.020347900688648224, 0.04679245501756668, 0.026303069666028023, -0.021595528349280357, 0.00913211703300476, -0.0212353877723217, -0.03045753948390484, -0.02445092238485813, -0.03099774941802025, 0.02586575783789158, -0.0204379353672266, 0.023203294724225998, 0.01481718197464943, -0.03176947683095932, 0.04010414332151413, 0.05901148542761803, 0.06467082351446152, 0.012765671126544476, 0.006984140258282423, 0.03040609136223793, -0.02929994836449623, 0.02500399388372898, -0.005222027655690908, -0.014945803210139275, 0.022547326982021332, 0.002221934264525771, 0.01825137250125408, 0.03766033798456192, -0.030508989468216896, -0.0033730955328792334, 0.03174375370144844, -0.0051545011810958385, 0.0069198296405375, 0.02665034867823124, -0.014186937361955643, -0.005527503322809935, 0.043731264770030975, 0.001625452539883554, -0.013363759964704514, 0.01467569824308157, 0.04596927762031555, 0.020527970045804977, 0.03964110463857651, -0.030045952647924423, 0.0068490877747535706, 0.04931343346834183, -0.03650274500250816, 0.0009670719155110419, -0.01646353490650654, 0.016206292435526848, -0.012270478531718254, -0.017158091068267822, 0.0026897944044321775, -0.011794579215347767, -0.0271905567497015, -0.012611324898898602, -0.027627870440483093, -0.03907517343759537, -0.01289429236203432, -0.013865383341908455, -0.015987636521458626, -0.016617881134152412, -0.03398176655173302, -0.020000623539090157, -0.02176273614168167, 0.02662462368607521, -0.024630991742014885, 0.04558341205120087, -0.0013947379775345325, 0.020129244774580002, 0.015408840030431747, -0.014495627954602242, -0.024270853027701378, -0.006624000612646341, 0.06513386219739914, -0.01745392009615898, -0.008212474174797535, -0.02286887913942337, 0.028090907260775566, 0.0070098647847771645, -0.00485224137082696, 0.011408715508878231, -0.013569554314017296, -0.03897227346897125, 0.02126111276447773, 0.03223251551389694, 0.027602145448327065, 0.025158340111374855, -0.00026467867428436875, -0.009318618103861809, -0.0039133052341639996, 0.03125499188899994, -0.006874812301248312, 0.004771852865815163, 0.034058939665555954, -0.0010088739218190312, -0.00982667226344347, 0.02824525348842144, -0.016051946207880974, 0.0010981049854308367, 0.013428070582449436, 0.03606543317437172, -0.0015482797753065825, -0.01780119724571705, -0.01090709213167429, -0.015100148506462574, -0.029222775250673294, 0.020836662501096725, 0.03169230371713638, 0.06024624779820442, -0.043731264770030975, 0.008013111539185047, 0.006861950270831585, 0.023254742845892906, 0.014225523918867111, -0.06153246387839317, -0.021145353093743324, -0.02288174256682396, -0.0094215152785182, 0.003414897480979562, -0.031152095645666122, 0.0030000933911651373, -0.025364134460687637, -0.023061811923980713, 0.027859387919306755, 0.020540833473205566, 0.01641208678483963, -0.04249650239944458, -0.007087037432938814, 0.014148350805044174, 0.033724524080753326, 0.017003744840621948, -0.033004242926836014, -0.021364009007811546, 0.019306067377328873, -0.01398114301264286, 0.008546889759600163, 0.02286887913942337, 0.0016624311683699489, 0.0026512080803513527, 0.0004843398346565664, -0.0025370565708726645, 0.025376996025443077, -0.013125810772180557, 0.025711411610245705, -0.002627091482281685, 0.007980955764651299, -0.03663136437535286, 0.04985364153981209, 0.026200173422694206, -0.035705290734767914, -0.018097026273608208, 0.04414285346865654, -0.006090221926569939, 0.021685563027858734, 0.024167954921722412, -0.03382742032408714, -0.030611885711550713, -0.010746315121650696, 0.007254245225340128, -0.011125748045742512, 0.026187309995293617, 0.006151317153126001, 0.018109889701008797, 0.008527596481144428, 0.006829794961959124, 0.013350898399949074, 0.006604707334190607, 0.02313898503780365, -0.008990633301436901, 0.04684390127658844, -0.00809028372168541, -0.004916551988571882, 0.008913461118936539, -0.07125623524188995, -0.019023099914193153, -0.04710114747285843, 0.011871752329170704, 0.0008673903648741543, -0.02607155218720436, -0.010572676546871662, -0.025145478546619415, -0.0193317923694849, 0.014264109544456005, 0.017595402896404266, 0.0025724275037646294, -0.012829981744289398, 0.017543954774737358, -0.028708290308713913, -0.010257554240524769, 0.07388011366128922, 0.015164459124207497, -0.01780119724571705, 0.015949049964547157, 0.019974898546934128, -0.008000249043107033, 0.033004242926836014, 0.016039084643125534, -0.019499000161886215, -0.017415333539247513, -0.01938324049115181, 0.03526797890663147, 0.032412584871053696, 0.010707729496061802, -0.0036689245607703924, 0.002189778722822666, 0.023229019716382027, 0.0065532587468624115, 0.016746502369642258, -0.003861856646835804, 0.03763461112976074, 0.043242502957582474, 0.002448629355058074, -0.024309439584612846, -0.007916645146906376, -0.006694742478430271, 0.013479519635438919, -0.039666831493377686, 0.03534515202045441, 0.07105044275522232, 0.02126111276447773, -0.023872125893831253, 0.002504901262000203, -0.0161419827491045, -0.021621251478791237, 0.03709440305829048, -0.02261163666844368, -0.010675573721528053, -0.01749250665307045, -0.01911313645541668, 0.012032529339194298, -0.004984077997505665, 0.02102959342300892, 0.0036528469063341618, -0.019434688612818718, 0.01858578808605671, -0.007556505501270294, -0.03207816928625107, 0.005270260851830244, 0.0048554567620158195, 0.02042507380247116, 0.0026801477652043104, 0.022663084790110588, -0.01908741146326065, -0.0005542777362279594, -0.025672825053334236, 0.014791457913815975, 0.03207816928625107, 0.015563185326755047, 0.012122564017772675, -0.022997500374913216, 0.004517825786024332, -0.0007580621750093997, 0.017955543473362923, -0.02075948938727379, -0.015691807493567467, -0.00823176745325327, -0.013903969898819923, -0.015087286941707134, 0.00956299901008606, -0.0009944039629772305, 0.0263931043446064, 0.02501685731112957, -0.008405406959354877, -3.9340051444014534e-05, 0.017968405038118362, -0.02958291582763195, -0.027087660506367683, 0.032283965498209, 0.027267729863524437, -0.0172481257468462, -0.013299449346959591, -0.0034213284961879253, 0.023756366223096848, -0.02290746569633484, -0.009112823754549026, 0.025917205959558487, -0.020000623539090157, -5.759071882494027e-06, -0.014186937361955643, 0.028708290308713913, 0.010444055311381817, -0.0029727614019066095, 0.021968530490994453, 0.034007489681243896, 0.03045753948390484, 0.010006742551922798, 0.00572365103289485, -0.0011463379487395287, 0.007357142399996519, 0.013749624602496624, 0.015138735063374043, 0.010051759891211987, -0.021364009007811546, -0.02066945470869541, 0.04061862826347351, -0.019228894263505936, -0.007672264706343412, -0.0023505555000156164, -0.009627309627830982, -0.018097026273608208, -0.010714160278439522, -0.0114473020657897, -0.0008995457319542766, -0.010038898326456547, -0.01750536821782589, -0.013106517493724823, -0.022740257903933525, -0.006003402639180422, -0.042933814227581024, 0.024322301149368286, 0.007376435678452253, 0.016064809635281563, -0.0012564699864014983, -0.026277346536517143, 0.028425322845578194, 0.03624550253152847, -0.004968000575900078, -0.02553134225308895, -0.01200037356466055, -0.005604675970971584, -0.01691371016204357, 0.019061686471104622, -0.005935876164585352, -0.01615484431385994, -0.001012089429423213, -0.023782091215252876, -0.011402284726500511, -0.01051479671150446, -0.009781654924154282, 0.01115147303789854, 0.027524972334504128, 0.035422325134277344, -0.029119879007339478, 0.007099899463355541, 0.010276847518980503, 0.019781965762376785, 0.005389235448092222, 0.0006282349932007492, -0.009517981670796871, 0.018174199387431145, 0.007112761959433556, 0.014367006719112396, -0.004408497363328934, 0.015177321620285511, -0.0017138797556981444, 0.025659963488578796, -0.04465733841061592, -0.0029534681234508753, -0.015035837888717651, 0.014238385483622551, -0.009260738268494606, -0.02201997861266136, -0.004038711078464985, 0.002602974884212017, 0.009691620245575905, 0.002895588520914316, 0.005341002251952887, 0.0016391185345128179, -0.016823675483465195, -0.018971651792526245, -0.018122751265764236, -0.024116506800055504, 0.0026576390955597162, 0.054741255939006805, -0.006829794961959124, 0.0031222838442772627, -0.004003339912742376, -0.0004698699340224266, -0.03210389241576195, 0.016064809635281563, 0.010141794569790363, 0.026058688759803772, 0.004964784719049931, 0.019035963341593742, 0.004511394537985325, -0.00022046506637707353, -0.004424575250595808, -0.018392855301499367, -0.02984015829861164, -0.00834109541028738, 0.02634165622293949, -0.005627185106277466, 0.005820116959512234, -0.0193317923694849, 0.02506830543279648, -0.0064728702418506145, 0.00015454660751856863, 0.007363573648035526, 0.022238634526729584, -0.044760238379240036, -0.016193430870771408, -0.0072928317822515965, 0.0169394351541996, -0.010038898326456547, 0.025235513225197792, -0.02176273614168167, -0.0008296078303828835, 0.0034213284961879253, 0.011543767526745796, -0.026521725580096245, 0.003861856646835804, 0.006945554167032242, -0.0039133052341639996, 0.046097900718450546, 0.013569554314017296, 0.012521290220320225, -0.0011616117553785443, 0.020849524065852165, -0.061172325164079666, -0.013659589923918247, 0.025171201676130295, 0.004074081778526306, -0.02099100686609745, 0.01293930970132351, -0.015035837888717651, 0.026290208101272583, 0.013402346521615982, -0.003897227579727769, -0.017093779519200325, 0.04331967607140541, -0.004913336131721735, 0.013711038045585155, 0.03894655033946037, 0.011067869141697884, -0.007858765311539173, -0.0249782707542181, -0.009871690534055233, 0.03668281435966492, -0.00034989032428711653, -0.023872125893831253, 0.027242006734013557, -0.030251746997237206, 0.02317757159471512, 0.003344155615195632, 0.012006805278360844, -0.00699057150632143, 0.02234153263270855, -0.014315558597445488, 0.017659714445471764, 0.035962533205747604, 0.03421328589320183, 0.012804257683455944, -0.02126111276447773, 0.016283465549349785, 0.0012661166256293654, 0.010643417946994305, 0.0011382991215214133, -0.006382835563272238, -0.007511488161981106, -0.023769229650497437, -0.026856141164898872, 0.0032991380430758, 0.009858828037977219, 0.015666082501411438, 0.0025483109056949615, -0.0163863617926836, -0.03740309551358223, -0.05386662855744362, 0.022200047969818115, -0.005820116959512234, 0.0005390039295889437, -0.005816901568323374, 0.025711411610245705, 0.017042331397533417, -0.004058004356920719, -0.0016286680474877357, -0.014637111686170101, 0.0026881867088377476, -0.038329169154167175, 0.007633678149431944, -0.016090532764792442, -0.02904270589351654, -0.006578983273357153, 0.014958665706217289, 0.01664360612630844, 0.012662773951888084, 0.005170579068362713, -0.007620816119015217, 0.020553695037961006, 0.03043181635439396, -0.013428070582449436, 0.033775970339775085, -0.02424512803554535, 0.02586575783789158, 0.008688373491168022, 0.02205856516957283, -0.008971340954303741, -0.009408652782440186, -0.008656218647956848, 0.011601647362112999, -0.015820428729057312, 0.007170641329139471, -0.014804319478571415, 0.025621376931667328, 0.010579107329249382, -0.013350898399949074, 0.014971527270972729, -0.04486313462257385, 0.012572739273309708, 0.009595153853297234, -0.015267356298863888, 0.010932816192507744, 0.013248001225292683, 0.009370067156851292, 0.05921727791428566, 0.01263704989105463, 0.0028103769291192293, -0.0006278330693021417, 0.018199924379587173, 0.01318369060754776, 0.013466657139360905, 0.021171078085899353, 0.0038457789923995733, 0.020309314131736755, 0.024579543620347977, -0.017633989453315735, 0.0169394351541996, 0.027113385498523712, -0.03462487459182739, 0.00026889904984273016, 0.008489010855555534, 0.03758316487073898, -0.0060805752873420715, 0.011903908103704453, -0.018238510936498642, -0.022778844460844994, 0.04298526048660278, -0.003024209989234805, -0.0016093748854473233, -0.046663831919431686, -0.030328918248414993, -0.008585476316511631, -0.021737011149525642, 0.012161150574684143, 0.029943054541945457, -0.015550323761999607, 0.000653155380859971, -0.00659184530377388, -0.03786613047122955, 0.015588910318911076, 0.04151897877454758, 0.008829857222735882, -0.008714097552001476, -0.02531268633902073, 0.006701173260807991, -0.017402471974492073, -0.012373375706374645, -0.031126370653510094, 0.006058066617697477, 0.0014678913867101073, 0.023563435301184654, -0.0043892040848731995, -0.0033698799088597298, -0.03393031656742096, 0.013235138729214668, -0.012585600838065147, -0.0046689556911587715, 0.015138735063374043, 0.04445154592394829, -0.04151897877454758, -0.025094028562307358, 0.044014234095811844, -0.03984690085053444, 0.00604520458728075, -0.032412584871053696, -0.03318431228399277, -0.026251621544361115, 0.026444554328918457, -0.008759114891290665, 0.012778532691299915, -0.011421578004956245, 0.007813747972249985, 0.0005498563405126333, -0.00863049365580082, -0.03758316487073898, 0.0048715341836214066, 0.005984109360724688, 0.001754073891788721]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:18:02.063127", "url_path": "/examples/chat-app/", "chunk_size": 4123}
updated_dt: 2025-03-15T11:18:02.064715
---
Table of contents 
  * [ Running the Example  ](https://ai.pydantic.dev/examples/chat-app/#running-the-example)
  * [ Example Code  ](https://ai.pydantic.dev/examples/chat-app/#example-code)


# Chat App with FastAPI
Simple chat app example build with FastAPI.
Demonstrates:
  * [reusing chat history](https://ai.pydantic.dev/message-history/)
  * [serializing messages](https://ai.pydantic.dev/message-history/#accessing-messages-from-results)
  * [streaming responses](https://ai.pydantic.dev/results/#streamed-results)


This demonstrates storing chat history between requests and using it to give the model context for new responses.
Most of the complex logic here is between `chat_app.py` which streams the response to the browser, and `chat_app.ts` which renders messages in the browser.
## Running the Example
With [dependencies installed and environment variables set](https://ai.pydantic.dev/examples/#usage), run:
[pip](https://ai.pydantic.dev/examples/chat-app/#__tabbed_1_1)[uv](https://ai.pydantic.dev/examples/chat-app/#__tabbed_1_2)
```
python-mpydantic_ai_examples.chat_app

```

```
uvrun-mpydantic_ai_examples.chat_app

```

Then open the app at [localhost:8000](http://localhost:8000).
[![Example conversation](https://ai.pydantic.dev/img/chat-app-example.png)](https://ai.pydantic.dev/img/chat-app-example.png)
## Example Code
Python code that runs the chat app:
chat_app.py```
from__future__import annotations as _annotations
importasyncio
importjson
importsqlite3
fromcollections.abcimport AsyncIterator
fromconcurrent.futures.threadimport ThreadPoolExecutor
fromcontextlibimport asynccontextmanager
fromdataclassesimport dataclass
fromdatetimeimport datetime, timezone
fromfunctoolsimport partial
frompathlibimport Path
fromtypingimport Annotated, Any, Callable, Literal, TypeVar
importfastapi
importlogfire
fromfastapiimport Depends, Request
fromfastapi.responsesimport FileResponse, Response, StreamingResponse
fromtyping_extensionsimport LiteralString, ParamSpec, TypedDict
frompydantic_aiimport Agent
frompydantic_ai.exceptionsimport UnexpectedModelBehavior
frompydantic_ai.messagesimport (
  ModelMessage,
  ModelMessagesTypeAdapter,
  ModelRequest,
  ModelResponse,
  TextPart,
  UserPromptPart,
)
# 'if-token-present' means nothing will be sent (and the example will work) if you don't have logfire configured
logfire.configure(send_to_logfire='if-token-present')
agent = Agent('openai:gpt-4o', instrument=True)
THIS_DIR = Path(__file__).parent

@asynccontextmanager
async deflifespan(_app: fastapi.FastAPI):
  async with Database.connect() as db:
    yield {'db': db}

app = fastapi.FastAPI(lifespan=lifespan)
logfire.instrument_fastapi(app)

@app.get('/')
async defindex() -> FileResponse:
  return FileResponse((THIS_DIR / 'chat_app.html'), media_type='text/html')

@app.get('/chat_app.ts')
async defmain_ts() -> FileResponse:
"""Get the raw typescript code, it's compiled in the browser, forgive me."""
  return FileResponse((THIS_DIR / 'chat_app.ts'), media_type='text/plain')

async defget_db(request: Request) -> Database:
  return request.state.db

@app.get('/chat/')
async defget_chat(database: Database = Depends(get_db)) -> Response:
  msgs = await database.get_messages()
  return Response(
    b'\n'.join(json.dumps(to_chat_message(m)).encode('utf-8') for m in msgs),
    media_type='text/plain',
  )

classChatMessage(TypedDict):
"""Format of messages sent to the browser."""
  role: Literal['user', 'model']
  timestamp: str
  content: str

defto_chat_message(m: ModelMessage) -> ChatMessage:
  first_part = m.parts[0]
  if isinstance(m, ModelRequest):
    if isinstance(first_part, UserPromptPart):
      assert isinstance(first_part.content, str)
      return {
        'role': 'user',
        'timestamp': first_part.timestamp.isoformat(),
        'content': first_part.content,
      }
  elif isinstance(m, ModelResponse):
    if isinstance(first_part, TextPart):
      return {
        'role': 'model',
        'timestamp': m.timestamp.isoformat(),
        'content': first_part.content,
      }
  raise UnexpectedModelBehavior(f'Unexpected message type for chat app: {m}')