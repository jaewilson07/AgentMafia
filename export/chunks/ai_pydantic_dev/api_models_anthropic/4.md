---
url: https://ai.pydantic.dev/api/models/anthropic/
session_id: pydantic_ai_docs
chunk_number: 4
title: Processing Anthropic API Responses
summary: This section explains how to handle API responses from the Anthropic model, including error handling for API status errors and processing non-streamed response content into structured message parts.
embedding: [0.009084549732506275, 0.036194756627082825, -0.03002682700753212, -0.033373765647411346, -0.016818370670080185, -0.03308688476681709, -0.015168807469308376, -0.002947996137663722, 0.03193936496973038, -0.024002335965633392, -0.0012790089240297675, -0.05259476229548454, 0.004186662379652262, 0.02407405711710453, -0.02823382429778576, -0.006233674474060535, 0.005089140962809324, 0.02768396958708763, 0.017451897263526917, 0.057471729815006256, 0.057615168392658234, 0.01794198527932167, -0.010297815315425396, 0.0193046685308218, 0.008988922461867332, 0.0032094756606966257, -0.02409796230494976, 0.060675229877233505, 0.00465583149343729, -0.037533532828092575, 0.01571866124868393, -0.014714580029249191, -0.03272828459739685, -0.0681341215968132, 0.016053354367613792, 0.011080759577453136, -0.043892718851566315, 0.01617288962006569, 0.0024848035536706448, 0.027923036366701126, -0.007686006836593151, -0.027540529146790504, -0.014726532623171806, 0.03629038482904434, -0.030696215108036995, 0.05589388683438301, -0.015085133723914623, 0.03282391279935837, -0.012043004855513573, 0.029644319787621498, -0.007542566861957312, 0.01660320907831192, 0.025675805285573006, -0.01937638781964779, -0.0063651613891124725, -0.011499127373099327, -0.03774869441986084, -0.01276618242263794, -0.009975074790418148, 0.018097378313541412, -0.004530321341007948, -0.04695277661085129, -0.018587466329336166, -0.004431706387549639, -0.04692887142300606, -0.020810790359973907, -0.03595568984746933, 0.0223049595952034, -0.019687175750732422, 0.004957654047757387, -0.01712915673851967, 0.03229796513915062, -0.036194756627082825, 0.002274125814437866, -0.027516622096300125, -0.0061798845417797565, -0.02629738114774227, 0.011839797720313072, -0.018958020955324173, -0.008564578369259834, -0.01338775735348463, 0.011833821423351765, -0.018730906769633293, -0.022627700120210648, -0.02813819609582424, -0.028831491246819496, -0.0726763978600502, -0.02361982874572277, -0.03858542814850807, -0.024767350405454636, -0.0005793641321361065, 0.013065016828477383, -0.022316914051771164, 0.023966476321220398, 0.06684315949678421, 0.007016619201749563, -0.0419323667883873, 0.03559708967804909, 0.018969973549246788, 0.03186764195561409, 0.06014928221702576, -0.015073180198669434, -0.0619661919772625, 0.035788342356681824, 0.043988343328237534, -0.04740700498223305, 0.011708310805261135, 0.01665102317929268, -0.029333531856536865, -0.0059079453349113464, -0.03351720795035362, 0.0026760571636259556, -0.006078280974179506, 0.010512975044548512, -0.03724665194749832, -0.013483383692800999, -0.038011666387319565, 0.02144431881606579, 0.017523618414998055, -0.005190744064748287, -0.03495160862803459, -0.0038310501258820295, -0.0061201173812150955, -0.029739946126937866, -0.030337614938616753, -0.03263265639543533, 0.013292130082845688, -0.054746363312006, -0.04860233888030052, -0.0016689870972186327, 0.05780642479658127, 0.011774054728448391, 0.00842711515724659, -0.06799068301916122, -0.017583385109901428, -0.01047113910317421, 0.01481020636856556, -0.02293848805129528, -0.013818077743053436, 0.04092828556895256, 0.025125950574874878, -0.002885241061449051, -0.052546948194503784, -0.010608602315187454, -0.0031586738768965006, 0.008648252114653587, -0.04824373871088028, -0.006610204931348562, -0.023787176236510277, -0.020428283140063286, 0.01103892270475626, 0.00964038074016571, -0.025819245725870132, 0.005821283906698227, 0.01451137289404869, 0.0010929849231615663, 0.01564694195985794, 0.005104082636535168, 0.030648401007056236, -0.03287172690033913, -0.01390175148844719, -0.01318455021828413, -0.046116042882204056, 0.0016510571585968137, -0.02730146236717701, -0.0223049595952034, -0.027827410027384758, -0.010285861790180206, -0.034353941679000854, -0.040737032890319824, -0.031604669988155365, -0.02507813833653927, -0.05775861069560051, 0.023380761966109276, -0.028951024636626244, -0.03631429001688957, -0.06564782559871674, -0.07731429487466812, -0.013076970353722572, -0.017188923433423042, -0.030170267447829247, 0.0036069247871637344, -0.04245831444859505, -0.0472874715924263, -0.0011490161996334791, 0.011744171380996704, 0.015276387333869934, 0.01339971087872982, 0.01276618242263794, 0.022065892815589905, 0.0026177847757935524, 0.04009155184030533, 0.04762216657400131, -0.005095117259770632, -0.027970850467681885, -0.049821581691503525, 0.05833237245678902, -0.021695338189601898, -0.007602333556860685, 0.00932361651211977, 0.02185073308646679, 0.01114052627235651, 0.03631429001688957, -0.0382029227912426, 0.02275918796658516, -0.025149857625365257, -0.00799679383635521, 0.04085656628012657, -0.00615000119432807, -0.0322023369371891, 0.011146503500640392, -0.052021000534296036, 0.014355978928506374, 0.013889797963202, -0.01124212983995676, -0.0032572890631854534, -0.08137843757867813, -0.020786883309483528, -0.05967114493250847, 0.021814871579408646, -0.04178892821073532, 0.046976685523986816, 0.043892718851566315, 0.01705743744969368, -0.04604432359337807, 0.03258484601974487, -0.030122453346848488, -0.03421049937605858, -0.020727116614580154, 0.007907143794000149, 0.00020750275871250778, 0.02593877911567688, 0.010614578612148762, -0.018981928005814552, -0.002283090725541115, -0.05957552045583725, 0.01814519241452217, -0.027373181656003, 0.03583615645766258, -0.014487465843558311, 0.01839621365070343, 0.002959949430078268, -0.0022681490518152714, -0.01225218828767538, 0.0029166184831410646, 0.01948396861553192, 0.005313266068696976, -0.0050024790689349174, -0.013722451403737068, 0.04229096695780754, 0.04766997694969177, -0.08104374259710312, -0.011666473932564259, 0.0008158164564520121, -0.012216328643262386, -0.012706415727734566, 0.008803646080195904, 0.019519828259944916, -0.060244906693696976, -0.013507290743291378, 0.037485718727111816, 0.07057260721921921, -0.03464082255959511, 0.03774869441986084, 0.01550350058823824, -0.014009331353008747, 0.012222304940223694, -0.005937829148024321, 0.03184373676776886, -0.04547056183218956, 0.007124199531972408, 0.04865015298128128, 0.03688805177807808, -0.00404919870197773, -0.044848985970020294, -0.00476938858628273, 0.027468809857964516, -0.0013596940552815795, 0.0071660359390079975, -0.014893880113959312, 0.013327990658581257, 0.00941326655447483, 0.05900175869464874, 0.002850875025615096, -0.021085716784000397, -0.004613995086401701, 0.05465073883533478, -0.04353411868214607, -0.0071660359390079975, -0.03136560320854187, 0.017272597178816795, 0.028927117586135864, 0.014929739758372307, -0.013519244268536568, 0.04030671343207359, 0.025221578776836395, 0.0071481061168015, -0.00076725595863536, -0.0014329083496704698, -0.009216036647558212, 0.009562683291733265, -0.015443733893334866, 0.025747526437044144, 0.011272013187408447, -0.004882945213466883, -0.00425240583717823, 0.00839125458151102, -0.05130379647016525, 0.019161228090524673, -0.008594461716711521, 0.05622858181595802, 0.012778135947883129, -0.03198717534542084, -0.03684023767709732, -0.03002682700753212, -0.016208749264478683, 0.011134549975395203, -0.024815164506435394, 0.03504723682999611, -0.020404376089572906, -0.04740700498223305, 0.02553236484527588, -0.008337465114891529, -0.007739797234535217, 0.004733528476208448, 0.010686298832297325, -0.0028598401695489883, -0.008361371234059334, -0.015658894553780556, 0.04876968637108803, -0.006675948388874531, 9.805486479308456e-05, -0.0034664729610085487, 0.0369836799800396, 0.024647817015647888, 0.011929447762668133, -0.042936451733112335, -0.018934113904833794, 0.019878428429365158, 0.03832245618104935, 0.011044899933040142, -0.01635218970477581, -0.03990029916167259, -0.005244534462690353, -0.02677551470696926, -0.003191545605659485, 0.007309476379305124, 0.029859479516744614, -0.009915308095514774, 0.015886008739471436, 0.026703793555498123, 0.02462390996515751, -0.009664286859333515, 0.001409001648426056, 0.01015437487512827, -0.002850875025615096, 0.016567349433898926, 0.011272013187408447, -0.005435788072645664, 0.017200877889990807, -0.002840415807440877, 0.018360352143645287, 0.008205978199839592, -0.015085133723914623, -0.013961518183350563, 0.045231495052576065, -0.009706123732030392, -0.03002682700753212, -0.024910790845751762, -0.032513123005628586, -0.004401823040097952, -0.015192713588476181, -0.04910438135266304, -0.009849564172327518, -0.024432657286524773, -0.004829155281186104, 0.013853938318789005, 0.0037115165032446384, 0.019723035395145416, 0.00579140055924654, 0.0708116739988327, -0.009341546334326267, 0.018324492499232292, -0.01459504570811987, -0.027588343247771263, 0.0483393669128418, 0.02816210314631462, 0.0013821066822856665, -0.035166770219802856, 0.017320411279797554, 0.016184842213988304, -0.06660409271717072, -0.03227405622601509, 0.051208171993494034, 0.0062575810588896275, 0.05402916297316551, 0.0022995267063379288, 0.017224784940481186, 0.0204402357339859, 0.00934752356261015, -0.0024638851173222065, 0.031676389276981354, 0.005773470271378756, 0.013913705013692379, 0.003974490333348513, 0.03320641815662384, -0.016639070585370064, 0.0013357873540371656, 0.03083965554833412, 0.008152187801897526, 0.06450030207633972, -0.07568864524364471, 0.012126678600907326, 0.012503208592534065, 0.013339944183826447, -0.05967114493250847, 0.015156853944063187, 0.019424201920628548, 0.005393951199948788, -0.029692132025957108, -0.015073180198669434, -0.0363381989300251, 0.009496940299868584, 0.003075000597164035, -0.020954230800271034, 0.04676152393221855, 0.02634519338607788, -0.04186064749956131, 0.021539945155382156, -0.025819245725870132, -0.029453065246343613, -0.0024384844582527876, 0.059766773134469986, 0.01167245116084814, 0.017380177974700928, 0.02255598083138466, 0.013017203658819199, 0.013734404928982258, -0.02460000477731228, 0.0016077262116596103, 0.04920000955462456, -0.029333531856536865, -0.03497551754117012, 0.02505423128604889, -0.008696065284311771, -0.012682509608566761, -0.02132478542625904, 0.037939947098493576, -0.009490964002907276, -0.04061749950051308, 0.014953646808862686, -0.0231177881360054, 0.008194024674594402, 0.001981268636882305, -0.07133761793375015, -0.06669972091913223, 0.03815510869026184, 0.0412868857383728, 0.05187755823135376, -0.020141402259469032, 0.06861225515604019, 0.003481414634734392, -0.0027104231994599104, -0.019364435225725174, -0.032991260290145874, -0.008965016342699528, -0.019997961819171906, 0.00649664830416441, -0.017368223518133163, 0.016065308824181557, 0.009903354570269585, 0.018981928005814552, -0.02641691453754902, 0.020858604460954666, 0.010554811917245388, -0.07219826430082321, 0.007040525786578655, 0.025819245725870132, 0.01146924402564764, 0.0229145810008049, 0.026584260165691376, -0.047144029289484024, -0.005650948267430067, 0.02198221907019615, -0.025197671726346016, 0.09715686738491058, -0.016435863450169563, -0.014702626504004002, -0.012210351414978504, 0.04415569081902504, -0.020858604460954666, 0.01612507551908493, -0.0317959226667881, -0.012102771550416946, 0.03492770344018936, -0.017392130568623543, -0.02957259863615036, 0.018659187480807304, 0.021707292646169662, 0.020201168954372406, -0.030720122158527374, -0.02198221907019615, -0.021862685680389404, 0.0005274417926557362, 0.03817901387810707, 0.03770088031888008, 0.010961226187646389, 0.03803557530045509, -0.027827410027384758, 0.0574239157140255, -0.019926242530345917, -0.017499711364507675, -0.012670556083321571, 0.020930323749780655, 0.03048105351626873, 0.012849856168031693, 0.0028613342437893152, -0.006891109049320221, 0.01928076148033142, 0.009610497392714024, 0.02155189774930477, -0.021492131054401398, 0.023607876151800156, -0.009490964002907276, 0.024014288559556007, -0.012802042998373508, -0.0033080908469855785, 0.000428079511038959, -0.051590677350759506, 0.02634519338607788, 0.04468163847923279, -0.017427990213036537, 0.02780350297689438, -0.003287172643467784, -0.014009331353008747, -0.017702918499708176, -0.024193590506911278, -0.008080467581748962, 0.0006697613862343132, 0.006293441168963909, 0.0006226950790733099, 0.009024783037602901, -0.01751166395843029, -0.03829854726791382, 0.011015016585588455, 0.0061798845417797565, 0.0033349860459566116, 0.04401225224137306, 0.012658602558076382, -0.01247930247336626, 0.014367932453751564, -0.038465894758701324, 0.01960350200533867, -0.03368455171585083, 0.00012700438674073666, 0.004625948145985603, -0.01034562848508358, 0.0016630104510113597, 0.015312246978282928, -0.008397231809794903, 0.00638309121131897, 0.011803938075900078, 0.045781347900629044, 0.030791841447353363, -0.01998600922524929, 0.04630729556083679, 0.021755104884505272, 0.006538485176861286, -0.013698544353246689, 0.0015927845379337668, 0.01521662063896656, -0.030337614938616753, -0.012754229828715324, -0.04453819990158081, 0.007883237674832344, 0.0011639578733593225, 0.020978137850761414, -0.002317456528544426, -0.0191014613956213, -0.02096618339419365, -0.0066879019141197205, -0.0025893955025821924, 0.014451606199145317, 0.010417348705232143, -0.029381345957517624, 0.006454811431467533, -0.009975074790418148, -0.0011378099443390965, -0.00851676519960165, -0.009227990172803402, 0.015551314689218998, -0.03762916103005409, 0.012383675202727318, 0.023930616676807404, -0.03734228014945984, -0.006950875744223595, 5.6638356909388676e-05, -0.020404376089572906, -0.04243440926074982, -0.00910845585167408, 0.05426822975277901, -0.007799563929438591, -0.005755540449172258, 0.010554811917245388, -0.03268047049641609, -0.014451606199145317, 0.021707292646169662, -0.013662684708833694, -0.04604432359337807, 0.011074783280491829, 0.03693586587905884, 0.00035710647352971137, -0.018109332770109177, 0.0009435679530724883, 0.028329450637102127, -0.010411371476948261, 0.014212538488209248, -0.01846793293952942, 0.060101468116045, -0.0014926751609891653, 0.0002230047684861347, 0.05947989225387573, 0.01980670914053917, -0.0008875365601852536, 0.009227990172803402, 0.0031825806945562363, 0.030313707888126373, 0.009634403511881828, 0.00669985543936491, 0.035262394696474075, 0.04637901484966278, 0.002868805080652237, 0.039852485060691833, 0.028425076976418495, -0.03868105635046959, 0.04783732444047928, 0.05307289585471153, -0.01521662063896656, 0.0016540454234927893, -0.038896214216947556, -0.00612609414383769, 0.01479825284332037, 0.0029509845189750195, -0.019639361649751663, -0.00016006288933567703, -0.012395628727972507, -0.03198717534542084, 0.046570271253585815, 0.0033260209020227194, -0.027181928977370262, 0.016866182908415794, -0.015551314689218998, -0.01367463730275631, 0.022795047610998154, 0.01184577401727438, 0.006837318651378155, 0.011690380983054638, 0.0059348405338823795, -0.009783821180462837, 0.00811035092920065, -0.024886883795261383, 0.007315453141927719, -0.017296504229307175, 0.05273820087313652, -0.0031526973471045494, 0.034282222390174866, 0.013865891844034195, 0.019041694700717926, 0.033875808119773865, 0.010758019052445889, 0.010632509365677834, 0.01076399628072977, 0.028353357687592506, -0.013710497878491879, 0.00020096577645745128, -0.013746357522904873, 0.01812128536403179, -0.032967351377010345, 0.0009898871649056673, 0.016997670754790306, -0.01106282975524664, -0.024815164506435394, -0.03440175577998161, 0.00863032229244709, 0.06779942661523819, -0.0011295920703560114, 0.025747526437044144, -0.000922649574931711, -0.007273616269230843, 0.01905364729464054, -0.011505103670060635, -0.07181575149297714, 0.0010100584477186203, -0.03280000388622284, 0.06818193197250366, 0.0033260209020227194, -0.02427726238965988, 0.05125598609447479, -0.009616473689675331, -0.0003074253327213228, -0.007662100251764059, -0.004957654047757387, -0.027660062536597252, -0.003493367927148938, -0.012455395422875881, -0.02442070282995701, 0.022221285849809647, 0.018228866159915924, 0.03970904275774956, 0.001920007634907961, -0.03007464110851288, -0.03808338940143585, -0.014893880113959312, 0.03676851838827133, -0.036146946251392365, 0.021910499781370163, 0.022591840475797653, 0.0038669102359563112, 0.025102045387029648, 0.016866182908415794, 0.004900875501334667, 0.00680145900696516, -0.06560000777244568, 0.046976685523986816, 0.005438776221126318, -0.0317959226667881, 0.017834404483437538, 0.040258899331092834, 0.019974054768681526, 0.03425831347703934, -0.0007971393642947078, 0.005612100008875132, 0.004772376734763384, -0.03559708967804909, -0.01935248076915741, -0.028329450637102127, -0.036194756627082825, -0.009873471222817898, 0.001284238533116877, 0.011738194152712822, 0.008749855682253838, 0.006532508414238691, 0.0010451714042574167, -0.0499650239944458, -0.014128864742815495, -0.01228804886341095, -0.03880058974027634, 0.01746385172009468, -0.04513586685061455, 0.02505423128604889, -0.02589096687734127, 0.0070046656765043736, -0.017846358940005302, -0.007452916819602251, 0.03186764195561409, -0.0011542458087205887, 0.020774930715560913, -0.005797376856207848, -0.05967114493250847, -0.035764437168836594, 0.016017494723200798, 0.026751607656478882, -0.01197128463536501, 0.017870265990495682, -0.0045392862521111965, -0.02954869344830513, 0.01726064458489418, 0.02114548347890377, 0.01660320907831192, -0.04637901484966278, 0.008229884319007397, 0.006293441168963909, 0.009496940299868584, 0.010746065527200699, 0.054363857954740524, -0.033349860459566116, 0.042960356920957565, -0.010208165273070335, 0.024337030947208405, -0.011248107068240643, -0.04059359058737755, 0.005525438115000725, -0.03827464208006859, -0.014367932453751564, 0.021276971325278282, 0.004389869514852762, -0.04406006634235382, -0.002679045544937253, -0.010226095095276833, 0.002965926192700863, -0.02442070282995701, 0.016483675688505173, 0.011546940542757511, 0.007524636574089527, 0.023428574204444885, -0.04284082353115082, 0.03923090919852257, -0.07669272273778915, 0.017774637788534164, 0.014869973063468933, -0.008277698419988155, 0.0014620446600019932, -0.009706123732030392, -0.04673761501908302, 0.01411691214889288, 0.0012551022227853537, -0.02768396958708763, 0.044323038309812546, 0.010925366543233395, 0.00013905113155487925, -0.019591547548770905, 0.03181983157992363, -0.005842201877385378, -0.033373765647411346, -0.013650731183588505, -0.011774054728448391, -0.035668808966875076, -0.004288265947252512, 0.01230000238865614, -0.0317959226667881, 0.01585014909505844, -0.024839071556925774, -0.029309624806046486, -0.01194737758487463, 0.03213061764836311, 0.02639300748705864, -0.04884140565991402, -0.025197671726346016, 0.010680322535336018, -0.010584695264697075, 0.008349418640136719, -0.05316852033138275, 0.0332542322576046, 9.5019830041565e-05, 0.008761809207499027, -0.008361371234059334, -0.038011666387319565, 0.023930616676807404, -0.018718954175710678, 0.0027851315680891275, 0.03459300845861435, 0.031150441616773605, 0.04781341925263405, -0.012885716743767262, -0.011301896534860134, -0.01657930202782154, 0.02394256927073002, 0.007315453141927719, -0.017607292160391808, -0.05962333455681801, 0.0012326897121965885, 0.03098309598863125, 0.03545365110039711, -0.04554228112101555, -0.004147814121097326, -0.004040233790874481, 0.03234577924013138, -0.031126536428928375, 0.016113122925162315, 0.0377965085208416, -0.017499711364507675, 0.005056269001215696, -0.031532950699329376, -0.015395920723676682, -0.019723035395145416, -0.03227405622601509, 0.0031706274021416903, -0.012945483438670635, 0.024205543100833893, 0.007016619201749563, 0.00015791502664797008, -0.01521662063896656, 0.0030197161249816418, -0.005656925030052662, 0.0382029227912426, 0.007948980666697025, 0.014128864742815495, 0.03734228014945984, -0.006191837601363659, -0.01769096404314041, 0.03050496056675911, -0.029955105856060982, -0.01004081778228283, 0.00505925714969635, 0.029476972296833992, -0.019472014158964157, 0.02048804983496666, 0.010919389314949512, -0.015479594469070435, -0.014176678843796253, -0.01844402588903904, -0.04857843369245529, 0.006075292360037565, -0.02768396958708763, 0.021013997495174408, 0.024671724066138268, -0.021456271409988403, 0.017320411279797554, 0.019005833193659782, -0.03880058974027634, -0.0017257655272260308, 0.014881926588714123, -0.004046210553497076, -0.021432364359498024, 0.023763269186019897, 0.017882218584418297, 0.045183680951595306, -0.014822159893810749, 0.007632216904312372, -0.0019110426073893905, 0.014439652673900127, -0.01746385172009468, -0.020344609394669533, 0.060770854353904724, -0.017021577805280685, -0.008851459249854088, 0.018324492499232292, -0.022615747526288033, 0.03373236581683159, -0.015240526758134365, 0.02134869061410427, 0.0006824618321843445, 0.023882802575826645, -0.014212538488209248, 0.02495860494673252, 0.006986735854297876, -0.011594753712415695, -0.0073034996166825294, -0.0016391037497669458, -0.04045015200972557, 0.019866475835442543, -0.037127118557691574, 0.04138251394033432, -0.0022293005604296923, -0.0249825119972229, -0.06822974979877472, -0.03263265639543533, 0.0012125184293836355, -0.013088922947645187, 0.04884140565991402, -0.0037384117022156715, -0.04102391377091408, -0.018228866159915924, 0.016471723094582558, 0.026106126606464386, 0.020547816529870033, -0.001740707317367196, 0.009771867655217648, -0.016065308824181557, -0.003430612850934267, 0.019651314243674278, -0.046187762171030045, 0.010829739272594452, -0.002534111263230443, -0.03225015103816986, -0.04272129014134407, 0.0010197705123573542, -0.02462390996515751, 0.03351720795035362, -0.049773767590522766, -0.01826472580432892, -0.010303791612386703, -0.03193936496973038, 0.014726532623171806, 0.0001891058054752648, -0.0009383383439853787, 0.02596268616616726, -0.05173411965370178, 0.011732217855751514, 0.010184258222579956, -0.04312770441174507, 0.02142041176557541, 0.0193046685308218, 0.04178892821073532, 0.013065016828477383, -0.008875365369021893, 0.04585306718945503, -0.0048650153912603855, 0.03915918990969658, 0.00011262301268288866, 0.002023105276748538, 0.0025430761743336916, -0.03538192808628082, -0.0013611882459372282, 0.0011056852526962757, 0.00374737661331892, 0.022567933425307274, 0.03370846062898636, 0.024480469524860382, -0.04422741383314133, 0.06454811245203018, 0.01983061619102955, -0.0017571431817486882, 0.02916618622839451, 0.05292945355176926, -0.020822742953896523, 0.024647817015647888, 0.026703793555498123, 0.03963732346892357, 0.0012543551856651902, -0.038370270282030106, 0.016722742468118668, 0.047144029289484024, -0.021731197834014893, -0.007082362659275532, -0.03280000388622284, 0.03088746778666973, -0.016029449179768562, -0.008122304454445839, -0.026608167216181755, -0.012813996523618698, -0.018659187480807304, -0.02200612612068653, -0.0004908346454612911, -0.02507813833653927, -0.011726240627467632, -0.033349860459566116, -0.00648469477891922, 0.021312830969691277, -0.014559186063706875, 0.03586006537079811, -0.018252773210406303, 0.011881634593009949, 0.00016333138046320528, 0.042482223361730576, 0.01206093467772007, 0.0071481061168015, 0.015766475349664688, -0.004201604053378105, -0.0415259525179863, 0.013292130082845688, 0.06273120641708374, -0.015168807469308376, -0.0002837053907569498, -0.017296504229307175, 0.004300219472497702, 0.031628575176000595, 0.023560062050819397, 0.04453819990158081, -0.014618952758610249, -0.022639654576778412, 0.005241545848548412, -0.020368516445159912, 0.012539069168269634, 0.02164752595126629, 0.009431196376681328, 0.004431706387549639, -0.0018721941160038114, 0.02076297625899315, -0.0003132152487523854, -0.006042420864105225, 0.03729446604847908, -0.028018662706017494, -0.004951677285134792, 0.0308635625988245, -0.004288265947252512, 0.0204402357339859, 0.014606999233365059, -0.004736516624689102, 0.02268746681511402, -0.001580831129103899, 0.02959650568664074, -0.006293441168963909, -0.02689504809677601, 0.0371510274708271, 0.023631781339645386, 0.021276971325278282, -0.01700962334871292, 0.0008158164564520121, -0.020786883309483528, 0.005761516746133566, 0.02541283145546913, -0.037055399268865585, -0.026918955147266388, -0.016160935163497925, 0.009502916596829891, 0.01213863119482994, -0.02820991724729538, -0.001011552638374269, -0.039254818111658096, -0.020930323749780655, 0.026201752945780754, 0.01653148978948593, 0.015933820977807045, -0.04100000485777855, 0.007901167497038841, 0.019950149580836296, -0.01227609533816576, 0.013148690573871136, 0.03172420337796211, -0.038418080657720566, 0.013519244268536568, -0.008953062817454338, 0.011654520407319069, 0.001072066486813128, 0.04104781895875931, 0.0009450620855204761, -0.008666181936860085, -0.024480469524860382, -0.013017203658819199, 0.022185426205396652, 0.011624637059867382, -0.010991109535098076, -0.015587174333631992, -0.05092129111289978, -0.020583676174283028, -0.017547525465488434, -0.036099132150411606, -0.0021979231387376785, 0.02997901290655136, 0.013280176557600498, 0.03373236581683159, 0.013065016828477383, 0.006616181693971157, -0.006544461473822594, -0.0028135208413004875, 0.012503208592534065, -0.05273820087313652, 0.02586705982685089, 0.009257873520255089, 0.02725364826619625, 0.01217449177056551, -0.013411663472652435, -0.025604085996747017, -0.009969097562134266, 0.00340072950348258, 0.006161954253911972, 0.062109630554914474, 0.024767350405454636, 0.024839071556925774, -0.015395920723676682, -0.044777266681194305, -0.0016645046416670084, -0.03810729458928108, -0.029835572466254234, -0.015180760063230991, -0.021181344985961914, -0.027779595926404, 0.01521662063896656, -0.02828163653612137, 0.001891618361696601, -0.003884840290993452, -0.030170267447829247, 0.010465161874890327, 0.00962842721492052, -0.022544026374816895, -0.005032362416386604, 0.06794286519289017, -0.012945483438670635, 0.0013477407628670335, 0.03762916103005409, -0.007954957894980907, 0.009712100960314274, 0.0007201895932666957, 0.022113706916570663, -0.008086444810032845, -0.041095633059740067, 0.002816509222611785, 0.030576681718230247, 0.013806124217808247, -0.0075724502094089985, -0.0010765490587800741, 0.0049457005225121975, 0.006879155524075031, 0.007261662743985653, 0.021970266476273537, 0.016639070585370064, 0.008959039114415646, 0.023524202406406403, -0.0058541554026305676, -0.015264433808624744, -0.0070943161845207214, 0.019472014158964157, -0.008032654412090778, -0.013698544353246689, 0.03002682700753212, 0.04489680007100105, -0.0172367375344038, -0.01928076148033142, -0.015443733893334866, -0.03002682700753212, -0.0032214291859418154, 0.02099009044468403, -0.0013372815446928144, -0.010064724832773209, 0.017320411279797554, -0.021539945155382156, 0.019746942445635796, 0.010572741739451885, -0.009514870122075081, 0.006849272176623344, 0.01296938955783844, 0.03263265639543533, 0.007464869879186153, -0.032943446189165115, -0.0020201168954372406, -0.011774054728448391, -0.013782218098640442, -0.0032632658258080482, 0.011026970110833645, -0.02639300748705864, -0.006968805566430092, -0.0035441697109490633, 0.00017042868421413004, 0.06980758905410767, 0.03559708967804909, -0.018981928005814552, 0.014822159893810749, 0.02405015006661415, 0.006424928084015846, -0.0008584003080613911, 0.001221483456902206, -0.008959039114415646, 0.01158280111849308, -0.02598659321665764, -0.022496214136481285, 0.02407405711710453, -0.008767785504460335, 0.022795047610998154, 0.013124783523380756, -0.00922201294451952, -0.013363850302994251, -0.009168223477900028, 0.010805832222104073, -0.01520466711372137, 0.03741399943828583, -0.008271721191704273, 0.02346443571150303, -0.03700758516788483, -0.010399418883025646, -0.005265452899038792, -0.027827410027384758, 0.00018835872469935566, 0.026201752945780754, -0.04135860875248909, 0.0028523693326860666, 0.0009667275589890778, 0.03186764195561409, 0.006305394694209099, -0.02155189774930477, 0.02008163556456566, -0.00019909806724172086, 0.013124783523380756, 0.018539652228355408, -0.001891618361696601, 0.04245831444859505, 0.045303214341402054, -0.003075000597164035, 0.022520119324326515, 0.029716039076447487, 0.028855398297309875, -0.06727348268032074, 0.01226414181292057, -0.03834636136889458, 0.014415745623409748, 0.003714504884555936, 0.00612609414383769, 0.0028209916781634092, 0.001742201391607523, 0.0101185142993927, 0.015575220808386803, -0.013507290743291378, -0.0313895083963871, 0.02430116944015026, 0.005136954132467508, 0.028472891077399254, -0.05106472969055176, 0.042027994990348816, 0.017631197348237038, 0.021814871579408646, -0.004709621891379356, -0.02359592169523239, 0.01541982777416706, 0.003403717651963234, -0.027014581486582756, -0.018910206854343414, -0.0019797743298113346, -0.0071421293541789055, 0.0308635625988245, 0.03452128916978836, -0.013961518183350563, -0.027540529146790504, -0.009078572504222393, 0.007739797234535217, -0.01550350058823824, -0.018181052058935165, 0.0015838195104151964, -0.017679011449217796, 0.03181983157992363, -0.006849272176623344, -0.03643382340669632, -0.02391866222023964, -0.00669985543936491, 0.019890382885932922, -0.01158280111849308, 0.022018078714609146, 0.023655688390135765, -0.008050584234297276, 0.017631197348237038, -0.026488633826375008, -0.02341662161052227, -0.007721866946667433, -0.014630906283855438, -0.028998838737607002, -0.006998688913881779, -0.04444257169961929, 0.02493469789624214, 0.0007948980783112347, -0.024408750236034393, -0.0012954447884112597, -0.006592275109142065, 0.020751023665070534, 0.02405015006661415, 0.021013997495174408, 0.014367932453751564, 0.026679888367652893, -0.018981928005814552, -0.04042624682188034, 0.010608602315187454, -0.0008875365601852536, -0.003983455244451761, 0.011511080898344517, -0.01564694195985794, 0.006227697711437941, 0.02734927460551262, -0.023500295355916023, -0.028759771957993507, 0.00854067225009203, -0.013937611132860184, 0.0229145810008049, -0.012019097805023193, 0.02298630028963089, 0.026488633826375008, 0.018432073295116425, 0.0007377461297437549, -0.022795047610998154, -0.01864723302423954, -0.005597158335149288, -0.008941109292209148, -0.03000291995704174, 0.022866766899824142, 0.01928076148033142, 0.012120701372623444, 0.00466778501868248, 0.0028762759175151587, 0.016890089958906174, 0.005848178640007973, -0.012132654897868633, -0.006460788194090128, -0.029763853177428246, 0.015288340859115124, -0.005083164200186729, 0.006167931016534567, -0.010847669094800949, -0.009897377341985703, -0.01837230660021305, -0.0056778434664011, -0.02087055705487728, -0.009419243782758713, 0.028903212398290634, -0.0048650153912603855, 0.022890673950314522, 0.006335278041660786, 0.02430116944015026, 0.008534695021808147, 0.018934113904833794, -0.025365019217133522, -0.007464869879186153, 0.012120701372623444, 0.016340235248208046, -0.023428574204444885, 0.0009547742083668709, -0.014858019538223743, 0.03423440828919411, 0.001740707317367196, 0.01940029487013817, -0.003672668244689703, -0.013029156252741814, -0.00669985543936491, 0.030122453346848488, 0.009765890426933765, -0.01864723302423954, -0.009915308095514774, 0.0009204082889482379, -0.012347815558314323, 0.025723619386553764, -0.007183966226875782, -0.05173411965370178, 0.004413776099681854, -0.0016779521247372031, -0.012455395422875881, -0.014212538488209248, 0.010811809450387955, 0.011768077500164509, 0.013029156252741814, 0.03327814117074013, 0.04083266109228134, 0.024408750236034393, 0.022663559764623642, -0.013124783523380756, 0.008773762732744217, 0.021133530884981155, -0.026249567046761513, 0.024384843185544014, -0.031532950699329376, 0.006424928084015846, 0.04735919088125229, 0.018432073295116425, -0.014642859809100628, 0.03540583699941635, 0.01298134308308363, -0.019185135141015053, 0.009389360435307026, -0.01592186838388443, -0.019460061565041542, 0.015168807469308376, -0.006424928084015846, -0.011421429924666882, 0.015862101688981056, -0.007901167497038841, -0.0347125418484211, 0.016639070585370064, 0.0060155256651341915, -0.009371429681777954, -0.004900875501334667, -0.005928863771259785, -0.023320995271205902, -0.02344052866101265, 0.012646649032831192, -0.000948797503951937, 0.020225076004862785, -0.00615000119432807, 0.026273474097251892, 0.005893003661185503, 0.007703937124460936, -0.03287172690033913, -0.020774930715560913, 0.043844904750585556, -0.027636155486106873, -0.00034739437978714705, -0.025269391015172005, 2.6007885026047006e-05, 0.024289216846227646, -0.0010220118565484881, -0.050682224333286285, 0.022113706916570663, 0.010668369010090828, -0.021707292646169662, -0.01225218828767538, 0.029955105856060982, -0.016029449179768562, -0.0016510571585968137, 0.006448834668844938, -0.017021577805280685, 0.013280176557600498, -0.03789213299751282, 0.002133673755452037, 0.02462390996515751, -0.01612507551908493, 0.022185426205396652, 0.0020544829312711954, 0.015611081384122372, -0.01013046782463789, -0.024862976744771004, -0.0033379741944372654, 0.01771487109363079, 0.0014852043241262436, 0.019997961819171906, 0.023858895525336266, 0.029716039076447487, -0.017416037619113922, 0.03559708967804909, -0.027516622096300125, -0.004763411823660135, 0.0036935866810381413, 0.04652245715260506, -0.04102391377091408, 0.013806124217808247, 0.01857551373541355, -0.04642682895064354, 0.028377264738082886, -0.006185860838741064, -0.027994755655527115, 0.007889213971793652, 0.004978572018444538, -0.00659825187176466, -0.005713703576475382, -0.026655981317162514, 0.0033469393383711576, -0.011941401287913322, -0.008881342597305775, 0.017021577805280685, 0.053933534771203995, -0.023404669016599655, 0.015073180198669434, -0.012790089473128319, -0.014571139588952065, 0.009257873520255089, 0.011517057195305824, 0.009981051087379456, -0.02770787663757801, 0.005038339179009199, -0.01106282975524664, -0.01973498798906803, 0.00023944063286762685, -0.03227405622601509, 0.01655539683997631, -0.01862332597374916, 0.023297088220715523, 0.00573462201282382, 0.021587759256362915, -0.023930616676807404, -0.00357405305840075, -0.024456564337015152, 0.014188632369041443, 0.012778135947883129, -0.0004829902318306267, -0.019460061565041542, 0.03951779007911682, 0.018587466329336166, -0.037127118557691574, 0.008277698419988155, -0.013973471708595753, 0.009305686689913273, -0.01406909804791212, -0.009664286859333515, 0.013076970353722572, 0.039374351501464844, -0.0015419827541336417, -0.0017855323385447264, 0.009060642682015896, 0.017093297094106674, 0.027181928977370262, 0.00613804766908288, 0.008074491284787655, -0.015120993368327618]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:26.742636", "url_path": "/api/models/anthropic/", "chunk_size": 5000}
updated_dt: 2025-03-15T11:17:26.742636
---
re', NOT_GIVEN),
        top_p=model_settings.get('top_p', NOT_GIVEN),
        timeout=model_settings.get('timeout', NOT_GIVEN),
        metadata=model_settings.get('anthropic_metadata', NOT_GIVEN),
      )
    except APIStatusError as e:
      if (status_code := e.status_code) >= 400:
        raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) frome
      raise
  def_process_response(self, response: AnthropicMessage) -> ModelResponse:
"""Process a non-streamed response, and prepare a message to return."""
    items: list[ModelResponsePart] = []
    for item in response.content:
      if isinstance(item, TextBlock):
        items.append(TextPart(content=item.text))
      else:
        assert isinstance(item, ToolUseBlock), 'unexpected item type'
        items.append(
          ToolCallPart(
            tool_name=item.name,
            args=cast(dict[str, Any], item.input),
            tool_call_id=item.id,
          )
        )
    return ModelResponse(items, model_name=response.model)
  async def_process_streamed_response(self, response: AsyncStream[RawMessageStreamEvent]) -> StreamedResponse:
    peekable_response = _utils.PeekableAsyncStream(response)
    first_chunk = await peekable_response.peek()
    if isinstance(first_chunk, _utils.Unset):
      raise UnexpectedModelBehavior('Streamed response ended without content or tool calls')
    # Since Anthropic doesn't provide a timestamp in the message, we'll use the current time
    timestamp = datetime.now(tz=timezone.utc)
    return AnthropicStreamedResponse(
      _model_name=self._model_name, _response=peekable_response, _timestamp=timestamp
    )
  def_get_tools(self, model_request_parameters: ModelRequestParameters) -> list[ToolParam]:
    tools = [self._map_tool_definition(r) for r in model_request_parameters.function_tools]
    if model_request_parameters.result_tools:
      tools += [self._map_tool_definition(r) for r in model_request_parameters.result_tools]
    return tools
  async def_map_message(self, messages: list[ModelMessage]) -> tuple[str, list[MessageParam]]:
"""Just maps a `pydantic_ai.Message` to a `anthropic.types.MessageParam`."""
    system_prompt: str = ''
    anthropic_messages: list[MessageParam] = []
    for m in messages:
      if isinstance(m, ModelRequest):
        user_content_params: list[
          ToolResultBlockParam | TextBlockParam | ImageBlockParam | DocumentBlockParam
        ] = []
        for request_part in m.parts:
          if isinstance(request_part, SystemPromptPart):
            system_prompt += request_part.content
          elif isinstance(request_part, UserPromptPart):
            async for content in self._map_user_prompt(request_part):
              user_content_params.append(content)
          elif isinstance(request_part, ToolReturnPart):
            tool_result_block_param = ToolResultBlockParam(
              tool_use_id=_guard_tool_call_id(t=request_part, model_source='Anthropic'),
              type='tool_result',
              content=request_part.model_response_str(),
              is_error=False,
            )
            user_content_params.append(tool_result_block_param)
          elif isinstance(request_part, RetryPromptPart):
            if request_part.tool_name is None:
              retry_param = TextBlockParam(type='text', text=request_part.model_response())
            else:
              retry_param = ToolResultBlockParam(
                tool_use_id=_guard_tool_call_id(t=request_part, model_source='Anthropic'),
                type='tool_result',
                content=request_part.model_response(),
                is_error=True,
              )
            user_content_params.append(retry_param)
        anthropic_messages.append(MessageParam(role='user', content=user_content_params))
      elif isinstance(m, ModelResponse):
        assistant_content_params: list[TextBlockParam | ToolUseBlockParam] = []
        for response_part in m.parts:
          if isinstance(response_part, TextPart):
            assistant_content_params.append(TextBlockParam(text=response_part.content, type='text'))
          else:
            tool_use_block_param = ToolUseBlockParam(
              id=_guard_tool_call_id(t=response_part, model_source='Anthropic'),
              type='tool_use',
              name=response_part.tool_name,
              input=response_part.args_as_dict(),
            )
            assistant_content_params.append(tool_use_block_param)
        anthropic_messages.append(MessageParam(role='assistant', content=assistant_content_params))
      else:
        assert_never(m)
    return system_prompt, anthropic_messages
  @staticmethod
  async def_map_user_prompt(
    part: UserPromptPart,
  ) -> AsyncGenerator[ImageBlockParam | TextBlockParam | DocumentBlockParam]:
    if isinstance(part.content, str):
      yield TextBlockParam(text=part.content, type='text')
    else:
      for item in part.content:
        if isinstance(item, str):
          yield Te