---
url: https://ai.pydantic.dev/examples/stream-whales/
session_id: pydantic_ai_docs
chunk_number: 1
title: Stream Whales: Example of Streamed Structured Response Validation
summary: This document provides an example of streaming structured responses about whales using GPT-4. It includes a script that validates the streamed data and displays it in a dynamic table format with the 'rich' library. Instructions for running the example by setting up dependencies and environment variables are also provided.
embedding: [0.0063066245056688786, 0.05010504275560379, 0.04386867955327034, -0.0027434653602540493, 0.040014445781707764, -0.013275695033371449, -0.007648245897144079, 0.003347362158820033, -0.019217640161514282, 0.03792673349380493, 0.0436277911067009, -0.01971280202269554, -0.01692918874323368, -0.019525444135069847, 0.01991354301571846, 0.05342396721243858, 0.005721129011362791, 0.008585038594901562, -0.017799068242311478, 0.06402311474084854, 0.060543596744537354, -0.020154433324933052, -0.01730390638113022, 0.009916623122990131, -0.006744909565895796, 0.03308217599987984, -0.04849911481142044, 0.06091831251978874, 0.020301643759012222, -0.010070525109767914, 0.011047466658055782, -0.02242950163781643, -0.008136716671288013, -0.030914170667529106, -0.013683869503438473, 0.003277102718129754, 0.021211670711636543, -0.000680847791954875, -0.011121071875095367, 0.015269726514816284, 0.028157321736216545, -0.04874000325798988, 0.0388367623090744, 0.027140231803059578, 0.026685219258069992, 0.04501959681510925, -0.004439729731529951, 0.02064959518611431, 0.04769614711403847, 0.032493334263563156, -0.04410956799983978, 0.05256747081875801, -0.03525018319487572, -0.03586579114198685, -0.014587205834686756, 0.0018886416219174862, -0.033804845064878464, 0.04675935581326485, -0.022978194057941437, -0.04919501766562462, -0.02398190088570118, 0.009582054801285267, -0.025547683238983154, 0.04073711484670639, -0.05727820098400116, 0.02366071566939354, -0.06396958231925964, 0.008979829959571362, -0.02131873182952404, -0.022483032196760178, 0.0311015285551548, -0.0014762853970751166, -0.031850963830947876, -0.0027451382484287024, -0.050238870084285736, -0.022536562755703926, -0.03570519760251045, 0.03182419762015343, -0.03551783785223961, -0.05010504275560379, 0.001799980876967311, -0.004864632152020931, -0.03798026591539383, -0.05379868671298027, 0.015885332599282265, 7.88066699897172e-06, -0.06343427300453186, -0.012492803856730461, -0.013583499006927013, -0.007260146085172892, -0.00783560425043106, 0.00762817170470953, -0.05377192050218582, -0.020047370344400406, 0.05888413265347481, -0.027488183230161667, 0.020462235435843468, -0.014025130309164524, 0.010538921691477299, 0.0024607544764876366, 0.03201155737042427, 0.003049595979973674, -0.06985799223184586, -0.035678431391716, 0.03324276953935623, -0.00037576272734440863, 0.023794542998075485, -0.012091321870684624, -0.06161421537399292, -0.05626111105084419, -0.07446166127920151, -0.014667502604424953, 0.010853416286408901, -0.022643625736236572, -0.014386463910341263, 0.04231628030538559, -0.04322630539536476, -0.024490445852279663, 0.007427430246025324, -0.028210852295160294, -0.03450074791908264, 0.013650412671267986, 0.020288260653614998, -0.03458104655146599, -0.018280846998095512, 0.03369778394699097, -0.016875656321644783, -0.018869688734412193, -0.0372575968503952, -0.007353825494647026, 0.03201155737042427, 0.037819672375917435, 0.06268483400344849, -0.03203831985592842, -0.01059914380311966, 0.012004333548247814, -0.05329013988375664, 0.007889135740697384, -0.013235547579824924, 0.025882253423333168, 0.02858556993305683, -0.013958215713500977, 0.04116536304354668, 0.013168632984161377, -0.011228133924305439, 0.002939188154414296, -0.0017681968165561557, 0.024878546595573425, -0.058027636259794235, 0.0015825111186131835, 0.01774553582072258, 0.044671643525362015, -0.03353719040751457, 0.023700863122940063, -0.03621374070644379, 0.020328408107161522, 0.030967701226472855, 0.025280028581619263, -0.019244404509663582, -0.043708086013793945, -0.006396958138793707, 0.026805663481354713, -0.058670010417699814, -0.0015498906141147017, -0.03270746022462845, -0.00040273735066875815, -0.008879459463059902, -0.009689116850495338, -0.04314601048827171, -0.001027963007800281, 0.0008832620223984122, -0.0010982225649058819, 0.009756030514836311, 0.002653131727129221, 0.0248651634901762, -0.005379868671298027, -0.056100521236658096, -0.04175420477986336, -0.0010472007561475039, -0.08008242398500443, -0.02928147278726101, 0.0016260050470009446, -0.04975709319114685, -0.02922794222831726, -0.04180773347616196, -0.008223704062402248, 0.010358254425227642, -0.02639079838991165, 0.01604592613875866, 0.07119627296924591, 0.012084630317986012, 0.03388514369726181, 0.03144948184490204, 0.022804219275712967, -0.02220199443399906, -0.010090598836541176, 0.060168877243995667, 0.013918068259954453, 0.02992384508252144, 0.015336640179157257, 0.029977377504110336, 0.012091321870684624, -0.005490276496857405, -0.0419950932264328, 0.02052915096282959, -0.026538008823990822, -0.049302078783512115, 0.040951237082481384, -0.026926107704639435, -0.045260485261678696, 0.04135271906852722, -0.006698070093989372, 0.048713237047195435, -0.0140117472037673, -0.019391614943742752, -0.043119244277477264, -0.025025757029652596, 0.008457902818918228, 0.029308238998055458, 0.0006298260414041579, -0.02799672819674015, 0.07269513607025146, 0.01695595309138298, -0.011589468456804752, -0.01769200526177883, 0.0019404998747631907, 0.0405229888856411, -0.028853224590420723, -0.003506282577291131, -0.008993213064968586, 0.05792057514190674, 0.011047466658055782, -0.0011919018579646945, -0.026203438639640808, 0.006326698698103428, -0.05572580173611641, 0.013095028698444366, 0.006821860559284687, 0.007634863257408142, 0.012365668080747128, 0.001078984816558659, 0.029763253405690193, 0.02445029839873314, -0.0014344643568620086, 0.026283735409379005, 0.00810995139181614, -0.03019150160253048, -0.06969740241765976, 0.03016473539173603, 0.04285158962011337, 0.03460781276226044, -0.05733173340559006, 0.007982814684510231, -0.053638093173503876, -0.038087327033281326, -0.01801319234073162, -0.048418816179037094, -0.018267463892698288, -0.038756467401981354, -0.01961912214756012, -0.016152989119291306, -0.026310501620173454, -0.10834680497646332, 0.032520100474357605, -0.02834467962384224, -0.03602638468146324, 0.013068262487649918, 0.010003611445426941, 0.007721851114183664, -0.0028153976891189814, 0.004436383955180645, 0.05010504275560379, -0.005189164076000452, 0.0050051514990627766, -0.07274866849184036, 0.03292158246040344, -0.021104607731103897, 0.005065373610705137, 0.01461397111415863, -0.02568151243031025, -0.00016446154040750116, -0.007848987355828285, 0.012425890192389488, 0.029388535767793655, -0.02639079838991165, 0.04691994935274124, -0.011422183364629745, -4.040965359308757e-05, 0.03115505911409855, -0.010612526908516884, 0.06247071176767349, 0.0326271615922451, 0.015042219310998917, -0.01572474092245102, 0.01149578858166933, 0.0029860278591513634, 0.06669966131448746, 0.06097184494137764, -0.014413230121135712, -0.027568479999899864, 0.0061761424876749516, -0.008738940581679344, -0.04427016153931618, 0.019164109602570534, -0.026872577145695686, 0.04022856801748276, -0.029415301978588104, -0.018548501655459404, 0.00631666136905551, -0.014185722917318344, -0.005513695999979973, 0.02743465267121792, -0.007581332232803106, -0.009214028716087341, -0.018026573583483696, -0.06434430181980133, 0.054922837764024734, -0.02474471926689148, 0.042476873844861984, -0.051523614674806595, -0.04172743856906891, 0.00413527199998498, 0.0372575968503952, 0.019190873950719833, -0.031931258738040924, -0.010967169888317585, 0.007855678908526897, 0.005276151932775974, -0.013202090747654438, 0.012071247212588787, -0.027488183230161667, -0.02220199443399906, -0.006343427114188671, 0.028398212045431137, -0.022884516045451164, -0.028853224590420723, -0.026725366711616516, 0.04948943853378296, 0.017236990854144096, 0.05620758235454559, -0.04544784501194954, -0.003857579780742526, -0.04641140252351761, -0.02105107717216015, -0.027889667078852654, -0.0008548236219212413, 0.05808116868138313, 0.032145384699106216, 0.010150821879506111, -0.015523998998105526, 0.004001444671303034, 0.0327877551317215, 0.004747533239424229, 0.04857940971851349, -0.0008748977561481297, -0.018548501655459404, 0.012847446836531162, -0.010364945977926254, -0.008210321888327599, 0.01431955024600029, -0.05701054632663727, -0.003901073709130287, 0.012044481933116913, -0.008036346174776554, -0.006805132143199444, 0.031235355883836746, -0.024637656286358833, -0.04416310042142868, 0.012392433360219002, -0.0056441780179739, 0.022657008841633797, 0.011816974729299545, 0.027153614908456802, -0.016527704894542694, -0.031877730041742325, -0.035678431391716, -0.006209599319845438, 0.04207538813352585, -0.023259231820702553, 0.015818418934941292, -0.011509171687066555, 0.045876093208789825, 0.012773841619491577, 0.002537705469876528, 0.015791654586791992, 0.04924854636192322, -0.005814807955175638, 0.024062197655439377, -0.021399028599262238, 0.011589468456804752, 0.04630434140563011, -0.025909017771482468, -0.010712897405028343, 0.015510615892708302, 0.032493334263563156, 0.00881254579871893, -0.013195399194955826, 0.008799162693321705, 0.06477254629135132, 0.023620566353201866, 0.012867521494626999, 0.0071263182908296585, 0.005038608331233263, 0.0015381807461380959, 0.044323693960905075, 0.021827276796102524, 0.05326337367296219, 0.007059404626488686, -0.00995677150785923, 0.0085649648681283, -0.002186408033594489, -0.0418880321085453, 0.02890675701200962, -0.05007828027009964, 0.009976846165955067, -0.02439676783978939, -0.05502989888191223, 0.011355269700288773, 0.02432985231280327, 0.050908010452985764, -0.0025009028613567352, -0.045902859419584274, 0.013918068259954453, 0.025895636528730392, -0.06247071176767349, 0.08538199216127396, 0.0528351254761219, -0.044323693960905075, -0.005399942863732576, -0.027488183230161667, -0.00408508675172925, 0.012345593422651291, 0.026805663481354713, -0.004218914080411196, 0.012251914478838444, 0.001454538432881236, -0.0011559356935322285, 0.027943197637796402, 0.02447706274688244, -0.02471795305609703, -0.0029860278591513634, -0.045581672340631485, -0.02050238475203514, -0.013623647391796112, -0.021332114934921265, 0.014573822729289532, 0.023995283991098404, 0.005664252210408449, 0.013436288572847843, -0.043038949370384216, 0.047803208231925964, 0.009327782317996025, -0.024463681504130363, -0.022483032196760178, 0.016233284026384354, -0.02893352136015892, 0.009441534988582134, 0.030298562720417976, 0.04020180180668831, -0.04796380177140236, -0.0050519909709692, 0.025748426094651222, -0.03396543860435486, 0.019458528608083725, -0.03013796918094158, -0.013108410872519016, 0.04887383058667183, -0.010371637530624866, 0.011616233736276627, -0.04336013272404671, 0.052433643490076065, -0.023874839767813683, -0.011221442371606827, 0.006209599319845438, -0.0033256153110414743, -0.048124395310878754, 0.019806481897830963, -0.011295047588646412, -0.031877730041742325, -0.015764888375997543, 0.004389544483274221, -0.0003046668425668031, -0.03487546741962433, 0.026524625718593597, 0.0011224787449464202, 0.022268908098340034, -0.008919607847929, -0.036267273128032684, -0.015042219310998917, -0.008912916295230389, -0.008009579963982105, 0.02272392250597477, 0.020341791212558746, -0.01601915992796421, 0.0081701735034585, -0.01276715099811554, -0.071570985019207, 0.002693279879167676, 0.011228133924305439, -0.029335005208849907, 0.0016736810794100165, -0.05733173340559006, 0.017196843400597572, 0.050881244242191315, 0.02237597107887268, -0.05722467228770256, 0.00871217530220747, -0.00032223170273937285, 0.013971598818898201, 0.04892736300826073, -0.03519665077328682, -0.008932990953326225, 0.0295223630964756, 0.02987031452357769, -0.008163481950759888, 0.024972226470708847, -0.0038676168769598007, -0.00030905805760994554, -0.016233284026384354, 0.01683550886809826, -0.0037505177315324545, -0.025962550193071365, 0.01148240640759468, -0.004011481534689665, -0.007226689253002405, -0.02829114906489849, -0.030914170667529106, -0.03270746022462845, -0.0008531507919542491, -0.018668945878744125, 0.004389544483274221, 0.009341164492070675, -0.009113658219575882, 0.022094933316111565, -0.0778341144323349, -0.017758918926119804, -0.000634426367469132, -0.017558177933096886, 0.002950898138806224, -0.04079064354300499, -0.0014194087125360966, 0.009066818282008171, -0.041861265897750854, -0.015189429745078087, 0.026578156277537346, -0.014252636581659317, 0.02447706274688244, -0.009769412688910961, 0.0104987733066082, 0.005035262554883957, 0.04424339532852173, -0.027809370309114456, 0.03230597823858261, -0.01885630562901497, 0.0023620566353201866, 0.0104987733066082, -0.006075771991163492, 0.00821701344102621, 0.0032285903580486774, 0.00228008721023798, 0.022683773189783096, -0.010860107839107513, 0.01631358079612255, 0.000794601219240576, -0.033724550157785416, 0.03195802494883537, 0.042128920555114746, 0.005480239167809486, -0.023085257038474083, 0.04769614711403847, -0.005486930720508099, -0.005312954541295767, -0.007159775123000145, -0.05093477666378021, 0.031904492527246475, -0.018294230103492737, -0.025320177897810936, -0.0034962454810738564, 0.00333063374273479, 0.026671836152672768, -0.04480547085404396, -0.02600269764661789, -0.001638551359064877, 0.045581672340631485, -0.033430129289627075, 0.017678622156381607, 0.02307187393307686, 0.033403363078832626, -0.0024473718367516994, -0.005734511651098728, 0.033430129289627075, 0.027862900868058205, 0.0011969204060733318, 0.020368557423353195, -0.013523276895284653, 0.0015482177259400487, -0.007414047606289387, -0.00579138845205307, -0.04480547085404396, -0.002298488514497876, 0.03516988828778267, 0.014881626702845097, -0.03396543860435486, -0.008310692384839058, -0.03508958965539932, 0.04721437022089958, 0.028077024966478348, 0.028210852295160294, -0.012312136590480804, -0.0010522193042561412, -0.041245657950639725, -0.0042021856643259525, -0.01865556463599205, -0.034045733511447906, -0.020984163507819176, 0.017317287623882294, -0.07253454625606537, 0.023406442254781723, 0.04534078389406204, -0.00715308403596282, -0.02743465267121792, -0.008491359651088715, 0.04137948527932167, -0.015416936948895454, 0.0036635298747569323, 0.01909719407558441, -0.01996707357466221, 0.02858556993305683, -0.0591517873108387, 0.027488183230161667, -0.03292158246040344, 0.008190247230231762, 0.03351042419672012, 0.028157321736216545, -0.007300294004380703, 0.01619313657283783, 0.03452751412987709, -0.004680619575083256, -0.008618495427072048, -0.020770039409399033, 0.035330478101968765, 0.047428492456674576, 0.0016945917159318924, 0.02102431282401085, 0.03051268681883812, 0.01143556647002697, -0.026484476402401924, 0.00042657539597712457, -0.008411062881350517, -0.016822125762701035, -0.01055899541825056, -0.006189525127410889, 0.022884516045451164, -0.016621384769678116, 0.009869784116744995, -0.042744528502225876, -0.035330478101968765, -0.01856188476085663, -0.03637433424592018, 0.013028114102780819, -0.02213508076965809, 0.02954912930727005, -0.016621384769678116, -0.018735861405730247, -0.023085257038474083, 0.049328844994306564, -0.004704039078205824, 0.005691017489880323, 0.010277957655489445, 0.014667502604424953, -0.038702934980392456, -0.009053435176610947, 0.024784866720438004, -0.022469649091362953, 0.02796996384859085, -0.019244404509663582, 0.017170077189803123, -0.03367101773619652, -0.0024624273646622896, 0.04935561120510101, -0.024035433307290077, 0.03182419762015343, -0.04440398886799812, -0.02489192970097065, 0.04207538813352585, -0.021332114934921265, 0.016969336196780205, -0.000776618137024343, 0.021573005244135857, 0.07306985557079315, -0.00808318518102169, -0.02321908436715603, -0.01725037395954132, 0.011810283176600933, -0.0050821020267903805, 0.012144852429628372, -0.010371637530624866, 0.04100476950407028, -0.0013508220436051488, -0.09132393449544907, 0.003235281677916646, -0.023767776787281036, -0.014975305646657944, -0.03610667958855629, -0.02228229120373726, 0.007554566487669945, -0.015176046639680862, 0.021091226488351822, 0.049650032073259354, -0.010157512500882149, -0.01754479482769966, 0.035357244312763214, -0.03798026591539383, 0.0514165535569191, -0.047776445746421814, 0.005162398796528578, -0.002484174445271492, 0.011970876716077328, -0.001035490888170898, 0.02471795305609703, 0.012727002613246441, 0.02222876064479351, -0.03083387389779091, -0.009280942380428314, 0.02562798000872135, -0.021532857790589333, 0.030030908063054085, 0.028772927820682526, -0.008411062881350517, -0.0062330192886292934, -0.0031014541164040565, -0.01646079123020172, 0.01737082004547119, -0.03586579114198685, 0.0006181161152198911, -0.0003571523411665112, -0.043065715581178665, 0.014439995400607586, -0.014493525959551334, -0.003009447595104575, -0.022041400894522667, -0.029201176017522812, 0.007855678908526897, -0.007320368196815252, 0.018722478300333023, -0.024825016036629677, -0.004965003114193678, 0.02208155021071434, -0.023700863122940063, 0.0002561543369665742, -0.012084630317986012, 0.010813267901539803, 0.0024624273646622896, 0.002868928713724017, 0.006587662268429995, -0.03795349970459938, 0.014199106022715569, -0.019458528608083725, -0.01041178498417139, 0.02556106634438038, -0.015885332599282265, 0.027193764224648476, -0.004352741874754429, 0.020167816430330276, 0.01569797471165657, -0.03179743140935898, 0.006008858326822519, 0.022335821762681007, -0.011208059266209602, -0.021746981889009476, -0.015015454031527042, -0.011589468456804752, -0.003432677360251546, 0.016862275078892708, 0.05626111105084419, -0.06305955350399017, 0.0048746694810688496, 0.02094401605427265, 0.024169260635972023, -0.009789487347006798, -0.007701776921749115, -0.010572378523647785, -0.03134241700172424, -0.02026149444282055, 0.015510615892708302, 0.008176865056157112, 0.0018802774138748646, -0.024838397279381752, -0.019190873950719833, -0.010525538586080074, -0.06477254629135132, 2.5981369617511518e-05, -0.005864993669092655, -0.016340347006917, 0.010358254425227642, -0.0049415831454098225, 0.0018183821812272072, -0.10240486264228821, -0.023152170702815056, -0.018548501655459404, -0.013483128510415554, 0.014573822729289532, -0.02018119767308235, -0.004991768393665552, 0.023152170702815056, -0.03246656805276871, -0.025815339758992195, 0.02858556993305683, -0.005266115069389343, 0.003519665217027068, -0.03613344579935074, 0.03645463287830353, -0.022951429709792137, 0.029120881110429764, -0.016969336196780205, 0.0116429990157485, -0.01134857814759016, -0.013208781369030476, -0.004724113270640373, -0.014747798442840576, 0.013944833539426327, 0.00754787540063262, -0.014051895588636398, 0.0060958461835980415, 0.0241558775305748, 0.043734852224588394, 0.010324797593057156, 0.0004830339166801423, -0.018428057432174683, 0.034393686801195145, -0.022121697664260864, 0.027220528572797775, 0.011147837154567242, -0.009963463060557842, 0.040255334228277206, 0.028451742604374886, -0.015938865020871162, -0.031235355883836746, -0.048070866614580154, -0.005246040876954794, 0.0029525707941502333, 0.054012808948755264, -0.015523998998105526, -0.05109536647796631, -0.0026899343356490135, -0.006831897888332605, 0.00871217530220747, 0.012586483731865883, 0.023419825360178947, -0.020328408107161522, 0.0036501470021903515, 0.0032687385100871325, 0.03511635586619377, -0.05486930534243584, 0.0035230109933763742, -0.021787129342556, 0.012660088948905468, 0.0032553558703511953, -0.010786502622067928, -0.005737857427448034, -0.02055591531097889, -0.007815530523657799, -0.0023921679239720106, -0.020716508850455284, -0.006490637548267841, -0.02345997467637062, -0.04611698165535927, 0.007206615060567856, 0.02491869404911995, 0.008337457664310932, -0.026685219258069992, 0.004623742774128914, -0.0124325817450881, 0.024062197655439377, 0.018896453082561493, -0.023232467472553253, 0.022590095177292824, 0.030726810917258263, -0.0683055967092514, -0.0007172321784310043, 0.032894816249608994, -0.015229578129947186, 0.005945289973169565, 0.020328408107161522, -0.023888222873210907, -0.029495596885681152, 0.03332306444644928, 0.006999182049185038, 0.03203831985592842, -0.004259062465280294, -0.01680874265730381, -0.03972002491354942, -0.0006670468137599528, -0.020368557423353195, -0.011154528707265854, 0.024851780384778976, -0.011121071875095367, 0.04635787382721901, 0.023352911695837975, -0.00950175803154707, 0.00021516965352930129, -0.006999182049185038, 0.02928147278726101, -0.026805663481354713, 0.005035262554883957, -0.040656816214323044, -0.02134549804031849, 0.019391614943742752, 0.01025119237601757, 0.004951620474457741, 0.011328504420816898, -0.018147019669413567, -0.017357436940073967, 0.05995475500822067, -0.007741925306618214, -0.03051268681883812, 0.0028053605929017067, 0.0179195124655962, -0.008203630335628986, 0.017384201288223267, 0.003111491212621331, -0.0033272881992161274, 0.017263757064938545, -0.0025326868053525686, -0.009247485548257828, 0.001198593177832663, -0.003277102718129754, 0.011221442371606827, 0.00940138753503561, -0.017986426129937172, 0.02671198360621929, -0.0016393878031522036, -0.0022315748501569033, 0.03460781276226044, -0.0021077843848615885, -0.014506909064948559, -0.027836136519908905, 0.00020502803090494126, -0.0420486256480217, 0.006614428013563156, -0.020422087982296944, 0.0038809997495263815, -0.004714076407253742, -0.02008751966059208, 0.025668129324913025, 0.0036501470021903515, 0.05476224422454834, 0.027233911678195, 0.001204448170028627, -0.017999809235334396, 0.008966447785496712, -0.0019220985705032945, 0.04986415430903435, -0.00303454021923244, -0.04793703928589821, -0.0021312041208148003, -0.028532039374113083, 0.002721718279644847, 0.019244404509663582, 0.02477148361504078, -0.015564147382974625, -0.015537381172180176, -0.02992384508252144, -0.03179743140935898, -0.008076494559645653, -0.0296026598662138, 0.005292880814522505, -0.04207538813352585, -0.010739662684500217, 0.037444956600666046, -0.0005010169697925448, 0.028719397261738777, 0.01039840281009674, 0.028799694031476974, -0.011569393798708916, 0.006079117767512798, 0.04453781619668007, -0.016915805637836456, 0.012158235535025597, 0.004827830009162426, 0.02422279119491577, 0.015283108688890934, 0.000807983975391835, -0.0004704875755123794, 0.013904685154557228, -0.02984355017542839, 0.004309247713536024, 0.001360022695735097, 0.009434844367206097, -0.027836136519908905, 0.013442980125546455, 0.00587168475612998, -0.0004307574999984354, 0.06439782679080963, 0.00989654939621687, 0.002111129928380251, 0.023419825360178947, 0.044966064393520355, 0.004001444671303034, 0.026016080752015114, -0.03107476234436035, -0.022041400894522667, 0.028478508815169334, -0.02237597107887268, 0.012151543982326984, 0.011020700447261333, 0.007614789064973593, -0.011736677959561348, -0.0004955802578479052, 0.002554433885961771, -0.005925215780735016, -0.028879990801215172, -0.009802869521081448, -0.0023754395078867674, 0.02003398723900318, -0.013128485530614853, -0.04111183062195778, 0.009742647409439087, -0.04531401768326759, -0.03013796918094158, 0.015202812850475311, -0.0012596520828083158, 0.009769412688910961, 0.007976123131811619, 0.0033657634630799294, 0.011750061064958572, 0.004921508952975273, 0.03321600332856178, 0.03487546741962433, -0.04207538813352585, -0.00825716182589531, 0.011689838953316212, -0.027541715651750565, 0.00912034884095192, 0.016246667131781578, 0.03174390271306038, -0.021800512447953224, 0.02410234697163105, 0.022148463875055313, 0.020167816430330276, -0.01114114560186863, 0.0005026898579671979, 0.017584944143891335, 0.010880181565880775, 0.008451211266219616, -0.030914170667529106, -0.004697347991168499, -0.018494971096515656, 0.044350460171699524, 0.004704039078205824, -0.043119244277477264, 0.021519474685192108, -0.019900159910321236, 0.02313878759741783, 0.0014302822528406978, -0.02981678396463394, 0.009843017905950546, 0.00529957190155983, 0.012713619507849216, 0.019833246245980263, -0.017946278676390648, 0.012887595221400261, 0.011422183364629745, -0.028077024966478348, -0.017839215695858, 0.029067348688840866, 0.029682956635951996, -0.009528523311018944, 0.019485294818878174, 0.007286911364644766, 0.022161846980452538, -0.019070429727435112, -0.0024590815883129835, -0.02058268152177334, -0.008698792196810246, 0.007828912697732449, -0.008678718470036983, -0.006667959038168192, 0.005108867771923542, -0.008411062881350517, -0.005399942863732576, 0.019632505252957344, -0.022804219275712967, -0.009461609646677971, -0.029067348688840866, 0.0015147608937695622, 0.020917249843478203, -0.0017548140604048967, 0.007768690586090088, -0.022121697664260864, -0.0017765610245987773, -0.012325519695878029, 0.010304722934961319, 0.006587662268429995, -0.007373899221420288, 0.019231023266911507, -0.030271798372268677, -0.023647332563996315, 0.01371732633560896, 0.007240071892738342, -0.02011428400874138, -0.017022866755723953, 0.018668945878744125, 0.010177587158977985, -0.050908010452985764, 0.030700046569108963, 0.0241558775305748, -0.001689573167823255, -0.014185722917318344, 0.02354026958346367, 0.002439007628709078, 0.002962607890367508, 0.006125957239419222, -0.006651230622082949, -0.004185457248240709, -0.013489819131791592, -0.011770134791731834, -0.009073509834706783, 0.02735435590147972, 0.009474992752075195, 0.02292466349899769, 0.0035263565368950367, 0.018147019669413567, 0.010338179767131805, -0.0073872823268175125, 0.003320596646517515, 0.0021044386085122824, 0.0147611815482378, -0.001249614986591041, 0.012178309261798859, 0.01695595309138298, -0.022563328966498375, -0.01850835420191288, -0.03144948184490204, -0.011917345225811005, 0.01707639917731285, -0.03698994219303131, -0.021131373941898346, -0.02383469045162201, 0.013034805655479431, -0.009555288590490818, 0.007092861458659172, -0.005259423516690731, -0.01083334255963564, -0.009461609646677971, 0.007902517914772034, 0.04951620101928711, 0.0842043086886406, 0.01973956823348999, -0.0077753821387887, 0.026377415284514427, 0.013095028698444366, -0.013128485530614853, 0.018441440537571907, 0.025788573548197746, -0.004864632152020931, -0.005389905534684658, -0.014881626702845097, 0.0031683677807450294, 0.018923219293355942, 0.009421461261808872, 0.02267039194703102, 0.012445964850485325, 0.006764983758330345, 0.007306985557079315, 0.04079064354300499, 0.017839215695858, -0.02119828760623932, 0.02087710238993168, 0.013730709441006184, -0.00490478053689003, 0.027140231803059578, 0.019016899168491364, -0.0031298925168812275, -0.004623742774128914, 0.025761807337403297, 0.04665229097008705, 0.01601915992796421, -0.042182452976703644, -0.006082463078200817, 0.006912194192409515, -0.029736487194895744, 0.0033272881992161274, -0.0027735764160752296, 0.010712897405028343, 0.00021663338702637702, 0.0240755807608366, 0.02307187393307686, 0.0097091905772686, -0.02427632175385952, -0.0024674460291862488, 0.00621629087254405, 0.014225871302187443, 0.035330478101968765, 0.010913638398051262, 0.012512878514826298, -0.004978385753929615, -0.0028572187293320894, 0.01572474092245102, -0.001448683557100594, -0.01212477870285511, 0.02102431282401085, -0.023058490827679634, 0.00808318518102169, 0.026163291186094284, -0.004754224792122841, 0.020475618541240692, 0.005446782335639, 0.015176046639680862, -0.005296226125210524, 0.019057046622037888, 0.0031834235414862633, -0.03915794938802719, 0.012392433360219002, 0.00201745075173676, 0.003559813601896167, 0.015135899186134338, 0.007280220277607441, 0.0022181919775903225, -0.003446059999987483, 0.011964185163378716, 0.015938865020871162, 0.016005778685212135, 0.0081701735034585, 7.182776607805863e-05, -0.003747172188013792, 0.0404159277677536, -0.030084438621997833, -0.053049251437187195, -0.005175781436264515, 0.03016473539173603, -0.014185722917318344, 0.025320177897810936, 0.010987243615090847, -0.016567854210734367, -0.033483657985925674, 0.02380792610347271, 0.02222876064479351, 0.030914170667529106, 0.04544784501194954, 0.03227921202778816, 0.018789391964673996, 0.02193433977663517, -0.0003245318657718599, 0.026136524975299835, 0.008979829959571362, -0.0025611252058297396, 0.022121697664260864, 0.01118798553943634, -0.011910654604434967, 0.029094114899635315, 0.0005261096521280706, 0.01431955024600029, 0.0002710008411668241, -0.03045915625989437, -0.02427632175385952, 0.028398212045431137, -0.002522649709135294, -0.00833076611161232, 0.004807755816727877, -0.031904492527246475, 0.007052713073790073, 0.03238627314567566, -0.02190757356584072, 0.0005712764686904848, -0.017410967499017715, -0.01628681644797325, 0.020274877548217773, 0.015336640179157257, 0.0037070238031446934, -0.026658453047275543, -0.003616690170019865, 0.015657825395464897, 0.0093143992125988, -0.02052915096282959, 0.008819237351417542, -0.03551783785223961, 0.021653302013874054, -0.009588745422661304, 0.00030613059061579406, -0.014707650989294052, -0.036588460206985474, 0.008792472071945667, -0.03326953575015068, -0.019485294818878174, -0.0147611815482378, 0.0001449101691832766, -0.004024864174425602, 0.02375439554452896, 0.018454821780323982, -0.045206956565380096, 0.03246656805276871, 0.009247485548257828, 0.001629350706934929, 0.004018173087388277, -0.006243056617677212, 0.018588650971651077, -0.01903028041124344, -0.019726185128092766, 0.00020398250489961356, 0.025587832555174828, 0.03835498169064522, -0.03519665077328682, -0.006952342577278614, -0.010338179767131805, -0.02987031452357769, -0.018789391964673996, 0.009080201387405396, -0.03112829476594925, -0.029682956635951996, 0.017210226505994797, 0.009936697781085968, -0.003947913646697998, -0.006724835839122534, 0.005349757149815559, 0.023647332563996315, 0.006821860559284687, -0.006805132143199444, -0.002413915004581213, 0.016527704894542694, 0.014145574532449245, 0.03637433424592018, -0.0011668091174215078, -0.0062464019283652306, -0.000766162876971066, 0.006052352022379637, 0.022309057414531708, -0.0073805907741189, -0.010465316474437714, 0.020475618541240692, -0.02026149444282055, -0.0005311282002367079, 0.02799672819674015, 0.0057545858435332775, -0.009829635731875896, 0.009495066478848457, -0.029201176017522812, 0.03514312207698822, 0.001554909162223339, -0.010023685172200203, 0.019833246245980263, 0.00391780212521553, 0.02627035230398178, 0.008384297601878643, -0.001056401408277452, 0.0016996102640405297, 0.02898705191910267, -0.01833437755703926, 0.004570211749523878, -0.033456895500421524, 0.010150821879506111, -6.74888287903741e-05, 0.020007222890853882, -0.009776104241609573, 0.016260050237178802, -0.0077954563312232494, 0.001424427260644734, -0.010545613244175911, -0.017651857808232307, 0.007782073691487312, 0.03391190618276596, 0.034393686801195145, -0.002045889152213931, -0.014654119499027729, -0.011161219328641891, 0.0019940307829529047, -0.009836326353251934, 0.024972226470708847, 0.009053435176610947, 0.00748096127063036, -0.017812449485063553, 0.03177066519856453, 0.026952873915433884, 0.026069611310958862, -0.029040584340691566, -0.022442884743213654, -0.007340442389249802, 0.029040584340691566, -0.015497232787311077, 0.0013115102192386985, 0.005567227024585009, -0.0041821119375526905, -0.009829635731875896, 0.02641756273806095, 0.0148013299331069, 0.03019150160253048, -0.010077216662466526, -0.012245222926139832, 0.03942560404539108, 0.019364850595593452, 0.019900159910321236, 0.0043226308189332485, -0.008384297601878643, 0.0017079744720831513, 0.010358254425227642, -0.017357436940073967, 0.03792673349380493, 0.031021231785416603, 0.036534927785396576, -0.023888222873210907, -0.039050888270139694, -0.02368748001754284, -0.023112021386623383, 0.006965725217014551, 0.008685410022735596, -0.006356809753924608, 0.008685410022735596, -0.011208059266209602, 0.013657104223966599, -0.012526260688900948, -0.017210226505994797, 0.019993839785456657, -0.011422183364629745, -0.05015857517719269, -0.02922794222831726, -0.04113859683275223, -0.002939188154414296, 0.017986426129937172, -0.01621990278363228, 0.009147115051746368, -0.006979107856750488, -0.016474174335598946, 0.005610721185803413, -0.008056419901549816, -0.011254899203777313, 0.030940935015678406, -0.022161846980452538, -0.00442969286814332, -0.001530652865767479, -0.009247485548257828, 0.010826651006937027, 0.009528523311018944, 0.009602128528058529, 0.000142923672683537, 0.007701776921749115, 0.027916431427001953, -0.006243056617677212, 0.021412411704659462, 0.014279401861131191, 0.013362683355808258, 0.00038329054950736463, 0.04236980900168419, 0.025280028581619263, 0.01986001245677471, -0.0038207771722227335, -0.005640832241624594, -0.04360102489590645, -0.023178936913609505, -0.0372575968503952, 0.009227410890161991, -0.010110673494637012, 0.004489914979785681, 0.004158691968768835, 0.011114380322396755, 0.0467325896024704, -0.034366920590400696, -0.021894190460443497, 0.016915805637836456, 0.010947095230221748, 0.010298032313585281, -0.02114475704729557, 0.0311015285551548, 0.039693258702754974, 0.0073805907741189, -0.0033423437271267176, 0.012947818264365196, 0.003961296286433935, 0.028772927820682526, -0.010532230138778687, 0.0028588916175067425, -0.006156068295240402, 0.0008732249261811376, 0.0202079638838768, -0.028478508815169334, 0.0147611815482378, -0.0026046191342175007, -0.002383803715929389, -0.001885295961983502, 0.014493525959551334, 0.014025130309164524, -0.0009535214630886912, 0.03452751412987709, -0.03308217599987984, -0.01601915992796421, 0.021746981889009476, 0.02922794222831726, -0.021158140152692795, -0.026685219258069992, 0.009863092564046383, -0.00833076611161232, -0.026752132922410965, -0.015858568251132965, 0.03225244581699371, -0.00018913600069936365, -0.004024864174425602, 0.017825832590460777, 0.00708616990596056, -0.009073509834706783, 0.049650032073259354, 0.024169260635972023, -0.009260868653655052, 0.0006846116739325225, 0.00012274498294573277, 0.0032269174698740244, 0.026671836152672768, -0.05270129814743996, 0.031583309173583984, -0.004208877217024565, 0.024142494425177574, -0.01745111495256424, 0.015189429745078087, -0.032172150909900665, 0.01616637036204338, 0.006075771991163492, 0.01253295224159956, -0.0031014541164040565, 0.016059309244155884, -0.007360516581684351, 0.010987243615090847, 0.00467727379873395, 0.0022968158591538668, -0.00989654939621687, -0.03929177671670914, -0.025373708456754684, 0.021894190460443497, 0.03334983065724373, -0.02509267069399357, 0.013543350622057915, 0.016300199553370476, 0.012559717521071434, -0.0023921679239720106, 0.018602032214403152, 0.0046739280223846436, 0.001674517523497343, 0.0029877005144953728, -0.0035363936331123114]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:07:51.519950", "url_path": "/examples/stream-whales/", "chunk_size": 3563}
updated_dt: 2025-03-14T10:07:52.964222
---
Table of contents 
  * [ Running the Example  ](https://ai.pydantic.dev/examples/stream-whales/#running-the-example)
  * [ Example Code  ](https://ai.pydantic.dev/examples/stream-whales/#example-code)


# Stream whales
Information about whales — an example of streamed structured response validation.
Demonstrates:
  * [streaming structured responses](https://ai.pydantic.dev/results/#streaming-structured-responses)


This script streams structured responses from GPT-4 about whales, validates the data and displays it as a dynamic table using [`rich`](https://github.com/Textualize/rich) as the data is received.
## Running the Example
With [dependencies installed and environment variables set](https://ai.pydantic.dev/examples/#usage), run:
[pip](https://ai.pydantic.dev/examples/stream-whales/#__tabbed_1_1)[uv](https://ai.pydantic.dev/examples/stream-whales/#__tabbed_1_2)
```
python-mpydantic_ai_examples.stream_whales

```

```
uvrun-mpydantic_ai_examples.stream_whales

```

Should give an output like this:
## Example Code
stream_whales.py```
fromtypingimport Annotated
importlogfire
frompydanticimport Field, ValidationError
fromrich.consoleimport Console
fromrich.liveimport Live
fromrich.tableimport Table
fromtyping_extensionsimport NotRequired, TypedDict
frompydantic_aiimport Agent
# 'if-token-present' means nothing will be sent (and the example will work) if you don't have logfire configured
logfire.configure(send_to_logfire='if-token-present')

classWhale(TypedDict):
  name: str
  length: Annotated[
    float, Field(description='Average length of an adult whale in meters.')
  ]
  weight: NotRequired[
    Annotated[
      float,
      Field(description='Average weight of an adult whale in kilograms.', ge=50),
    ]
  ]
  ocean: NotRequired[str]
  description: NotRequired[Annotated[str, Field(description='Short Description')]]

agent = Agent('openai:gpt-4', result_type=list[Whale], instrument=True)

async defmain():
  console = Console()
  with Live('\n' * 36, console=console) as live:
    console.print('Requesting data...', style='cyan')
    async with agent.run_stream(
      'Generate me details of 5 species of Whale.'
    ) as result:
      console.print('Response:', style='green')
      async for message, last in result.stream_structured(debounce_by=0.01):
        try:
          whales = await result.validate_structured_result(
            message, allow_partial=not last
          )
        except ValidationError as exc:
          if all(
            e['type'] == 'missing' and e['loc'] == ('response',)
            for e in exc.errors()
          ):
            continue
          else:
            raise
        table = Table(
          title='Species of Whale',
          caption='Streaming Structured responses from GPT-4',
          width=120,
        )
        table.add_column('ID', justify='right')
        table.add_column('Name')
        table.add_column('Avg. Length (m)', justify='right')
        table.add_column('Avg. Weight (kg)', justify='right')
        table.add_column('Ocean')
        table.add_column('Description', justify='right')
        for wid, whale in enumerate(whales, start=1):
          table.add_row(
            str(wid),
            whale['name'],
            f'{whale["length"]:0.0f}',
            f'{w:0.0f}' if (w := whale.get('weight')) else '…',
            whale.get('ocean') or '…',
            whale.get('description') or '…',
          )
        live.update(table)

if __name__ == '__main__':
  importasyncio
  asyncio.run(main())

```

© Pydantic Services Inc. 2024 to present