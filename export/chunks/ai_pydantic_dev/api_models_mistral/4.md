---
url: https://ai.pydantic.dev/api/models/mistral/
session_id: pydantic_ai_docs
chunk_number: 4
title: Mistral API Tool Choice and Response Handling
summary: This section details how to handle tool parameters and the response format for the Mistral API, including options for JSON Mode and Stream Mode. It describes the construction of user output format messages, the streaming of chat responses from the model, and provides a function to determine tool choice based on user parameters.
embedding: [3.307586666778661e-05, 0.04952450841665268, -0.02641609124839306, -0.06615350395441055, 0.008093609474599361, -0.03312206268310547, -0.03271426633000374, -0.018158230930566788, -0.03232912719249725, 0.02159051038324833, -0.0007033766014501452, -0.0499776154756546, 0.02034446783363819, 0.012041297741234303, -0.002664830768480897, -0.01577942445874214, 0.0027639479376375675, 0.03482121229171753, -0.023969318717718124, 0.05147286504507065, 0.04356616362929344, 0.025215361267328262, -0.014227534644305706, 0.030947154387831688, 0.007549882400780916, 0.013309994712471962, -0.03128698468208313, 0.06538322567939758, -0.020514383912086487, 0.015314989723265171, -0.0011334734736010432, -0.017082104459404945, -0.011033136397600174, -0.039148375391960144, 0.03463996946811676, -0.014873211272060871, 0.04250136390328407, 0.027367614209651947, -0.020253848284482956, 0.03821950778365135, -0.037675779312849045, -0.01640244387090206, -0.01724069193005562, 0.05188066139817238, 0.0014159568818286061, -0.006541721057146788, -0.00244535761885345, 0.04775739461183548, 0.020695626735687256, 0.011712795123457909, -0.014963832683861256, 0.01905311644077301, -0.006048968061804771, 0.0076631586998701096, 0.025713777169585228, -0.05523364618420601, -0.04657931625843048, -0.02273460477590561, -0.010200553573668003, 0.02280256897211075, -0.043543506413698196, -0.03547821566462517, 0.008286179974675179, 0.0016793248942121863, -0.002327833091840148, -0.0027483722660690546, -0.03260099142789841, -0.005029479041695595, -0.013740445487201214, 0.0013897616881877184, -0.025011463090777397, -0.01405762042850256, -0.025804398581385612, -0.018928511068224907, -0.005394795909523964, -0.021567855030298233, 0.006235874257981777, 0.01705944910645485, 0.011197387240827084, -0.022168220952153206, -0.051019757986068726, -9.814351506065577e-05, -0.005006823688745499, 0.012958837673068047, -0.03772109001874924, -0.06221148371696472, -0.034436073154211044, -0.017603175714612007, -0.00948691088706255, -0.036135219037532806, -0.031672123819589615, -0.03076591156423092, -0.0034719263203442097, 0.06316300481557846, 0.08101539313793182, -0.030539358034729958, 0.0008835570770315826, -0.025804398581385612, 0.0021791576873511076, 0.005077621433883905, 0.03756250441074371, 0.016391117125749588, -0.010715961456298828, 0.02770744450390339, 0.06203024089336395, 0.023788075894117355, 0.03724532946944237, -0.0018251684959977865, -0.030901843681931496, 0.008699638769030571, -0.06656130403280258, -0.006762610282748938, 0.017308657988905907, 0.010217544622719288, -0.022100254893302917, -0.0243997685611248, -0.021726442500948906, 0.008790260180830956, 0.001976675819605589, -0.0063378228805959225, -0.015099764801561832, -0.03468528017401695, 0.02970111183822155, 0.008172903209924698, -0.0038145878352224827, 0.02958783507347107, -0.03636177256703377, -0.029157385230064392, -0.05074789375066757, 0.0403037965297699, -0.014397449791431427, 0.02958783507347107, -0.0252833254635334, -0.05052134022116661, -0.02019720897078514, -0.002310841577127576, -0.011599519290030003, -0.0039080409333109856, -0.02899879775941372, 0.014895866625010967, 0.0037183028180152178, -0.015790751203894615, -0.0752609446644783, -0.01871328614652157, -0.061848998069763184, -0.00783307384699583, -0.009526558220386505, -0.014793917536735535, -0.06035374850034714, 0.0031207690481096506, 0.010659323073923588, 0.0007773603429086506, 0.014873211272060871, 0.009577532298862934, 0.025623155757784843, -0.01872461475431919, 0.031151052564382553, 0.013604514300823212, 0.010936850681900978, -0.042025599628686905, 0.0012170149711892009, 0.009622843004763126, -0.028772244229912758, 0.008150247856974602, -0.01387637760490179, -0.03162681311368942, -0.008654328994452953, 0.00039292805013246834, -0.028749588876962662, -0.024195872247219086, -0.004148753825575113, 0.012732284143567085, -0.02963314577937126, 0.018452750518918037, 0.019041787832975388, -0.014465415850281715, -0.07843268662691116, -0.06624412536621094, 0.006207555066794157, -0.02476225420832634, -0.05863194167613983, 0.013933015987277031, -0.05015885829925537, -0.03704143315553665, -0.02453570067882538, -0.00515974685549736, 0.015518887899816036, -0.009588859975337982, 0.02111474983394146, 0.01666298136115074, 0.0026280160527676344, -0.0016920685302466154, 0.02258734405040741, 0.006790929473936558, -0.054961781948804855, -0.012358471751213074, 0.048663605004549026, -0.010126924142241478, -0.004533893894404173, 0.030969809740781784, 0.017569193616509438, 0.043316952884197235, 0.046307455748319626, -0.05097444728016853, 0.026484057307243347, 0.020537039265036583, -0.023742765188217163, 0.026212194934487343, -0.03756250441074371, -0.03427748382091522, -0.02365214377641678, -0.022632654756307602, -0.006994827184826136, 0.002931030699983239, 0.0032821879722177982, 0.02031048573553562, -0.03556883707642555, -0.013797083869576454, -0.0019441088661551476, 0.0400092788040638, -0.04506141319870949, 0.04293181374669075, 0.027548857033252716, 0.014771262183785439, -0.0329408198595047, 0.051201000809669495, -0.00033805970451794565, -0.07444535195827484, 0.009016813710331917, 0.0065247295424342155, 0.004363979212939739, 0.025441912934184074, -0.0033303305972367525, -0.024490389972925186, 0.04934326559305191, -0.06216617301106453, 0.036180529743433, -0.0029083755798637867, 0.026597334071993828, -0.04050769656896591, -0.007918030954897404, -0.020922178402543068, 0.01794300600886345, 0.006156580522656441, 0.006604022812098265, 0.013978326693177223, 0.009798421524465084, -0.03232912719249725, 0.037539850920438766, -0.0039023770950734615, 0.07847799360752106, -0.05464460700750351, 0.015450921840965748, 0.0055590467527508736, -0.011435267515480518, 0.011520225554704666, -0.02185104601085186, -0.026212194934487343, -0.07770771533250809, -0.029905010014772415, 0.029202695935964584, 0.003619185881689191, -0.058496009558439255, 0.04352085292339325, -0.018769925460219383, 0.0344134159386158, -0.01015524286776781, -0.01620987430214882, 0.0017713620327413082, -0.040439728647470474, 0.01525835134088993, 0.03744922950863838, 0.031015120446681976, 0.02376542054116726, 0.0034351113718003035, -0.018407439813017845, 0.02804727479815483, 0.026189539581537247, 0.007057128939777613, -0.022904518991708755, -0.004491415340453386, 0.0194156002253294, 0.020038621500134468, 0.010563038289546967, -0.015677474439144135, 0.03180805593729019, 0.04633010923862457, -0.017886366695165634, -0.011067119427025318, -0.030652634799480438, -0.003984502516686916, 0.028183206915855408, 0.007538554724305868, -0.004802925977855921, -0.029361281543970108, -0.0030103244353085756, 0.013174062594771385, 0.019392944872379303, 0.005448602139949799, -0.0018237525364384055, 0.0065757036209106445, 0.029678456485271454, 0.03570476919412613, 0.015688803046941757, -0.004899210762232542, 0.018146904185414314, 0.034322794526815414, -0.03855933994054794, 0.04034910723567009, -0.0028857202269136906, 0.02196432277560234, -0.007272354792803526, -0.04057566076517105, -0.014918521977961063, -0.026212194934487343, -0.017263347283005714, -0.02981438860297203, 0.018837889656424522, 0.036135219037532806, -0.007062792778015137, -0.017478572204709053, -0.008155912160873413, -0.005856397561728954, 0.023244349285960197, -0.001035064458847046, 0.025328636169433594, -0.018566027283668518, -0.012958837673068047, 0.002334913006052375, 0.047848016023635864, 0.004845404531806707, -0.038672614842653275, -0.020729608833789825, 0.0023094257339835167, 0.04734959825873375, 0.007765107788145542, -0.011769433505833149, 0.019506221637129784, 0.03550087288022041, 0.02804727479815483, -0.034798555076122284, -0.0007929358398541808, -0.04653400927782059, -0.007810418028384447, 0.01750122755765915, -0.02229282446205616, 0.004783102311193943, 0.02111474983394146, -0.007974669337272644, 0.029542524367570877, 0.055143024772405624, 0.02535129152238369, -0.011678812094032764, -0.01669696345925331, -0.06674254685640335, -0.020627660676836967, -0.007595192641019821, 0.04211622104048729, -0.009011149406433105, 0.0006216050824150443, -0.02951986901462078, -0.008671320043504238, -0.02510208450257778, -0.0180902648717165, -0.01125968899577856, 0.0676034465432167, -0.03289550915360451, 0.02634812518954277, -0.06615350395441055, -0.05600392818450928, 0.004941689781844616, -0.0032283817417919636, -0.017625831067562103, -0.005675155203789473, 0.0006293928599916399, -0.07159078121185303, -0.006264193449169397, 0.024966152384877205, 0.05192597210407257, -0.011690139770507812, 0.05428212508559227, -0.009124426171183586, -0.02078624814748764, -0.037857022136449814, 0.013162734918296337, -0.0021253512240946293, 0.019257014617323875, 9.044424950843677e-05, -0.015292334370315075, -0.003925032448023558, -0.00175720255356282, -0.042206842452287674, -0.012596352957189083, 0.01650439389050007, 0.023187709972262383, 0.03128698468208313, -0.0001423921639798209, 0.023538867011666298, 0.05736324563622475, -0.040190521627664566, 0.026076262816786766, 0.025895019993185997, -0.01750122755765915, 0.012018642388284206, -0.012845560908317566, 0.028024619445204735, -0.026098918169736862, -0.004069460090249777, 0.04229746386408806, 0.006490746513009071, 0.056139860302209854, -0.041323285549879074, 0.01982339657843113, 0.005867725238204002, -0.01805628277361393, -0.08273719251155853, 0.027503546327352524, 0.054010260850191116, 0.05740855634212494, -0.020355796441435814, -0.02262132801115513, -0.0391257219016552, 0.019290996715426445, 0.002919703023508191, -0.017954332754015923, 0.0599912628531456, 0.0176484864205122, -0.06547384709119797, 0.029202695935964584, -0.024739598855376244, -0.007634839508682489, -0.036724258214235306, 0.05269625037908554, -0.01161084696650505, -0.03699612244963646, 0.000761076807975769, 0.0015802078414708376, -0.009141418151557446, 0.015745440497994423, 0.005587365943938494, 0.06692378968000412, 0.020423762500286102, 0.013072114437818527, 0.04698711261153221, -0.05224314704537392, 0.015881372615695, -0.053964950144290924, -0.04068893566727638, 0.0034266156144440174, -0.03076591156423092, 0.0010994905605912209, 0.009328324347734451, -0.02055969461798668, -0.020774919539690018, 0.013842394575476646, -0.04041707515716553, 0.09256959706544876, 0.03244240581989288, 0.013332650065422058, 0.002674742601811886, 0.03935227543115616, -0.015677474439144135, -0.01505445409566164, 0.01782972924411297, -0.03346189484000206, -0.019687464460730553, -0.001965348143130541, -0.026076262816786766, -0.016017304733395576, -0.011486242525279522, 0.019585516303777695, 0.03346189484000206, -0.01728600263595581, 0.010234536603093147, -0.005284351296722889, -0.03953351825475693, 0.02893083170056343, 0.0015348972519859672, 0.05015885829925537, 0.0335298590362072, 0.018543371930718422, -0.02988235466182232, -0.03772109001874924, 0.027798065915703773, -0.026325469836592674, 0.11019542813301086, -0.022338135167956352, -0.016968827694654465, 0.008195558562874794, 0.02782072126865387, 0.009135753847658634, -0.01982339657843113, -0.01952887699007988, -0.010166570544242859, 0.022202204912900925, 0.02929331548511982, -0.0031094413716346025, 0.016719618812203407, 0.014544709585607052, -0.0036644963547587395, -0.040145210921764374, -0.001519321696832776, 0.005108772311359644, 0.04875422641634941, 0.021092094480991364, 0.05428212508559227, 0.018146904185414314, 0.001870479085482657, -0.012902199290692806, 0.0629364550113678, -0.029837043955922127, -0.025396602228283882, -0.023244349285960197, 0.028545690700411797, 0.03439076244831085, 0.01643642783164978, -0.0599912628531456, -0.0057855998165905476, -0.007345984224230051, -0.008807252161204815, -0.023742765188217163, -0.009033804759383202, -0.012811577878892422, 0.000649216235615313, 0.020253848284482956, -0.000635056640021503, -0.0038032601587474346, 0.005134259816259146, -0.02464897744357586, 0.016459083184599876, 0.033371273428201675, 0.010313830338418484, 0.00833149068057537, -0.0065643759444355965, -0.022825224325060844, -0.02652936801314354, -0.007878384552896023, -0.002841825596988201, 0.0034662624821066856, 0.0388312004506588, -0.00961717963218689, -0.008688311092555523, -0.0314682275056839, -0.0019511885475367308, -0.005479753017425537, 0.033190030604600906, 0.016561031341552734, -0.006626678165048361, 0.03203460946679115, 0.0063491505570709705, 0.03364313766360283, -0.01901913248002529, 0.03051670268177986, -0.027254337444901466, 0.013944343663752079, 0.0180902648717165, -0.03405093029141426, 0.0126416627317667, 0.019245686009526253, -0.0027639479376375675, 0.05817883834242821, 0.0034889178350567818, 0.012222539633512497, 0.02347090095281601, -0.01054038293659687, 0.051608797162771225, 0.002092784270644188, 0.023674799129366875, -0.0022442915942519903, -0.01997065544128418, 0.011860054917633533, 0.003273692447692156, -0.007323328871279955, -0.021499888971447945, -0.007351648062467575, -0.02863631211221218, 0.02096748910844326, -0.007159078028053045, -0.05038541182875633, -0.0028970479033887386, 0.007867056876420975, -0.005530727561563253, 0.012517059221863747, -0.012856888584792614, -0.019007805734872818, 0.0029508541338145733, -0.005482585169374943, -0.021363956853747368, -0.024422423914074898, -0.05414619296789169, 0.03604459762573242, -0.024807564914226532, -0.029497213661670685, 0.006252865772694349, -0.026846542954444885, -0.020740937441587448, 0.026619989424943924, -0.010183561593294144, -0.020990144461393356, -0.020978817716240883, 0.044427063316106796, -0.006785265635699034, 0.018849218264222145, 0.027888687327504158, -0.004327164497226477, 0.0053211660124361515, 0.029383936896920204, 0.0018973822006955743, -0.05111037939786911, 0.01609659753739834, 0.008099273778498173, 0.004550885409116745, -0.04234277456998825, -0.006870222743600607, 0.028092585504055023, -0.0015858716797083616, -0.021828390657901764, -0.009917361661791801, 0.02992766536772251, -0.009198055602610111, -0.04503875598311424, 0.02276858687400818, 0.03636177256703377, -0.009481247514486313, 0.011288008652627468, -0.009407618083059788, 0.04422316700220108, -0.005066293757408857, -0.010806582868099213, 0.037789057940244675, -0.0035908666905015707, 0.015836061909794807, 0.029610490426421165, 0.020503055304288864, -0.03726798668503761, 0.046148866415023804, 0.05736324563622475, -0.008756277151405811, -0.023448245599865913, -0.05623048171401024, 0.0323517844080925, 0.02863631211221218, -0.0015986153157427907, -0.01864532008767128, 0.013128751888871193, 0.007872720248997211, -0.01820354163646698, 0.04893546923995018, 0.01731998473405838, 0.012902199290692806, 0.016923516988754272, -0.014612674713134766, -0.0016170227900147438, -0.007085448130965233, 0.012007314711809158, -0.01805628277361393, 0.021771753206849098, 0.019223030656576157, -0.0069778356701135635, 0.022508051246404648, -0.0367695689201355, 0.008456094190478325, -0.01525835134088993, 0.012856888584792614, -0.012754939496517181, 0.036203186959028244, 0.007821746170520782, 0.006688980385661125, 0.014080275781452656, 0.019687464460730553, -0.0063321590423583984, 0.008977166377007961, -0.0038287474308162928, -0.036429740488529205, 0.013242028653621674, 0.008014315739274025, 0.006196227390319109, -0.03932961821556091, -0.0046415068209171295, 0.02435445785522461, -0.02270062081515789, -0.00175720255356282, -0.07947482913732529, 0.0018591514090076089, 0.06153182312846184, 0.020899523049592972, 0.0344134159386158, 0.01931365206837654, 0.0014081691624596715, 0.02011791616678238, -0.006082950625568628, -0.050249479711055756, 0.02063898742198944, -0.01122004259377718, 0.02859100140631199, 0.005828078370541334, -0.04100611060857773, 0.05709138140082359, 0.0031660795211791992, -0.025509878993034363, 0.013604514300823212, 0.00025593419559299946, -0.02236079052090645, -0.018441421911120415, 0.0020347300451248884, -0.01967613771557808, 0.00876760482788086, -0.007674486376345158, 0.046148866415023804, -0.002465181052684784, -0.02605360746383667, -0.010149579495191574, -0.017931677401065826, 0.01494117733091116, -0.0493885762989521, 0.007091111969202757, 0.015904027968645096, 0.061667755246162415, 0.014034965075552464, 0.012449093163013458, 0.0019455248257145286, 0.032147884368896484, -0.018588682636618614, 0.025849709287285805, 0.026665300130844116, -0.053557153791189194, -0.022236187011003494, 0.039963968098163605, 0.025147395208477974, 0.013944343663752079, 0.007549882400780916, 0.012539714574813843, -0.005689315032213926, -0.03221585229039192, 0.0016779089346528053, -0.0043441555462777615, -0.0060999421402812, -0.0006070915260352194, 0.01293618232011795, -0.020389778539538383, 0.034141551703214645, 0.021069439128041267, -0.01893983967602253, -0.008744949474930763, -0.022677965462207794, 0.0012332984479144216, -0.024218527600169182, 0.021862374618649483, -0.030312804505228996, 0.013536548241972923, -0.011792088858783245, 0.005411787424236536, 0.0028800563886761665, 0.006853231228888035, -0.019392944872379303, -0.023380279541015625, 0.0007270938949659467, -0.03298613056540489, -0.05269625037908554, -0.009362307377159595, 0.014601347967982292, 0.028613656759262085, -0.01261900831013918, 0.025849709287285805, -0.03330330550670624, -0.0023901353124529123, 0.019358962774276733, 0.03944289684295654, 0.029678456485271454, -0.061486512422561646, -0.023969318717718124, -0.024490389972925186, -0.015836061909794807, 0.014793917536735535, 0.040960799902677536, -0.016561031341552734, 0.009345315396785736, -0.02535129152238369, 0.001999331172555685, -0.046148866415023804, -0.004593363963067532, -0.018373455852270126, -0.046194177120923996, -0.002928198780864477, 0.009424609132111073, 0.027186373248696327, -0.05582268536090851, -0.01361584197729826, 0.0027469564229249954, 0.014091603457927704, -0.010160906240344048, -0.01161084696650505, 0.0046330108307302, 0.002797930734232068, 0.011814744211733341, -0.057317934930324554, 0.011435267515480518, -0.08559176325798035, -0.020321812480688095, 0.0025048276875168085, -0.021511217579245567, 0.002674742601811886, 0.0005731085548177361, -0.028749588876962662, 0.01861133798956871, -0.009872051887214184, -0.02178308181464672, -0.010092941112816334, -0.01048374455422163, 0.03427748382091522, 0.04657931625843048, 0.02723168395459652, -0.02612157352268696, -0.005924363620579243, -0.0058847167529165745, -0.007345984224230051, -0.01020621694624424, 0.016017304733395576, 0.023720109835267067, -0.008223877288401127, 0.0004955849144607782, -0.058722563087940216, -0.032850198447704315, 0.011571199633181095, 0.03076591156423092, 0.029361281543970108, 0.0006488622748292983, -0.051790039986371994, 0.03482121229171753, -0.011299336329102516, 0.007312001194804907, -0.045265309512615204, 0.026370780542492867, 0.017863711342215538, -0.0029650137294083834, -0.023425590246915817, -0.02358417771756649, 0.04200294613838196, -0.0299956314265728, 0.015756769105792046, 0.0213299747556448, 0.05265093967318535, 0.005261695943772793, -0.0252833254635334, -0.01731998473405838, 0.008693975396454334, 0.021012799814343452, -0.023856041952967644, 0.016481738537549973, -0.010687642730772495, -0.009940017014741898, 0.057317934930324554, 0.023187709972262383, -0.03541025146842003, -0.008070954121649265, -0.020842885598540306, 0.0376531258225441, 0.0017359631601721048, -0.0014138330006971955, 0.01647040992975235, -0.02464897744357586, 0.009062124416232109, -0.02476225420832634, -0.040190521627664566, -0.02399197407066822, -0.03733595088124275, -0.002217388479039073, -0.003630513558164239, 0.010885876603424549, 0.008507069200277328, 0.021273337304592133, 0.013140079565346241, 0.00016752540250308812, 0.012585025280714035, 0.0420709103345871, 0.005230544600635767, 0.02693716436624527, 0.014578692615032196, 0.008252196945250034, -0.011984659358859062, 0.009135753847658634, -0.04256932809948921, 0.011180395260453224, 0.003525732783600688, 0.018475405871868134, 0.017297329381108284, -0.017512554302811623, 0.012075280770659447, 0.020627660676836967, 0.031037775799632072, -0.020208537578582764, -0.029497213661670685, 0.0024906680919229984, -0.009957008995115757, -0.0006814292282797396, 0.000881433195900172, 0.002443941542878747, 0.013525220565497875, 0.044019266963005066, -0.007153414189815521, 0.01243776548653841, 0.012347144074738026, 0.008076618425548077, 0.013106097467243671, 0.00677960179746151, 0.0030924498569220304, 0.043090399354696274, -0.015802079811692238, 0.00911876279860735, 0.00954354926943779, 0.04299977794289589, -0.019109753891825676, 0.0002575271646492183, 0.08663390576839447, -0.023334968835115433, -0.006875886581838131, 0.035908665508031845, 0.012165901251137257, 0.03932961821556091, -0.002432613866403699, -0.007731124758720398, 0.010636668652296066, 0.019959328696131706, -0.017478572204709053, -0.0005784183740615845, 0.007731124758720398, 0.0030273159500211477, -0.012732284143567085, 0.05623048171401024, -0.013910360634326935, 0.027798065915703773, -0.04227481037378311, 0.010381796397268772, 0.0004945229738950729, -0.02741292491555214, -0.05006823688745499, -0.02546456828713417, -0.01364982407540083, 0.010732953436672688, 0.051427554339170456, 0.007991660386323929, -0.02535129152238369, -0.039080411195755005, 0.00820122193545103, 0.035206351429224014, 0.037018775939941406, 0.006235874257981777, -9.327616135124117e-05, -0.005578869953751564, 0.013026803731918335, 0.059311602264642715, -0.03699612244963646, 0.013411943800747395, -0.010087276808917522, -0.01750122755765915, 0.0008658576407469809, -0.010772599838674068, -0.025600500404834747, 0.023006467148661613, -0.02899879775941372, -0.007793426979333162, 0.0016198547091335058, -0.020072605460882187, 0.0012892287923023105, 0.016606342047452927, -0.0076461671851575375, 0.06810186058282852, -0.028772244229912758, 0.016119252890348434, 0.00025221731630153954, -0.02616688422858715, 0.02126200869679451, 0.016628997400403023, 0.03507041931152344, 0.0029395264573395252, -0.017920350655913353, 0.03751719370484352, 0.0065757036209106445, 0.07163608819246292, -0.019812067970633507, -0.01679891347885132, -0.018690630793571472, -0.026506712660193443, 0.0005925779696553946, 0.02816055156290531, 0.0012863968731835485, -0.006643669679760933, 0.023720109835267067, 0.021715115755796432, -0.01816955953836441, 0.03076591156423092, 0.011871382594108582, 0.01797698810696602, 0.037970300763845444, 0.004916202276945114, -0.01614190824329853, 0.008212549611926079, -0.0027483722660690546, 0.023187709972262383, 0.011372965760529041, -0.018124248832464218, -0.007261027116328478, 0.00013964874960947782, -0.02458101138472557, -0.012086608447134495, -0.04297712445259094, 0.010914195328950882, 0.0037013113033026457, 0.007532890886068344, 0.010166570544242859, -0.002234379993751645, 0.0009203719673678279, -0.02517005056142807, -0.03527431935071945, -0.013389288447797298, -0.012097936123609543, -0.02671061083674431, -0.0079406863078475, -0.021952996030449867, -0.014216206967830658, -0.005975338164716959, 0.010228872299194336, 0.0016864046920090914, 7.57094458094798e-05, 0.03076591156423092, 0.038264818489551544, 0.00041345940553583205, 0.005193729884922504, -0.00899415835738182, -0.017184052616357803, -0.02258734405040741, 0.06773937493562698, 0.007765107788145542, 0.041368596255779266, -0.00820122193545103, -0.0232216939330101, 0.02405994012951851, 0.030244838446378708, 0.027435580268502235, -0.00019487107056193054, -0.006366142071783543, 0.03194398805499077, -0.011894037947058678, 0.01886054500937462, 0.018656648695468903, 0.0198573786765337, 0.017841055989265442, 0.005845069885253906, 0.0015490568475797772, 0.019846051931381226, 0.024784909561276436, 0.01481657288968563, -0.02399197407066822, -0.01661767065525055, 0.03350720554590225, 0.015802079811692238, 0.027095751836895943, 0.014952505007386208, 0.02023119293153286, -0.002343408763408661, 0.002455269219353795, 0.02929331548511982, -0.01520171295851469, -0.013525220565497875, 0.015371628105640411, 0.014397449791431427, 0.014420105144381523, -0.02822851575911045, 0.0033699774648994207, 0.0013118840288370848, 0.03262364864349365, 0.04739490896463394, -0.030788566917181015, -0.03783436864614487, -0.020242519676685333, -0.0034067921806126833, 0.02122802659869194, -0.040077243000268936, 0.0007285097963176668, -0.0006853231461718678, 0.016866877675056458, 0.01923435926437378, -0.02494349703192711, 0.018701959401369095, -0.02782072126865387, 0.016640326008200645, -0.04399661347270012, -0.003641841234639287, 0.016742274165153503, -0.02682388760149479, -0.013423271477222443, -0.018033627420663834, -0.00012832108768634498, 0.02682388760149479, 0.00018814527720678598, 0.030788566917181015, 0.023074433207511902, 0.023901352658867836, -0.031740088015794754, -0.0032142221461981535, 0.004313004668802023, 0.006485082674771547, 0.004723632242530584, -0.014352139085531235, 0.0015901195583865047, -0.033076751977205276, -0.015099764801561832, -0.023006467148661613, -0.004270526114851236, 0.006932524964213371, 0.03291816636919975, 0.007725460920482874, 0.01164482906460762, -0.012970165349543095, 0.0020715449936687946, -0.031219016760587692, 0.008643001317977905, -0.014963832683861256, 0.014850555919110775, 0.01990268938243389, 0.010330821387469769, 0.0041884006932377815, -0.009526558220386505, -0.024218527600169182, -0.004171409178525209, -0.020865540951490402, -0.0025274830404669046, 0.052786871790885925, 0.02904410846531391, -0.0017090599285438657, 0.0083824647590518, -0.011248361319303513, -0.030040942132472992, -0.03581804409623146, -0.030947154387831688, -0.006230210419744253, -0.012686973437666893, -0.03976006805896759, 0.013049459084868431, -0.031015120446681976, -0.021975651383399963, 0.015099764801561832, 0.014080275781452656, 0.029655801132321358, 0.018815236166119576, 0.018146904185414314, -0.019517550244927406, 0.05781635269522667, 0.021363956853747368, 0.022315479815006256, 0.0326463021337986, 0.0022598672658205032, 0.011067119427025318, 0.0003964679199270904, 0.013785756193101406, -0.0008304587099701166, -0.025328636169433594, -0.01426151767373085, 0.014510726556181908, -0.0004991248133592308, 0.005275855306535959, 0.009843732230365276, 0.004740623757243156, 0.0010237367823719978, 0.006411452777683735, -0.002364648040384054, 0.033031441271305084, 0.0022386277560144663, -0.007045801728963852, 0.007312001194804907, -0.015598180703818798, -0.011531553231179714, 0.018509387969970703, 0.0041940645314753056, -0.007935022003948689, 0.04916202276945114, 0.04062097147107124, -0.02623485028743744, -0.012131918221712112, 0.00021752637985628098, -0.023119743913412094, -0.01908709853887558, 0.004516902379691601, 0.006858895067125559, -0.00033664374495856464, -0.007935022003948689, -0.035795390605926514, 0.013751773163676262, -0.015371628105640411, 0.019426928833127022, 0.022066272795200348, -0.003508741268888116, 0.04671524837613106, 0.005839406047016382, -0.029202695935964584, -0.02582705393433571, 0.016198547556996346, 0.00518806604668498, -0.01758052036166191, -0.010024975053966045, -0.028862865641713142, 0.008427775464951992, -0.010308166034519672, 0.002691734116524458, 0.021420596167445183, 0.02816055156290531, 0.01643642783164978, 0.006388797424733639, 0.008592026308178902, 0.010919859632849693, 0.02196432277560234, 0.047258976846933365, -0.02671061083674431, 0.028908176347613335, -0.006858895067125559, -0.013865049928426743, 0.043611470609903336, 0.0009366555023007095, 0.023153727874159813, 0.0024977480061352253, -0.017048120498657227, 0.0037126389797776937, 0.007317665033042431, 0.0015363132115453482, -0.026959819719195366, 0.016368461772799492, -0.00987771525979042, 0.01020621694624424, -0.008478749543428421, -0.043973956257104874, -0.0009486911003477871, -0.040553007274866104, 0.0009529389790259302, -0.028024619445204735, -0.015394283458590508, 0.00792369432747364, -0.016538375988602638, 0.03629380837082863, -0.004652834497392178, -0.007804754190146923, -0.006994827184826136, -0.010715961456298828, 0.02881755493581295, 0.02310841716825962, -0.0057742721401154995, 0.013174062594771385, 0.025192705914378166, 0.008172903209924698, -0.015428266488015652, 0.03638442978262901, 0.0397147573530674, -0.03629380837082863, -0.006360478233546019, -0.044132545590400696, -0.013072114437818527, 0.009169736877083778, 0.027571512386202812, 0.013513892889022827, 0.008291843347251415, -0.022859208285808563, 0.0010789592051878572, -0.0011419692309573293, -0.027209028601646423, -0.0009444432216696441, 0.006445435807108879, -0.01481657288968563, -0.05310404673218727, 0.039261654019355774, 0.011565536260604858, 0.031604159623384476, -0.00469814520329237, -0.03350720554590225, 0.012313161045312881, -0.03321268409490585, -0.039193686097860336, 0.01105579175055027, 0.0007964757387526333, 0.008699638769030571, 0.02340293489396572, 0.022609999403357506, -0.012392454780638218, -0.026687955483794212, -0.014918521977961063, -0.01846407726407051, -0.04211622104048729, -0.00405530072748661, 0.013343977741897106, -0.008892209269106388, 0.012868216261267662, -0.028137896209955215, -0.01182607188820839, -0.0006570040131919086, -0.014023637399077415, -0.009537885896861553, -0.000872937438543886, 0.015167729929089546, 0.01758052036166191, -0.0004477963666431606, -0.007300673983991146, -0.001755786594003439, -0.04574107006192207, -0.005997993517667055, -0.02557784505188465, -0.020990144461393356, -0.0025473064742982388, -0.03772109001874924, 0.026098918169736862, 0.035364940762519836, 0.005513736046850681, 0.019290996715426445, -0.0012686974368989468, 0.0028899679891765118, 0.01684422232210636, 0.01170146744698286, 0.03423217311501503, 0.00653039338067174, -0.021103421226143837, -0.037857022136449814, 0.0034719263203442097, 0.024739598855376244, 0.005771440453827381, 0.016685636714100838, 0.010698970407247543, -0.0015717122005298734, 0.007872720248997211, -0.034798555076122284, -0.021567855030298233, -0.0005200101877562702, -0.006688980385661125, 0.01841876655817032, 0.012856888584792614, 0.019189048558473587, 0.009186727926135063, -0.03035811521112919, -0.01081791054457426, -0.024331802502274513, -0.012607680633664131, 0.00961717963218689, 0.0010315246181562543, -0.003871226217597723, -0.0308791883289814, 0.02137528546154499, 0.017625831067562103, -0.0048907152377069, -0.02181706391274929, 0.021986978128552437, 0.00020265883358661085, 0.05505240336060524, -0.007334656547755003, -0.020729608833789825, 0.011780761182308197, -0.02686919830739498, -0.01064799539744854, -0.014465415850281715, 0.027616823092103004, -0.02292717434465885, 0.0012099351733922958, -0.005420282948762178, 0.00044142454862594604, -0.0012807330349460244, 0.007867056876420975, 0.01293618232011795, 0.014895866625010967, 0.022236187011003494, -0.020469073206186295, 0.024716943502426147, -0.04956981912255287, -0.025011463090777397, -0.002140926895663142, 0.00860335398465395, 0.006898541934788227, 0.0024935000110417604, 0.017218036577105522, 0.04721366614103317, -0.037539850920438766, -0.01355920359492302, 0.025441912934184074, -0.01127668097615242, -0.004069460090249777, -0.011197387240827084, 0.0195628609508276, 0.03686019033193588, -0.018996477127075195, -0.02553253434598446, 0.0030556349083781242, 0.024150561541318893, -0.02126200869679451, -0.03710939735174179, 0.007782099302858114, -0.022791242226958275, 0.018985150381922722, 0.005060629919171333, 0.021873701363801956, 0.022156894207000732, -0.007918030954897404, 0.040371764451265335, 0.003633345477283001, -0.01431815605610609, 0.007011818699538708, -0.02623485028743744, 0.008807252161204815, 0.025691121816635132, -0.011044464074075222, 0.0007405454525724053, -0.018588682636618614, 0.006621014326810837, 0.03262364864349365, 0.04279588162899017, 0.0007285097963176668, 0.0320572629570961, -0.010574365966022015, 0.033914998173713684, 0.026098918169736862, -0.030969809740781784, -0.024445079267024994, 0.0008247948717325926, 0.031604159623384476, 0.010347813367843628, -0.0267559215426445, 0.008235204964876175, 0.02134130150079727, 0.005649668164551258, 0.03976006805896759, -0.002936694538220763, -0.012347144074738026, 0.0030612987466156483, -0.027276992797851562, -0.03035811521112919, -0.01414824090898037, -0.01565481908619404, -0.00798033270984888, -0.015575526282191277, 0.03386968746781349, -0.015179057605564594, -0.012335816398262978, 0.012211211957037449, 0.01650439389050007, 0.030629979446530342, -0.036429740488529205, 0.03244240581989288, -0.045967623591423035, 0.0023717277217656374, 0.03871792554855347, 0.012449093163013458, -0.015281006693840027, -0.007787763141095638, -0.02376542054116726, -0.02317638322710991, -0.05034010112285614, 0.01691218838095665, -0.01960817165672779, 0.005791263654828072, 0.017931677401065826, -0.004570709075778723, -0.01986870728433132, -0.04569575935602188, 0.009923025965690613, 0.01975543051958084, -0.016515720635652542, 0.020072605460882187, 0.00031381144071929157, 0.005493912845849991, -0.014680640771985054, -0.008031307719647884, 0.00044567242730408907, 0.017308657988905907, -0.0017218035645782948, 0.024377113208174706, -0.0088242432102561, 0.021363956853747368, -0.0350024551153183, -0.0017402110388502479, -0.013230700977146626, -0.040915489196777344, 0.0009741783724166453, 0.037857022136449814, -0.012788922525942326, -0.015983320772647858, 0.02111474983394146, -0.010160906240344048, 0.012585025280714035, -0.010727289132773876, -0.025623155757784843, -0.019846051931381226, 0.008405120112001896, 0.01155420858412981, -0.016119252890348434, -0.01287954393774271, 0.008416447788476944, -0.007589528802782297, 0.03110574185848236, -0.022462740540504456, 0.04150452837347984, -0.01449939887970686, -0.010851893573999405, 0.014170896261930466, -0.017263347283005714, 0.011242697946727276, 0.001871895045042038, -0.007991660386323929, -0.02976907789707184, -0.005975338164716959, 0.009866387583315372, -0.016425099223852158, -0.018396111205220222, -0.03346189484000206, -0.00558170210570097, 0.0004612479533534497, 0.028273826465010643, 0.021103421226143837, 0.027616823092103004, 0.010404450818896294, 0.023833386600017548, -0.0014881707029417157, 0.007408286444842815, -0.021613165736198425, -0.015462249517440796, -0.04028114303946495, 0.03289550915360451, 0.022632654756307602, -0.0018464077729731798, 0.0010230288607999682, -0.020537039265036583, -0.006065959110856056, -0.031037775799632072, -0.012120591476559639, 0.019370289519429207, 0.053602464497089386, 0.005833742208778858, -0.008818579837679863, -0.010449761524796486, -0.021239353343844414, 0.003944856114685535, 0.008150247856974602, -0.010608348995447159, -0.007867056876420975]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:47.286011", "url_path": "/api/models/mistral/", "chunk_size": 5000}
updated_dt: 2025-03-15T11:17:47.287520
---
t_parameters.result_tools:
      # Json Mode
      parameters_json_schemas = [tool.parameters_json_schema for tool in model_request_parameters.result_tools]
      user_output_format_message = self._generate_user_output_format(parameters_json_schemas)
      mistral_messages.append(user_output_format_message)
      response = await self.client.chat.stream_async(
        model=str(self._model_name),
        messages=mistral_messages,
        response_format={'type': 'json_object'},
        stream=True,
      )
    else:
      # Stream Mode
      response = await self.client.chat.stream_async(
        model=str(self._model_name),
        messages=mistral_messages,
        stream=True,
      )
    assert response, 'A unexpected empty response from Mistral.'
    return response
  def_get_tool_choice(self, model_request_parameters: ModelRequestParameters) -> MistralToolChoiceEnum | None:
"""Get tool choice for the model.
    - "auto": Default mode. Model decides if it uses the tool or not.
    - "any": Select any tool.
    - "none": Prevents tool use.
    - "required": Forces tool use.
    """
    if not model_request_parameters.function_tools and not model_request_parameters.result_tools:
      return None
    elif not model_request_parameters.allow_text_result:
      return 'required'
    else:
      return 'auto'
  def_map_function_and_result_tools_definition(
    self, model_request_parameters: ModelRequestParameters
  ) -> list[MistralTool] | None:
"""Map function and result tools to MistralTool format.
    Returns None if both function_tools and result_tools are empty.
    """
    all_tools: list[ToolDefinition] = (
      model_request_parameters.function_tools + model_request_parameters.result_tools
    )
    tools = [
      MistralTool(
        function=MistralFunction(name=r.name, parameters=r.parameters_json_schema, description=r.description)
      )
      for r in all_tools
    ]
    return tools if tools else None
  def_process_response(self, response: MistralChatCompletionResponse) -> ModelResponse:
"""Process a non-streamed response, and prepare a message to return."""
    assert response.choices, 'Unexpected empty response choice.'
    if response.created:
      timestamp = datetime.fromtimestamp(response.created, tz=timezone.utc)
    else:
      timestamp = _now_utc()
    choice = response.choices[0]
    content = choice.message.content
    tool_calls = choice.message.tool_calls
    parts: list[ModelResponsePart] = []
    if text := _map_content(content):
      parts.append(TextPart(content=text))
    if isinstance(tool_calls, list):
      for tool_call in tool_calls:
        tool = self._map_mistral_to_pydantic_tool_call(tool_call=tool_call)
        parts.append(tool)
    return ModelResponse(parts, model_name=response.model, timestamp=timestamp)
  async def_process_streamed_response(
    self,
    result_tools: list[ToolDefinition],
    response: MistralEventStreamAsync[MistralCompletionEvent],
  ) -> StreamedResponse:
"""Process a streamed response, and prepare a streaming response to return."""
    peekable_response = _utils.PeekableAsyncStream(response)
    first_chunk = await peekable_response.peek()
    if isinstance(first_chunk, _utils.Unset):
      raise UnexpectedModelBehavior('Streamed response ended without content or tool calls')
    if first_chunk.data.created:
      timestamp = datetime.fromtimestamp(first_chunk.data.created, tz=timezone.utc)
    else:
      timestamp = datetime.now(tz=timezone.utc)
    return MistralStreamedResponse(
      _response=peekable_response,
      _model_name=self._model_name,
      _timestamp=timestamp,
      _result_tools={c.name: c for c in result_tools},
    )
  @staticmethod
  def_map_mistral_to_pydantic_tool_call(tool_call: MistralToolCall) -> ToolCallPart:
"""Maps a MistralToolCall to a ToolCall."""
    tool_call_id = tool_call.id or None
    func_call = tool_call.function
    return ToolCallPart(func_call.name, func_call.arguments, tool_call_id)
  @staticmethod
  def_map_pydantic_to_mistral_tool_call(t: ToolCallPart) -> MistralToolCall:
"""Maps a pydantic-ai ToolCall to a MistralToolCall."""
    return MistralToolCall(
      id=t.tool_call_id,
      type='function',
      function=MistralFunctionCall(name=t.tool_name, arguments=t.args),
    )
  def_generate_user_output_format(self, schemas: list[dict[str, Any]]) -> MistralUserMessage:
"""Get a message with an example of the expected output format."""
    examples: list[dict[str, Any]] = []
    for schema in schemas:
      typed_dict_definition: dict[str, Any] = {}
      for key, value in schema.get('properties', {}).items():
        typed_dict_definition[key] = self._get_python_type(value)
      examples.append(typed_dict_definition)
    example_schema = examples[0] if len(examples) == 1 else examples
    return MistralUserMessage(content=self.json_mode_schema_prompt.format(schema=example_schema))
  @classmethod
  def_get_python_type(cls, value: dict[str, Any]) -> str:
"""Return a string representa