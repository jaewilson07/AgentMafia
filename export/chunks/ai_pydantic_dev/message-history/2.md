---
url: https://ai.pydantic.dev/message-history/
session_id: pydantic_ai_docs
chunk_number: 2
title: Using Pydantic AI Agent for Streaming Responses
summary: This documentation chunk provides an example of how to use the Pydantic AI Agent to handle a user request for a joke. It showcases the asynchronous execution of requests, including modeling the system prompt, capturing both system and user inputs, and streaming text responses from the agent.
embedding: [-0.002331544877961278, 0.0027895544189959764, -0.01219104416668415, -0.018148241564631462, 0.006492053624242544, 0.01700475439429283, -0.009867183864116669, -0.0019181068055331707, -0.003093869425356388, -0.015012874267995358, -0.014607121236622334, -0.03007493168115616, 0.010094651952385902, -0.025648530572652817, -0.014139889739453793, -0.004663089755922556, -0.02273448370397091, 0.011348798871040344, 0.014803850091993809, 0.0281568244099617, 0.04679688811302185, 0.04455909505486488, 0.02537802793085575, 0.021726248785853386, 0.021873794496059418, -0.0016414567362517118, -0.03587843477725983, 0.0650188997387886, 0.008988051675260067, -0.05405126512050629, -0.013340678997337818, -0.0039468733593821526, -0.037403080612421036, 0.016402272507548332, 0.00040152674773707986, 0.010395892895758152, 0.01589815504848957, -0.012861152179539204, 0.005456153303384781, -0.0022639192175120115, 0.008404012769460678, -0.0392720066010952, 0.05242825299501419, 0.0479772612452507, -0.0029540073592215776, 0.058035027235746384, 0.0013017919845879078, 0.04920681565999985, -0.0014600972644984722, 0.01498828362673521, -0.03435378521680832, 0.034230828285217285, -0.004666163586080074, -0.0241976547986269, -0.004610833711922169, -0.02879619225859642, -0.02198445424437523, -0.0044294740073382854, -0.025402618572115898, -0.0301487036049366, 0.011102887801826, -0.004177415277808905, -0.01316854078322649, 0.02284514345228672, -0.02145574614405632, -0.026312490925192833, -0.029238833114504814, 0.042567215859889984, -0.0380670428276062, 0.03236190602183342, 0.02673053927719593, 0.008846652694046497, -0.05783829838037491, -0.01910729520022869, -0.046993616968393326, -0.04345249757170677, 0.02014012075960636, 0.08700335770845413, 0.03204222023487091, -0.04298526421189308, 0.0031599579378962517, 0.006590418051928282, -0.0022055155131965876, 0.021123765036463737, -0.022980395704507828, -0.008526968769729137, -0.03981301188468933, 0.0014308954123407602, -0.01942697912454605, -0.05419881269335747, -0.011053705587983131, 0.020152416080236435, -0.032017629593610764, 0.025599347427487373, 0.07003548741340637, 0.0033874257933348417, -0.029017513617873192, -0.011779142543673515, 0.017226073890924454, 0.0022224218118935823, 0.06054332107305527, -0.0547398179769516, -0.06851083785295486, 0.030591344460844994, 0.02156640589237213, 0.01126272976398468, 0.03609975427389145, 0.008545411750674248, -0.049452729523181915, -0.0017920773243531585, -0.07288806140422821, 0.015799790620803833, 0.021541815251111984, -0.009953252971172333, -0.07431434094905853, 0.012166452594101429, -0.00585268484428525, -0.018553994596004486, 0.04974782094359398, -0.01096148882061243, -0.035903025418519974, -0.0026235643308609724, -0.0035196030512452126, -0.005071917083114386, 0.01407841220498085, -0.014693189412355423, -0.027886321768164635, -0.03440296649932861, -0.018308082595467567, 0.004085198510438204, 0.03204222023487091, -0.026558401063084602, 0.015873562544584274, -0.026705948635935783, -0.021750839427113533, 0.004100568126887083, -0.008379421196877956, -0.021800020709633827, -0.031304486095905304, 0.05257580056786537, 0.026435445994138718, -0.03789490461349487, -0.047485437244176865, 0.008274909108877182, -0.00868066307157278, 0.02459111250936985, -0.05680546909570694, 0.0010289843194186687, -0.03204222023487091, -0.012689013965427876, 0.033124227076768875, 0.048592038452625275, -0.03127989545464516, -0.0034581252839416265, -0.016918685287237167, 0.016599001362919807, -0.004844448994845152, 0.037575218826532364, 0.005536074284464121, -0.04507550969719887, -0.01219104416668415, 0.026312490925192833, -0.032165177166461945, -0.026755129918456078, -0.02990279346704483, -0.02130819857120514, 0.00034350709756836295, -0.03307504579424858, -0.017275257036089897, -0.02950933575630188, -0.015406331978738308, -0.023853380233049393, -0.011711517348885536, 0.018012989312410355, 0.014730076305568218, -0.020693421363830566, -0.09413477778434753, -0.07795383036136627, -0.041755709797143936, -0.01927943155169487, 0.00571128586307168, -0.00994095765054226, -0.07647836208343506, -0.061281051486730576, -0.018222015351057053, -0.010924601927399635, 0.005526852793991566, 0.02070571668446064, 0.01277508307248354, 0.03246026858687401, 0.0124000683426857, 0.017594940960407257, 0.031058575958013535, 0.020767195150256157, -0.0021932199597358704, -0.019894210621714592, 0.048100218176841736, -0.005041178315877914, 0.009455283172428608, 0.03157498687505722, 0.03755062818527222, 0.02641085535287857, 0.013623476028442383, -0.015799790620803833, -0.022144297137856483, -0.05380535498261452, 0.007666279561817646, 0.020410623401403427, -0.05292007327079773, -0.014299731701612473, 0.031525805592536926, -0.03563252091407776, 0.004352626856416464, -0.02665676549077034, -0.03538661077618599, -0.004158971831202507, -0.0975283533334732, 0.025820668786764145, -0.06074004992842674, 0.03155039623379707, -0.022537754848599434, 0.028697827830910683, 0.03846050053834915, -0.043919727206230164, 0.00930158793926239, 0.02089015021920204, -0.012074236758053303, -0.037230946123600006, -0.0027265397366136312, 0.037870313972234726, 0.03514070063829422, -0.03179631009697914, -0.014201367273926735, -0.03983760252594948, 0.0476083941757679, -0.04313281178474426, 0.0075125847943127155, 0.005148764234036207, 0.04259180650115013, 0.008299500681459904, -0.011127478443086147, -0.007881451398134232, 0.030099522322416306, 0.019734367728233337, 0.012449250556528568, 0.03164876252412796, -0.022181183099746704, -0.06437953561544418, 0.03489479050040245, 0.028206005692481995, 0.05478899925947189, -0.04480500891804695, -0.009602829813957214, 0.007352742832154036, -0.00556988688185811, -0.030960211530327797, -0.04571487754583359, -0.023226305842399597, -0.040649108588695526, 0.017447395250201225, 0.010986079461872578, -0.009529056027531624, -0.038903139531612396, 0.040108103305101395, -0.003399721346795559, -0.01468089409172535, 0.004853670950978994, -0.02098851464688778, -0.007660131435841322, -0.04593619704246521, 0.0289437398314476, -0.008865095674991608, 0.03324718400835991, 0.025033753365278244, -0.042468853294849396, 0.027394499629735947, -0.02537802793085575, 0.021787725389003754, 0.0158612672239542, 0.004386439919471741, -0.006633452605456114, -0.004487878177314997, 0.033517684787511826, 0.0015784420538693666, -0.012639831751585007, -0.0054530794732272625, 0.025255072861909866, 0.00832409132272005, -0.025894442573189735, 0.010365153662860394, 0.02896833047270775, 0.0309356190264225, 0.024529634043574333, -0.023029576987028122, 0.04991995915770531, 0.019832732155919075, 0.044141046702861786, 0.03801786154508591, -0.00684247724711895, 0.003959169145673513, 0.007580210454761982, -0.026681357994675636, 0.026140352711081505, -0.01074631605297327, -0.030271660536527634, 0.05380535498261452, -0.02130819857120514, -0.024996865540742874, 0.04101797565817833, -0.013795614242553711, 0.004598537925630808, 0.028599463403224945, -0.020939333364367485, -0.01019301638007164, -0.021025400608778, -0.024468157440423965, 0.041362252086400986, -0.0459853820502758, 0.03260781615972519, -0.0092155197635293, -0.0515429712831974, -0.011416424065828323, 0.03587843477725983, -0.02373042330145836, -0.055723462253808975, -0.007549471687525511, -0.007125274743884802, -0.01340215653181076, -0.032632406800985336, 0.05892030522227287, -0.00935691874474287, -0.026214126497507095, 0.02370583266019821, 0.037329308688640594, 0.03410787507891655, -0.013475929386913776, -0.05114951357245445, -0.010303676128387451, 0.012535319663584232, 0.06806819885969162, -0.023828787729144096, 0.010734020732343197, -0.041067156940698624, -0.02095162868499756, -0.02926342375576496, -0.0038546568248420954, 0.03061593510210514, 0.05892030522227287, -0.05100196599960327, -0.012104975059628487, 0.035657115280628204, 0.025119822472333908, 0.0412638857960701, 0.008090476505458355, 0.01503746584057808, -0.023361556231975555, -0.00860688928514719, 0.021222129464149475, 0.011090591549873352, -0.007026910316199064, -0.044214822351932526, 0.014742371626198292, -0.002611268777400255, 0.00700231920927763, -0.02958310768008232, 0.019414683803915977, -0.040255650877952576, -0.027861731126904488, -9.44740604609251e-05, 0.016525227576494217, 0.03578006848692894, 0.004650793969631195, -0.012436955235898495, -0.022390207275748253, -0.023939447477459908, -0.023115646094083786, -0.026214126497507095, -0.0008522357675246894, 0.0006731817265972495, 0.0412638857960701, 0.01881220191717148, 0.01952534355223179, -0.00028491110424511135, -0.012043497525155544, -0.004386439919471741, 0.03991137444972992, 0.01345133874565363, 0.0014808460837230086, -0.02751745469868183, 0.0337144173681736, 0.08159331232309341, -0.03794408589601517, -0.03464887663722038, 0.041927848011255264, 0.002054894808679819, 0.025894442573189735, -0.00686092022806406, 2.3978736862773076e-05, 0.04030483216047287, 0.0124922851100564, -0.004438695963472128, 0.008158101700246334, -0.005379305686801672, 0.04293608292937279, 0.001653752289712429, -0.011619300581514835, 0.02288203127682209, 0.019402388483285904, -0.007180605083703995, -0.002270067110657692, 0.04377217963337898, -0.0150743518024683, 0.0007757727871648967, 0.001715230057016015, -0.03666535019874573, -0.03196844831109047, 0.001818205346353352, 0.01946386508643627, 0.05724811181426048, 0.01899663545191288, -0.0022178110666573048, -0.07987193763256073, 0.00844704732298851, -0.0007269747438840568, -0.03750144690275192, 0.06246142461895943, 0.023263191804289818, -0.07190441340208054, 0.01193898543715477, -0.018443334847688675, -0.03349309414625168, 0.016586706042289734, 0.010315971449017525, 0.003421238623559475, 0.01736132614314556, -0.02376731112599373, 0.023250896483659744, 0.02491079643368721, -0.017976103350520134, -0.019857322797179222, 0.03078807331621647, -0.015812085941433907, 0.01642686314880848, 0.038116224110126495, -0.03673912212252617, -0.03595220670104027, -0.04497714340686798, -0.011428719386458397, 0.050657693296670914, -0.029607700183987617, 0.023853380233049393, -0.016377681866288185, -0.05508409067988396, -0.01892286166548729, -0.03078807331621647, -0.02333696559071541, 0.052329886704683304, 0.03794408589601517, 0.0531659871339798, -0.026041988283395767, 0.003461199114099145, -0.01618095301091671, -0.011736108921468258, 0.016377681866288185, -0.008686810731887817, -0.010149981826543808, 0.04711657017469406, -0.016168655827641487, -0.017090823501348495, 0.039862193167209625, 0.012627536430954933, -0.005038104020059109, -0.005563739221543074, -0.0011688462691381574, -0.003565711434930563, -0.032558634877204895, 0.02416076883673668, 0.045616514980793, -0.005846537183970213, -0.002097929362207651, 0.037083398550748825, 0.0010182257974520326, 0.003596450202167034, -0.013672658242285252, -0.04394431784749031, 0.02855028212070465, -0.010777055285871029, -0.07741282135248184, 0.0068178861401975155, -0.006255364511162043, -0.03659157454967499, 0.009270849637687206, 0.04008351266384125, -0.011674630455672741, 0.020164713263511658, 0.009793411009013653, -0.02633708156645298, -0.02124672196805477, 0.022082818672060966, -0.01995568722486496, -0.015332559123635292, -0.0164637491106987, -0.03538661077618599, 0.034796424210071564, 0.025279663503170013, -0.03996055945754051, 0.023828787729144096, -0.007574062794446945, 0.011619300581514835, 0.06314997375011444, -0.01219104416668415, -0.017828557640314102, 0.0013117821654304862, 0.013525111600756645, 0.017951512709259987, -0.011668482795357704, -0.012129566632211208, 0.026066578924655914, -0.0011281173210591078, 0.03037002496421337, 0.0281568244099617, -0.01436121016740799, 0.013365269638597965, 0.0007515659090131521, 0.0047614541836082935, 0.0011288857785984874, 0.0022977320477366447, -0.005969492718577385, 0.004005277529358864, -0.01372184045612812, 0.04197702929377556, 0.002955544274300337, 0.02665676549077034, -0.008102771826088428, -0.005151838064193726, 0.0014816145412623882, -0.012363182380795479, 0.008434752002358437, -0.02904210425913334, -0.003811622504144907, -0.009805706329643726, 0.031771719455718994, -0.025353437289595604, 0.007463402580469847, -0.009504465386271477, 0.017717896029353142, 0.01888597384095192, -0.001187289715744555, -0.007856860756874084, 0.015123534016311169, 0.02982901968061924, -0.011133626103401184, 0.01974666304886341, -0.029681473970413208, 0.025648530572652817, -0.005071917083114386, -0.02555016614496708, 0.009461430832743645, 0.019119590520858765, -0.004487878177314997, -0.021972158923745155, -0.009289292618632317, 0.013156245462596416, 0.007604801561683416, -0.004656942095607519, 0.027566637843847275, 0.0507560558617115, 0.023189419880509377, -0.032017629593610764, 0.017201483249664307, 0.04687066003680229, 0.004878262057900429, -0.0036640758626163006, 0.009467578493058681, -0.0040452382527291775, -0.008570002391934395, 0.012498432770371437, -0.005462300963699818, -0.061871238052845, 0.02373042330145836, -0.0003325563739053905, -0.01856628991663456, 0.03671453148126602, 0.02904210425913334, -0.0017505798023194075, -0.00944298692047596, -0.017349030822515488, 0.007131422869861126, -0.004211227875202894, -0.007057649549096823, 0.00821343157440424, -0.011195103637874126, 0.01079549826681614, 0.0012902648886665702, -0.04625588282942772, 0.022586936131119728, 0.0013094767928123474, 0.007906042970716953, -0.05685465410351753, 0.012135714292526245, 0.05134624242782593, -0.018504811450839043, -0.034624285995960236, 0.031943853944540024, 0.023152532055974007, 0.013807909563183784, -0.016943275928497314, -0.006264586001634598, -0.017705600708723068, -0.0035718590952455997, 0.004048312082886696, -0.010678690858185291, -0.02648462913930416, -0.04332954064011574, -0.03516529127955437, -0.022463981062173843, -0.05995313450694084, 0.02680431306362152, 0.06300242990255356, -0.0124000683426857, -0.014840736985206604, 0.03578006848692894, 0.008699106052517891, 0.012430807575583458, 0.009529056027531624, 0.006261512171477079, -0.023816492408514023, -0.0008345608948729932, -0.029337197542190552, 0.01044507510960102, -0.007850713096559048, 0.007924485951662064, 0.047878894954919815, 0.028771601617336273, -0.015492401085793972, -0.004361848812550306, 0.005914162378758192, -0.0009567479719407856, -0.0016061069909483194, -0.02373042330145836, 0.01559076551347971, 0.0041251592338085175, 0.025402618572115898, -0.01238162536174059, 0.01538174133747816, 0.012523024342954159, -0.019340910017490387, 0.04401809349656105, 0.012160304933786392, -0.009639715775847435, -0.013525111600756645, -0.019131885841488838, 0.03587843477725983, 0.008969608694314957, 0.0033413174096494913, -0.004902853164821863, 0.002416076837107539, -0.00482907984405756, -0.014459574595093727, -0.005068843252956867, -0.04187866672873497, 0.020877854898571968, -0.02020159922540188, 0.032558634877204895, -0.0048413751646876335, 0.026828903704881668, 0.02138197235763073, 0.010432779788970947, 0.030591344460844994, 0.01222178339958191, 0.0044725085608661175, 0.006092448253184557, 0.03467346727848053, -0.021554110571742058, -0.0014447278808802366, 0.0005559896817430854, 0.006110891699790955, -0.034943971782922745, -0.008422455750405788, 0.038976915180683136, -0.012246374040842056, -0.012824265286326408, -0.047805123031139374, 0.03759981319308281, 0.050338007509708405, -0.012689013965427876, 0.003206066321581602, 0.002423761645331979, 0.005803502630442381, 0.011287320405244827, -0.0038269918877631426, -0.05498572811484337, -0.020718012005090714, 0.02879619225859642, 0.04566569626331329, 0.012701309286057949, -0.009221667423844337, 0.017410507425665855, -0.004678459372371435, -0.041460614651441574, -0.028427327051758766, -0.024050109088420868, -0.0042050802148878574, 0.016512932255864143, -0.0136849544942379, -0.02626330778002739, -0.028255188837647438, 0.0313536673784256, 0.025070639327168465, -0.003482716390863061, -0.031230712309479713, 0.021443450823426247, -0.005185650661587715, 0.029927384108304977, -0.0071006836369633675, -0.01063565630465746, -0.02188608981668949, 0.014447278343141079, 0.0035687852650880814, -0.02074260264635086, 0.009369214065372944, 0.01702934503555298, -0.03959169238805771, 0.010180721059441566, 0.010027025826275349, -0.040108103305101395, -0.011459458619356155, 0.04087042808532715, -0.021996749565005302, 0.02273448370397091, -0.01984502747654915, -0.0018981265602633357, 0.020115530118346214, -0.019771255552768707, -0.026312490925192833, 0.001048196223564446, -0.055477552115917206, 0.03442755714058876, -0.002981672529131174, 0.005327049642801285, -0.007174456957727671, -0.014496460556983948, 0.009486021474003792, -0.013488225638866425, 0.010641803964972496, -0.007420368492603302, -0.014963692054152489, 0.023300079628825188, -0.020976219326257706, 0.02331237494945526, -0.03226353973150253, 0.009117155335843563, -0.00464157247915864, -0.008348682895302773, 0.025525575503706932, 0.012811969965696335, 0.027419090270996094, 0.012215634807944298, -0.05562509596347809, 0.01702934503555298, -0.001981121487915516, 0.027812547981739044, -0.03789490461349487, 0.0531659871339798, -0.016881799325346947, -0.01037130132317543, 0.042001619935035706, 0.018049877136945724, -0.0021132987458258867, -0.02958310768008232, -0.025095229968428612, -0.011600857600569725, 0.02673053927719593, 0.025845259428024292, 0.047091979533433914, -0.041534390300512314, 0.03464887663722038, -0.0068547725677490234, 0.04812480881810188, -0.02376731112599373, 0.010359006002545357, 0.0059817880392074585, -0.01742280274629593, -0.0021732395980507135, 0.020250780507922173, -0.013316087424755096, -0.02198445424437523, -0.011594709940254688, -0.01538174133747816, -0.02569771185517311, -0.03253404051065445, -0.022107411175966263, 0.037230946123600006, 0.014484165236353874, 0.005090360529720783, -0.01149634551256895, 0.019267136231064796, -0.06772392243146896, -0.03127989545464516, 0.04979700222611427, -0.03435378521680832, 0.009147893637418747, -0.015246490016579628, -0.03531283885240555, 0.02705022320151329, -0.021689360961318016, -0.035091519355773926, 0.01042663212865591, -0.019340910017490387, 0.010697133839130402, -0.03054216131567955, 0.03789490461349487, -0.00612011319026351, -0.0019949539564549923, -0.01400463841855526, 0.01589815504848957, -0.023029576987028122, -0.01661129668354988, 0.005588330328464508, -0.05355944484472275, 0.01899663545191288, 0.005357788875699043, -0.007746200542896986, -0.014939101412892342, 0.02918964996933937, 0.02862405590713024, -0.019045816734433174, -0.031230712309479713, -0.02152951993048191, 0.0024714069440960884, -0.0030523717869073153, -0.06162532791495323, 0.041608162224292755, 0.004604686051607132, 0.04315740242600441, 0.01753346249461174, -0.0313536673784256, 0.0071437181904911995, -0.003461199114099145, -0.010856975801289082, -0.00662115728482604, 0.018615473061800003, 0.00814580637961626, -0.014299731701612473, 0.015406331978738308, -0.0036425585858523846, 0.032558634877204895, 0.006547383964061737, -0.011822177097201347, -0.012344738468527794, 0.011367241851985455, 0.037476856261491776, 0.034943971782922745, -0.055330004543066025, -0.004878262057900429, -0.007641688454896212, 0.004853670950978994, -0.010561882518231869, -0.010979931801557541, -0.003953021485358477, -0.016721956431865692, 0.01203120220452547, -0.009412248618900776, -0.01498828362673521, 0.01209882739931345, 0.006095522083342075, 0.0025528648402541876, -0.03538661077618599, 0.013525111600756645, -0.0011719202157109976, -0.0003842361329589039, 0.005259424448013306, 0.020693421363830566, 0.00577276386320591, 0.021369677037000656, -0.001411683508194983, 0.007826121523976326, 0.03100939281284809, -0.016918685287237167, 0.03624730184674263, 0.030591344460844994, -0.035903025418519974, 0.03705880790948868, 0.027861731126904488, -0.017767079174518585, -0.009350770153105259, 0.029410971328616142, 0.038263771682977676, 0.005342419259250164, -0.006946989335119724, -0.005253276322036982, -0.01563994772732258, -0.011963576078414917, -0.028747010976076126, 0.04212457686662674, 0.008410160429775715, -0.026361672207713127, 0.04814939945936203, 0.024332905188202858, -0.008041294291615486, -0.011133626103401184, -0.023103350773453712, 0.030320841819047928, -0.03297668322920799, -0.015443218871951103, 0.00745725492015481, 0.030566753819584846, 0.01610717922449112, -9.125607903115451e-05, -0.015295672230422497, 0.020767195150256157, -0.011809881776571274, -0.023435330018401146, 0.06541235744953156, -0.018295787274837494, -0.03639484569430351, 0.0023499883245676756, -0.0031138495542109013, 0.014803850091993809, -0.013832501135766506, 0.02288203127682209, 0.0017352104187011719, 0.006762555800378323, -0.056608740240335464, 0.0066518960520625114, 0.007973668165504932, 0.004395661409944296, -0.005766615737229586, 0.023324670270085335, -0.03511610999703407, 0.03100939281284809, -0.04812480881810188, -0.0008991125505417585, 0.006719521712511778, -0.03641943633556366, -0.034796424210071564, -0.03909986838698387, -0.011766847223043442, -0.01475466787815094, -0.002293121302500367, -0.011613152921199799, -0.04901008680462837, -0.02448045276105404, 0.050018321722745895, 0.0026251012459397316, -0.00844704732298851, -0.022291842848062515, 0.014348913915455341, 0.0031230712775141, 0.009381509386003017, 0.008238023146986961, -0.0035073074977844954, 0.04888713359832764, -0.01439809612929821, -0.02896833047270775, -0.011889803223311901, -0.0006558910827152431, -0.007371185813099146, 0.05292007327079773, 0.003811622504144907, -0.004610833711922169, 0.019144181162118912, -0.014275141060352325, -0.008268761448562145, -0.02095162868499756, -0.015123534016311169, 0.034476738423109055, -0.023263191804289818, 0.016844911500811577, 0.015049761161208153, -0.00997784361243248, 0.027861731126904488, 0.045346010476350784, 0.04615752026438713, -0.006498201750218868, 0.0024176137521862984, 0.040821246802806854, -0.021910682320594788, 0.04507550969719887, 0.0009790336480364203, -0.013156245462596416, 0.006879363674670458, 0.019021226093173027, 0.02006634883582592, 0.023435330018401146, -0.0235951729118824, 0.005207167938351631, 0.03895232081413269, -0.005250202491879463, -0.013303792104125023, 0.033443912863731384, 0.005004291422665119, 0.011207399889826775, 0.028304370120167732, 0.010752463713288307, -0.03007493168115616, 0.0041466765105724335, -0.005225611384958029, 0.03302586451172829, 0.001257989089936018, -0.04610833525657654, 0.016021110117435455, 0.0634450688958168, -0.009104859083890915, 0.003903839038684964, -0.00975037645548582, 0.013279200531542301, -0.00684247724711895, -0.003820844227448106, 0.014434983022511005, -0.0038976913783699274, -0.023656649515032768, -0.007444959599524736, -0.03823918104171753, 0.002883307868614793, -0.009080268442630768, -0.014164481312036514, -0.030025748535990715, 0.002565160393714905, -0.01372184045612812, 0.024222245439887047, -0.00868066307157278, 0.019549934193491936, -0.008028998039662838, 0.017619531601667404, 0.011348798871040344, -0.002271604025736451, -0.0011826788540929556, 0.002672746544703841, -0.026164943352341652, 0.006910102441906929, 0.0488133579492569, -0.02990279346704483, 0.004795266781002283, -0.006375245749950409, 0.017705600708723068, -0.002025692956522107, -0.017508871853351593, 0.018799906596541405, -0.030247068032622337, -0.04701820760965347, 0.0384850911796093, 0.006279955618083477, 0.03983760252594948, 0.04244425892829895, 0.008846652694046497, 0.009117155335843563, 0.00365792796947062, 0.02252545952796936, 0.00030354654882103205, -0.03381277993321419, 0.04928059130907059, -0.024369793012738228, 0.00437414413318038, 0.02641085535287857, -0.00715601397678256, 0.031697943806648254, 0.012283260934054852, 0.015283376909792423, 0.026533810421824455, -0.027861731126904488, -0.0058434633538126945, -0.04062451794743538, -0.03366523236036301, 0.017705600708723068, 0.016672775149345398, 0.02387797087430954, -0.019131885841488838, 0.02234102599322796, 0.01439809612929821, -0.0009190928540192544, 0.005370084196329117, -0.021037697792053223, -0.033345550298690796, -0.00646746251732111, -0.008969608694314957, -0.015172716230154037, -0.05626446753740311, -0.014496460556983948, -0.026705948635935783, -0.032091401517391205, 0.019340910017490387, -0.010783202946186066, -0.009326179511845112, -0.05355944484472275, 0.038681820034980774, 0.027787957340478897, 0.01792692206799984, 0.01277508307248354, -0.009061825461685658, -0.031378258019685745, 0.007487993687391281, -0.014975987374782562, -0.011428719386458397, 0.04209998622536659, 0.0018151315161958337, -0.006910102441906929, -0.0034765684977173805, -0.01074631605297327, -0.0016721956199035048, 0.010272936895489693, -0.013881683349609375, 0.0018766092834994197, 0.013033289462327957, -0.029484743252396584, 0.037870313972234726, 0.008883539587259293, -0.0595104917883873, 0.007297412492334843, 0.031230712309479713, -0.008545411750674248, 0.017336733639240265, 0.008926574140787125, -0.04337872192263603, -0.026140352711081505, -0.01632849872112274, -0.007506437133997679, -0.01582438126206398, 0.04079665616154671, 0.02491079643368721, 0.00684247724711895, 0.007697018329054117, -0.033837370574474335, 0.007740052882581949, -0.002463722135871649, 0.02800927683711052, -0.0074326638132333755, 0.05114951357245445, 0.0007281274884007871, 0.009541351348161697, 0.010272936895489693, -0.07810137420892715, 0.017152301967144012, -0.04679688811302185, -0.00018558606097940356, 0.0014716243604198098, -0.0349193811416626, 0.0026865790132433176, -0.005954123102128506, -0.008649923838675022, -0.0012910334626212716, 0.02205822803080082, -0.03150121495127678, 0.012959516607224941, -0.012018905952572823, 0.008102771826088428, 0.024074699729681015, 0.06610091030597687, 0.013906273990869522, -0.031033983454108238, 0.01717689260840416, 0.016586706042289734, 0.005729729309678078, 0.003246026812121272, -0.00876673124730587, -0.008945017121732235, -0.02886996604502201, -0.009350770153105259, 0.028599463403224945, 0.02601739764213562, -0.028132233768701553, 0.026164943352341652, -0.013820204883813858, -0.0017536537488922477, 0.005394675303250551, 0.032952092587947845, -0.016623592004179955, 0.023152532055974007, 0.026435445994138718, -0.0022285697050392628, -0.030124112963676453, -0.00851467251777649, 0.020472101867198944, 0.035017743706703186, -0.036444030702114105, 0.023103350773453712, 0.05405126512050629, 0.014103002846240997, -0.05070687457919121, -6.5752406953834e-05, -0.003900765208527446, -0.034943971782922745, 0.016242429614067078, 0.007303560618311167, -0.022304140031337738, -0.01158241368830204, 0.004887483548372984, 0.02783714048564434, 0.012418512254953384, -0.025525575503706932, -0.004586242605000734, 0.0046969023533165455, 0.01864006370306015, 0.014902214519679546, -0.03531283885240555, 0.010592621751129627, -0.0003684824623633176, 0.030911028385162354, -0.002669672714546323, 0.005440783686935902, -0.03341932222247124, 0.007438811473548412, -0.046526383608579636, -0.010838532820343971, 0.03973923996090889, -0.003329021856188774, 0.00900034699589014, -0.0029540073592215776, 0.003368982346728444, 0.020754899829626083, 0.02744368091225624, 0.0030462241265922785, -0.027787957340478897, 0.016021110117435455, -0.013525111600756645, 0.00898190401494503, 0.06511726975440979, -0.0053885276429355145, 0.0016491415444761515, 0.014607121236622334, 0.009615125134587288, -0.00039134451071731746, 0.014225958846509457, -0.012418512254953384, -0.029927384108304977, 0.04679688811302185, 0.04758380353450775, 0.01559076551347971, -0.013279200531542301, -0.02398863062262535, 0.02855028212070465, -0.021357381716370583, -0.0021394267678260803, 0.02063194289803505, -0.017164597287774086, -0.016057996079325676, 0.011576266027987003, 0.03627189248800278, -0.004082124680280685, 0.032238949090242386, 0.025033753365278244, 0.03895232081413269, 0.040821246802806854, 0.02569771185517311, -0.00470305047929287, -0.02002946101129055, 0.004337257705628872, -0.02049669250845909, 0.010076208040118217, -0.012037349864840508, 0.0037870313972234726, -0.0020180081482976675, 0.03376359865069389, -0.033984918147325516, 0.012043497525155544, 0.01559076551347971, 0.03949332609772682, -0.01789003424346447, -0.01702934503555298, -0.007463402580469847, 0.0023054168559610844, -0.004032942466437817, -0.044608280062675476, -0.03774735704064369, 0.0023376925382763147, -0.01777937449514866, -0.049059268087148666, 0.013475929386913776, 0.007586358115077019, -0.0008268761448562145, 0.016906389966607094, -0.005883423611521721, 0.011932837776839733, 0.02095162868499756, -0.03587843477725983, -0.007899895310401917, -0.00967660266906023, -0.0012187970569357276, 0.03538661077618599, 0.023853380233049393, -0.019832732155919075, -0.00304315029643476, 0.0009767282754182816, -0.015762902796268463, -0.014410392381250858, 0.009190928190946579, -0.0078384168446064, 0.0025344216264784336, 0.035730887204408646, 0.0015707573620602489, -0.03794408589601517, 0.004644646309316158, -0.007580210454761982, 0.009449135512113571, -0.024726364761590958, -0.015344854444265366, 0.002835662569850683, -0.004235818982124329, -0.004533986561000347, 0.026460036635398865, -0.012689013965427876, 0.014176776632666588, -0.01265212707221508, -0.0006424428429454565, -0.033911146223545074, -0.02761581912636757, 0.0017997620161622763, 0.016992459073662758, 0.0002845268463715911, -0.026509219780564308, -0.02098851464688778, 0.005351640749722719, 0.03236190602183342, 0.02138197235763073, 0.012393920682370663, 0.012000462971627712, 0.0037163319066166878, 0.003953021485358477, 0.00025839879526756704, 0.022968098521232605, 0.0033198001328855753, 0.06492053717374802, 0.00335053913295269, -0.0020011018496006727, -0.0011288857785984874, -0.005615995265543461, -0.014533347450196743, 0.04522305727005005, -0.022574640810489655, 0.006504349410533905, -0.01503746584057808, -0.03029625117778778, 0.008656071498990059, -0.0008076643571257591, -0.0014624027535319328, -0.01832037977874279, -0.023177124559879303, -0.015295672230422497, 0.012000462971627712, 0.00040114251896739006, -0.021332791075110435, 0.0016583631513640285, 0.015271080657839775, -0.023361556231975555, -0.00835483055561781, 0.020693421363830566, 0.015553878620266914, -0.034698061645030975, 0.0005148764466866851, -0.03841131925582886, -0.025279663503170013, -0.009492169134318829, 0.04805103316903114, 0.011361094191670418, -0.0019027373054996133, -7.420560723403469e-05, -0.009707341901957989, 0.0005859601078554988, 0.014066116884350777, 0.01950075291097164, -0.021959863603115082, 0.02555016614496708, -0.00011286936205578968, 0.035189881920814514, -0.001098915352486074, 0.04551814869046211, -0.04812480881810188, -0.023250896483659744, 0.015443218871951103, 0.019254840910434723, -0.03865722939372063, -0.018332675099372864, -0.016512932255864143, 0.009793411009013653, 0.013500520959496498, -0.016635887324810028, -0.0027296135667711496, 0.02997656725347042, 0.0016322351293638349, 0.03900150582194328, 0.023423034697771072, -0.022009046748280525, -0.00914174597710371, -0.05070687457919121, -0.0060033053159713745, 0.05877275764942169, -0.012135714292526245, -0.019119590520858765, 0.031033983454108238, 0.013193132355809212, 0.015873562544584274, 0.006903954781591892, 0.004134380724281073, 0.019611412659287453, -0.007783086970448494, 0.0029616921674460173, 0.009233962744474411, 0.052723344415426254, 0.0033474653027951717, -0.02537802793085575, -0.027640409767627716, -0.021873794496059418, -0.017164597287774086, 0.005493039730936289, -0.008016702719032764, -0.015689129009842873, 0.02066883072257042, -0.016439158469438553, -0.010279085487127304, -0.007291264832019806, 0.011619300581514835, 0.018443334847688675, -0.0073896292597055435, -0.014029229991137981, -0.03592761605978012, -0.03452592343091965, -0.005831167567521334, 0.014484165236353874, 0.00979955866932869, 0.0058004288002848625, -0.0036333368625491858, 0.004684607032686472, 0.01970977708697319, 0.013943160884082317, -0.036689940840005875, 0.006971580442041159, -0.03878018632531166, -0.025992807000875473, 0.0018627768149599433, -0.0220213420689106, -0.0031753273215144873, 0.021000809967517853, 0.009074120782315731, 0.019217954948544502, 0.02177543006837368, 0.02077949047088623, 0.012197191826999187, 0.027886321768164635, -0.00012929545482620597, 0.02074260264635086, -0.03496856242418289, 0.03381277993321419, 0.026681357994675636, 0.026066578924655914, 0.003811622504144907, -0.02057046629488468, 0.013082471676170826, -0.0025636234786361456, -0.026066578924655914, 0.03838672861456871, -0.02152951993048191, 8.939493454818148e-06, 0.001941160997375846, -0.005775837693363428, 0.008957312442362309, -0.05173970013856888, 0.019795846194028854, 0.007776939310133457, -0.03147662431001663, 0.0030523717869073153, -0.005305532366037369, 0.015615356154739857, 0.03666535019874573, -0.0003448519273661077, -0.019402388483285904, -0.018935156986117363, 0.020533578470349312, 0.016955573111772537, 0.0020395254250615835, 0.013045585714280605, -0.027640409767627716, 0.03046838939189911, -0.007365038152784109, -0.020164713263511658, 0.007776939310133457, 0.03531283885240555, -0.006848624907433987, 0.02124672196805477, 0.018123650923371315, 0.008785175159573555, 0.01732443831861019, -0.008871244266629219, -0.0006097827572375536, -0.015664538368582726, 0.004014499019831419, -0.0019795845728367567, -0.002631249139085412, -0.04116552323102951, -0.03007493168115616, -0.0006973886047489941, -0.013660362921655178, 0.0037317012902349234, 0.021259017288684845, -0.006129334680736065, -0.014299731701612473, -0.028992921113967896, -0.005723581649363041, 0.004865966271609068, 0.030124112963676453, 0.004669237416237593, -0.01439809612929821, -0.015480105765163898, 0.009953252971172333, -0.007863008417189121, 0.019549934193491936, -0.005191798787564039, 0.0013240777188912034, -0.02141885831952095, 0.0004453296714928001, 0.022230366244912148, -0.006824033800512552, -0.028747010976076126, -0.0029647659976035357, 0.006089374423027039, -0.018295787274837494, 0.0196360033005476, 8.184229955077171e-05, -0.02473866008222103, 0.018344970420002937, 0.0460345633327961, -0.03514070063829422, -0.008004407398402691, -0.018787609413266182, -0.007666279561817646, -0.007180605083703995, 0.015086648054420948, -0.05419881269335747, 0.02134508639574051, -0.04721493646502495, 0.008785175159573555, -0.007531028240919113, 0.024320609867572784, 0.0027280766516923904, -0.01757035031914711, -0.00616622157394886, -0.0013171614846214652]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:24:58.125424", "url_path": "/message-history/", "chunk_size": 4955}
updated_dt: 2025-03-15T11:24:58.126965
---
```
frompydantic_aiimport Agent
agent = Agent('openai:gpt-4o', system_prompt='Be a helpful assistant.')

async defmain():
  async with agent.run_stream('Tell me a joke.') as result:
    # incomplete messages before the stream finishes
    print(result.all_messages())
"""
    [
      ModelRequest(
        parts=[
          SystemPromptPart(
            content='Be a helpful assistant.',
            dynamic_ref=None,
            part_kind='system-prompt',
          ),
          UserPromptPart(
            content='Tell me a joke.',
            timestamp=datetime.datetime(...),
            part_kind='user-prompt',
          ),
        ],
        kind='request',
      )
    ]
    """
    async for text in result.stream_text():
      print(text)
      #> Did you hear
      #> Did you hear about the toothpaste
      #> Did you hear about the toothpaste scandal? They called
      #> Did you hear about the toothpaste scandal? They called it Colgate.
    # complete messages once the stream finishes
    print(result.all_messages())
"""
    [
      ModelRequest(
        parts=[
          SystemPromptPart(
            content='Be a helpful assistant.',
            dynamic_ref=None,
            part_kind='system-prompt',
          ),
          UserPromptPart(
            content='Tell me a joke.',
            timestamp=datetime.datetime(...),
            part_kind='user-prompt',
          ),
        ],
        kind='request',
      ),
      ModelResponse(
        parts=[
          TextPart(
            content='Did you hear about the toothpaste scandal? They called it Colgate.',
            part_kind='text',
          )
        ],
        model_name='gpt-4o',
        timestamp=datetime.datetime(...),
        kind='response',
      ),
    ]
    """

```

_(This example is complete, it can be run "as is" — you'll need to add`asyncio.run(main())` to run `main`)_
### Using Messages as Input for Further Agent Runs
The primary use of message histories in PydanticAI is to maintain context across multiple agent runs.
To use existing messages in a run, pass them to the `message_history` parameter of [`Agent.run`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run), [`Agent.run_sync`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run_sync) or [`Agent.run_stream`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run_stream).
If `message_history` is set and not empty, a new system prompt is not generated — we assume the existing message history includes a system prompt.
Reusing messages in a conversation```
frompydantic_aiimport Agent
agent = Agent('openai:gpt-4o', system_prompt='Be a helpful assistant.')
result1 = agent.run_sync('Tell me a joke.')
print(result1.data)
#> Did you hear about the toothpaste scandal? They called it Colgate.
result2 = agent.run_sync('Explain?', message_history=result1.new_messages())
print(result2.data)
#> This is an excellent joke invented by Samuel Colvin, it needs no explanation.
print(result2.all_messages())
"""
[
  ModelRequest(
    parts=[
      SystemPromptPart(
        content='Be a helpful assistant.',
        dynamic_ref=None,
        part_kind='system-prompt',
      ),
      UserPromptPart(
        content='Tell me a joke.',
        timestamp=datetime.datetime(...),
        part_kind='user-prompt',
      ),
    ],
    kind='request',
  ),
  ModelResponse(
    parts=[
      TextPart(
        content='Did you hear about the toothpaste scandal? They called it Colgate.',
        part_kind='text',
      )
    ],
    model_name='gpt-4o',
    timestamp=datetime.datetime(...),
    kind='response',
  ),
  ModelRequest(
    parts=[
      UserPromptPart(
        content='Explain?',
        timestamp=datetime.datetime(...),
        part_kind='user-prompt',
      )
    ],
    kind='request',
  ),
  ModelResponse(
    parts=[
      TextPart(
        content='This is an excellent joke invented by Samuel Colvin, it needs no explanation.',
        part_kind='text',
      )
    ],
    model_name='gpt-4o',
    timestamp=datetime.datetime(...),
    kind='response',
  ),
]
"""

```

_(This example is complete, it can be run "as is")_
## Storing and loading messages (to JSON)
While maintaining conversation state in memory is enough for many applications, often times you may want to store the messages history of an agent run on disk or in a database. This might be for evals, for sharing data between Python and JavaScript/TypeScript, or any number of other use cases.
The intended way to do this is using a `TypeAdapter`.
We export [`ModelMessagesTypeAdapter`](https://ai.pydantic.dev/api/messages/#pydantic_ai.messages.ModelMessagesTypeAdapter) that can be used for this, or you can create your own.
Here's an example showing how:
serialize messages to json```
frompydantic_coreimport to_jsonable_python
frompydantic_aiimport Agent
frompydantic_ai.messagesimport ModelMessagesTypeAdapter 
Alternatively, you can create a TypeAdapter from scratch: