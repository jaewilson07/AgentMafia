---
url: https://ai.pydantic.dev/message-history/
session_id: pydantic_ai_docs
chunk_number: 3
title: Managing Message History with Pydantic
summary: This document chunk explains how to manage and serialize message histories using Pydantic's TypeAdapter and ModelMessage classes. It demonstrates converting message history to Python objects and JSON, validating JSON data against a defined schema, and continuing conversations with retained history.
embedding: [-0.02434946410357952, -0.016932953149080276, 0.0032925186678767204, -0.009747068397700787, 0.010888070799410343, 0.010584612376987934, -0.012587434612214565, 0.001513496390543878, -0.0067671118304133415, -0.005708043463528156, -0.028136620298027992, -0.05234042555093765, -0.000513981853146106, -0.00846040714532137, -0.03481269255280495, -0.022358780726790428, -0.022249534726142883, 0.029229067265987396, 0.003611149499192834, 0.04054198041558266, 0.03182666748762131, 0.04731516167521477, 0.008776003494858742, 0.021569790318608284, 0.010803102515637875, -0.014286799356341362, -0.04789780080318451, 0.05661311000585556, -0.001603775192052126, -0.029544664546847343, -0.02777246944606304, -0.01046929880976677, -0.032967668026685715, 0.011786306276917458, -0.002077169483527541, 0.0023624200839549303, 0.019384892657399178, -0.01370416022837162, -0.0003368383040651679, -0.0028327798936516047, 0.022516578435897827, -0.04981565475463867, 0.047703586518764496, 0.033623140305280685, -0.0292776208370924, 0.04105179011821747, -0.01169526856392622, 0.06676074862480164, -0.020756522193551064, 0.021496959030628204, -0.024021729826927185, 0.03425433114171028, 0.012575296685099602, -0.021545512601733208, -0.011828790418803692, -0.030078750103712082, -0.006967394147068262, -0.002084756037220359, -0.020586585626006126, -0.016872260719537735, 0.004730909131467342, -0.015087928622961044, -0.01696936786174774, 0.04095468297600746, -0.04231417551636696, -0.041148897260427475, -0.03580803424119949, 0.017904017120599747, -0.05025263503193855, 0.031244028359651566, 0.017260687425732613, 0.01217473205178976, -0.06501282751560211, -0.00693097896873951, -0.038259975612163544, -0.04743654280900955, 0.013558500446379185, 0.09006631374359131, 0.0251020397990942, -0.043697942048311234, 0.007210160605609417, 0.00674283504486084, -0.002224346622824669, 0.02867070585489273, -0.032506413757801056, -0.0102811548858881, -0.009304020553827286, -0.0011850032024085522, -0.022905005142092705, -0.056273240596055984, -0.02166689559817314, 0.0033016223460435867, -0.023426951840519905, 0.01496654562652111, 0.09302806109189987, -0.003002716228365898, -0.04437768831849098, -0.029593218117952347, 0.02204318344593048, -0.00808411929756403, 0.07103343307971954, -0.045542966574430466, -0.07011091709136963, 0.05505940690636635, 0.004955468233674765, 0.020161744207143784, 0.03554099425673485, -0.005711078178137541, -0.04787352308630943, 0.018340997397899628, -0.07195594161748886, -0.012793786823749542, 0.0189964659512043, -0.004885672591626644, -0.07962736487388611, 0.009740999899804592, -0.008254055865108967, -0.03809003904461861, 0.04549441486597061, -0.01415327750146389, -0.0543796606361866, -0.01996753178536892, 0.011118698865175247, -0.010754548944532871, 0.024640783667564392, -0.029763154685497284, -0.030709942802786827, -0.0543796606361866, -0.012490328401327133, 0.011786306276917458, -0.010985177010297775, -0.012241492979228497, 0.013643468730151653, 0.0013511464931070805, -0.01885080710053444, -0.01139787957072258, -0.01557346060872078, -0.012684541754424572, -0.03546816483139992, 0.04821339622139931, 0.041148897260427475, -0.04653830826282501, -0.06564401835203171, 0.012107971124351025, -0.016386728733778, 0.03374452143907547, -0.06326490640640259, -0.011203667148947716, -0.031996604055166245, -0.0018526106141507626, 0.03879406303167343, 0.03809003904461861, -0.024689337238669395, 0.013619191944599152, -0.03202088177204132, 0.040857575833797455, 0.023111356422305107, 0.026315871626138687, 0.0144810127094388, -0.030078750103712082, -0.011470709927380085, 0.014735917560756207, -0.04981565475463867, -0.04127027839422226, -0.029884537681937218, -0.008593929000198841, -0.018219614401459694, -0.007094846572726965, -0.011610300280153751, -0.0233783982694149, -0.023863932117819786, -0.024859273806214333, -0.018195336684584618, -0.008411853574216366, 0.022395195439457893, -0.02160620503127575, -0.061565544456243515, -0.0739951804280281, -0.03947380930185318, -0.023791102692484856, -0.0036627373192459345, -0.0005287754465825856, -0.07093632966279984, -0.06646942347288132, -0.006827803328633308, -0.025150593370199203, -0.007610724773257971, 0.024677198380231857, -0.008964147418737411, 0.009558924473822117, -0.004782496951520443, -0.005498657934367657, 0.04670824483036995, 0.02993309125304222, 0.010693857446312904, -0.03253069147467613, 0.04119744896888733, 0.0035383193753659725, 0.01143429521471262, 0.01281806267797947, 0.02398531511425972, 0.012538881972432137, 0.027311213314533234, -0.0026203591842204332, -0.03478841856122017, -0.053748469799757004, 0.005161819513887167, 0.010426814667880535, -0.05379702150821686, -0.026995617896318436, 0.04238700494170189, -0.039449531584978104, 0.017527729272842407, -0.023341983556747437, -0.022322366014122963, -0.035856589674949646, -0.10487505793571472, 0.01908143423497677, -0.06996525824069977, 0.03202088177204132, -0.02339053712785244, 0.034230053424835205, 0.044644732028245926, -0.03782299533486366, -0.007392235100269318, 0.016423143446445465, 0.006839941721409559, -0.04156159982085228, -0.0061086080968379974, 0.03864840045571327, 0.028136620298027992, -0.022613685578107834, -0.010985177010297775, -0.05243752896785736, 0.044960327446460724, -0.05102948471903801, 0.01951841451227665, 0.000649779278319329, 0.037653058767318726, -0.00905518513172865, 8.629584772279486e-05, -0.0011288635432720184, 0.03532250225543976, 0.012411429546773434, 0.014420321211218834, 0.032215092331171036, -0.0050980933010578156, -0.06637232005596161, 0.05214621126651764, 0.036317843943834305, 0.06904274970293045, -0.01974904164671898, -0.014978683553636074, -0.02397317625582218, -0.0030239582993090153, -0.03146251663565636, -0.04597994685173035, -0.013679883442819118, -0.04716949909925461, 0.012429636903107166, 0.019336339086294174, 0.012314322404563427, -0.034084394574165344, 0.04869892820715904, -0.019797595217823982, -0.01802540197968483, 0.021120671182870865, -0.029010578989982605, -0.0069977398961782455, -0.036245014518499374, 0.01647169701755047, -0.0186323169618845, 0.029690323397517204, 0.030879879370331764, -0.049645718187093735, 0.004658079240471125, -0.004667182918637991, 0.008654620498418808, 0.016386728733778, -0.014614533632993698, -0.0008011289173737168, 0.0046702176332473755, 0.028549322858452797, -0.0023260051384568214, -0.013024413958191872, 0.017479177564382553, 0.015974026173353195, -0.002961749443784356, -0.020319543778896332, -0.006864218506962061, 0.016265345737338066, 0.015500631183385849, 0.00968637689948082, -0.02459223009645939, 0.03741029277443886, 0.025344805791974068, 0.04996131360530853, 0.032433584332466125, 0.00998376589268446, -0.0029541628900915384, 0.005705009214580059, -0.036317843943834305, 0.02025885134935379, -0.026728574186563492, -0.0355895459651947, 0.054185450077056885, -0.004855326842516661, -0.05481664091348648, 0.0415373221039772, -0.01570698246359825, 0.01818319968879223, 0.028573598712682724, -0.014663087204098701, -0.024750029668211937, -0.019785456359386444, -0.026607191190123558, 0.024398017674684525, -0.041755810379981995, 0.020234575495123863, -0.010991246439516544, -0.06219673901796341, -0.006803527008742094, 0.03690048307180405, -0.026121659204363823, -0.08671613782644272, -0.014056171290576458, 0.008879179134964943, -0.015330694615840912, 0.0005132232327014208, 0.05175778642296791, -0.012830201536417007, -0.027384044602513313, 0.014590257778763771, 0.03998361527919769, 0.022334503009915352, 0.014590257778763771, -0.06510993093252182, 0.00934650469571352, 0.01965193636715412, 0.05102948471903801, -0.014298937283456326, 0.013255042023956776, -0.03522539511322975, -0.037725888192653656, -0.03158390149474144, -0.008339024148881435, -0.007889905944466591, 0.039279595017433167, -0.05311727523803711, 0.01485730055719614, 0.01728496327996254, -0.001131139462813735, 0.05908932909369469, 0.03267635032534599, 0.03471558913588524, -0.004418347496539354, -0.015597737394273281, 0.027845298871397972, -0.0025839442387223244, 0.01786760240793228, -0.03896399959921837, 0.008247986435890198, -0.0020392374135553837, 0.007962736301124096, -0.017017921432852745, 0.035419609397649765, -0.034958355128765106, -0.02517486922442913, -0.027214108034968376, 0.014116862788796425, 0.025150593370199203, -0.01452956534922123, -0.02859787456691265, -0.008102326653897762, -0.02689851075410843, -0.029884537681937218, -0.029083408415317535, 0.0023927658330649137, -0.014177554287016392, 0.03403584286570549, 0.011780236847698689, 0.01780691184103489, 0.009898797608911991, 0.0011417604982852936, 0.004029921256005764, 0.019166402518749237, 0.011652784422039986, 0.003990471828728914, -0.024167390540242195, 0.041367385536432266, 0.07666561007499695, -0.04265404865145683, -0.03097698651254177, 0.03316188231110573, 0.006360478233546019, 0.03702186793088913, -0.005073816515505314, 0.001508944551460445, 0.024300910532474518, 0.005331756081432104, -0.021327024325728416, -0.0012692128075286746, 0.0008034048951230943, 0.03274917975068092, -0.029666047543287277, -0.0025809097569435835, 0.0017661252059042454, 0.020076775923371315, 0.008879179134964943, 0.01564629003405571, 0.06540125608444214, -0.013497808948159218, -0.000888373120687902, -0.012077625840902328, -0.035856589674949646, -0.040105000138282776, -0.009704584255814552, 0.024228081107139587, 0.06025460734963417, 0.0005196717102080584, -0.007446857634931803, -0.09943709522485733, 0.003771982155740261, 0.005283202510327101, -0.032142262905836105, 0.04556724429130554, 0.027238383889198303, -0.03597797080874443, -0.0029253344982862473, 0.0006486413185484707, -0.035929419100284576, 0.032967668026685715, 0.015694843605160713, -0.016641633585095406, 0.028258003294467926, -0.03546816483139992, 0.03238502889871597, 0.018231753259897232, -0.005814253818243742, -0.011737752705812454, 0.01571912132203579, -0.01705433614552021, -0.009759207256138325, 0.030807049944996834, -0.02629159577190876, -0.026315871626138687, -0.03000592067837715, -0.004160408396273851, 0.047485098242759705, -0.03240930661559105, 0.010954831726849079, -0.02369399555027485, -0.03335609659552574, -0.009000562131404877, -0.03828425332903862, -0.048310503363609314, 0.045615795999765396, 0.021181363612413406, 0.050835274159908295, -0.009091599844396114, 0.013206489384174347, -0.0040268865413963795, -0.012453913688659668, 0.021776141598820686, -0.028937747702002525, -0.004497246351093054, 0.03143824264407158, -0.03017585724592209, -0.01757628284394741, 0.03121975250542164, 0.02913196198642254, -0.014687363989651203, 0.008126603439450264, -0.011646714992821217, -0.003638460533693433, -0.03964374586939812, 0.03796865791082382, 0.0428968146443367, -0.0032136195804923773, 0.014990821480751038, 0.02643725462257862, 0.010159771889448166, 0.011039800010621548, 0.011003384366631508, -0.03806576132774353, 0.006560760550200939, -0.017928294837474823, -0.05942920222878456, 0.006924910005182028, 0.021788278594613075, -0.030151579529047012, 0.009504302404820919, 0.008769934065639973, -0.01188341248780489, 0.02173972688615322, 0.004072405397891998, -0.009504302404820919, -0.01076668780297041, -0.0027447768952697515, -0.04056625813245773, -0.018802253529429436, -0.008448269218206406, -0.012247562408447266, 0.05272885039448738, 0.008776003494858742, -0.03469131141901016, 0.01142822578549385, -0.012150455266237259, 0.022395195439457893, 0.06117711961269379, -0.01786760240793228, -0.03165673092007637, -0.008788141421973705, 9.174861042993143e-05, 0.031025538221001625, 0.0059659830294549465, -0.007889905944466591, 0.030078750103712082, -0.002571806078776717, 0.016180377453565598, 0.031535349786281586, -0.01009301096200943, 0.005565418396145105, -0.005826392211019993, 0.01705433614552021, -0.0008352679433301091, 0.00987452082335949, -0.031559623777866364, -0.003614183980971575, -0.006020605564117432, 0.03731318563222885, 0.011124767363071442, 0.04292108863592148, -0.0170664731413126, -0.019627658650279045, -0.016411004588007927, -0.022140290588140488, 0.014917992055416107, -0.03233647719025612, -0.004943329840898514, -0.00997769646346569, 0.03097698651254177, -0.017904017120599747, 0.014383905567228794, -0.014541704207658768, 0.02376682497560978, -0.0019315097015351057, 0.024033868685364723, -0.004403174389153719, 0.009838106110692024, 0.0432124100625515, -0.005829426925629377, 0.017988985404372215, -0.016216792166233063, 0.026024552062153816, -0.002019512467086315, -0.04054198041558266, -0.0053894128650426865, 0.03670627251267433, 0.014954406768083572, -0.005286237224936485, -0.017479177564382553, 0.009868452325463295, 0.0072951288893818855, -0.008879179134964943, 0.020283129066228867, 0.04699956625699997, 0.018207475543022156, -0.045033156871795654, 0.0038357083685696125, 0.035710930824279785, -0.010408607311546803, -0.01541566289961338, -0.019870424643158913, -0.00612681545317173, -0.010366123169660568, 1.2624323971976992e-05, -0.0004301516164559871, -0.0421685129404068, -0.002168206963688135, -0.007665347307920456, -0.019020743668079376, 0.029763154685497284, 0.020076775923371315, -0.008521098643541336, -0.03265207260847092, -0.017017921432852745, -0.0024686302058398724, -0.005146646406501532, -0.006226956844329834, 0.00480373902246356, -0.014056171290576458, -0.018061816692352295, -0.010445022024214268, -0.030855601653456688, 0.00480373902246356, -0.01415327750146389, 0.019700488075613976, -0.05117514729499817, 0.019105711951851845, 0.05117514729499817, -0.00931008905172348, -0.03223937004804611, 0.028476491570472717, 0.00532872136682272, 0.01552490796893835, -0.00982596818357706, -0.008278332650661469, -0.02181255631148815, -0.015209311619400978, 0.01456598099321127, 0.006445446517318487, -0.020465202629566193, -0.036681994795799255, -0.03345320373773575, -0.012963722459971905, -0.028500769287347794, 0.00923725962638855, 0.08705601096153259, -0.010177979245781898, -0.006151092238724232, 0.024859273806214333, 0.027286937460303307, 0.007829214446246624, 0.0055866604670882225, 0.017017921432852745, -0.0275539793074131, -0.008430060930550098, -0.016884399577975273, -0.007440788671374321, -0.0002167827624361962, -0.005462242756038904, 0.04930584505200386, 0.01647169701755047, -0.008727449923753738, 0.012405360117554665, -0.0024944241158664227, -0.010724203661084175, -0.0028024339117109776, -0.01699364371597767, -0.0008519581169821322, -0.0018222648650407791, 0.01493012998253107, -0.01523358840495348, 0.00742865027859807, -0.0029951296746730804, -0.00037325324956327677, 0.024252356961369514, 0.00476428959518671, -0.013874096795916557, -0.02309921756386757, -0.027578257024288177, 0.03709469735622406, -0.005495623219758272, 0.003996540792286396, 0.002151516731828451, -0.004779462236911058, -0.01728496327996254, -0.007768522948026657, 0.004293929785490036, -0.03687620908021927, 0.03991078585386276, 0.006815664935857058, 0.02553902007639408, 0.01928778551518917, 0.023050663992762566, -0.005186095833778381, -6.126057269284502e-05, 0.026243042200803757, 0.008879179134964943, -0.004724840167909861, 0.018753699958324432, 0.04386787861585617, -0.008260125294327736, -0.014165416359901428, 0.009437541477382183, 0.014165416359901428, -0.037046145647764206, 0.00972279254347086, 0.03818714618682861, -0.015512769110500813, -0.02323273941874504, -0.044280581176280975, 0.05064105987548828, 0.06797457486391068, -0.002274417085573077, -0.013097244314849377, 0.00987452082335949, 0.0013784576440230012, 0.010074803605675697, -0.003869088599458337, -0.03299194574356079, -0.02852504514157772, 0.023851793259382248, 0.051515016704797745, 0.007574310060590506, 0.0030831326730549335, 0.029884537681937218, 0.00046277334331534803, -0.01959124393761158, -0.022771483287215233, -0.03301622346043587, -0.01247819047421217, 0.014347490854561329, -0.01698150672018528, -0.016034716740250587, -0.02369399555027485, 0.03129258006811142, 0.0146388104185462, -0.0011607265332713723, -0.01615609973669052, 0.010214393958449364, 0.006566829513758421, 0.022383056581020355, -0.0066517977975308895, -0.006269440986216068, -0.025441912934184074, -0.0006759525276720524, 0.0029268518555909395, -0.02347550541162491, 0.005173957906663418, 0.019093573093414307, -0.021569790318608284, 0.0033532101660966873, 0.009103737771511078, -0.03345320373773575, -0.02823372557759285, 0.05161212384700775, -0.03197232633829117, 0.01631389930844307, -0.015889057889580727, -0.006433308124542236, 0.008205502294003963, -0.019129987806081772, -0.011998726986348629, -0.010529990307986736, -0.04840761050581932, 0.037653058767318726, -0.008873109705746174, 0.002630980219691992, 0.010463229380548, -0.01496654562652111, -0.004051163326948881, -0.025878893211483955, -0.004530626814812422, -0.022225258871912956, -0.005744458641856909, 0.0074529265984892845, 0.00024978379951789975, 0.005674663465470076, -0.01039039995521307, 0.008247986435890198, -0.007325474638491869, -0.013473532162606716, 0.005304444581270218, 0.014177554287016392, 0.013825543224811554, -0.0012388670584186912, -0.06205107644200325, 0.002248623175546527, 0.01757628284394741, 0.01519717276096344, -0.02978743053972721, 0.04195002466440201, -0.011185459792613983, -0.006481861229985952, 0.04209568351507187, 0.005993294063955545, -0.02689851075410843, -0.02167903445661068, -0.026607191190123558, -0.009061253629624844, 0.00953464861959219, 0.024750029668211937, 0.041367385536432266, -0.03223937004804611, 0.026485808193683624, -0.008011288940906525, 0.0515635721385479, -0.029253344982862473, -0.00551079586148262, 0.017005782574415207, -0.009212982840836048, -0.00741044245660305, 0.019797595217823982, -0.003866054117679596, -0.031850945204496384, -0.0210842564702034, -0.02205532230436802, -0.030515730381011963, -0.026412978768348694, -0.007252644747495651, 0.03240930661559105, 0.014917992055416107, 5.789408169221133e-05, 0.006324063520878553, 0.019469860941171646, -0.06991671025753021, -0.011294703930616379, 0.039158210158348083, -0.02532052993774414, 0.016204653307795525, 0.0023017283529043198, -0.01885080710053444, 0.019785456359386444, -0.021181363612413406, -0.02777246944606304, 0.016435282304883003, -0.03328326717019081, 0.006148057524114847, -0.024191666394472122, 0.04068763926625252, 0.005398516543209553, 0.007950597442686558, -0.012399290688335896, 0.023329846560955048, -0.015185034833848476, -0.010402537882328033, 0.0030543040484189987, -0.044644732028245926, 0.02062300033867359, -0.01631389930844307, -0.0054713464342057705, -0.020149607211351395, 0.044717561453580856, 0.02658291533589363, -0.01809823140501976, -0.013922649435698986, -0.03299194574356079, 0.015561322681605816, -0.015221449546515942, -0.05603047087788582, 0.04340662434697151, -0.0012722474057227373, 0.0231720469892025, 0.006402962375432253, -0.0411246195435524, 0.007234436925500631, 0.0005416724015958607, 0.0005644317716360092, -0.0008216123678721488, 0.01838955096900463, 0.007610724773257971, -0.01228397712111473, -0.01388623472303152, -0.00816301815211773, 0.02488354966044426, 0.012399290688335896, 0.01496654562652111, -0.01696936786174774, 0.01388623472303152, 0.05214621126651764, 0.030637113377451897, -0.051806338131427765, 0.003762878244742751, -0.002981474157422781, 0.0040602670051157475, 0.01068171951919794, -0.00519216526299715, 0.006293717306107283, -0.0074043734930455685, 0.0006016053375788033, -0.0011956242378801107, -0.006542553193867207, 0.012514605186879635, -0.002241036854684353, -0.005222511012107134, -0.03687620908021927, 0.02362116612493992, 0.006578967906534672, -0.009097668342292309, -0.005753562320023775, 0.008945940062403679, 0.0183167215436697, 0.03699759021401405, -0.004609526135027409, -0.0011705890065059066, 0.01818319968879223, -0.025490466505289078, 0.008618204854428768, 0.03889117017388344, -0.036317843943834305, 0.03253069147467613, 0.03384162858128548, -0.010809171944856644, 0.006645728833973408, 0.03017585724592209, 0.023487644270062447, 0.009328296408057213, -0.02905913069844246, 0.0059659830294549465, -0.018535209819674492, -0.010851656086742878, -0.029107684269547462, 0.035492438822984695, 0.021946078166365623, -0.03881833702325821, 0.04020210728049278, 0.03435143828392029, -0.023135632276535034, 0.0008724415674805641, -0.0032469998113811016, 0.023584749549627304, -0.01609540916979313, -0.009473956190049648, 0.013291457667946815, 0.01735779456794262, 0.024106698110699654, 0.0016234999056905508, -0.023220600560307503, 0.018498795107007027, -0.03046717680990696, -0.019397031515836716, 0.06797457486391068, -0.008521098643541336, -0.036754824221134186, -0.011792374774813652, 0.005799081176519394, -0.0073376125656068325, -0.011476779356598854, 0.020610863342881203, -0.0006896081613376737, -0.011889481917023659, -0.06166265159845352, 0.013097244314849377, -0.008612136356532574, 0.01609540916979313, -0.014626672491431236, 0.0074529265984892845, -0.031923774629831314, 0.03270062804222107, -0.059477753937244415, -0.007495410740375519, 0.034521374851465225, -0.03323471173644066, -0.011555678211152554, -0.017709804698824883, -0.008618204854428768, -0.02099928818643093, 0.009504302404820919, -0.006402962375432253, -0.04350372776389122, -0.038696955889463425, 0.04178008809685707, 0.001213073031976819, -0.006566829513758421, -0.018862944096326828, 0.015512769110500813, -0.001957303611561656, 0.013946926221251488, 0.0231720469892025, -0.0022273811046034098, 0.05175778642296791, -0.008599997498095036, -0.031025538221001625, -0.023718271404504776, -0.010991246439516544, -0.025660403072834015, 0.0551079586148262, -0.010663512162864208, -0.012095833197236061, -0.009898797608911991, -0.009194775484502316, -0.028039513155817986, -0.021715449169278145, -0.011258289217948914, 0.03821142390370369, -0.01187734305858612, 0.024094559252262115, 0.007719969842582941, -0.019724765792489052, 0.02159406617283821, 0.03961946815252304, 0.035710930824279785, -0.00923725962638855, 0.010608889162540436, 0.03575948253273964, -0.016362451016902924, 0.025830339640378952, 0.017115026712417603, -0.013631329871714115, 0.016180377453565598, 0.016046855598688126, 0.012987999245524406, 0.02517486922442913, -0.027796747162938118, 0.00021735174232162535, 0.04015355184674263, 0.0033592793624848127, 0.00019354926189407706, 0.047994907945394516, 0.014286799356341362, 0.001500599435530603, 0.03537105768918991, 0.007871698588132858, -0.02665574476122856, 0.005981155671179295, -0.005920464172959328, 0.023147771134972572, 0.00030383726698346436, -0.026267318055033684, 0.00897021684795618, 0.056418899446725845, -0.002574840560555458, -0.007483272813260555, -0.004063301719725132, 0.020392373204231262, -0.007143399678170681, 0.007143399678170681, 0.0189964659512043, -0.004812842700630426, -0.01846238039433956, -0.016726601868867874, -0.017333516851067543, -0.0019846148788928986, 0.01057854387909174, -0.006317994091659784, -0.024907827377319336, 0.007719969842582941, -0.02651008404791355, 0.026704298332333565, -0.00979562196880579, 0.024774305522441864, -0.0013147314311936498, 0.02762681059539318, -0.006011501420289278, 0.0008542340947315097, 0.011379672214388847, -0.005941706243902445, -0.02025885134935379, -0.004697528667747974, 0.039061106741428375, -0.030272962525486946, 0.0005815012846142054, -0.01541566289961338, -0.005007056053727865, -0.014213969931006432, -0.0024655957240611315, 0.027893852442502975, -0.02600027620792389, -0.031923774629831314, 0.029908813536167145, 0.0034199708607047796, 0.04245983436703682, 0.02830655500292778, 0.01207155641168356, -0.015100066550076008, 0.005407620221376419, 0.003523146500810981, 0.011088352650403976, -0.03134113550186157, 0.03442426770925522, -0.02517486922442913, 0.013619191944599152, 0.03180238977074623, -0.006639659404754639, 0.019931117072701454, 0.007489341776818037, 0.013898373581469059, 0.036463506519794464, -0.024677198380231857, -0.016520250588655472, -0.04333379119634628, 0.0021727588027715683, 0.0251020397990942, 0.03821142390370369, 0.02070796862244606, -0.028719259425997734, 0.02107211947441101, 0.017333516851067543, -0.00037325324956327677, -0.007222298998385668, -0.018486658111214638, -0.03017585724592209, 0.0027614671271294355, -0.01321862731128931, -0.00016709152259863913, -0.04151304438710213, -0.029763154685497284, -0.018535209819674492, -0.03600224852561951, 0.009358642622828484, 0.010226531885564327, -0.0029905778355896473, -0.047630757093429565, 0.034982629120349884, 0.015974026173353195, 0.016289621591567993, 0.0271898303180933, -0.015221449546515942, -0.03748312219977379, -0.005231614690274, -0.005173957906663418, -0.020987151190638542, 0.030588559806346893, 0.005040436051785946, -0.031923774629831314, 0.004463866353034973, -0.0026249110233038664, 0.013157935813069344, -0.001993718557059765, -0.004275722429156303, -0.004824981093406677, 0.016811570152640343, -0.02859787456691265, 0.04996131360530853, 0.0038023279048502445, -0.05913788080215454, 0.014286799356341362, 0.030297240242362022, -0.02025885134935379, 0.021059980615973473, -0.0036900483537465334, -0.03641495108604431, -0.0210842564702034, -0.013170074671506882, 0.0018480587750673294, -0.010329707525670528, 0.029763154685497284, 0.016811570152640343, -0.01573125831782818, 0.0019178541842848063, -0.03270062804222107, 0.021181363612413406, -0.0026461530942469835, 0.03148679435253143, 0.001661432208493352, 0.03991078585386276, 0.008193364366889, -0.0012426602188497782, 0.005841565318405628, -0.07603441923856735, 0.007653208915144205, -0.03699759021401405, 0.0023138667456805706, 0.0033865906298160553, -0.015318556688725948, -0.001579498522914946, -0.019166402518749237, -0.015597737394273281, 0.01974904164671898, 0.035201121121644974, -0.03284628689289093, 0.012866616249084473, 0.005428862292319536, -0.001447494374588132, 0.021569790318608284, 0.05243752896785736, 0.014286799356341362, -0.046878181397914886, 0.015585599467158318, -0.0024655957240611315, 0.016580941155552864, -0.011646714992821217, 0.01496654562652111, -0.009261536411941051, -0.03575948253273964, 0.0036688062828034163, 0.02651008404791355, 0.017685528844594955, -0.022006768733263016, 0.009449680335819721, -0.007270852103829384, -0.0010522403754293919, -0.013655606657266617, 0.03910965844988823, -0.025830339640378952, 0.0169086754322052, 0.03233647719025612, -0.01660521887242794, -0.0324578620493412, -0.013667745515704155, 0.008260125294327736, 0.038405634462833405, -0.03384162858128548, 0.025150593370199203, 0.05496229976415634, -0.005228579975664616, -0.05413689464330673, 0.010135495103895664, -0.015221449546515942, -0.02859787456691265, 0.022759344428777695, 0.007343681994825602, -0.01009301096200943, -0.004130062647163868, -0.0003525801876094192, 0.012538881972432137, 0.007592517416924238, -0.011531401425600052, -0.0017691596876829863, 0.007022016681730747, 0.03148679435253143, 0.022358780726790428, -0.0362207405269146, 0.005319617688655853, 0.016046855598688126, 0.03024868667125702, 0.005307479295879602, 0.0014634259277954698, -0.019906841218471527, -0.012720956467092037, -0.03403584286570549, -0.006354409269988537, 0.051951996982097626, -0.00014812540030106902, 0.023123495280742645, -0.00931008905172348, 0.010196186602115631, 0.03634212166070938, 0.020671553909778595, -0.012199008837342262, -0.026752851903438568, 0.025369083508849144, -0.020744383335113525, 0.013340010307729244, 0.06981959939002991, -0.0006971945986151695, -0.0035474232863634825, 0.01906929723918438, -0.0036839793901890516, 0.01988256350159645, 0.020817214623093605, -0.02099928818643093, -0.024543678387999535, 0.04996131360530853, 0.037361741065979004, 0.03503118455410004, -0.017916155979037285, -0.013874096795916557, 0.024482985958456993, -0.019834009930491447, -0.0021940008737146854, 0.025053486227989197, -0.0019815803971141577, -0.010426814667880535, -0.006633590441197157, 0.04520309343934059, -0.007258713711053133, 0.027311213314533234, 0.0031863083131611347, 0.026267318055033684, 0.03886689245700836, 0.026485808193683624, -0.008909524418413639, -0.009443610906600952, 0.004042059648782015, -0.012854478321969509, 0.003158997045829892, -0.013946926221251488, 0.022091737017035484, -0.009103737771511078, 0.029884537681937218, -0.026097381487488747, 0.005544176325201988, 0.01276951003819704, 0.032579243183135986, -0.02278362214565277, -0.017746219411492348, -0.003347140969708562, 0.0146388104185462, 0.004351586569100618, -0.05059250816702843, -0.038624126464128494, 0.0023624200839549303, -0.011889481917023659, -0.0530201680958271, 0.023584749549627304, 0.005058643873780966, -0.027456874027848244, 0.014250384643673897, -0.006378685589879751, 0.0069977398961782455, 0.028719259425997734, -0.02762681059539318, -0.012144386768341064, 0.0021439301781356335, -0.010044457390904427, 0.03741029277443886, 0.004885672591626644, -0.009668169543147087, -0.006657867226749659, -0.004530626814812422, -0.007380096707493067, -0.0181103702634573, 0.004567041993141174, 0.012326461263000965, 0.0007521963561885059, 0.03202088177204132, 0.0008929249597713351, -0.04355228319764137, 0.006815664935857058, -0.007610724773257971, 0.01676301658153534, -0.013255042023956776, -0.014396044425666332, -0.009067323058843613, -0.003735567210242152, -0.001747917733155191, 0.016046855598688126, -0.013801266439259052, 0.007458996027708054, -0.013898373581469059, 0.008235848508775234, -0.03709469735622406, -0.029107684269547462, 0.008794210851192474, 0.019834009930491447, 0.0007662312709726393, -0.03391445800662041, 0.0012274873442947865, 0.002245588693767786, 0.018960051238536835, 0.02093859761953354, 0.022455886006355286, -0.007264782674610615, 0.0006687454297207296, 0.012114040553569794, 0.0038175007794052362, 0.029835984110832214, -0.004937260411679745, 0.07894761860370636, -0.01426252257078886, 0.004342482890933752, -0.00038425359525717795, -0.00398743711411953, -0.011051937937736511, 0.04156159982085228, -0.004260549321770668, 0.024932103231549263, -0.011938035488128662, -0.03003019653260708, 0.014784470200538635, -0.0018662662478163838, 0.001357215573079884, -0.011476779356598854, -0.021436268463730812, -0.02173972688615322, 0.019858287647366524, 0.004011713899672031, -0.011974450200796127, -0.007119122892618179, 0.025441912934184074, -0.022164566442370415, -0.0068338727578520775, 0.024616507813334465, 0.011634577065706253, -0.048965971916913986, -0.002278969157487154, -0.043843600898981094, -0.0005811219452880323, -0.020064638927578926, 0.03425433114171028, 0.012502466328442097, -0.014772332273423672, -0.001344318618066609, -0.0029966470319777727, -0.010748479515314102, 0.01426252257078886, 0.008739588782191277, -0.03755595535039902, 0.021800417453050613, 0.004333379212766886, 0.03134113550186157, -0.01594974845647812, 0.0411246195435524, -0.0289620254188776, -0.03143824264407158, 0.025369083508849144, 0.006827803328633308, -0.041755810379981995, -0.018899360671639442, -0.009747068397700787, 0.011306842789053917, 0.02167903445661068, -0.02905913069844246, -0.012107971124351025, 0.04000789299607277, 0.011816651560366154, 0.027845298871397972, 0.021424129605293274, -0.012575296685099602, -0.008260125294327736, -0.043528005480766296, -0.004937260411679745, 0.04996131360530853, -0.015561322681605816, -0.03500690683722496, 0.03483697026968002, -0.004758220165967941, 0.007198022212833166, -0.007726038806140423, -0.004193788394331932, 0.02227381244301796, -0.00017837635823525488, 0.009789552539587021, 0.017321377992630005, 0.04335806891322136, 0.01397120300680399, -0.030272962525486946, -0.01587691903114319, -0.017236409708857536, -0.0026628433261066675, 0.004740012809634209, -0.005844599567353725, -0.01936061680316925, 0.008618204854428768, -0.020817214623093605, -0.013157935813069344, 0.01105800736695528, 0.016265345737338066, -0.002920782659202814, -0.007732108235359192, -0.01801326312124729, -0.02830655500292778, -0.03821142390370369, -0.0031468586530536413, -0.01217473205178976, 0.01615609973669052, -0.003307691542431712, -0.005022228695452213, 0.002923817140981555, 0.018583763390779495, 0.008854902349412441, -0.023863932117819786, 0.01632603630423546, -0.02383965440094471, -0.019105711951851845, 0.0036536334082484245, -0.014408182352781296, 0.0018601971678435802, 0.013534223660826683, 0.008290470577776432, 0.03614790737628937, 0.017539868131279945, 0.015585599467158318, 0.018814392387866974, 0.027384044602513313, 0.004515454173088074, 0.024762166664004326, -0.029763154685497284, 0.01995539292693138, 0.045858561992645264, 0.014116862788796425, -0.01780691184103489, -0.008945940062403679, 0.025830339640378952, -0.0032682418823242188, -0.03687620908021927, 0.027602532878518105, -0.023123495280742645, 0.005283202510327101, 0.01743062399327755, 0.000789749261457473, 0.016338175162672997, -0.05476808920502663, 0.036317843943834305, 0.006912771612405777, -0.012235423550009727, 0.0034776278771460056, -0.008648551069200039, 0.02114494889974594, 0.046344093978405, 0.015476354397833347, -0.013946926221251488, -0.020016085356473923, 0.014408182352781296, 0.014687363989651203, 0.013764851726591587, 0.01966407336294651, -0.026388701051473618, 0.019943255931138992, 0.0027736055199056864, -0.02665574476122856, -0.007398304529488087, 0.014238245785236359, -0.011822720989584923, 0.014711640775203705, 0.013097244314849377, 0.009067323058843613, 0.004035990685224533, -0.005052574444562197, 0.010299362242221832, -0.01705433614552021, -0.007070569787174463, 0.013437117449939251, -0.011452502571046352, -0.050689611583948135, -0.022807897999882698, -0.011476779356598854, -0.024907827377319336, 0.0051254043355584145, 0.0341329462826252, -0.0008656137506477535, -0.010499644093215466, -0.01348567008972168, 0.00593867152929306, -0.014007617719471455, 0.03724035620689392, 0.0031772046349942684, -0.016629494726657867, -0.025903169065713882, 0.00666393619030714, -0.020428787916898727, 0.012538881972432137, -0.0011963829165324569, 0.024094559252262115, -0.027214108034968376, -0.021411990746855736, 0.01162243913859129, -0.0008443716797046363, -0.027966683730483055, -0.004909949377179146, 0.0023669719230383635, -0.033623140305280685, 0.015112205408513546, 0.00781707651913166, -0.004090612754225731, 0.015221449546515942, 0.04865037649869919, -0.04415920004248619, -0.007416511885821819, -0.0006440894794650376, -0.00942540355026722, -0.019700488075613976, 0.02466506138443947, -0.05544783174991608, 0.02905913069844246, -0.05049540102481842, 0.009753137826919556, -0.008606066927313805, 0.03359886258840561, 0.001533979899249971, -0.02212815172970295, -0.020805075764656067, 0.003869088599458337]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:14:09.057152", "url_path": "/message-history/", "chunk_size": 3391}
updated_dt: 2025-03-14T10:14:09.057152
---
```
frompydanticimport TypeAdapter
frompydantic_ai.messagesimport ModelMessage
ModelMessagesTypeAdapter = TypeAdapter(list[ModelMessage])

```

[](https://ai.pydantic.dev/message-history/#__code_3_annotation_1) agent = Agent('openai:gpt-4o', system_prompt='Be a helpful assistant.') result1 = agent.run_sync('Tell me a joke.') history_step_1 = result1.all_messages() as_python_objects = to_jsonable_python(history_step_1)
Alternatively you can serialize to/from JSON directly: 
```
frompydantic_coreimport to_json
...
as_json_objects = to_json(history_step_1)
same_history_as_step_1 = ModelMessagesTypeAdapter.validate_json(as_json_objects)

```

[](https://ai.pydantic.dev/message-history/#__code_3_annotation_2) same_history_as_step_1 = ModelMessagesTypeAdapter.validate_python(as_python_objects) result2 = agent.run_sync(
You can now continue the conversation with history `same_history_as_step_1` despite creating a new agent run.
[](https://ai.pydantic.dev/message-history/#__code_3_annotation_3) 'Tell me a different joke.', message_history=same_history_as_step_1 ) `
```

_(This example is complete, it can be run "as is")_
## Other ways of using messages
Since messages are defined by simple dataclasses, you can manually create and manipulate, e.g. for testing.
The message format is independent of the model used, so you can use messages in different agents, or the same agent with different models.
In the example below, we reuse the message from the first agent run, which uses the `openai:gpt-4o` model, in a second agent run using the `google-gla:gemini-1.5-pro` model.
Reusing messages with a different model```
frompydantic_aiimport Agent
agent = Agent('openai:gpt-4o', system_prompt='Be a helpful assistant.')
result1 = agent.run_sync('Tell me a joke.')
print(result1.data)
#> Did you hear about the toothpaste scandal? They called it Colgate.
result2 = agent.run_sync(
  'Explain?',
  model='google-gla:gemini-1.5-pro',
  message_history=result1.new_messages(),
)
print(result2.data)
#> This is an excellent joke invented by Samuel Colvin, it needs no explanation.
print(result2.all_messages())
"""
[
  ModelRequest(
    parts=[
      SystemPromptPart(
        content='Be a helpful assistant.',
        dynamic_ref=None,
        part_kind='system-prompt',
      ),
      UserPromptPart(
        content='Tell me a joke.',
        timestamp=datetime.datetime(...),
        part_kind='user-prompt',
      ),
    ],
    kind='request',
  ),
  ModelResponse(
    parts=[
      TextPart(
        content='Did you hear about the toothpaste scandal? They called it Colgate.',
        part_kind='text',
      )
    ],
    model_name='gpt-4o',
    timestamp=datetime.datetime(...),
    kind='response',
  ),
  ModelRequest(
    parts=[
      UserPromptPart(
        content='Explain?',
        timestamp=datetime.datetime(...),
        part_kind='user-prompt',
      )
    ],
    kind='request',
  ),
  ModelResponse(
    parts=[
      TextPart(
        content='This is an excellent joke invented by Samuel Colvin, it needs no explanation.',
        part_kind='text',
      )
    ],
    model_name='gemini-1.5-pro',
    timestamp=datetime.datetime(...),
    kind='response',
  ),
]
"""

```

## Examples
For a more complete example of using messages in conversations, see the [chat app](https://ai.pydantic.dev/examples/chat-app/) example.
Â© Pydantic Services Inc. 2024 to present