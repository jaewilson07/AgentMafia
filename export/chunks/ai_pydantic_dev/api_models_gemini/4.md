---
url: https://ai.pydantic.dev/api/models/gemini/
session_id: pydantic_ai_docs
chunk_number: 4
title: Gemini Model Request Handling
summary: This document chunk outlines the process of configuring and making requests to the Gemini model, including handling model request parameters, tool configurations, and managing async requests with contextual messages.
embedding: [0.03236247971653938, 0.024021632969379425, 0.0022550069261342287, -0.03908281773328781, -0.028954647481441498, -0.015716534107923508, 0.00028168968856334686, -0.013297690078616142, 0.007214830722659826, 0.007030140608549118, -0.004983654711395502, -0.034340448677539825, -3.376831955392845e-05, -0.012225295417010784, -0.0077569857239723206, -0.02064954861998558, 0.015716534107923508, 0.012171675451099873, 0.005138556007295847, 0.0483768992125988, 0.06639312207698822, 0.014596479013562202, -0.012737661600112915, 0.009276211261749268, 0.010658408515155315, 0.03512687236070633, -0.036270759999752045, 0.061102647334337234, -0.030146196484565735, -0.04804326593875885, 0.021090421825647354, -0.023354366421699524, -0.01113502774387598, -0.07668811082839966, 0.0018454119563102722, 0.02316371724009514, -0.023473519831895828, 0.04125143587589264, -0.021424055099487305, 0.01578802801668644, 0.008442126214504242, -0.0017426408594474196, -0.04454011097550392, 0.03996456414461136, 0.0245220847427845, 0.04389667510986328, -0.02549915388226509, -0.010342647321522236, 0.029741069301962852, 0.03312506899237633, -0.008775760419666767, 0.04001222550868988, 0.0170868169516325, 0.017885154113173485, 0.017908984795212746, -0.05228518322110176, -0.04861520975828171, -0.00017538115207571536, -0.03136157616972923, -0.0025737464893609285, -0.020530393347144127, -0.013047464191913605, -0.03407830744981766, -0.028549520298838615, -0.008638732135295868, -0.02483188733458519, -0.04933014139533043, -0.002059890888631344, -0.01255892962217331, 0.020149098709225655, -0.04067949205636978, -0.02221047878265381, 0.006261591333895922, -0.04065566137433052, -0.040465012192726135, -0.024736562743782997, 0.012368281371891499, -0.015668872743844986, -0.005361971911042929, 0.011665266938507557, 0.00920471828430891, -0.019255436956882477, -0.009222591295838356, -0.007310154847800732, -0.02514168992638588, 0.025403831154108047, -0.039154309779405594, -0.0072386618703603745, -0.018135379999876022, -0.03252929449081421, -0.03803425282239914, 0.032410141080617905, -0.013524084351956844, 0.05471594259142876, 0.03231481462717056, -0.03443577513098717, 0.00870426744222641, -0.02735797129571438, 0.03067047894001007, 0.04201402887701988, 0.04871053248643875, 0.005889232270419598, -0.07759369164705276, -0.005510915536433458, 0.06686974316835403, -0.05848123878240585, -0.001002390868961811, 0.04034585878252983, -0.030551323667168617, -0.03257695585489273, -0.008722140453755856, 0.013845802284777164, 0.025618309155106544, -0.018814563751220703, -0.016610197722911835, -0.005677732173353434, -0.005993492901325226, -0.016908084973692894, 0.00515642948448658, 0.003476344980299473, -0.029836393892765045, 0.0038278519641608, -0.038892168551683426, -0.04580315575003624, -0.01805197075009346, -0.02100701443850994, 0.020792534574866295, -0.06510625034570694, -0.03829639405012131, -0.03970242291688919, 0.032719943672418594, 0.010420097969472408, -0.011236310005187988, -0.03481706976890564, -0.011486534960567951, 0.007435267325490713, -0.0006780659896321595, -0.00984219741076231, 0.004349154885858297, 0.019803548231720924, 0.00500748585909605, -0.029121464118361473, 0.0009152587736025453, 0.02000611275434494, -0.013321520760655403, 0.0020211655646562576, -0.039464112371206284, 0.017837492749094963, -0.05943447723984718, -0.025403831154108047, 0.009157055988907814, 0.008477873168885708, -0.024426760151982307, 0.017015323042869568, 0.018611999228596687, -0.0012742129620164633, -0.010354563593864441, 0.009037901647388935, 0.0009644101955927908, -0.03972625359892845, -0.04654191434383392, 0.01419135183095932, -0.02389056235551834, 0.017885154113173485, -0.05128427967429161, 0.016562534496188164, -0.0024411864578723907, 0.02714349329471588, -0.043658364564180374, -0.04170422628521919, 0.0015996549045667052, -0.008317014202475548, -0.02928828075528145, 0.021352563053369522, 0.0015936971176415682, -0.03748613968491554, -0.0849812924861908, -0.0754489004611969, 0.028239717707037926, -0.04089397192001343, -0.03929729387164116, -0.0003777583478949964, -0.061150308698415756, -0.03801042214035988, -0.05123661831021309, 0.014465408399701118, 0.011683140881359577, -0.009276211261749268, 0.012952140532433987, 0.009389407932758331, -0.043753691017627716, 0.05557385832071304, 0.04346771910786629, -0.011039704084396362, -0.03975008428096771, -0.02971723861992359, 0.058862533420324326, -0.004959824029356241, -0.0026526865549385548, 0.08140664547681808, 0.05290478840470314, 0.008811506442725658, 0.015466309152543545, -0.05462061986327171, -0.00791784469038248, -0.010765647515654564, 0.008996197022497654, 0.06863323599100113, -0.022448787465691566, -0.013011718168854713, 0.025880450382828712, -0.0074173943139612675, 0.007214830722659826, 0.0008832358871586621, -0.021066591143608093, 0.013667070306837559, -0.029836393892765045, -0.023330533877015114, -0.018480928614735603, -0.006440323777496815, -0.05895785614848137, 0.08650647848844528, 0.04294343665242195, 0.03093261830508709, -0.025999605655670166, 0.03486473113298416, -0.02262752130627632, -0.015227999538183212, -0.020899774506688118, 0.003851683111861348, 0.018278365954756737, -0.00040438203723169863, -0.013166619464755058, -0.04132292792201042, 0.0019109471468254924, -0.04966377466917038, 0.01048563327640295, -0.00037924779462628067, 0.022174732759594917, -0.03450726717710495, -0.014060281217098236, -0.004566612653434277, 0.004897267557680607, -0.025546817108988762, 0.03279143571853638, -0.0057611409574747086, -0.00531728845089674, -0.051045969128608704, 0.014763295650482178, 0.04322940856218338, 0.0021701091900467873, -0.0834561139345169, -0.025594478473067284, 0.01419135183095932, -0.015883352607488632, -0.02871633693575859, -0.01518033817410469, 0.009407281875610352, -0.042728956788778305, -0.011057577095925808, 0.00917492900043726, 0.03445960581302643, -0.05428698658943176, -0.010789478197693825, -0.003101007081568241, 0.04189487174153328, 0.017325125634670258, -0.042061690241098404, 0.04890118166804314, -0.022508366033434868, 0.017861323431134224, -0.003056323854252696, 0.03257695585489273, -0.01498968992382288, -0.0734471008181572, -0.0008594049140810966, 0.019231604412198067, 0.022341549396514893, 0.040774814784526825, -0.03960709646344185, 0.01142099965363741, -0.007298239506781101, 0.031719040125608444, 0.01777791604399681, -0.023354366421699524, 0.015132675878703594, 0.01419135183095932, -0.022353464737534523, 0.04682788625359535, -0.005180260632187128, 0.049520786851644516, 0.02487954869866371, 0.02325904183089733, -0.017658760771155357, 0.04065566137433052, 0.012928309850394726, 0.012004858814179897, 0.02321138046681881, -0.038201071321964264, -0.001554971793666482, -0.008019126951694489, 0.03124242275953293, 0.006553520914167166, 0.026643041521310806, -0.015382900834083557, 0.029264450073242188, -0.04199019819498062, -0.008477873168885708, 0.009758788160979748, 0.005764119792729616, 0.03715250641107559, -0.005784971639513969, -0.0187549851834774, -0.04220467433333397, 0.020137183368206024, -0.02833504229784012, 0.0003144573129247874, 0.005218985956162214, 0.01932692900300026, -0.00619605602696538, 0.022055577486753464, 0.0022609648294746876, -0.019303098320961, 0.0004457139002624899, 0.01809963397681713, 0.012630422599613667, 0.01865966245532036, -0.018147295340895653, 0.03579413890838623, 0.026643041521310806, -0.020864028483629227, -0.014060281217098236, -0.007268450688570738, 0.017289379611611366, 0.033363379538059235, -0.01703915372490883, -0.023354366421699524, -0.009133225306868553, 0.03355402871966362, 0.05357205495238304, -0.022067492827773094, -0.014429661445319653, -0.009359619580209255, 0.03841554746031761, -0.03615160658955574, -0.0022028766106814146, 0.012022731825709343, 0.04494524002075195, -0.013595577329397202, -0.005719436332583427, 0.022472620010375977, -0.01030094362795353, 0.015442478470504284, -0.027572449296712875, 0.009395365603268147, -0.02287774533033371, 0.012809154577553272, 0.03002704121172428, 0.0034971970599144697, 0.0012056989362463355, -0.04311025142669678, 0.015394816175103188, 0.006225844845175743, -0.005147492978721857, 0.012523182667791843, 0.06863323599100113, -0.02317563258111477, -0.020732957869768143, -0.03031301312148571, -0.018194956704974174, 0.03214799985289574, 0.03448343649506569, -0.023068394511938095, 0.005367929581552744, -0.06729870289564133, -0.012040605768561363, -0.022961154580116272, 0.023390112444758415, -0.014262844808399677, 0.03414980322122574, 0.05247582867741585, 0.0024158661253750324, -0.012213380075991154, -0.03317273035645485, -0.04232383146882057, 0.029598083347082138, -0.02131681703031063, -0.00044683096348308027, -0.03577030822634697, -0.008370633237063885, -0.0036163520999252796, -0.06138861924409866, -0.034936223179101944, 0.003521028207615018, 0.01639571785926819, 0.0306228157132864, -0.02066146396100521, 0.029192958027124405, 0.034030646085739136, -0.012189549393951893, 0.05376270413398743, 0.017956648021936417, 0.017194056883454323, -0.00659522507339716, 0.005195154808461666, -0.0075961267575621605, -0.0032410139683634043, 0.004262767732143402, 0.021769605576992035, -0.01994653418660164, 0.04363453388214111, -0.055001914501190186, 0.03574647754430771, -0.024760393425822258, -2.4342978576896712e-05, -0.028597181662917137, 0.014405830763280392, 0.05309543386101723, 0.02261560596525669, 0.02356884442269802, -0.019827380776405334, -0.055001914501190186, 0.0064164926297962666, 0.02163853496313095, -0.026738366112113, 0.032124169170856476, 0.004804922267794609, -0.05829058960080147, 0.01743236556649208, -0.01804005540907383, -0.04639893025159836, -0.015216084197163582, 0.06572585552930832, 0.03221949189901352, -0.017623012885451317, 0.03288675844669342, -0.008352760225534439, -0.013345351442694664, -0.02390247769653797, -0.027834590524435043, 0.03357785940170288, -0.010420097969472408, -0.020196760073304176, 0.005838591605424881, -0.022401126101613045, -0.01097416877746582, -0.01645529456436634, 0.031742870807647705, -0.044373296201229095, -0.06243718042969704, 0.028168225660920143, -0.015275661833584309, 0.0245220847427845, -0.015096928924322128, -0.009496647864580154, -0.0444924496114254, 0.040107548236846924, 0.03286292776465416, 0.05190388485789299, -0.030217690393328667, 0.009127267636358738, -0.01142099965363741, 0.0012369770556688309, -0.004930035211145878, -0.04942546412348747, -0.03443577513098717, 0.004992591217160225, 0.023044563829898834, -0.009883901104331017, 0.02711966075003147, 0.012088267132639885, 0.014370083808898926, -0.04387284442782402, 0.022043662145733833, -0.023127971217036247, -0.044659268110990524, 0.027500957250595093, 0.028883153572678566, 0.01178442221134901, 0.0062556336633861065, 0.0050789788365364075, -0.021102337166666985, -0.001109630218707025, -0.003196330973878503, -0.02321138046681881, 0.08421870321035385, -0.007560380268841982, -0.04606529325246811, 0.020220590755343437, 0.012332535348832607, 0.012547014281153679, -0.002883549313992262, -0.02904997207224369, -0.012141887098550797, 0.005779013969004154, -0.02447442151606083, -0.07297047972679138, 0.002526084426790476, 0.03874918073415756, 0.011867830529808998, -0.03741464763879776, -0.010408182628452778, -0.02387864701449871, -0.013214281760156155, -0.0020911688916385174, 0.005067063495516777, -0.026047267019748688, 0.008710225112736225, 0.006738211028277874, 0.0380580835044384, -0.02549915388226509, 0.007822521030902863, 0.00709567591547966, 0.03093261830508709, 0.0033005913719534874, 0.024021632969379425, -0.014405830763280392, -0.0148109570145607, -0.006708422210067511, 0.0052249436266720295, 0.02771543525159359, 0.005424527917057276, 0.029812563210725784, -0.008311056531965733, -0.01400070358067751, 0.012761492282152176, -0.003926154691725969, -0.03781977295875549, -0.03248163312673569, 0.023342451080679893, 0.034626420587301254, 0.002201387193053961, 0.011766549199819565, 0.00669650686904788, 0.000584603869356215, -0.018909886479377747, 0.0038308307994157076, 0.008668520487844944, -0.01641954854130745, -0.014918196946382523, -0.03226715326309204, -0.014882449992001057, -0.06372405588626862, 0.0012168696848675609, 0.00540665490552783, 0.01972014084458351, -0.0010560104856267571, -0.011093324050307274, 0.0027286477852612734, 0.01550205610692501, 0.014715633355081081, -0.060483042150735855, 0.030861126258969307, -0.006493943743407726, -0.011617605574429035, 0.021745774894952774, -0.020268253982067108, 0.024379098787903786, -0.037891265004873276, 0.01613357663154602, -0.02735797129571438, 0.010026887059211731, 0.026523886248469353, 0.01549014076590538, -0.039201971143484116, 0.018171126022934914, 0.028501858934760094, 0.004301493056118488, -0.0010545210679993033, 0.032767605036497116, -0.0076557039283216, -0.010491590946912766, 0.02585661970078945, -0.03391149267554283, 0.0074173943139612675, -0.022401126101613045, 0.0077569857239723206, -0.0049985493533313274, -0.06339041888713837, 0.0067918309941887856, 0.0043402183800935745, -0.012153802439570427, -0.014846703968942165, -0.012785323895514011, -0.012773408554494381, 0.014703718014061451, 0.0020286126527935266, 0.01774216815829277, 0.005129619501531124, -0.03093261830508709, 0.03975008428096771, -0.00966346450150013, 0.011498450301587582, 0.015704618766903877, -0.014858619309961796, -0.01869540847837925, 0.01257084496319294, -0.008430210873484612, -0.06043538078665733, -0.023461604490876198, 0.06534456461668015, 0.006112647708505392, -0.04861520975828171, 0.04318174719810486, 0.006014344748109579, 0.014310507103800774, -0.0020896794740110636, -0.013488337397575378, -0.04890118166804314, 0.0021164894569665194, 0.013726647943258286, 0.0009137693559750915, -0.006398619618266821, -0.025975774973630905, 0.013238112442195415, -0.0062556336633861065, 0.006380746141076088, -0.012821069918572903, 0.033411040902137756, 0.02193642221391201, -0.012606590986251831, 0.038558535277843475, 0.012773408554494381, 0.004581506829708815, 0.027906084433197975, 0.0180877186357975, 0.017670676112174988, 0.017992394044995308, 0.011367379687726498, 0.029455097392201424, 0.016324225813150406, -0.021471718326210976, 0.02876400016248226, 0.02058997191488743, -0.05071233585476875, 0.014012619853019714, 0.06053070351481438, -0.03903515264391899, -0.03608011081814766, -0.036604393273591995, 0.03553199768066406, 0.03519836440682411, 0.014524986036121845, -0.02678602747619152, 0.023151801899075508, 0.010074549354612827, -0.015132675878703594, 0.04937780275940895, -0.011820169165730476, -0.013738563284277916, 0.0007238661637529731, -0.032743774354457855, 0.008710225112736225, 0.0036997604183852673, 0.021769605576992035, -0.019577154889702797, -0.013357267715036869, -0.006073922384530306, 0.006505859084427357, 0.02132873237133026, -0.018278365954756737, 0.03193351998925209, -0.029478928074240685, 0.053953349590301514, -0.0073041971772909164, 0.033363379538059235, 0.03126625344157219, -0.021757690235972404, -0.00563602801412344, 0.001448477036319673, -0.007435267325490713, 0.0038963661063462496, 0.004632147960364819, -0.05023571848869324, 0.05390568822622299, -0.013095126487314701, -0.01338109839707613, -0.026500055566430092, -0.02025633677840233, 0.04644659161567688, -0.010402224957942963, 0.025570647791028023, -0.050474025309085846, -0.015216084197163582, 0.02157895639538765, -0.047256845980882645, 0.02255602739751339, -0.01931501366198063, -0.010169873014092445, 0.02293732389807701, -0.002092658309265971, -0.03839171677827835, 0.00935366190969944, -0.021042760461568832, 0.01308321114629507, 0.015216084197163582, -0.03698568791151047, 0.0062735071405768394, 0.0008273820276372135, -0.040155209600925446, 0.005650922190397978, -0.023711830377578735, -0.015120760537683964, 0.01467988733202219, -0.00187371124047786, -0.031790535897016525, 0.013226197101175785, 0.0035925209522247314, 0.028954647481441498, -0.02676219679415226, -0.023604590445756912, -0.015251830220222473, 0.0026333238929510117, 0.025618309155106544, -0.04184721037745476, -0.0035299647133797407, 0.034173633903265, 0.007298239506781101, 0.031766705214977264, -0.012159760110080242, 0.008871084079146385, -0.012183591723442078, -0.05195154994726181, 0.017337040975689888, -8.210519445128739e-05, -0.027024338021874428, -0.009657506830990314, 0.052094534039497375, -0.010860971175134182, 0.03183819726109505, 0.01707490161061287, 0.032743774354457855, 0.0153114078566432, -0.006899070460349321, -0.010688196867704391, -0.004935992881655693, -0.04525504261255264, -0.030479829758405685, 0.02645239420235157, 0.026666872203350067, 0.008418295532464981, -0.01112311240285635, 0.008251478895545006, 0.012773408554494381, -0.03224332258105278, -0.023962056264281273, -0.026595380157232285, 0.03326805680990219, -0.02161470428109169, 0.004941950552165508, -0.020220590755343437, 0.006410534959286451, -0.0001468025875510648, -0.005448359064757824, 0.028597181662917137, -0.040488842874765396, 0.013142788782715797, 0.008197858929634094, -0.048233915120363235, -0.009955394081771374, -0.004075098317116499, -0.020482731983065605, 0.013964957557618618, 0.03507921099662781, -0.019732056185603142, 0.01744428090751171, 0.016943830996751785, 0.03610394150018692, 0.017813662067055702, -0.03634225204586983, 0.0010262217838317156, 0.021066591143608093, 0.00043417076813057065, 0.036318421363830566, 0.06882388889789581, -0.019815463572740555, 0.005981577560305595, 0.011724844574928284, 0.03129008412361145, 0.015263746492564678, -0.0020718062296509743, -0.004647042136639357, -0.03603244945406914, 0.02802523970603943, -0.007310154847800732, 0.04091780260205269, -0.0355081669986248, 0.005802845116704702, -0.020125268027186394, 0.010432014241814613, -0.005519852042198181, 0.023795239627361298, -0.011992943473160267, 0.009979224763810635, 0.004524908494204283, -0.05180856212973595, 0.011087366379797459, -0.09456135332584381, 0.021078506484627724, 0.0274056326597929, -0.0025499153416603804, -0.012213380075991154, -0.022091323509812355, -0.014346253126859665, 0.004512992687523365, -0.01194528117775917, -0.022424956783652306, 0.010348604992032051, -0.012177633121609688, 0.019136281684041023, -0.02257985807955265, 0.03650907054543495, 0.016205070540308952, -0.00855532381683588, -0.038892168551683426, -0.013512169010937214, -0.05276180058717728, -0.01560929510742426, -0.0038040210492908955, -0.049806758761405945, 0.010569041594862938, 0.007649746257811785, -0.04556484520435333, 0.028525689616799355, 0.032171830534935, 0.014799041673541069, -0.03195735067129135, -0.025904281064867973, 0.05462061986327171, 0.036270759999752045, 0.012487436644732952, -0.042728956788778305, 0.023127971217036247, -0.024617407470941544, 0.017563436180353165, 0.005951788742095232, 0.006773957516998053, -0.0026794965378940105, -0.03648523986339569, -0.018516676500439644, 0.015359070152044296, 0.02350926771759987, 0.02449825219810009, -0.0032380351331084967, -0.0005272605339996517, -0.020065689459443092, 0.009633676148951054, -0.047280676662921906, -0.0062973378226161, -0.05218985676765442, 0.014953942969441414, 0.016693605110049248, 0.044373296201229095, -0.02286582998931408, -0.020554224029183388, -0.009538351558148861, 0.028144393116235733, -0.0015184805961325765, -0.006184140685945749, 0.038272563368082047, -0.03028918243944645, 0.02161470428109169, -0.01703915372490883, -0.059863436967134476, -0.013726647943258286, -0.03195735067129135, -0.0046232109889388084, 0.008287224918603897, 0.005198133643716574, 0.005531767383217812, 0.0009621760109439492, -0.014072196558117867, 0.010449887253344059, -0.026619210839271545, 0.03486473113298416, -0.015549718402326107, 0.040155209600925446, -0.014965859241783619, 0.0018900950672104955, -0.007196957711130381, 0.02125723846256733, -0.04039352014660835, -0.01806388609111309, 0.0011878256918862462, -0.007292281370609999, 0.007042056415230036, 0.020149098709225655, 0.034626420587301254, -0.019469914957880974, 0.020113350823521614, -0.0020107394084334373, -0.03619926795363426, -0.00804295763373375, -0.022055577486753464, -0.008483830839395523, 0.018814563751220703, -0.0056956056505441666, 0.03944028168916702, 0.031051773577928543, 0.0035955000203102827, -0.039797745645046234, 0.023437773808836937, -0.02833504229784012, 0.01093246415257454, 0.041489746421575546, 0.020232506096363068, 0.00036230543628335, -0.015442478470504284, 0.012064436450600624, 0.0036372041795402765, -0.010247323662042618, -0.013535999692976475, -0.02483188733458519, 0.04411115497350693, -0.03031301312148571, -0.036270759999752045, -0.003955943509936333, -0.0016443380154669285, 0.012737661600112915, 0.0014641161542385817, 0.00856723915785551, 0.0018811584450304508, 0.0008921725093387067, -0.017611097544431686, 0.005814760457724333, 0.006202014163136482, -0.020172929391264915, -0.014727548696100712, 0.015966759994626045, -0.0006255633779801428, 0.002336926059797406, -0.019541408866643906, 0.018588168546557426, -0.029431266710162163, 0.009317914955317974, -0.022341549396514893, -0.030861126258969307, 0.027667773887515068, -0.00035187939647585154, 0.029788732528686523, 0.00041555281495675445, -0.040750984102487564, -0.023390112444758415, 0.02384290099143982, 0.029455097392201424, -0.00969325378537178, 0.015525886788964272, 0.0387253500521183, -0.029264450073242188, -0.0033631478436291218, -0.03250546380877495, -0.006762042175978422, -0.006720338016748428, -0.024045463651418686, -0.017170224338769913, -0.018194956704974174, -0.024021632969379425, 0.030050871893763542, 0.06196056306362152, -0.033982984721660614, -0.0020181864965707064, 0.012040605768561363, -0.021793436259031296, 0.013023633509874344, 0.0030220667831599712, -0.025713633745908737, 0.045016732066869736, -0.06062602624297142, -0.00045204401249065995, 0.018552422523498535, -0.013416844420135021, 0.004885352216660976, -0.004089992959052324, 0.03183819726109505, -0.014048365876078606, 0.002809077501296997, 0.04165656119585037, -0.02067337930202484, 0.03648523986339569, 0.004119781777262688, 0.002246070420369506, 0.003440598491579294, 0.0005172068485990167, 0.008638732135295868, 0.03300591558218002, -0.01193336583673954, 0.0008221690077334642, 0.006309253163635731, 0.04511205479502678, -0.009621760807931423, 0.027906084433197975, 0.015192253515124321, -0.016526788473129272, 0.04487374424934387, 0.034983888268470764, -0.02771543525159359, -0.00309802801348269, 0.03839171677827835, 0.004903225228190422, 0.010616703890264034, -0.028168225660920143, 0.02029208466410637, 0.02480805665254593, -0.019922703504562378, -0.015537802129983902, -0.046565745025873184, -0.009764745831489563, 0.006410534959286451, -0.009139182977378368, -0.040417350828647614, -0.0002617684949655086, -0.010956295765936375, -0.02678602747619152, -0.006225844845175743, 0.013416844420135021, -0.01098608411848545, -0.026976674795150757, 0.007411436643451452, 0.020113350823521614, 0.03972625359892845, 0.02833504229784012, -0.015513971447944641, 0.02680985815823078, -0.010855013504624367, 0.02091168984770775, 0.024355266243219376, 0.004611295647919178, 0.020113350823521614, -0.008722140453755856, -0.019517576321959496, -0.006184140685945749, 0.04813859239220619, -0.02516552060842514, 0.006249675992876291, 0.017158308997750282, -0.0008616390405222774, 0.03941645100712776, 0.011617605574429035, 0.04775729402899742, 0.0027494998648762703, -0.04096546396613121, 0.027572449296712875, -0.025356167927384377, 0.023020731285214424, -0.0029327005613595247, -0.0012853838270530105, -0.012213380075991154, -0.021412139758467674, 0.03136157616972923, 0.011730802245438099, 0.02445059083402157, -0.0041614859364926815, 0.0052398378029465675, 0.0004099674115423113, 0.037867434322834015, -0.009294084273278713, 0.02286582998931408, 0.0026884330436587334, 0.00791784469038248, -0.01806388609111309, 0.0071075912564992905, 0.03546050563454628, -0.027238816022872925, -0.014536901377141476, 0.009931563399732113, 0.0026333238929510117, 0.0017158309929072857, -0.0018439225386828184, -0.0096515491604805, -0.0432770699262619, 0.04558867588639259, 0.017015323042869568, -0.018576253205537796, 0.020089520141482353, -0.02257985807955265, 0.0355081669986248, 0.004813859239220619, -0.012404028326272964, 0.026547716930508614, -0.024116957560181618, -0.04680405557155609, 7.847468805266544e-05, -0.023306703194975853, -0.002204366261139512, -0.0177540834993124, -0.008489788509905338, -0.011224393732845783, 0.01417943648993969, 0.019219689071178436, -0.01900521107017994, -0.02323521114885807, 0.014942027628421783, -0.022734759375452995, 0.050521690398454666, -0.03152839466929436, 0.029598083347082138, 0.0018513696268200874, -0.03526986017823219, 0.004024457652121782, -0.023747576400637627, 0.010253281332552433, -0.04234766215085983, 0.013321520760655403, 0.013345351442694664, -0.03803425282239914, -0.025737464427947998, -0.02031591534614563, -0.033982984721660614, 0.02190067619085312, 0.011677183210849762, -0.02638090029358864, 0.02192450687289238, -0.01583568938076496, 0.01773025281727314, -0.00619605602696538, 0.001467839814722538, -0.012618506327271461, -0.02897847816348076, 0.016002506017684937, -0.00659522507339716, 0.008763845078647137, 0.026833688840270042, -0.015132675878703594, -0.006523732095956802, -0.011361422017216682, 0.010539253242313862, 0.0015936971176415682, 0.06849025189876556, 0.0032499507069587708, 0.014632225036621094, -0.007077802903950214, -0.0038874296005815268, -0.01778983138501644, -0.05795695632696152, -0.018469013273715973, -0.0336255207657814, -0.012404028326272964, -0.03129008412361145, 0.02035166136920452, -0.03155222535133362, 0.02093552052974701, -0.004730450455099344, 0.019100535660982132, 0.013845802284777164, 0.005743267480283976, -0.017920900136232376, 0.004361070226877928, 0.07449565827846527, 0.009258338250219822, 6.362686690408736e-05, 0.030408337712287903, 0.019839296117424965, 0.015025435946881771, 0.024319520220160484, 0.004727471619844437, 0.025951942428946495, -0.02262752130627632, 0.014858619309961796, -0.0011073960922658443, -0.0125946756452322, 0.008418295532464981, 0.022770507261157036, 0.0007085994584485888, 0.018874140456318855, 0.013988788239657879, 0.009371534921228886, 0.023080309852957726, 0.034340448677539825, 0.03093261830508709, 0.002750989282503724, 0.015442478470504284, -0.018469013273715973, 0.027524787932634354, 0.011998901143670082, 0.013774309307336807, 0.011563985608518124, 0.07406670600175858, -0.004182337783277035, -0.003261866047978401, -0.049520786851644516, -0.010384351946413517, -0.0014246461214497685, 0.030527492985129356, -0.02585661970078945, -0.02392631024122238, -0.0014983732253313065, 0.0067262956872582436, -0.0009778151288628578, -0.0024575702846050262, -0.012547014281153679, 0.0010567553108558059, 0.004188295919448137, 0.02480805665254593, -0.04351538047194481, -0.001361345057375729, -0.006976521108299494, -0.011718886904418468, -0.024045463651418686, -0.01769450679421425, 0.008305098861455917, -0.026214083656668663, 0.006160309538245201, -0.02833504229784012, 0.011617605574429035, 0.024974873289465904, 0.030122365802526474, -0.003455492900684476, -0.011236310005187988, -0.016276562586426735, -0.0072863237001001835, 0.015144591219723225, -0.0071731265634298325, -0.04456394165754318, 0.026666872203350067, 0.001514757052063942, -0.02778692916035652, 0.020875943824648857, 0.008328929543495178, 0.014405830763280392, 0.0009860070422291756, -0.030575154349207878, 0.0020479753147810698, -0.026619210839271545, -0.009419197216629982, 0.0002312350261490792, 0.03064664639532566, 0.013643239624798298, 0.013667070306837559, -0.0329582542181015, -0.018790731206536293, -0.005201112478971481, -0.020852113142609596, 0.05752800032496452, 0.0076914504170417786, -0.03603244945406914, 0.019839296117424965, -0.00531728845089674, 0.02933594398200512, 0.032719943672418594, 0.020887859165668488, -0.00342868291772902, -0.01811154931783676, 0.013023633509874344, 0.014322422444820404, -0.04380135238170624, 0.023735661059617996, -0.005624112673103809, 0.02802523970603943, 0.026714535430073738, 0.021030845120549202, 0.01577611267566681, -0.06644079089164734, -0.045612506568431854, -0.046303603798151016, -0.005939872935414314, -0.010217535309493542, 0.018957549706101418, 0.016240816563367844, -0.0020807429682463408, -0.006404577288776636, 0.019267352297902107, -0.04549334943294525, 0.0022490492556244135, 0.02516552060842514, 0.0010537763591855764, 0.001435072161257267, -0.04942546412348747, 0.03729549050331116, 0.007864225655794144, 0.018802648410201073, -0.02194833755493164, -0.02284199930727482, -0.009317914955317974, -0.003622309770435095, -0.010741816833615303, -0.021543210372328758, -0.012964055873453617, -0.003288676030933857, -0.010866929776966572, 0.025618309155106544, -0.02647622488439083, -0.018802648410201073, 0.02001802809536457, -0.01289256289601326, -0.03319656103849411, -0.009478774853050709, -0.02025633677840233, -0.026523886248469353, 0.01607399992644787, -0.006636929232627153, -0.01873115450143814, 0.014441576786339283, 0.0274056326597929, -0.003726570401340723, -0.023687999695539474, 0.020709127187728882, 0.02964574657380581, -0.03479323908686638, -0.010843098163604736, -0.02714349329471588, -0.006583309732377529, 0.012535098008811474, -0.0009137693559750915, -0.023294787853956223, -0.022162815555930138, -0.02711966075003147, 0.015168421901762486, 0.0042419154196977615, -0.02383098565042019, -0.004462352022528648, -0.023985886946320534, 0.024009717628359795, 0.01450115442276001, 0.0200299434363842, 0.05767098441720009, 0.02676219679415226, 0.007488887291401625, -0.043968167155981064, -0.002432249952107668, 0.022794337943196297, 0.03481706976890564, 0.02609492838382721, 0.00563602801412344, 0.034411944448947906, 0.05419166013598442, -0.0066786338575184345, 0.018874140456318855, 0.00229820073582232, -0.027000507339835167, 0.014119858853518963, -0.01678892970085144, 0.012523182667791843, 0.01582377403974533, -0.0005209304508753121, 0.0025141688529402018, -0.015120760537683964, -0.014060281217098236, 0.020172929391264915, 0.0016532746376469731, -0.038201071321964264, 0.01649104245007038, 0.0497114360332489, 0.00968729518353939, 0.023378197103738785, 0.025403831154108047, 0.027977576479315758, -0.015692703425884247, -0.020184844732284546, -0.006815661676228046, 0.01671743579208851, 0.028430365025997162, -0.017527690157294273, 0.0002193195396102965, -0.0006121584447100759, 0.002564809750765562, -0.008174028247594833, 0.01840943656861782, -0.004012542311102152, -0.01833794265985489, -0.01096225343644619, -0.0030190879479050636, 0.026857521384954453, 0.010390309616923332, 0.030479829758405685, 0.026881352066993713, 0.014358168467879295, -0.006601182743906975, -0.004018499981611967, -0.004036372993141413, -0.019231604412198067, -0.009472816251218319, 9.262433741241693e-05, 0.013500253669917583, 0.0018573274137452245, -0.00548708438873291, 0.003833809867501259, 0.013130873441696167, -0.002171598607674241, 0.00039358361391350627, 0.01615740731358528, 0.005314309615641832, -0.008597028441727161, -0.00187371124047786, -0.004694703966379166, -0.053047772496938705, 0.034721747040748596, -0.006184140685945749, -0.0015370985493063927, -0.0036044365260750055, -0.010765647515654564, 0.0007417394081130624, 0.030408337712287903, 0.01048563327640295, -0.015978675335645676, -0.013559830375015736, 0.019160112366080284, 0.028454195708036423, 0.028144393116235733, 0.04168039187788963, -0.014620309695601463, -0.02356884442269802, 0.016300393268465996, -0.01226104237139225, -0.003818915458396077, -0.040846310555934906, 0.004337239544838667, 0.043753691017627716, 0.02449825219810009, -0.000508270226418972, 0.024355266243219376, -0.033339548856019974, -0.004950887057930231, -0.0008877041982486844, -0.0074650561437010765, -0.029526591300964355, 0.018278365954756737, 0.02478422410786152, -0.008579154498875141, -0.01128397136926651, -0.015692703425884247, -0.02902613952755928, -0.0049002463929355145, 0.030884956941008568, -0.018802648410201073, -0.00044012852595187724, 0.001435816870070994, -0.0029058908112347126, 0.007339943666011095, 0.0095145208761096, -0.027548618614673615, 0.015156506560742855, 0.011248225346207619, 0.03353019803762436, -0.00458746450021863, -0.00982432346791029, 0.002369693713262677, -0.010884802788496017, 0.03972625359892845, -0.0242480281740427, -0.004793006926774979, -0.02190067619085312, 0.015954844653606415, -0.010432014241814613, 0.0051445141434669495, -0.026190252974629402, 0.0028120563365519047, -0.03774828091263771, -0.04933014139533043, -0.02129298634827137, 0.01899329572916031, -0.03388766199350357, 0.006952689960598946, 0.002046485897153616, 0.012076351791620255, 0.004700662102550268, -0.016252731904387474, -0.0021954295225441456, 0.02163853496313095, -0.008525535464286804, 0.00010239876428386196, -0.011701013892889023, 0.030432168394327164, 0.015204168856143951, -0.008507661521434784, -0.024712732061743736, 0.0242480281740427, -0.009597929194569588, 0.017182139679789543, 0.019112451002001762, 0.0020211655646562576, -0.016836591064929962, 0.025737464427947998, -0.026690702885389328, -0.030813464894890785, -0.0022356442641466856, 0.014084112830460072, -0.008185943588614464, -0.0014075175859034061, -0.02033974602818489, -0.00452788732945919, 0.0316237173974514, -0.010545210912823677, -0.022651351988315582, 0.012189549393951893, 0.004283619578927755, -0.023282872512936592, -0.008823422715067863, -0.023366281762719154, 0.0037563589867204428, 0.0059637040831148624, -0.015919098630547523, 0.00902598537504673, 0.04227616637945175, -0.0187549851834774, -0.008990239351987839, 0.0031993098091334105, -0.036628223955631256, -0.020494647324085236, 0.005498999729752541, 0.032028842717409134, -0.04985442012548447, -0.021805351600050926, -0.0043402183800935745, -0.016967661678791046, 0.01289256289601326, -0.03863002732396126, -0.014215182512998581, -0.012129971757531166, 0.03643757849931717, 0.032124169170856476, 0.012368281371891499, -0.014799041673541069, 0.019291182979941368, -0.03357785940170288, 0.021054675802588463, 0.016002506017684937, 0.001954140840098262, -0.0336255207657814, 0.014524986036121845, -0.0002896954247262329, -0.029836393892765045, -0.01550205610692501, -0.03343487158417702, -0.03643757849931717, -0.01097416877746582, 0.009145140647888184, 0.006702464539557695, 0.015668872743844986, -0.016526788473129272, -0.019767802208662033, 0.010646493174135685, 0.005320267286151648, 0.015287577174603939, 0.0020107394084334373, 0.017575351521372795, 0.003955943509936333]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:39.441817", "url_path": "/api/models/gemini/", "chunk_size": 5000}
updated_dt: 2025-03-15T11:17:39.441817
---
st_parameters: ModelRequestParameters, tools: _GeminiTools | None
  ) -> _GeminiToolConfig | None:
    if model_request_parameters.allow_text_result:
      return None
    elif tools:
      return _tool_config([t['name'] for t in tools['function_declarations']])
    else:
      return _tool_config([])
  @asynccontextmanager
  async def_make_request(
    self,
    messages: list[ModelMessage],
    streamed: bool,
    model_settings: GeminiModelSettings,
    model_request_parameters: ModelRequestParameters,
  ) -> AsyncIterator[HTTPResponse]:
    tools = self._get_tools(model_request_parameters)
    tool_config = self._get_tool_config(model_request_parameters, tools)
    sys_prompt_parts, contents = await self._message_to_gemini_content(messages)
    request_data = _GeminiRequest(contents=contents)
    if sys_prompt_parts:
      request_data['system_instruction'] = _GeminiTextContent(role='user', parts=sys_prompt_parts)
    if tools is not None:
      request_data['tools'] = tools
    if tool_config is not None:
      request_data['tool_config'] = tool_config
    generation_config: _GeminiGenerationConfig = {}
    if model_settings:
      if (max_tokens := model_settings.get('max_tokens')) is not None:
        generation_config['max_output_tokens'] = max_tokens
      if (temperature := model_settings.get('temperature')) is not None:
        generation_config['temperature'] = temperature
      if (top_p := model_settings.get('top_p')) is not None:
        generation_config['top_p'] = top_p
      if (presence_penalty := model_settings.get('presence_penalty')) is not None:
        generation_config['presence_penalty'] = presence_penalty
      if (frequency_penalty := model_settings.get('frequency_penalty')) is not None:
        generation_config['frequency_penalty'] = frequency_penalty
      if (gemini_safety_settings := model_settings.get('gemini_safety_settings')) != []:
        request_data['safety_settings'] = gemini_safety_settings
    if generation_config:
      request_data['generation_config'] = generation_config
    headers = {
      'Content-Type': 'application/json',
      'User-Agent': get_user_agent(),
    }
    if self._provider is None: # pragma: no cover
      url = self.base_url + ('streamGenerateContent' if streamed else 'generateContent')
      headers.update(await self.auth.headers())
    else:
      url = f'/{self._model_name}:{"streamGenerateContent"ifstreamedelse"generateContent"}'
    request_json = _gemini_request_ta.dump_json(request_data, by_alias=True)
    async with self.client.stream(
      'POST',
      url,
      content=request_json,
      headers=headers,
      timeout=model_settings.get('timeout', USE_CLIENT_DEFAULT),
    ) as r:
      if (status_code := r.status_code) != 200:
        await r.aread()
        if status_code >= 400:
          raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=r.text)
        raise UnexpectedModelBehavior(f'Unexpected response from gemini {status_code}', r.text)
      yield r
  def_process_response(self, response: _GeminiResponse) -> ModelResponse:
    if len(response['candidates']) != 1:
      raise UnexpectedModelBehavior('Expected exactly one candidate in Gemini response')
    if 'content' not in response['candidates'][0]:
      if response['candidates'][0].get('finish_reason') == 'SAFETY':
        raise UnexpectedModelBehavior('Safety settings triggered', str(response))
      else:
        raise UnexpectedModelBehavior('Content field missing from Gemini response', str(response))
    parts = response['candidates'][0]['content']['parts']
    return _process_response_from_parts(parts, model_name=response.get('model_version', self._model_name))
  async def_process_streamed_response(self, http_response: HTTPResponse) -> StreamedResponse:
"""Process a streamed response, and prepare a streaming response to return."""
    aiter_bytes = http_response.aiter_bytes()
    start_response: _GeminiResponse | None = None
    content = bytearray()
    async for chunk in aiter_bytes:
      content.extend(chunk)
      responses = _gemini_streamed_response_ta.validate_json(
        _ensure_decodeable(content),
        experimental_allow_partial='trailing-strings',
      )
      if responses:
        last = responses[-1]
        if last['candidates'] and last['candidates'][0].get('content', {}).get('parts'):
          start_response = last
          break
    if start_response is None:
      raise UnexpectedModelBehavior('Streamed response ended without content or tool calls')
    return GeminiStreamedResponse(_model_name=self._model_name, _content=content, _stream=aiter_bytes)
  @classmethod
  async def_message_to_gemini_content(
    cls, messages: list[ModelMessage]
  ) -> tuple[list[_GeminiTextPart], list[_GeminiContent]]:
    sys_prompt_parts: list[_GeminiTextPart] = []
    contents: list[_GeminiContent] = []
    for m in messages:
      if isinstance(m, ModelRequest):
        message_parts: list[_GeminiPartUnion] = []
        for pa