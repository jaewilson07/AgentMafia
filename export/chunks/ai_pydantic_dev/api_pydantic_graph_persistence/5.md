---
url: https://ai.pydantic.dev/api/pydantic_graph/persistence/
session_id: pydantic_ai_docs
chunk_number: 5
title: BaseStatePersistence Class
summary: Abstract base class for storing the state of a graph run. Each subclass instance is meant for a single graph run. It includes abstract methods to snapshot the graph state when running a node, with specific functions for capturing state based on snapshot ID presence.
embedding: [0.03843018040060997, 0.050030991435050964, 0.027327686548233032, -0.04273563623428345, -0.014949499629437923, 0.02413845993578434, 0.029879067093133926, -0.041858598589897156, 0.006194076035171747, -0.007988016121089458, 0.025454014539718628, 0.0055512478575110435, 0.02270330674946308, -0.03900822997093201, -0.029121626168489456, 0.03745348006486893, 0.003435893449932337, 0.03308822587132454, 0.02559354342520237, 0.03605819493532181, 0.023600276559591293, -0.039626140147447586, 0.0277861375361681, -0.02112862654030323, -0.02330128662288189, 0.0007935693138279021, 0.013344920240342617, 0.047997862100601196, 0.00814747717231512, -0.009801888838410378, 0.06282776594161987, -0.009607545100152493, -0.0030995295383036137, 0.03386560082435608, 0.015278388746082783, 0.018597178161144257, -0.021547213196754456, 0.025015495717525482, -0.032191257923841476, 0.012049296870827675, 0.025952331721782684, -0.05939934775233269, 0.009004581719636917, 0.015985999256372452, 0.003361145965754986, 0.01051448192447424, 0.0010296468390151858, 0.06864809989929199, 0.011610778048634529, 0.03715449199080467, -0.03029765374958515, -0.018736707046628, 0.008252124302089214, 0.028882434591650963, -0.03613792359828949, -0.03488216549158096, -0.01504916325211525, -0.005040472839027643, -0.005356904119253159, 0.0014874752378091216, 0.02866317518055439, 0.009472999721765518, -0.0034533345606178045, 0.07363127171993256, -0.028962165117263794, 0.025394218042492867, -0.018338052555918694, 0.056927695870399475, -0.05210398882627487, -0.04369240626692772, 0.024656709283590317, 0.023899266496300697, -0.0424964465200901, -0.04767893999814987, -0.015587344765663147, 0.005095287691801786, 0.015168759040534496, 0.05792433023452759, 0.01895596645772457, 0.0019085528329014778, 0.00013376688002608716, 0.023141825571656227, -0.008282022550702095, 0.021646875888109207, 0.007449834141880274, -0.03773253783583641, -0.0452471524477005, -0.03852984309196472, -0.011232057586312294, -0.043293751776218414, 0.029201356694102287, -0.030457114800810814, -0.004469900391995907, 0.06749200820922852, 0.035041626542806625, -0.004320405423641205, 0.02627125382423401, -0.020590445026755333, -0.036536578088998795, 0.0016519196797162294, 0.018906135112047195, -0.019484180957078934, -0.025075294077396393, -0.009672326035797596, 0.03456324338912964, 0.00218013534322381, -0.003969092387706041, 0.04548634588718414, -0.020969165489077568, -0.0002771886356640607, -0.08563073724508286, -0.06306695938110352, 0.03603826090693474, -0.004444984719157219, -0.047080960124731064, -0.055372945964336395, -0.04094169661402702, -0.0024691589642316103, 0.015637176111340523, 0.0528215654194355, -0.026729706674814224, 0.05485469847917557, -0.07502655684947968, 0.005865186918526888, 0.027347618713974953, -0.008441484533250332, -0.02330128662288189, 0.018637042492628098, -0.04795799404382706, -0.0008514986257068813, 0.04496809467673302, -0.04460930824279785, -0.015198658220469952, -0.028144925832748413, 0.019135359674692154, 0.0008396635530516505, -0.04072243720293045, 0.0034707756713032722, -0.037274084985256195, -0.009931450709700584, -0.00481623038649559, -0.03243044763803482, -0.018926067277789116, 0.022763105109333992, -0.00824215728789568, 0.05632971599698067, -0.025753004476428032, 0.07028257846832275, -0.012188825756311417, 0.03181253746151924, 0.06027638539671898, 0.02786586806178093, -0.03392539918422699, -0.02407866157591343, 0.01633482053875923, -0.01617535948753357, 0.013823304325342178, 0.02023165673017502, -0.004093671217560768, -0.03454330936074257, -0.02260364405810833, 0.043293751776218414, 0.00846640020608902, 0.010663976892828941, 0.030616575852036476, -0.01617535948753357, -0.06545887887477875, -0.028384117409586906, -0.029201356694102287, -0.05963853746652603, 0.02551381289958954, -0.014202024787664413, -0.005491449497640133, 0.01429172232747078, 0.011182226240634918, -0.010913134552538395, -0.04273563623428345, 0.031055094674229622, -0.01834801957011223, -0.026550311595201492, -0.00013010736438445747, -0.03856971114873886, -0.05365873873233795, 0.0020032329484820366, -0.03444364666938782, -0.011889835819602013, 0.022384384647011757, 0.03555987775325775, 0.00657279696315527, 0.010663976892828941, -0.0025227281730622053, 0.03775247186422348, 0.005396769382059574, 0.0017702699406072497, 0.008446467109024525, 0.01842775009572506, 0.028822636231780052, 0.03334734961390495, 0.03215138986706734, 0.008610911667346954, -0.025314485654234886, 0.012597445398569107, 0.012986131943762302, 0.01018559280782938, 0.038749102503061295, -0.024377651512622833, -0.0004079967620782554, -0.020869500935077667, -0.033546678721904755, -0.02180633693933487, -0.0018375427462160587, -0.009871653281152248, -0.017590578645467758, -0.0011093774810433388, -0.028802702203392982, 0.03591866418719292, -0.02489590086042881, 0.007594346068799496, 0.01918519102036953, 0.04532688483595848, 0.004400135949254036, -0.0012993606505915523, 0.005795422941446304, 0.015537513419985771, 0.020929299294948578, 0.011770240031182766, 0.0055063990876078606, -0.04895462840795517, -3.4882166801253334e-05, 0.04010452330112457, -0.0467221699655056, -0.009582629427313805, 0.03079596906900406, -0.013653876259922981, -0.025473948568105698, -0.03850991278886795, -0.027586810290813446, -0.03316795825958252, 0.026809437200427055, -0.013394751586019993, -0.030736172571778297, 0.04381199926137924, -0.021367818117141724, 0.0034035027492791414, 0.026191523298621178, -0.004988149739801884, -0.021527279168367386, -0.0572466179728508, 0.021507347002625465, 0.024576976895332336, 0.010564313270151615, -0.0053519210778176785, -0.013384785503149033, 0.03563960641622543, -0.017819803208112717, -0.06171153485774994, 0.050947897136211395, 0.00888498593121767, -0.02417832426726818, 0.025434082373976707, 0.027626676484942436, 0.03221118822693825, -0.016843102872371674, -0.0019372060196474195, 0.008501281961798668, -0.01840781792998314, 0.051705338060855865, -0.012986131943762302, 0.01965360902249813, -0.0393470823764801, -0.037413615733385086, 0.018377918750047684, -0.0015933675458654761, -0.01356417965143919, -0.006363503634929657, 0.03454330936074257, -0.015188692137598991, 0.006488082930445671, -0.008969699963927269, -0.0060744802467525005, 0.02186613529920578, -0.01613549329340458, 0.0038470046129077673, 0.06338588148355484, 0.003196701407432556, 0.049353282898664474, 0.019394485279917717, 0.032729439437389374, 0.04201805964112282, -0.017171991989016533, 0.004160943906754255, -0.012956233695149422, 0.014082428999245167, -0.028025329113006592, 0.039666008204221725, -0.031932130455970764, 0.010075963102281094, -0.00864081084728241, 0.051665470004081726, -0.01241805125027895, -0.002621145686134696, -0.004148486070334911, -0.04305455833673477, 0.026849301531910896, 0.01094303373247385, 0.00021925933833699673, -0.019025729969143867, -0.012138993479311466, -0.02029145509004593, 0.0008272056584246457, -0.011122427880764008, -0.009687275625765324, -0.03482236713171005, -0.01281670480966568, -0.021547213196754456, 0.012358252890408039, 0.04012445732951164, -0.028164857998490334, -0.007071113679558039, -0.0029550178442150354, 0.022723238915205002, -0.03591866418719292, 0.06661497056484222, 0.013285121880471706, 0.004948284476995468, 0.006702359300106764, -0.05433644726872444, 0.009936434216797352, 0.022264787927269936, -0.0011828792048618197, 0.007469766773283482, -0.034961897879838943, -0.009313538670539856, -0.0011915997602045536, 0.054695237427949905, -0.02940068393945694, -0.007479733321815729, 0.027407417073845863, 0.021228289231657982, 0.04891476407647133, -0.06852851063013077, 0.0006172897410579026, -0.030556777492165565, -0.013773472979664803, -0.007753807120025158, -0.0064482176676392555, -0.00732525484636426, 0.03410479426383972, -0.045645806938409805, -0.02936081774532795, 0.038928497582674026, 0.017520813271403313, -0.001831313711591065, 0.025852669030427933, -0.0050828298553824425, 0.04588499665260315, 0.013494415208697319, -0.029121626168489456, 0.008760406635701656, 0.011770240031182766, -0.044928230345249176, -0.0025052870623767376, 0.014152193441987038, -0.023699941113591194, -0.022783037275075912, -0.04157954081892967, -0.028982097283005714, -0.01505912933498621, 0.007205659057945013, 0.018457649275660515, 0.03872917219996452, 0.03438384830951691, 0.040423449128866196, 0.02334115281701088, -0.004150977823883295, 0.0037398666609078646, -0.01054438017308712, -0.006308688782155514, 0.05218372121453285, 0.041101157665252686, 0.008247140794992447, 0.009906535036861897, 0.04381199926137924, -0.015976032242178917, 0.0056509110145270824, 0.004145994782447815, -0.0004213890351820737, -0.013942900113761425, 0.0016656233929097652, 0.01397279929369688, 0.0015684516401961446, -0.01805899664759636, -0.0037398666609078646, 0.016783304512500763, 0.017919467762112617, 0.034284185618162155, -0.005391786340624094, -0.0018599668983370066, 0.02557361125946045, 0.003590371459722519, -0.005596096161752939, 0.01503919716924429, 0.018238389864563942, 0.0031020212918519974, 0.004567072261124849, -0.04437011480331421, 0.05054924264550209, 0.006787072867155075, -0.0043228971771895885, 0.007350170984864235, 0.025374284014105797, 0.020032329484820366, -0.0014525930164381862, -0.058442577719688416, 0.00042574931285344064, -0.017550712451338768, -0.02487596869468689, -0.01592620089650154, -0.0037423581816256046, -0.010444717481732368, 0.005411718972027302, -0.059997327625751495, -0.012378185987472534, -0.031094959005713463, -0.003288890002295375, 0.01998249813914299, -0.004474883433431387, -0.04285523295402527, 0.028782770037651062, -0.04887489974498749, 0.027367550879716873, 0.032729439437389374, 0.01776997186243534, -0.013135626912117004, 0.04385186731815338, 0.005371853709220886, -0.018049029633402824, -0.02786586806178093, -0.017600543797016144, -0.008994615636765957, -0.00045004222192801535, -0.06286762654781342, -0.010105862282216549, 0.045566074550151825, -0.03474263846874237, -0.023161757737398148, -0.037333883345127106, -0.04468903690576553, 0.006876769941300154, -0.045526210218667984, -0.004021415486931801, 0.018945999443531036, -0.047041092067956924, 0.007305322214961052, -0.019274888560175896, 0.006044581066817045, 0.08515235036611557, -0.023759737610816956, 0.018985865637660027, -0.04066263884305954, 0.0023707414511591196, 0.008177376352250576, 0.028224656358361244, 0.0540972575545311, 0.004601954482495785, 0.025374284014105797, 0.004676701966673136, -0.002641078317537904, 0.0014139735139906406, 0.0011554717784747481, 0.05058910697698593, 0.0007705221651121974, 0.008257106877863407, -0.006876769941300154, 0.010384919121861458, 0.012298455461859703, -0.03171287104487419, 0.036596376448869705, 0.03021792322397232, 0.0011374077294021845, -0.05218372121453285, -0.008551114238798618, 0.016404584050178528, -0.004312930628657341, 0.008919868618249893, -0.009313538670539856, 0.0690467581152916, 0.006787072867155075, -0.019444316625595093, 0.03448351472616196, -0.006542897783219814, 0.022424248978495598, 0.00927367340773344, -0.005182493478059769, 0.05676823481917381, 0.016593944281339645, -0.04157954081892967, -0.028124991804361343, 0.044051192700862885, -0.024576976895332336, 0.0014264314668253064, -0.026171591132879257, 0.0049956245347857475, 0.030536845326423645, -0.022204991430044174, -0.09575653076171875, 0.031254421919584274, 0.025314485654234886, 0.02489590086042881, 0.0007456063176505268, -0.03643691539764404, 0.0009997477754950523, 0.012109095230698586, -0.020630309358239174, 0.02098909765481949, 0.014082428999245167, -0.02413845993578434, 0.033506810665130615, 0.008217241615056992, -0.0064482176676392555, -0.026789503172039986, 0.0014239398296922445, -0.0006820709095336497, -0.0007231820491142571, -0.02043098397552967, -0.013464516028761864, 0.030337518081068993, -0.02565334178507328, 0.054695237427949905, -0.041898466646671295, 0.01769024133682251, -0.0032564993016421795, -0.025015495717525482, 0.039586275815963745, -0.0422971174120903, 0.0015933675458654761, 0.014899668283760548, -0.006712325382977724, -0.029759470373392105, 0.018497513607144356, -0.01503919716924429, 0.00886505376547575, -0.018656976521015167, -0.012268556281924248, -0.018437717109918594, -0.016783304512500763, 0.04421065375208855, -0.0257729385048151, 0.0013691249769181013, 0.010384919121861458, -0.019025729969143867, -0.0034757587127387524, 0.00087392283603549, -0.05146614462137222, 0.05050937831401825, 0.016902901232242584, -0.02563340961933136, 0.003361145965754986, -0.019773205742239952, 0.027646608650684357, -0.012188825756311417, -0.0016232664929702878, 0.02172660641372204, 0.01504916325211525, 0.01538801845163107, 0.057645272463560104, 0.020969165489077568, 0.012248623184859753, 0.0004285523318685591, 0.028782770037651062, -0.010723774321377277, 0.0027307753916829824, 0.01838788576424122, -0.03478250280022621, -0.0025339401327073574, 0.0015011789510026574, -0.020570510998368263, -0.008600945584475994, -0.030596643686294556, -0.007454817183315754, 0.0003715573693625629, -0.04612419009208679, 0.006463167257606983, 0.030018595978617668, -0.016803238540887833, 0.04835664853453636, -0.01538801845163107, 0.033506810665130615, 0.017391251400113106, -0.013723640702664852, -0.007589362561702728, -0.007898319512605667, 0.009183975867927074, 0.00020181824220344424, 0.045645806938409805, -0.0010059768101200461, -0.01881643757224083, 0.01650424860417843, -0.07207652181386948, 0.002185118617489934, 0.01769024133682251, 0.02786586806178093, -0.022165125235915184, -0.007340204436331987, 0.002282290253788233, -0.02487596869468689, 0.01689293421804905, -0.0007549497531726956, -0.05070870369672775, 0.020171858370304108, 0.004283031914383173, 0.018597178161144257, -0.0154677489772439, -0.011730373837053776, -0.004327880218625069, 0.012597445398569107, -0.028423981741070747, 0.03480243682861328, 0.06868796795606613, -0.04767893999814987, 0.02334115281701088, 0.019434349611401558, 0.0025177448987960815, -0.007081079762428999, 0.0012171384878456593, -0.004412594251334667, -0.031114893034100533, 0.014261823147535324, -0.029819268733263016, -0.0018475090619176626, 0.0056808097288012505, -0.007594346068799496, 0.011391518637537956, 0.020181825384497643, -0.03101522848010063, 0.01282667089253664, 0.012667209841310978, -0.016185324639081955, 0.012687142007052898, 0.0033387215808033943, 0.005820338614284992, 0.0376727394759655, -0.03711462393403053, -0.028842568397521973, 0.029161490499973297, -0.0020530647598206997, -0.014112328179180622, 0.06653524190187454, 0.004078722093254328, -0.04456944391131401, -0.04373227059841156, 0.025473948568105698, 0.0210488960146904, 0.003525590291246772, 0.004223233554512262, -0.02790573239326477, 0.0031568361446261406, -0.050828300416469574, -0.021467482671141624, -8.37016268633306e-05, -0.041101157665252686, 0.008306939154863358, -0.003226600354537368, 0.006398385856300592, 0.009463033638894558, -0.009791922755539417, -0.008685659617185593, -0.018557311967015266, 0.004616904072463512, 0.004148486070334911, -0.007140877656638622, 0.0077189248986542225, 0.059957459568977356, -0.009463033638894558, -0.0090494304895401, 0.025035429745912552, 0.012288488447666168, -0.020321354269981384, 0.006308688782155514, 0.020869500935077667, -0.030536845326423645, 0.0049208770506083965, -0.025414150208234787, 0.03400512784719467, -0.00231841835193336, -0.045605942606925964, -0.040483247488737106, 0.01984296925365925, -0.010110844857990742, -0.0023856910411268473, -0.008222225122153759, 0.019235022366046906, -0.020949233323335648, 0.00042637219303287566, -0.012308421544730663, 0.046283651143312454, -0.004312930628657341, 0.026968898251652718, 0.03344701603055, -0.0177301075309515, -0.01247784961014986, -0.037254154682159424, -0.0530208945274353, 0.02174653857946396, -0.004953267518430948, -0.03996499627828598, -0.008042830973863602, 0.011311788111925125, 0.028962165117263794, -0.06498049199581146, -0.0019583844114094973, 0.013275155797600746, -0.02116849273443222, 0.015796639025211334, -0.021268155425786972, -0.03797173127532005, 0.020161891356110573, 0.024258054792881012, -0.003587879939004779, -0.001992020756006241, -0.003408486023545265, 0.028124991804361343, 0.0003198570047970861, -0.016863035038113594, -0.02559354342520237, -0.0061791264452040195, -0.008680676110088825, 0.014431250281631947, -0.027028696611523628, 0.004437509924173355, -0.013135626912117004, -0.008087679743766785, -0.032729439437389374, 0.01472027413547039, -0.010504514910280704, 0.011610778048634529, -0.0542965829372406, 0.012946266680955887, -0.017112193629145622, 0.026071928441524506, -0.014630577526986599, 0.0032490247394889593, -0.013763505965471268, -0.005042964592576027, -0.012288488447666168, -0.015756772831082344, -0.018288221210241318, 0.05286142975091934, 0.002536431886255741, 0.006637577898800373, -7.669405022170395e-05, 0.00189111172221601, -0.011979532428085804, -0.04064270853996277, 0.050150588154792786, 0.021587077528238297, 0.005252257455140352, 0.015318254008889198, -0.016424518078565598, 0.0644223764538765, -0.0345233790576458, -0.02499556355178356, -0.03225105628371239, 0.009816838428378105, -0.05146614462137222, -0.044170789420604706, -0.013354886323213577, -0.0055512478575110435, 0.009597579017281532, 0.01060417853295803, -0.0420977920293808, 0.011790172196924686, -0.013863169588148594, 0.07379072904586792, 0.0587216354906559, 0.026570243760943413, 0.04018425568938255, -0.053180355578660965, 0.007026264909654856, -0.006836904678493738, 0.006772123277187347, 0.021228289231657982, 0.03454330936074257, 0.024616843089461327, 0.03392539918422699, -0.00543663464486599, 0.0023134350776672363, -0.009358386509120464, -0.0345233790576458, 0.028244588524103165, -0.032789237797260284, -0.03310815989971161, 0.012786805629730225, 0.005591113120317459, 0.02106882818043232, -0.014680408872663975, -0.0037448497023433447, -0.07076096534729004, 0.027307752519845963, 0.00984673760831356, -0.024676641449332237, 0.03229092061519623, -0.005287139676511288, 0.0025962297804653645, -0.04720055311918259, 0.023022230714559555, -0.03290883079171181, -0.020341286435723305, -0.015238523483276367, -0.02415839210152626, -0.006866803392767906, 0.04688163101673126, -0.026769571006298065, 0.0021577111911028624, 0.012697109021246433, -0.006617645267397165, -0.0310351625084877, -0.01844768226146698, 0.0015597312012687325, -0.057725001126527786, -0.013474482111632824, 0.00583528820425272, 0.017640409991145134, -0.0018736706115305424, -0.03249024599790573, -0.01953401230275631, -0.012717041186988354, -0.0008278285386040807, -0.020650243386626244, -0.014570779167115688, 0.028443915769457817, -0.011421417817473412, 0.03555987775325775, 0.029839200899004936, 0.0386095754802227, 0.024337785318493843, 0.018557311967015266, 0.00292262714356184, -0.03484230116009712, -0.006926601752638817, -0.022065462544560432, 0.04217752069234848, 0.01728162169456482, 0.0022287212777882814, 0.00623892480507493, -0.05377833545207977, -0.0022959939669817686, 0.009373336099088192, -0.026151658967137337, 0.02045091614127159, -0.019444316625595093, 0.06801025569438934, 0.007115961983799934, -0.02720808982849121, -0.035838935524225235, -0.013833270408213139, 0.03344701603055, -0.03326762095093727, 0.04345321282744408, 0.005890103057026863, 0.0038171056658029556, 0.013374819420278072, -0.03372607007622719, 0.03221118822693825, -0.021507347002625465, 0.03017805702984333, -0.012717041186988354, -0.019444316625595093, -0.002056801924481988, -0.011531047523021698, -0.011451316997408867, 0.0369352325797081, 0.04437011480331421, 0.006866803392767906, -0.03597846254706383, 0.0033835701178759336, -0.043333616107702255, 0.013285121880471706, 0.024357719346880913, 0.05138641595840454, -0.0105244480073452, -0.01795933209359646, -0.013404718600213528, -0.0014476098585873842, 0.009931450709700584, -0.0034657923970371485, -0.0022262297570705414, 0.005715691950172186, 0.015776704996824265, 0.013205391354858875, -0.034164588898420334, -0.06458184123039246, -0.026171591132879257, 0.03448351472616196, -0.037991661578416824, -0.0045022908598184586, 0.003333738539367914, 0.004205792676657438, 0.003351179650053382, 0.0022025597281754017, 0.004871045239269733, -0.03603826090693474, -0.005526331719011068, 0.018965931609272957, -0.002842896617949009, -0.03368620574474335, 0.04325388744473457, 0.009183975867927074, -0.020361218601465225, 0.007873402908444405, -0.003361145965754986, -0.0020331318955868483, -0.00972714088857174, 0.01926492154598236, 0.0006194699089974165, 0.009233808144927025, -0.02035125158727169, -0.018926067277789116, 0.020690107718110085, -0.0022287212777882814, 0.011491182260215282, -0.009278655983507633, -0.010295222513377666, 0.0022424249909818172, -0.05046951025724411, -0.03823085501790047, 0.001233956660144031, 0.02330128662288189, 0.0439714640378952, -0.05110735818743706, 0.04237684980034828, -0.002540169283747673, -0.00498067494481802, 0.022324586287140846, -0.038888633251190186, 0.0012968691298738122, -0.024596910923719406, -0.014839869923889637, -0.04165927320718765, 0.004594479687511921, -0.012717041186988354, -0.05549254268407822, 0.01471030805259943, 0.012707075104117393, -0.03376593813300133, 0.006782089825719595, 0.01811879314482212, -0.031234487891197205, 0.032071661204099655, 0.01693280041217804, 0.030457114800810814, -0.030656440183520317, 0.0629473626613617, -0.002398148877546191, 0.027447281405329704, -0.025753004476428032, 0.01314559392631054, -0.004320405423641205, 0.017929432913661003, -0.0059499009512364864, 0.020929299294948578, 0.004504782613366842, 0.004223233554512262, 0.01503919716924429, 0.013285121880471706, -0.015976032242178917, -0.015338187105953693, -0.00902949832379818, 0.0028254555072635412, 0.03709469363093376, 0.048715438693761826, 0.023062095046043396, 0.046323515474796295, 0.04090183228254318, 0.007305322214961052, -0.009896568953990936, -0.016095628961920738, -0.0014314146246761084, 0.015567412599921227, 0.01619529165327549, 0.004838654771447182, 0.06306695938110352, -0.031055094674229622, -0.021467482671141624, 0.04044337943196297, 0.024576976895332336, 0.02860337682068348, 0.03856971114873886, 0.005710708908736706, -0.009567679837346077, 0.048555973917245865, -0.0128366369754076, 0.012607411481440067, 0.021607009693980217, -0.019414417445659637, 0.009368353523314, -0.0035529977176338434, 0.024258054792881012, 0.005446601193398237, -0.03155340999364853, -0.03978560119867325, 0.021387750282883644, 0.023779671639204025, -0.02172660641372204, 0.003341213334351778, -0.023620210587978363, -0.0032614825759083033, 0.0013442091876640916, -0.060196653008461, 0.010504514910280704, -0.022404316812753677, -0.05668850243091583, -0.006159193813800812, -0.0030870717018842697, -0.010464649647474289, 0.009004581719636917, -0.013065862469375134, -0.00058614497538656, -0.013075829483568668, -0.0033187889494001865, 0.020092127844691277, -0.03996499627828598, 0.013833270408213139, -0.017600543797016144, 0.04767893999814987, 0.011760273016989231, -0.01390303485095501, -0.024357719346880913, 0.032011862844228745, -0.0300983265042305, 0.001826330553740263, 0.009916502051055431, 0.009323504753410816, 0.016673674806952477, 0.0007568184519186616, 0.005297106225043535, 0.029560144990682602, 0.012547613121569157, -0.006094412878155708, -0.048635706305503845, -0.020829636603593826, 0.029600009322166443, -0.005611045751720667, 0.010624111630022526, 0.03534061834216118, 0.0339851975440979, 0.03797173127532005, 0.02002236433327198, -0.00880525540560484, 0.014361485838890076, -0.0332476869225502, -0.004043839871883392, -0.004945792723447084, -0.028822636231780052, -0.011700475588440895, 0.006398385856300592, 0.00830195564776659, -0.014132260344922543, 0.026789503172039986, -0.023082027211785316, 0.0006914143450558186, -0.01135165337473154, -7.895204907981679e-05, -0.0035081494133919477, 0.022065462544560432, 0.0031892266124486923, 0.02172660641372204, -0.007584379520267248, 0.018866268917918205, -0.001688047661446035, 0.021387750282883644, -0.002102896338328719, -0.010893202386796474, -0.027566878125071526, 8.268942474387586e-05, -0.013464516028761864, 0.001599596464075148, -0.017201891168951988, 0.012946266680955887, 0.019015762954950333, -0.022902633994817734, -0.006687409710139036, -0.010614144615828991, -0.01092310156673193, -0.007938184775412083, -0.016065729781985283, 0.01924498938024044, 0.008022897876799107, 0.0037398666609078646, 0.014361485838890076, -0.03781227022409439, 0.020889434963464737, 0.03759301081299782, 0.005939934402704239, 0.028962165117263794, 0.0006281904643401504, -0.048755303025245667, -0.02936081774532795, -0.014182092621922493, -0.016324853524565697, 0.02559354342520237, 0.005755557678639889, -0.0008371719741262496, -0.01396283321082592, -0.029779404401779175, -0.018995830789208412, -0.0030297653283923864, -0.014580745249986649, -0.006542897783219814, -0.0248361025005579, 0.012537647038698196, 0.013713674619793892, 0.06661497056484222, 0.01053441409021616, -0.017162024974822998, -0.04433025047183037, 0.02274317294359207, -0.00919394288212061, 0.019912734627723694, -0.006134278140962124, 0.044768769294023514, -0.022444183006882668, 0.00263609504327178, -0.005466533824801445, -0.009174009785056114, 0.008909901604056358, -0.019344652071595192, -0.025792870670557022, 0.03322775661945343, -0.028483780100941658, 0.04963234066963196, 0.026231389492750168, 0.03015812486410141, 0.008919868618249893, -0.020570510998368263, 0.009258723817765713, -0.007639194373041391, -0.02625132165849209, -0.009662359952926636, -0.037353817373514175, 0.004086196422576904, 0.01650424860417843, -9.33565097511746e-05, -0.03316795825958252, 0.007983032613992691, -0.011481216177344322, 0.010474616661667824, 0.054057393223047256, 0.02178640477359295, -0.009637444280087948, -0.0017341419588774443, -0.02114855870604515, -0.02035125158727169, 0.028483780100941658, 0.011142360977828503, 0.019823037087917328, -0.034284185618162155, -0.018945999443531036, 0.03420445695519447, -0.010853337123990059, 0.003655152628198266, -0.02176647260785103, -0.008381686173379421, 0.020211724564433098, -0.0007026264793239534, -0.00411609560251236, -0.002561347559094429, 0.0467221699655056, 0.03667610511183739, -0.009094279259443283, -0.007041214499622583, 0.008600945584475994, -0.003704984439536929, -0.0035505061969161034, 0.015417917631566525, 0.03781227022409439, -0.008152460679411888, -0.0011087545426562428, -0.03328755125403404, -0.005770506802946329, 8.510314364684746e-05, -0.0300983265042305, 0.03388553485274315, -0.004988149739801884, -0.031991928815841675, -0.00831192173063755, 0.03266964107751846, 0.03021792322397232, 0.026530379429459572, -0.009268689900636673, -0.004188351333141327, 0.00946801621466875, -1.3752372069575358e-05, -0.0012981148902326822, 0.02559354342520237, 0.023779671639204025, 0.036636240780353546, 0.002314680954441428, 0.007185726426541805, 0.026829369366168976, -0.011919734999537468, -0.004245657939463854, -0.018417783081531525, -0.002930101938545704, 0.047041092067956924, 0.015338187105953693, 0.014122294262051582, -0.02796553075313568, -0.0139927314594388, 0.013484449125826359, -0.006293739657849073, -0.004885994829237461, 0.00036034523509442806, 0.00657778000459075, -0.028184790164232254, 0.00407373858615756, 0.040483247488737106, -0.021646875888109207, 0.015687009319663048, -0.014670442789793015, -0.029141558334231377, -0.01466047577559948, -0.002506532706320286, -0.025115160271525383, 0.005406735930591822, 0.020530646666884422, 0.031274352222681046, 0.025135092437267303, 0.008461416698992252, -0.05708715692162514, 0.04767893999814987, -0.03386560082435608, -0.016554079949855804, 0.048516109585762024, 0.009174009785056114, -0.021228289231657982, 0.004601954482495785, 0.016534147784113884, 0.01594613306224346, -0.002114108530804515, 0.008506265468895435, 0.02000243030488491, 0.031055094674229622, 0.017470981925725937, -0.04138021543622017, -0.035061560571193695, -0.0036078125704079866, 0.016165392473340034, 0.02043098397552967, -0.020261555910110474, 0.017331453040242195, 0.027666540816426277, 0.01425185613334179, 0.01167057640850544, 0.010883236303925514, -0.006488082930445671, 0.0032564993016421795, -0.03310815989971161, 0.023819535970687866, -0.014790038578212261, -0.008351786993443966, 0.024676641449332237, -0.008825188502669334, 0.014152193441987038, -0.012507747858762741, -0.025035429745912552, 0.00886505376547575, 0.024537112563848495, 0.013016031123697758, 0.023082027211785316, -0.023859402164816856, 0.0008184851030819118, -0.024656709283590317, 0.01396283321082592, -0.042695771902799606, -0.003079596906900406, -0.01961374469101429, -0.020729973912239075, 0.013195425271987915, -0.0034633008763194084, -0.008850104175508022, 0.015358119271695614, 0.014690374955534935, 0.0014800004428252578, 0.0051276786252856255, -0.037393681704998016, -0.003729900112375617, -0.026610109955072403, 0.007056164089590311, 0.015228557400405407, -0.0019147817511111498, -0.0033212804701179266, -0.0038594624493271112, 0.024417515844106674, 0.005356904119253159, 0.029261155053973198, 0.05194452777504921, 0.0002829504373949021, -0.02499556355178356, 0.00395663408562541, 0.016055762767791748, 0.011730373837053776, -0.09129161387681961, 0.02934088557958603, 0.024596910923719406, -0.01707232929766178, -0.019813070073723793, 0.016344785690307617, 0.03099529631435871, 0.0043228971771895885, -0.03982546925544739, -0.030616575852036476, 0.05501415953040123, -0.02930101938545704, -0.03017805702984333, 0.011122427880764008, -0.0210488960146904, 0.02876283787190914, -0.019743306562304497, 0.03992513194680214, 0.022125259041786194, 0.019195158034563065, -0.003637711750343442, 0.008939800783991814, -0.03978560119867325, -0.017580611631274223, -0.005586129613220692, -0.023799603804945946, -0.01473024021834135, 0.0052771735936403275, 0.011002832092344761, -0.011122427880764008, 0.011989498510956764, 0.006976433098316193, -0.02649051323533058, -0.0064183184877038, -0.03013819269835949, -0.003214142518118024, -0.0019085528329014778, -0.01660391129553318, -0.012228691019117832, -0.009094279259443283, 0.02940068393945694, 0.04512755572795868, 0.0001605513971298933, 0.01058424636721611, -0.004751449450850487, 0.01249778177589178, -0.045685671269893646, -0.005695759318768978, 0.04365253821015358, 0.03858964145183563, 0.03448351472616196, -4.6911842218833044e-05, 0.011989498510956764, -0.01094303373247385, -0.019583845511078835, -0.00337609532289207, 0.03167300671339035, -0.00584525428712368, -0.043214019387960434, 0.021706674247980118, -0.019334686920046806, 3.496489398457925e-06, -0.017839737236499786, 0.03677577152848244, 0.02186613529920578, 0.0065229651518166065, -0.0030521894805133343, 0.021427616477012634, 0.00888498593121767, 0.0030073411762714386, -0.024477314203977585, 0.04516742378473282, -0.005825321655720472, -0.026530379429459572, 0.004131045192480087, -0.008112595416605473, -0.023520546033978462, 0.0025887549854815006, -0.023998931050300598, 0.0026784520596265793, -0.03005846031010151, 0.007713941857218742, -0.05230331793427467, 0.027686472982168198, -0.01838788576424122, -0.0053818197920918465, 0.02262357622385025, 0.02651044726371765, 0.005057914182543755, -0.008954750373959541, -0.000801044050604105, 0.025972263887524605, 0.005371853709220886, -0.028105059638619423, 0.03183246776461601, -0.007624244783073664, 0.040423449128866196, -0.005760540720075369, -0.004993132781237364, -0.002188856014981866, 0.011451316997408867, 0.027706407010555267, -0.03217132389545441, -0.011212124489247799, 0.017859669402241707, 0.007260473910719156, 0.02405872941017151, 0.0022997313644737005, 0.0033785870764404535, 0.03171287104487419, -0.014192058704793453, -0.002989900065585971, 0.02035125158727169, -0.015687009319663048, -0.01817859150469303, 0.01838788576424122, -0.005182493478059769, 0.0030098326969891787, 0.011092528700828552, 0.012288488447666168, 0.030616575852036476, -0.026071928441524506, -0.007534548174589872, 0.017391251400113106, -0.015268422663211823, 0.011242023669183254, -0.030696306377649307, -0.01834801957011223, -0.0017964316066354513, -8.673824777361006e-05, 0.014002698473632336, -0.009841754101216793, 0.035878799855709076, -0.00927367340773344, -0.003124445443972945, 0.014590712264180183, -0.0277861375361681, 0.006059530656784773, -0.037174422293901443, 0.020809704437851906, -0.033526744693517685, -4.0994331357069314e-05, -0.01660391129553318, -0.0279854629188776, 0.005685793235898018, -0.025394218042492867, 0.0008845120901241899, -0.011192192323505878, -0.008032864890992641, -0.012348286807537079, 0.006876769941300154, 0.02936081774532795, 0.00889495201408863, -0.026550311595201492, -0.009717174805700779, 0.007813605479896069, 0.008541147224605083, -0.015248489566147327, -0.017201891168951988, 0.017411183565855026, 0.004494816530495882, -0.03476256877183914, -0.003343704855069518, -0.009298589080572128, 0.02786586806178093, 0.04126061871647835, -0.0028703040443360806, 0.0191054604947567, 0.04014439135789871, -0.00019932666327804327, 0.013753539882600307, -0.02557361125946045, 0.01357414573431015, 0.03922748938202858, 0.00756444688886404, -0.00349070830270648, 0.014750173315405846, 0.05569187179207802, 0.013075829483568668, 0.004078722093254328, -0.0035081494133919477, 0.011072596535086632, -0.007574413437396288, 0.016823170706629753, 0.004033873323351145, -0.0037473412230610847, -0.005217375233769417, 0.037393681704998016, -0.015318254008889198, 0.0010340070584788918, -0.0083617540076375, -0.017002563923597336, 0.013035964220762253, 0.002793064806610346, 0.020690107718110085, -0.0030845801811665297, -0.0037000011652708054, -0.0006988891400396824, -0.011879868805408478, 0.01060417853295803, 0.009811854921281338, -0.005795422941446304, 0.005177509970963001, -0.004295489750802517, 0.03597846254706383, -0.0021602027118206024, 0.004898452665656805, -0.006054547615349293, -0.027566878125071526, -0.03831058368086815, 0.01734142005443573, 0.025055361911654472, 0.014421284198760986, -0.017580611631274223, -0.025852669030427933, 0.00291764410212636, -0.02043098397552967, -0.012049296870827675, 0.007220608647912741, 0.011560946702957153, -0.05413712188601494, 0.0029002029914408922, -0.0007175760110840201, -0.016015898436307907, -0.00681697204709053, 0.025254689157009125, -0.012996098957955837, -0.004148486070334911, 0.017331453040242195, -0.035021696239709854, -0.023540480062365532, 0.012786805629730225, -0.005237308330833912, -0.031134825199842453]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:59.745280", "url_path": "/api/pydantic_graph/persistence/", "chunk_size": 4867}
updated_dt: 2025-03-15T11:17:59.745280
---
```
classBaseStatePersistence(ABC, Generic[StateT, RunEndT]):
"""Abstract base class for storing the state of a graph run.
  Each instance of a `BaseStatePersistence` subclass should be used for a single graph run.
  """
  @abstractmethod
  async defsnapshot_node(self, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]) -> None:
"""Snapshot the state of a graph, when the next step is to run a node.
    This method should add a [`NodeSnapshot`][pydantic_graph.persistence.NodeSnapshot] to persistence.
    Args:
      state: The state of the graph.
      next_node: The next node to run.
    """
    raise NotImplementedError
  @abstractmethod
  async defsnapshot_node_if_new(
    self, snapshot_id: str, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]
  ) -> None:
"""Snapshot the state of a graph if the snapshot ID doesn't already exist in persistence.
    This method will generally call [`snapshot_node`][pydantic_graph.persistence.BaseStatePersistence.snapshot_node]
    but should do so in an atomic way.
    Args:
      snapshot_id: The ID of the snapshot to check.
      state: The state of the graph.
      next_node: The next node to run.
    """
    raise NotImplementedError
  @abstractmethod
  async defsnapshot_end(self, state: StateT, end: End[RunEndT]) -> None:
"""Snapshot the state of a graph when the graph has ended.
    This method should add an [`EndSnapshot`][pydantic_graph.persistence.EndSnapshot] to persistence.
    Args:
      state: The state of the graph.
      end: data from the end of the run.
    """
    raise NotImplementedError
  @abstractmethod
  defrecord_run(self, snapshot_id: str) -> AbstractAsyncContextManager[None]:
"""Record the run of the node, or error if the node is already running.
    Args:
      snapshot_id: The ID of the snapshot to record.
    Raises:
      GraphNodeRunningError: if the node status it not `'created'` or `'pending'`.
      LookupError: if the snapshot ID is not found in persistence.
    Returns:
      An async context manager that records the run of the node.
    In particular this should set:
    - [`NodeSnapshot.status`][pydantic_graph.persistence.NodeSnapshot.status] to `'running'` and
     [`NodeSnapshot.start_ts`][pydantic_graph.persistence.NodeSnapshot.start_ts] when the run starts.
    - [`NodeSnapshot.status`][pydantic_graph.persistence.NodeSnapshot.status] to `'success'` or `'error'` and
     [`NodeSnapshot.duration`][pydantic_graph.persistence.NodeSnapshot.duration] when the run finishes.
    """
    raise NotImplementedError
  @abstractmethod
  async defload_next(self) -> NodeSnapshot[StateT, RunEndT] | None:
"""Retrieve a node snapshot with status `'created`' and set its status to `'pending'`.
    This is used by [`Graph.iter_from_persistence`][pydantic_graph.graph.Graph.iter_from_persistence]
    to get the next node to run.
    Returns: The snapshot, or `None` if no snapshot with status `'created`' exists.
    """
    raise NotImplementedError
  @abstractmethod
  async defload_all(self) -> list[Snapshot[StateT, RunEndT]]:
"""Load the entire history of snapshots.
    `load_all` is not used by pydantic-graph itself, instead it's provided to make it convenient to
    get all [snapshots][pydantic_graph.persistence.Snapshot] from persistence.
    Returns: The list of snapshots.
    """
    raise NotImplementedError
  defset_graph_types(self, graph: Graph[StateT, Any, RunEndT]) -> None:
"""Set the types of the state and run end from a graph.
    You generally won't need to customise this method, instead implement
    [`set_types`][pydantic_graph.persistence.BaseStatePersistence.set_types] and
    [`should_set_types`][pydantic_graph.persistence.BaseStatePersistence.should_set_types].
    """
    if self.should_set_types():
      with _utils.set_nodes_type_context(graph.get_nodes()):
        self.set_types(*graph.inferred_types)
  defshould_set_types(self) -> bool:
"""Whether types need to be set.
    Implementations should override this method to return `True` when types have not been set if they are needed.
    """
    return False
  defset_types(self, state_type: type[StateT], run_end_type: type[RunEndT]) -> None:
"""Set the types of the state and run end.
    This can be used to create [type adapters][pydantic.TypeAdapter] for serializing and deserializing snapshots,
    e.g. with [`build_snapshot_list_type_adapter`][pydantic_graph.persistence.build_snapshot_list_type_adapter].
    Args:
      state_type: The state type.
      run_end_type: The run end type.
    """
    pass

```
  
---|---  
####  snapshot_node `abstractmethod` `async`
```
snapshot_node(
  state: StateT, next_node: BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.BaseNode "pydantic_graph.nodes.BaseNode")[StateT, Any[](https://docs.python.org/3/library/typing.html#typing.Any "typing.Any"), RunEndT]
) -> None