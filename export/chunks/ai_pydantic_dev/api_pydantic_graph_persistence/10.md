---
url: https://ai.pydantic.dev/api/pydantic_graph/persistence/
session_id: pydantic_ai_docs
chunk_number: 10
title: In Memory State Persistence
summary: This document introduces the FullStatePersistence class for in-memory state persistence, which holds a list of snapshots. It includes a deep_copy attribute to ensure that the state and nodes are preserved accurately when taking snapshots, along with methods to capture state snapshots during graph runs.
embedding: [0.029363015666604042, 0.025823116302490234, 0.002562740119174123, -0.01648549549281597, 0.01603166200220585, 0.039415422827005386, -0.023179536685347557, -0.03544438257813454, -0.009836836718022823, 0.002810930134728551, 0.050148580223321915, 0.00027460462297312915, 0.03274407237768173, -0.0471532829105854, -0.04075423255562782, 0.04229726642370224, 0.01427305769175291, 0.034809015691280365, 0.02852342464029789, 0.02353125810623169, 0.007947755977511406, -0.009927603416144848, 0.044407591223716736, -0.0317002572119236, 0.009252526797354221, -0.02176130749285221, 0.004217813257128, 0.01805122010409832, 0.0038207091856747866, -0.026844240725040436, 0.05986061319708824, -0.022793779149651527, 0.0027073994278907776, 0.02371279150247574, 0.007624399848282337, 0.028886491432785988, 0.0002223074116045609, 0.010256633162498474, -0.026004649698734283, 0.014182290993630886, -0.010926037095487118, -0.08595602959394455, -0.005732482299208641, 0.010041061788797379, -0.010914691723883152, 0.032244857400655746, -0.013739803805947304, 0.059134479612112045, 0.025641582906246185, 0.043409157544374466, -0.050375498831272125, 0.008435626514256, 0.0071592205204069614, 0.022703012451529503, -0.05223621428012848, -0.03194986656308174, -0.0033243291545659304, 0.025187749415636063, -0.016859907656908035, 0.0035455727484077215, 0.03610244020819664, 0.0011218192521482706, -0.008469664491713047, 0.07656168192625046, -0.010171539150178432, 0.029272248968482018, -0.005009185057133436, 0.04892323166131973, -0.04384030029177666, -0.021999569609761238, 0.02852342464029789, 0.017699498683214188, -0.04551948234438896, -0.07093414664268494, 0.007760549895465374, -0.017245665192604065, 0.034604791551828384, 0.07456481456756592, 0.008344859816133976, -0.00957588292658329, 0.010937383398413658, 0.05005781352519989, -0.00968934129923582, 0.015623211860656738, -0.010001352056860924, -0.04007348045706749, -0.04025501385331154, -0.03471824899315834, 0.00796477496623993, -0.025028906762599945, 0.019855206832289696, 0.008157653734087944, -0.01958290860056877, 0.0382581502199173, 0.05105624720454216, -0.024212008342146873, 0.04942244663834572, -0.03803123161196709, -0.06276515126228333, 0.014216328971087933, 0.03932465612888336, -0.016326652839779854, -0.061358265578746796, -0.007811605930328369, 0.03267600014805794, 0.011107570491731167, 0.004095845855772495, 0.013909990899264812, -0.019424065947532654, 0.02709384821355343, -0.09866335988044739, -0.05518613010644913, -0.007493922486901283, 0.018573127686977386, -0.018697932362556458, -0.03426441550254822, -0.03744124993681908, 0.026980390772223473, 0.01336539164185524, 0.03689664974808693, -0.045769091695547104, -0.012684641405940056, -0.04905937984585762, 0.0052077374421060085, 0.037168949842453, 0.009513480588793755, -0.014885732904076576, 0.0018153332639485598, -0.03415095806121826, 0.0013196622021496296, 0.05799989774823189, -0.023599332198500633, 0.015328220091760159, -0.060132913291454315, 0.016735102981328964, 0.005009185057133436, -0.0558214969933033, 0.013705765828490257, -0.03508131578564644, -0.02475660666823387, 0.006313955876976252, -0.044021833688020706, 0.0020479229278862476, 0.02793344110250473, 0.02452968992292881, 0.08513913303613663, -0.027661141008138657, 0.039415422827005386, 0.010489222593605518, 0.0014551030471920967, 0.046200230717659, 0.0454740971326828, -0.011981199495494366, -0.05700146406888962, 0.0099843330681324, -0.0008559012785553932, 0.03267600014805794, 0.0354897640645504, 0.009269545786082745, -0.03487709164619446, -0.009819818660616875, 0.03190448135137558, 0.020014049485325813, -0.02473391592502594, 0.02711654081940651, 0.005545275751501322, -0.05146469920873642, -0.043409157544374466, -0.04043654724955559, -0.05486844852566719, 0.01866389438509941, -0.022929929196834564, -0.016167812049388885, 0.01956021599471569, 0.01727970317006111, 0.01346750371158123, -0.029272248968482018, 0.024665839970111847, -0.043772224336862564, -0.03794046491384506, 0.010029716417193413, -0.04987628012895584, -0.07914853096008301, 0.0099105853587389, -0.06462586671113968, 0.006915285252034664, 0.017427198588848114, 0.052780814468860626, 0.0028634045738726854, 0.04924091324210167, 0.010852289386093616, 0.028387274593114853, -0.008010158315300941, -0.005740991327911615, -0.009314929135143757, -0.011215356178581715, 0.030588366091251373, 0.008702253922820091, -0.006189151667058468, 0.015861473977565765, -0.028251124545931816, 0.04983089864253998, 0.0016295452369377017, 0.009002918377518654, 0.050557032227516174, -0.029363015666604042, -0.014919769950211048, -0.012037929147481918, -0.047561731189489365, -0.02734345756471157, -0.005253120791167021, 0.008605814538896084, -0.0013224986614659429, -0.012310228310525417, -0.025868499651551247, 0.04125344753265381, -0.04987628012895584, 0.002725836355239153, 0.02251013182103634, 0.04313685745000839, -0.002352842129766941, 0.003256254130974412, 0.02053595706820488, -0.004203631076961756, 0.009865202009677887, 0.02145496942102909, 0.007318062242120504, -0.05486844852566719, -0.03190448135137558, 0.05151008069515228, -0.0026067050639539957, -0.02375817485153675, 0.016372036188840866, -0.003917148802429438, -0.04570101574063301, -0.0423426479101181, -0.018788699060678482, -0.015089957974851131, 0.044407591223716736, -0.006143768317997456, -0.014114215970039368, 0.04828786477446556, -0.012718678452074528, 0.021681886166334152, 0.019344644621014595, 0.0073123895563185215, -0.017018750309944153, -0.07256794720888138, 0.025777732953429222, 0.03185909986495972, 0.045360639691352844, -0.025777732953429222, -0.0073691182769834995, 0.007652764208614826, -0.016519533470273018, -0.039211198687553406, 0.024575073271989822, 0.01177697442471981, -0.017574695870280266, 0.03469555824995041, 0.009439732879400253, 0.026980390772223473, -0.008254093118011951, 0.012559836730360985, 0.019185803830623627, -0.022589553147554398, 0.0720687285065651, -0.019299261271953583, 0.01625857874751091, -0.019730404019355774, -0.017608731985092163, 0.011186990886926651, 0.028795724734663963, 0.017018750309944153, -0.011822357773780823, 0.019548870623111725, -0.02854611538350582, -0.001151602016761899, -0.02475660666823387, 0.023258958011865616, 0.02530120685696602, -0.01070479303598404, -0.008225728757679462, 0.039960023015737534, -0.012514453381299973, 0.03503593057394028, 0.005369415506720543, 0.032403700053691864, 0.0280922818928957, -0.021704578772187233, 0.0018323520198464394, -0.014987844973802567, 0.017427198588848114, 0.001740167150273919, 0.028251124545931816, -0.016519533470273018, -0.010052408091723919, 0.02595926634967327, 0.03812199831008911, -0.010080772452056408, 0.038394298404455185, -0.03265330567955971, -0.03712356463074684, 0.008832731284201145, 0.0016791833331808448, 0.04295532405376434, -0.019809823483228683, -0.05087471380829811, 0.03326598182320595, -0.010387110523879528, -0.0014976499369367957, 0.007981793023645878, -0.014772274531424046, -0.008776001632213593, -0.0357847586274147, 0.00858879555016756, 0.021579774096608162, -0.015384949743747711, -0.007919391617178917, -0.01976444013416767, 0.005624696612358093, -0.0475163497030735, 0.025028906762599945, -0.004266033414751291, -0.022827815264463425, 0.0008424281259067357, -0.03950618952512741, 0.01797179877758026, -0.0014933953061699867, 0.0004439057083800435, 0.004941110033541918, -0.01603166200220585, -0.013081745244562626, -0.014375170692801476, 0.05405154824256897, -0.043794915080070496, -0.006087039597332478, 0.008259766735136509, 0.0026733619160950184, 0.03111027367413044, -0.06766654551029205, 0.013546924106776714, -0.04842401668429375, 0.007108164485543966, -0.026254257187247276, 0.01415959931910038, 0.013558270409703255, 0.051328547298908234, -0.058362964540719986, -0.04964936524629593, 0.03174564242362976, 0.021852074190974236, 0.008481009863317013, 0.0239397082477808, -0.023179536685347557, -0.0011416744673624635, 0.027888057753443718, -0.030202606692910194, -0.005136826075613499, 0.03126911446452141, -0.05500459671020508, 0.021886112168431282, 0.030429523438215256, -0.014987844973802567, -0.02304338663816452, -0.010897672735154629, -0.025777732953429222, -0.02831919863820076, 0.001896172296255827, 0.013422120362520218, 0.04075423255562782, 0.02831919863820076, 0.06367281824350357, 0.023690098896622658, -0.015169378370046616, 0.004680156242102385, 0.013229241594672203, 0.014783619903028011, 0.012934249825775623, 0.03070182353258133, 0.023826248943805695, 0.014987844973802567, 0.026821549981832504, 0.01615646667778492, 0.02972608245909214, 0.01766546256840229, 0.01835755817592144, -0.018652549013495445, -0.027229998260736465, 0.007045762147754431, 0.012344266287982464, -0.02791074849665165, 0.004206467419862747, 0.026866933330893517, 0.04052731394767761, 0.032040633261203766, -0.015362258069217205, 6.26236796961166e-05, 0.04245610535144806, -0.012888866476714611, -0.009394349530339241, 0.03095143288373947, 0.004388000816106796, -0.0061040581203997135, -0.0008821384981274605, -0.011204009875655174, 0.03830353170633316, 0.010659409686923027, 0.02061537839472294, -0.01953752525150776, 0.03685126453638077, 0.019480794668197632, 0.0005573640228249133, -0.03705548867583275, 0.007125183008611202, -0.033402133733034134, -0.04093576595187187, 0.0070003787986934185, 0.0034009134396910667, 0.003298800904303789, -0.010585661977529526, -0.04565563052892685, -0.025686966255307198, -0.011022476479411125, -0.006058674771338701, 0.031813714653253555, 0.02224917896091938, -0.06625966727733612, 0.03966503217816353, -0.05559458211064339, -0.005516911391168833, 0.001578488969244063, 0.020751528441905975, 0.03217678144574165, 0.07107029855251312, -0.04089038074016571, -0.03430980071425438, -0.015487061813473701, -0.005295667331665754, -0.05073856562376022, 0.0011757119791582227, -0.05328003317117691, 0.006109731271862984, 0.05164623260498047, -0.04815171658992767, -0.06058674678206444, -0.012003891170024872, -0.051963914185762405, 0.033629048615694046, -0.032040633261203766, 0.0061324224807322025, 0.01684856228530407, -0.03846237435936928, -0.0019429739331826568, -0.0002815184707287699, 0.02573234960436821, 0.053189266473054886, -0.004197958391159773, 0.017756229266524315, -0.053370799869298935, -0.003931330982595682, -0.001972756814211607, 0.013342699967324734, 0.03787238895893097, 0.012276191264390945, -0.0012232225853949785, 0.049967046827077866, -0.011351506225764751, 0.0005431817262433469, 0.013773840852081776, 0.03848506510257721, 0.019480794668197632, -0.0006959959282539785, 0.01287752017378807, 0.022203795611858368, -0.007249987218528986, -0.050557032227516174, 0.03129180893301964, 0.032993681728839874, 0.012174079194664955, -0.033742506057024, -0.007057107985019684, -0.02161381207406521, -0.004538333043456078, 0.025028906762599945, 0.00679048104211688, 0.039960023015737534, 0.004529824014753103, -0.01866389438509941, 0.011487656272947788, -0.03315252438187599, 0.030974123626947403, 0.04431682452559471, -0.009621266275644302, 0.022181103006005287, 0.0222264863550663, -0.03508131578564644, -0.03950618952512741, 0.05641148239374161, -0.03653358295559883, 0.034990549087524414, -0.01579339988529682, 0.015827437862753868, 0.05287158116698265, -0.018788699060678482, -0.06281053274869919, 0.013807878829538822, 0.0009246853878721595, 0.020490573719143867, 0.012208116240799427, -0.020581340417265892, 0.030157223343849182, -0.009967314079403877, -0.010103464126586914, 0.02074018307030201, -0.019480794668197632, -0.0026180509012192488, 0.012866174802184105, 0.005809066351503134, 0.003083229996263981, -0.004260360263288021, 0.004019261337816715, 0.009019937366247177, -0.019503487274050713, -0.015782054513692856, -0.009314929135143757, 0.020501920953392982, -0.04048193246126175, 0.04733481630682945, -0.057772982865571976, 0.02153439074754715, 0.0009700687369331717, -0.0013700093841180205, 0.024892756715416908, -0.04688098281621933, -0.001318243914283812, -0.0016196176875382662, -0.02096709981560707, -0.012786753475666046, 0.026254257187247276, 0.03054298274219036, 0.015804745256900787, -0.009785780683159828, 0.0008963207947090268, -0.007601708173751831, 0.023780865594744682, 0.03946080803871155, -0.003919985145330429, -0.0035767739173024893, -0.016905291005969048, -0.009950295090675354, 0.011754282750189304, 0.009269545786082745, -0.047788649797439575, 0.03991464152932167, 0.015135341323912144, -0.012582528404891491, 0.009286563843488693, -0.014295749366283417, 0.025777732953429222, -0.0073691182769834995, -0.018402941524982452, 0.02550543285906315, 0.03784969821572304, -0.01823275350034237, 0.04268302395939827, 0.022464748471975327, 0.01053460594266653, 0.012389649637043476, 0.011697554029524326, -9.794644574867561e-05, 0.0003288518637418747, 0.0034519697073847055, -0.03946080803871155, 0.01925387792289257, -0.00458938954398036, -0.03197255730628967, -0.024597765877842903, -0.04429413005709648, -0.00218549114651978, -0.003383894683793187, -0.03773624077439308, -0.010568642988801003, 0.022056300193071365, -0.010188558138906956, 0.07057107985019684, -0.014692854136228561, 0.032812148332595825, 0.011629479005932808, -0.021749962121248245, -0.006308283191174269, 0.012843483127653599, 0.0020706146024167538, 0.003318656235933304, 0.04624561592936516, -0.015350911766290665, -0.006762116216123104, 0.008957535028457642, -0.08364147692918777, 0.027774598449468613, -0.021647850051522255, 0.009825491346418858, -0.034400563687086105, -0.02550543285906315, 0.00031236495124176145, -0.010443839244544506, 0.004058971535414457, 0.007119510322809219, -0.04608677327632904, 0.016451457515358925, 0.0019982848316431046, 0.0051963916048407555, -0.006977687124162912, -0.020014049485325813, -0.011811012402176857, 0.01994597353041172, -0.027615757659077644, 0.03365173935890198, 0.06535200029611588, -0.04222919046878815, 0.01758604124188423, 0.014556704089045525, 0.00953617226332426, 0.00480779679492116, 0.0004676610406022519, 0.011913124471902847, -0.020592687651515007, 0.0044362205080688, -0.02629964053630829, 0.016678374260663986, -0.019900590181350708, 0.006796153727918863, 0.010494895279407501, 0.03033875674009323, -0.0317002572119236, 0.03090604953467846, 0.014885732904076576, 0.009303582832217216, 0.008940516039729118, -0.008010158315300941, 0.024302775040268898, 0.025686966255307198, -0.007465558126568794, -0.011765629053115845, 0.05191853269934654, 0.003803690429776907, -0.017835648730397224, 0.03875736519694328, 0.0005768646951764822, -0.011391215957701206, -0.009780107997357845, -0.011890432797372341, 0.009042629040777683, 0.02232859842479229, 0.0016025989316403866, -0.008401589468121529, -0.004274542443454266, -0.0510108657181263, -0.03390134871006012, -0.0023599332198500633, -0.03208601474761963, -0.0010785632766783237, -0.004705684259533882, -0.001387737225741148, 0.012321574613451958, 0.00814063474535942, -0.007607380859553814, 0.0011430926388129592, 0.01002404373139143, 0.012514453381299973, -0.021693233400583267, -0.012616566382348537, 0.0771062821149826, 0.0048389979638159275, -0.0007970447768457234, 0.014987844973802567, 0.024847373366355896, -0.02831919863820076, -0.009212816134095192, 0.012888866476714611, -0.044157981872558594, -0.010290670208632946, -0.036420125514268875, 0.0010679265251383185, 0.008197364397346973, -0.028999948874115944, -0.015384949743747711, 0.02212437428534031, -0.0003907221253030002, -0.011640824377536774, -0.012752716429531574, 0.013127128593623638, -0.025051599368453026, 0.0031030853278934956, 0.0008984481683000922, 0.05141931399703026, -0.010421147570014, 0.005230429116636515, 0.05273543298244476, 0.002460627583786845, -0.01112458948045969, -0.026798857375979424, -0.05486844852566719, 0.021886112168431282, 0.001876317081041634, -0.02216975763440132, -0.025618890300393105, 0.009700687602162361, 0.017903724685311317, -0.02811497449874878, -0.0005977835971862078, 0.028228431940078735, -0.026095416396856308, 0.026276949793100357, -0.010880653746426105, -0.01974174939095974, -0.008685234934091568, 0.01912907510995865, -0.02143227867782116, 0.002554230624809861, -6.825227319495752e-05, 0.03812199831008911, -0.008225728757679462, -0.012718678452074528, -0.009184451773762703, -0.01805122010409832, 0.015055919997394085, 0.01246907003223896, -0.037010107189416885, 0.014091524295508862, -0.019934628158807755, -0.0004977984353899956, -0.014114215970039368, 0.016269924119114876, -0.010182885453104973, 0.011056514456868172, -0.06880112737417221, 0.029612623155117035, -0.049331679940223694, 0.025868499651551247, -0.0064727975986897945, 0.006200497504323721, -0.0028137664776295424, 0.002849222393706441, 0.00381503626704216, -0.029476473107933998, -0.03331136703491211, 0.05264466628432274, 0.003015155205503106, 0.003105921670794487, -0.033220600336790085, 0.0062628998421132565, 0.004067481029778719, -0.028931874781847, 0.046744830906391144, 0.023440491408109665, 0.012037929147481918, 0.013456158339977264, -0.013535578735172749, 0.07166028022766113, -0.03111027367413044, -0.022589553147554398, -0.018323520198464394, -0.004853180143982172, -0.028364581987261772, -0.038621217012405396, -0.0030378468800336123, -0.016111083328723907, -0.005516911391168833, -0.017654115334153175, -0.030202606692910194, -0.003877438372001052, -0.007828624919056892, 0.04250149056315422, 0.031813714653253555, 0.02811497449874878, 0.035625915974378586, -0.05105624720454216, -0.004280215594917536, 0.0031144311651587486, 0.005295667331665754, 0.027638448402285576, 0.03158679977059364, 0.011578422971069813, 0.03172294795513153, 0.009088012389838696, 0.017109517008066177, -0.028409965336322784, -0.030656440183520317, 0.0053297048434615135, -0.017302395775914192, -0.02931763231754303, 0.014556704089045525, 0.015282836742699146, 0.006552218459546566, -0.0034718248061835766, 0.020116161555051804, -0.08881518244743347, -0.012435032986104488, 0.022680319845676422, -0.026208873838186264, 0.016723757609725, 0.004850343801081181, -0.01504457462579012, -0.021749962121248245, 0.022725703194737434, -0.06920958310365677, -0.01123804785311222, -0.011391215957701206, 0.0042518507689237595, -0.004787941463291645, 0.03258523344993591, -0.01992328278720379, 0.012695986777544022, 0.018017182126641273, 0.01986655406653881, -0.03669242560863495, -0.015294183045625687, -0.0060927122831344604, -0.0357847586274147, -0.0005875013885088265, 0.026458483189344406, 0.00040490442188456655, -0.014953807927668095, -0.02811497449874878, -0.006172133143991232, -0.011192664504051208, 0.041412290185689926, -0.004280215594917536, -0.016962019726634026, 0.006773462053388357, -0.004030607175081968, 0.02536928281188011, 0.012934249825775623, 0.031632181257009506, 0.037600088864564896, 0.004804960452020168, 0.0007686801836825907, -0.03396942466497421, 0.022090336307883263, -0.0313371904194355, 0.03510400652885437, 0.0002512038336135447, -0.03074720688164234, 0.027071157470345497, -0.03685126453638077, 0.01845967024564743, 0.011879087425768375, 0.0020252312533557415, 0.0064444332383573055, -0.018731970340013504, 0.041412290185689926, 0.029771465808153152, -0.04463450610637665, -0.011822357773780823, 0.01923118717968464, 0.024416232481598854, -0.04486142471432686, 0.044793348759412766, 0.001062253606505692, 0.0038434008602052927, 0.0076981475576758385, -0.0263450238853693, 0.030860666185617447, -0.014522666111588478, 0.02974877320230007, 0.003780998755246401, -0.0011622387683019042, 0.0010494895977899432, -0.02675347402691841, -0.013206549920141697, 0.01963963732123375, 0.027434224262833595, 0.023054732009768486, -0.03671511635184288, -0.006739425007253885, -0.01725701242685318, 0.03335674852132797, -0.0020266494248062372, 0.052553899586200714, -0.00583175802603364, -0.03033875674009323, -0.00047581587568856776, -0.016224540770053864, 0.013274624943733215, 0.00037122148205526173, 0.011555731296539307, 0.0008757564937695861, 0.024779299274086952, 0.008344859816133976, -0.034400563687086105, -0.032199472188949585, -0.012457724660634995, 0.009950295090675354, -0.04865093156695366, 2.672475420695264e-05, -0.004399346653372049, 0.01613377407193184, 0.011708899401128292, 0.029998382553458214, -0.03365173935890198, -0.03408288210630417, 0.010699120350182056, 0.017120862379670143, -0.013081745244562626, -0.028001515194773674, 0.040572699159383774, 0.02204495295882225, -0.0016181993996724486, 0.021284783259034157, 0.020093470811843872, -0.011606787331402302, -0.03151872381567955, 0.04064077511429787, 0.005386434029787779, 0.009626938961446285, -0.018505053594708443, -0.019889244809746742, 0.011606787331402302, -0.0007686801836825907, -0.003094575833529234, -0.004949619527906179, -0.00917877908796072, 0.011901779100298882, -0.021897457540035248, -0.01897023245692253, 0.0030690478160977364, 0.007658437360078096, 0.051555465906858444, -0.02514236606657505, 0.03188179060816765, 0.011232374235987663, -0.0021060702856630087, 0.03587552532553673, -0.051555465906858444, -0.00046269723679870367, -0.018221408128738403, -0.002245056675747037, -0.025845807045698166, -0.015384949743747711, 0.0031002487521618605, -0.04061808064579964, 0.018902158364653587, 0.026231566444039345, -0.018811391666531563, -0.007743530906736851, 0.02007077820599079, -0.03095143288373947, 0.04104922339320183, 0.0010516168549656868, 0.03156410902738571, -0.0060643479228019714, 0.07860393077135086, -0.011606787331402302, 0.011311795562505722, -0.013535578735172749, 0.011833704076707363, -0.016474150121212006, 0.033039066940546036, -0.0040646446868777275, -0.010648064315319061, 0.031201040372252464, 0.019469449296593666, -0.000318037869874388, -0.007051435299217701, -0.04084499925374985, 0.004447566345334053, 0.01325193326920271, 0.010109136812388897, 0.03725971654057503, 0.030429523438215256, 0.009099357761442661, 0.0650796964764595, 0.022521479055285454, 0.010557297617197037, -0.001271442393772304, -0.008157653734087944, -0.009655304253101349, 0.010806906037032604, 0.02202226221561432, 0.017631424590945244, 0.062129780650138855, -0.02754768170416355, -0.03689664974808693, 0.017676807940006256, -0.003829218680039048, 0.007720839232206345, 0.03923388943076134, 0.002267748350277543, -0.024461615830659866, 0.04683559760451317, -0.017688153311610222, 0.005071587394922972, -0.002826530719175935, -0.016508186236023903, 0.010772868059575558, 0.012117349542677402, 0.015838783234357834, 0.02416662499308586, -0.02055864967405796, -0.06535200029611588, 0.010007024742662907, 0.04404452443122864, -0.01112458948045969, 0.020059432834386826, 0.0022110191639512777, 0.018005836755037308, 0.006591929122805595, -0.07043492794036865, 0.0012040765723213553, -0.0320633240044117, -0.06557891517877579, -0.016882600262761116, -0.005709790624678135, 0.00788535363972187, 0.007091145496815443, -0.00748257664963603, -0.022135719656944275, -0.0007452794234268367, -0.024870065972208977, 0.025596199557185173, -0.051147013902664185, 0.016576262190937996, -0.014227674342691898, 0.04061808064579964, 0.0006403304287232459, -0.011697554029524326, -0.008793020620942116, 0.03074720688164234, -0.019900590181350708, -0.004121373873203993, 0.012605220079421997, 0.004200794734060764, 0.02312280796468258, -0.014329787343740463, -0.012695986777544022, 0.01633800007402897, -0.005414798855781555, -0.006773462053388357, -0.01336539164185524, -0.0235766414552927, 0.027456915006041527, 0.005843103863298893, 0.009904911741614342, 0.028614191338419914, 0.025028906762599945, 0.025437356904149055, 0.019060999155044556, -0.012060620822012424, 0.022873198613524437, -0.030361449345946312, 8.890523895388469e-05, -0.009632612578570843, -0.028455348685383797, -0.0068018268793821335, 0.0034377872943878174, 0.005928197875618935, 0.003327165497466922, 0.01318385824561119, 0.012128695845603943, -0.00972905196249485, -0.010738831013441086, -0.014681507833302021, -0.03158679977059364, 0.026617323979735374, -0.004132719710469246, 0.025210440158843994, -0.020989790558815002, 0.031178349629044533, 0.01892484910786152, 0.026685399934649467, 0.002724418183788657, 0.008214383386075497, -0.05849911645054817, 0.00029304157942533493, -0.0144659373909235, -0.0033583666663616896, -0.01526014506816864, 0.00513398926705122, 0.047607116401195526, -0.013025016523897648, -0.02314549870789051, -0.009990005753934383, 0.006869901902973652, -0.029998382553458214, 0.004895727150142193, 0.018890811130404472, 0.01884542778134346, 0.004850343801081181, 0.010228268802165985, -0.02831919863820076, 0.003695904975757003, 0.02412124164402485, -0.023644715547561646, 0.007851316593587399, 0.005261629819869995, -0.030656440183520317, -0.019503487274050713, 0.0022308744955807924, 0.00723296869546175, 0.04427143931388855, -0.004317089449614286, -0.006121077109128237, -0.016553569585084915, -0.023871632292866707, 0.005097115412354469, 0.02015019953250885, 0.003508698893710971, -0.010364418849349022, -0.019571561366319656, 0.010733158327639103, 0.018062565475702286, 0.06766654551029205, -0.0006725951679982245, -0.016315307468175888, -0.022192448377609253, 0.011845049448311329, -0.009082339704036713, 0.04163920879364014, 0.013660382479429245, 0.022703012451529503, 0.005227592308074236, 0.005326868500560522, 0.0022578206844627857, -0.009133395738899708, -0.0006807500030845404, -0.012128695845603943, -0.026821549981832504, 0.023622024804353714, -0.003922821953892708, 0.03449133038520813, 0.009451079182326794, 0.019832516089081764, -0.009031282737851143, -0.01246907003223896, -0.002303204033523798, -0.017449891194701195, -0.00638770405203104, -0.0020606869366019964, -0.015475716441869736, 0.0006541581824421883, 0.007465558126568794, -0.0031257770024240017, -0.0392792746424675, 0.0016876925947144628, -0.0094737708568573, 0.007891027256846428, 0.06807500123977661, 0.014511320739984512, -0.012616566382348537, -0.011538712307810783, -0.008463991805911064, -0.0203317329287529, 0.014692854136228561, 0.013921337202191353, 0.016814524307847023, -0.025891190394759178, -0.011459290981292725, 0.014704199507832527, -0.009604247286915779, 0.0038235457614064217, 0.0028634045738726854, -0.03417364880442619, 0.008997245691716671, -0.0004605698923114687, -0.006694041658192873, -0.01577070727944374, 0.040595389902591705, 0.01851639896631241, 0.00016699648404028267, -0.010710466653108597, -0.007981793023645878, -0.0008147726184688509, -0.00597925391048193, -0.0027740560472011566, 0.03088335692882538, 0.014772274531424046, 0.006330974865704775, -0.06040521338582039, 0.011476309970021248, -0.002280512358993292, -0.029998382553458214, 0.00958722922950983, 0.013773840852081776, -0.01851639896631241, -0.01125506591051817, 0.019526178017258644, 0.03653358295559883, 0.011340159922838211, -0.005372251849621534, -0.009303582832217216, 0.0018124968046322465, -0.0021457807160913944, -0.014102870598435402, -0.0012565510114654899, 0.004779431968927383, 0.03710087388753891, 0.024053165689110756, -0.004254687577486038, 0.006915285252034664, -0.010744503699243069, -0.0012863337760791183, -0.009882220067083836, -0.013444812037050724, 0.0444529727101326, -0.00429439777508378, 0.004558188375085592, -0.04604139178991318, 0.0017543494468554854, 0.017994491383433342, -0.013501540757715702, 0.012332919985055923, -0.01772219128906727, -0.010517586953938007, -0.046608682721853256, 0.02145496942102909, 0.030247990041971207, -0.010188558138906956, 0.03474093973636627, -0.021681886166334152, -0.0030066457111388445, -0.015203416347503662, -0.004030607175081968, -0.021954186260700226, 0.0028279488906264305, 0.008804365992546082, 0.023894324898719788, 0.010041061788797379, 0.015237453393638134, -0.05645686388015747, 0.04883246496319771, -0.027615757659077644, -0.019424065947532654, 0.02709384821355343, -0.010489222593605518, -0.002195418579503894, 0.016315307468175888, 0.01833486557006836, 0.010636718012392521, -0.013263278640806675, 0.011186990886926651, 0.01178832072764635, 0.036828573793172836, 0.024870065972208977, -0.017529312521219254, -0.0253238994628191, -0.019775787368416786, -0.0005116261309012771, 0.02147766202688217, -0.01265060342848301, 0.01789237931370735, 0.018425632268190384, 0.010892000049352646, 0.0001489140558987856, -0.018800044432282448, -0.028364581987261772, -0.02022962085902691, -0.02155708335340023, 0.03925658017396927, -0.015180724672973156, 0.012378303334116936, -0.003205197863280773, -0.045179106295108795, -0.022373981773853302, -0.03011183999478817, -0.017166245728731155, -0.023848941549658775, 0.019140420481562614, 0.004268869757652283, 0.005718299653381109, -0.011947162449359894, 0.02053595706820488, -0.00913906842470169, 0.013331353664398193, -0.0368739552795887, -0.025641582906246185, -0.04290993884205818, -0.01692798361182213, 0.027252690866589546, 0.001628127065487206, 0.001744421781040728, -0.0022110191639512777, 0.014760928228497505, -0.009723379276692867, 0.010426820255815983, -0.029068024829030037, -0.01067642867565155, -0.020104816183447838, 0.026866933330893517, -0.008299476467072964, 0.0030889029148966074, -0.002759873867034912, 0.005477200727909803, 0.008242747746407986, 0.005261629819869995, 0.016984712332487106, 0.019015615805983543, 0.006994706112891436, -0.020978445187211037, 0.01764276996254921, 0.0392792746424675, 0.010199903510510921, -0.07402021437883377, 0.018550436943769455, 0.0303160659968853, -0.0019529014825820923, -0.03265330567955971, 0.012389649637043476, 0.044384896755218506, -8.6290376202669e-05, -0.011101897805929184, -0.013456158339977264, 0.050193965435028076, -0.02176130749285221, -0.00682451855391264, 0.015396295115351677, -0.024801990017294884, 0.02654924988746643, -0.029998382553458214, 0.051782380789518356, 0.00832216814160347, 0.006728079169988632, -0.006007618736475706, 0.0039596958085894585, -0.04109460860490799, -0.022283215075731277, -0.042546872049570084, -0.018686586990952492, -0.009632612578570843, 0.005511238239705563, 0.006189151667058468, -0.026050033047795296, 0.0006825227756053209, -0.0024946650955826044, -0.019265225157141685, 0.0008785929530858994, -0.025618890300393105, 0.003383894683793187, 0.013603653758764267, -0.018017182126641273, -0.03415095806121826, -0.011822357773780823, 0.02184072881937027, 0.016088390722870827, 0.01126641221344471, 0.021772652864456177, 0.01107353251427412, -0.005451672710478306, -0.06081366539001465, -0.007136528845876455, 0.01276406180113554, 0.03430980071425438, 0.045156415551900864, -0.005704117473214865, -0.009763089008629322, -0.00016885790682863444, -0.021420933306217194, -0.017983146011829376, 0.02176130749285221, 0.011612460017204285, -0.04810633137822151, 0.025051599368453026, -0.0038434008602052927, 0.013966720551252365, 0.007255660369992256, 0.015089957974851131, -0.007125183008611202, -0.007108164485543966, -0.004524150863289833, 0.014783619903028011, 0.0003978132735937834, 0.004929764196276665, -0.01886812038719654, 0.03966503217816353, 0.01305905357003212, 0.011629479005932808, -0.013898645527660847, 0.010131828486919403, -0.02949916571378708, -0.002195418579503894, -0.028568807989358902, 0.0006052292883396149, -0.022305907681584358, -0.028614191338419914, -0.0227370485663414, 0.025437356904149055, -0.02194284088909626, -0.010608353652060032, 0.024030474945902824, 0.031995248049497604, 0.018754661083221436, -0.03596629202365875, -0.00291587901301682, 0.0361478254199028, 0.014806311577558517, -0.028773032128810883, 0.05668378248810768, -0.009955968707799911, 0.035013239830732346, 0.00022053462453186512, 0.0035257176496088505, 0.002108906628564, -0.01556648313999176, 0.01705278642475605, -0.01682586967945099, -0.018187370151281357, -0.0007388973608613014, 0.003676049876958132, 0.011901779100298882, 0.017222974449396133, -0.018414286896586418, 0.018754661083221436, -0.007624399848282337, -0.0020720327738672495, 0.008696581237018108, -0.03226754814386368, -0.012389649637043476, 0.012718678452074528, -0.014738236553966999, 0.004614917561411858, 0.020240966230630875, 0.006143768317997456, 0.0010516168549656868, -0.02450699917972088, 0.007544978987425566, 0.011935816146433353, -0.02206764556467533, -0.0005963653675280511, -0.015986278653144836, -0.0030491927172988653, -0.008685234934091568, 0.009723379276692867, 0.01417094562202692, 0.0020691961981356144, 0.017098169773817062, 0.0010062335059046745, 0.010273652151226997, 0.013841915875673294, -0.0158501286059618, 0.0060756937600672245, -0.012037929147481918, 0.03573937341570854, -0.018992925062775612, 0.008452645502984524, -0.015634557232260704, -0.04045924171805382, 0.0036817227955907583, -0.01797179877758026, -0.03846237435936928, -0.010670755989849567, 0.011765629053115845, -0.014488629065454006, 0.0044986228458583355, 0.021114595234394073, 0.01674645021557808, -0.01994597353041172, -0.006438760086894035, -0.018629858270287514, 0.024416232481598854, -0.014431899413466454, 0.010801233351230621, 0.02752499096095562, 0.01125506591051817, -0.01956021599471569, 0.008242747746407986, 0.013955374248325825, 0.04009617492556572, 0.06185748055577278, -0.010313361883163452, 0.014102870598435402, 0.024484308436512947, -0.006206170655786991, 0.0007573343464173377, -0.02831919863820076, 0.021795345470309258, 0.04172997176647186, 0.01156140398234129, 0.005375088192522526, 0.013660382479429245, 0.052553899586200714, 0.000841009896248579, 0.003676049876958132, -0.014318441040813923, 0.0099105853587389, 0.0203317329287529, 0.007068453822284937, -0.007874008268117905, -0.02017289027571678, 0.020388461649417877, 0.03887082263827324, -0.02092171646654606, -0.008095251396298409, 0.0018947541248053312, -0.03135988116264343, 0.008203037083148956, -0.009229835122823715, 0.024257391691207886, -0.023871632292866707, 0.0027570375241339207, 0.01684856228530407, -0.0073407539166510105, 0.008061214350163937, 0.00877032894641161, 0.020206928253173828, -0.014136907644569874, -0.017347779124975204, 0.011039495468139648, 0.014114215970039368, -0.00190751813352108, 0.0012317319633439183, -0.011640824377536774, -0.037622783333063126, 0.014987844973802567, 0.019287915900349617, 0.009400022216141224, -0.013626345433294773, -0.01727970317006111, 0.023304341360926628, -0.008855422958731651, 0.005539603065699339, -0.006779135204851627, 0.012979633174836636, -0.05986061319708824, 0.010432492941617966, -0.01002404373139143, -0.02117132395505905, 0.00334134791046381, 0.02875034138560295, -0.01166351605206728, -0.004280215594917536, 0.020649416372179985, -0.035240158438682556, -0.013138474896550179, 0.01966232806444168, 0.006109731271862984, -0.040209632366895676]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:18:00.628679", "url_path": "/api/pydantic_graph/persistence/", "chunk_size": 4771}
updated_dt: 2025-03-15T11:18:00.628679
---
```
@dataclass
classFullStatePersistence(BaseStatePersistence[StateT, RunEndT]):
"""In memory state persistence that hold a list of snapshots."""
  deep_copy: bool = True
"""Whether to deep copy the state and nodes when storing them.
  Defaults to `True` so even if nodes or state are modified after the snapshot is taken,
  the persistence history will record the value at the time of the snapshot.
  """
  history: list[Snapshot[StateT, RunEndT]] = field(default_factory=list)
"""List of snapshots taken during the graph run."""
  _snapshots_type_adapter: pydantic.TypeAdapter[list[Snapshot[StateT, RunEndT]]] | None = field(
    default=None, init=False, repr=False
  )
  async defsnapshot_node(self, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]) -> None:
    snapshot = NodeSnapshot(
      state=self._prep_state(state),
      node=next_node.deep_copy() if self.deep_copy else next_node,
    )
    self.history.append(snapshot)
  async defsnapshot_node_if_new(
    self, snapshot_id: str, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]
  ) -> None:
    if not any(s.id == snapshot_id for s in self.history):
      await self.snapshot_node(state, next_node)
  async defsnapshot_end(self, state: StateT, end: End[RunEndT]) -> None:
    snapshot = EndSnapshot(
      state=self._prep_state(state),
      result=end.deep_copy_data() if self.deep_copy else end,
    )
    self.history.append(snapshot)
  @asynccontextmanager
  async defrecord_run(self, snapshot_id: str) -> AsyncIterator[None]:
    try:
      snapshot = next(s for s in self.history if s.id == snapshot_id)
    except StopIteration as e:
      raise LookupError(f'No snapshot found with id={snapshot_id!r}') frome
    assert isinstance(snapshot, NodeSnapshot), 'Only NodeSnapshot can be recorded'
    exceptions.GraphNodeStatusError.check(snapshot.status)
    snapshot.status = 'running'
    snapshot.start_ts = _utils.now_utc()
    start = perf_counter()
    try:
      yield
    except Exception:
      snapshot.duration = perf_counter() - start
      snapshot.status = 'error'
      raise
    else:
      snapshot.duration = perf_counter() - start
      snapshot.status = 'success'
  async defload_next(self) -> NodeSnapshot[StateT, RunEndT] | None:
    if snapshot := next((s for s in self.history if isinstance(s, NodeSnapshot) and s.status == 'created'), None):
      snapshot.status = 'pending'
      return snapshot
  async defload_all(self) -> list[Snapshot[StateT, RunEndT]]:
    return self.history
  defshould_set_types(self) -> bool:
    return self._snapshots_type_adapter is None
  defset_types(self, state_type: type[StateT], run_end_type: type[RunEndT]) -> None:
    self._snapshots_type_adapter = build_snapshot_list_type_adapter(state_type, run_end_type)
  defdump_json(self, *, indent: int | None = None) -> bytes:
"""Dump the history to JSON bytes."""
    assert self._snapshots_type_adapter is not None, 'type adapter must be set to use `dump_json`'
    return self._snapshots_type_adapter.dump_json(self.history, indent=indent)
  defload_json(self, json_data: str | bytes | bytearray) -> None:
"""Load the history from JSON."""
    assert self._snapshots_type_adapter is not None, 'type adapter must be set to use `load_json`'
    self.history = self._snapshots_type_adapter.validate_json(json_data)
  def_prep_state(self, state: StateT) -> StateT:
"""Prepare state for snapshot, uses [`copy.deepcopy`][copy.deepcopy] by default."""
    if not self.deep_copy or state is None:
      return state
    else:
      return copy.deepcopy(state)

```
  
---|---  
####  deep_copy `class-attribute` `instance-attribute`
```
deep_copy: bool[](https://docs.python.org/3/library/functions.html#bool) = True

```

Whether to deep copy the state and nodes when storing them.
Defaults to `True` so even if nodes or state are modified after the snapshot is taken, the persistence history will record the value at the time of the snapshot.
####  history `class-attribute` `instance-attribute`
```
history: list[](https://docs.python.org/3/library/stdtypes.html#list)[Snapshot[](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.Snapshot "pydantic_graph.persistence.Snapshot")[StateT, RunEndT]] = field[](https://docs.python.org/3/library/dataclasses.html#dataclasses.field "dataclasses.field")(
  default_factory=list[](https://docs.python.org/3/library/stdtypes.html#list)
)

```

List of snapshots taken during the graph run.
####  dump_json
```
dump_json(*, indent: int[](https://docs.python.org/3/library/functions.html#int) | None = None) -> bytes[](https://docs.python.org/3/library/stdtypes.html#bytes)

```

Dump the history to JSON bytes.
Source code in `pydantic_graph/pydantic_graph/persistence/in_mem.py`
```
157
158
159
160
```
|