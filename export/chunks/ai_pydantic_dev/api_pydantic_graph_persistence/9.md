---
url: https://ai.pydantic.dev/api/pydantic_graph/persistence/
session_id: pydantic_ai_docs
chunk_number: 9
title: In Memory State Persistence
summary: This module offers an in memory state persistence solution for graphs, including a function to build a type adapter for a list of snapshots and a dataclass for simple state persistence.
embedding: [0.01877303048968315, 0.03563813865184784, 0.013708787970244884, -0.04289295896887779, 0.002632228657603264, 0.00968683697283268, 0.008709319867193699, -0.040961481630802155, -0.012766603380441666, -0.009374737739562988, 0.03686297684907913, -0.015169174410402775, 0.04729767516255379, -0.03523770719766617, -0.011883304454386234, 0.025886526331305504, 0.02320129983127117, 0.03822914510965347, 0.010140263475477695, 0.05596577376127243, 0.007937906309962273, -0.025650979951024055, 0.06675378978252411, -0.0342719703912735, 0.0011519680265337229, -0.03116275928914547, -0.012955039739608765, 0.04508353769779205, 0.015640266239643097, -0.05012422800064087, 0.04814564064145088, -0.010364032350480556, 0.015063178725540638, 0.034342631697654724, 0.009150968864560127, 0.01105889305472374, 0.0038659016136080027, 0.016912216320633888, -0.018890803679823875, -0.002769139828160405, 0.006783729884773493, -0.07358463108539581, 0.002036002231761813, 0.0040572830475866795, -0.019774101674556732, 0.02101071923971176, -0.00952195469290018, 0.052149925380945206, 7.784065383020788e-05, 0.03019702062010765, -0.06618847697973251, -0.004060227423906326, 0.016205577179789543, 0.03309423848986626, -0.0374518446624279, -0.03827625513076782, -0.024473248049616814, 0.03441329672932625, 0.020492518320679665, 0.006907391827553511, 0.04510709270834923, 0.004163278732448816, 0.002065445529296994, 0.07038120180368423, -0.033424004912376404, -0.0018181221093982458, -0.0019197013461962342, 0.05483515188097954, -0.03431908041238785, -0.010140263475477695, 0.029184171929955482, 0.03688653185963631, -0.06091224402189255, -0.04294006898999214, -0.011347437277436256, -0.006430410780012608, 0.001879952964372933, 0.0763169601559639, 0.010016601532697678, 0.018443265929818153, 0.02708781138062477, 0.04060816019773483, -0.012754825875163078, 0.02238866500556469, -0.01945611461997032, -0.009940048679709435, -0.03994863107800484, -0.04970024526119232, 0.001173314405605197, 0.00040079656173475087, 0.02105782926082611, -0.020115643739700317, -0.02175268903374672, 0.02449680306017399, 0.05742615833878517, -0.014085661619901657, 0.030621003359556198, -0.023224852979183197, -0.02083406038582325, 0.010252147912979126, 0.027558904141187668, -0.009357072412967682, -0.039312656968832016, -0.015016068704426289, 0.027252692729234695, 0.019079240038990974, 0.010947008617222309, 0.01473341416567564, -0.0053410097025334835, 0.015322279185056686, -0.09468956291675568, -0.06034693121910095, 0.014945405535399914, 0.036438994109630585, -0.03363599628210068, -0.05182015895843506, -0.013791228644549847, 0.03752250596880913, 0.021210933104157448, 0.034695953130722046, -0.019397228956222534, 0.013131699524819851, -0.038865119218826294, -0.002554203849285841, 0.03307068347930908, 0.012083519250154495, -0.0017872066237032413, 0.010740906000137329, -0.06307926774024963, -0.034389741718769073, 0.04734478145837784, -0.026875820010900497, 0.004601983353495598, -0.034884389489889145, 0.02056318148970604, -0.03608567640185356, -0.07636407017707825, -0.013355468399822712, -0.044117800891399384, -0.006736620794981718, 0.013331914320588112, -0.009039084427058697, 0.038182035088539124, 0.017442194744944572, 0.04034906253218651, 0.08993153274059296, -0.004107336513698101, 0.023189522325992584, -0.01645290106534958, 0.01607602648437023, 0.01955033279955387, 0.03149252384901047, -0.014556754380464554, -0.02781800366938114, -0.008197006769478321, -0.017029989510774612, 0.02110493741929531, 0.0453190840780735, -0.03349466621875763, -0.046072833240032196, 0.01048180554062128, 0.03033834882080555, 0.005011245142668486, 0.011612426489591599, 0.013061035424470901, 0.017100652679800987, -0.04150323569774628, -0.04482444003224373, -0.059687402099370956, -0.05964029207825661, 0.021858686581254005, 0.0028250820469111204, -0.02631050907075405, 0.020951833575963974, 0.053845856338739395, 0.009050861932337284, -0.049229152500629425, -0.002511511091142893, -0.021552475169301033, -0.028618860989809036, -0.02631050907075405, -0.027629567310214043, -0.06967455893754959, -0.006012316327542067, -0.015169174410402775, -0.03646254912018776, 0.006277305539697409, 0.019632773473858833, 0.005258568562567234, 0.003459584666416049, -0.04326983541250229, 0.05172594264149666, -0.024379029870033264, 0.039453987032175064, 0.005196737591177225, -0.011217886582016945, 0.0304796751588583, 0.011494653299450874, 0.027205584570765495, -0.008626879192888737, -0.0301028024405241, 0.018172388896346092, -0.022541768848896027, -0.00825000461190939, 0.021258043125271797, -0.013355468399822712, -0.030856549739837646, 0.0006083716289140284, -0.04058460891246796, -0.05808568745851517, 0.027888668701052666, -0.022011790424585342, 0.0054617272689938545, -0.012896153144538403, -0.01213062833994627, 0.05186726897954941, -0.05648397281765938, 0.007089939899742603, 0.056813739240169525, 0.0264047272503376, -0.03905355557799339, 0.023366181179881096, 0.026922928169369698, -0.01087045669555664, 0.011029450222849846, 0.02178802154958248, -0.013178808614611626, -0.04847540333867073, -0.012966817244887352, 0.04647326096892357, -0.046119943261146545, -0.011471099220216274, 0.010440584272146225, -0.02320129983127117, -0.022082455456256866, -0.012872599065303802, -0.018537484109401703, -0.020445408299565315, 0.0375460609793663, -0.021458256989717484, -0.019715216010808945, 0.018195942044258118, -0.023224852979183197, 0.014415426179766655, 0.001486149150878191, -0.0019888931419700384, -0.025321215391159058, -0.041149917989969254, 0.030997877940535545, 0.046449705958366394, 0.04308139532804489, 0.001925590098835528, -0.0024452637881040573, 0.006713066250085831, -0.020492518320679665, -0.05040688440203667, 0.034931499511003494, 0.00989293958991766, -0.0053704530000686646, 0.00446654437109828, -0.008721097372472286, 0.04885227978229523, -0.01566382125020027, 0.009692725725471973, 0.0027794449124485254, -0.02449680306017399, 0.0843726396560669, -0.002901634434238076, 0.022953975945711136, -0.05912209302186966, -0.016511786729097366, 0.02326018549501896, 0.013037481345236301, 0.005226180888712406, 0.009463068097829819, 0.01571093127131462, -0.04098503664135933, -0.007407927419990301, -0.01407388411462307, 0.02562742494046688, 0.011000006459653378, -0.03457817807793617, -0.0070016104727983475, 0.06322059780359268, -0.01466275006532669, 0.03116275928914547, 0.042280539870262146, 0.028171323239803314, 0.035803020000457764, -0.040137071162462234, 0.006035870872437954, -0.025156332179903984, 0.02868952415883541, 0.007914351299405098, 0.008414887823164463, -0.01290793064981699, -0.0072371563874185085, -0.0072548226453363895, 0.05620132014155388, -0.020845837891101837, 0.049040716141462326, -0.027488239109516144, -0.03238759934902191, 0.010269813239574432, 0.006077091675251722, -0.005326287820935249, -0.01758352294564247, -0.0132259177044034, -0.018808363005518913, -0.001405180199071765, -0.012271956540644169, -0.03038545697927475, -0.061383336782455444, -0.019997870549559593, -0.0056266095489263535, -0.002780917100608349, 0.05488226190209389, -0.0055647785775363445, 0.0026410615537315607, -0.026334064081311226, -0.01813705638051033, -0.020716287195682526, 0.06585871428251266, 0.020916501060128212, -0.010682019405066967, 0.0013094895984977484, -0.07052252441644669, -0.0034890277311205864, 0.009539620019495487, -0.03964242339134216, 0.004725645296275616, -0.03827625513076782, -0.03460173308849335, -0.00883887056261301, 0.058038581162691116, -0.04732122644782066, 0.004978857468813658, 0.013779452070593834, 0.014815854839980602, 0.05893365666270256, -0.025886526331305504, 0.011906859464943409, -0.043693818151950836, 0.00416916748508811, -0.005270345602184534, -0.00776713527739048, 0.02032763510942459, 0.0455075241625309, -0.04722701013088226, -0.042516086250543594, 0.018890803679823875, 0.025933634489774704, 0.007278377190232277, 0.018949691206216812, 0.003748128656297922, 0.05295078083872795, 0.02311885729432106, -0.03688653185963631, -0.010611355304718018, 0.02156425267457962, -0.047674547880887985, 0.024284811690449715, 0.011688979342579842, -0.04268096759915352, -0.013437910005450249, -0.021128492429852486, 0.005856267176568508, -0.03307068347930908, -0.013343690894544125, -0.007319597527384758, 0.03281158208847046, 0.0528094545006752, 0.07443259656429291, 0.021540697664022446, 0.014003220945596695, 0.011388657614588737, -0.019114572554826736, -0.008161675184965134, 0.030550340190529823, 0.03248181939125061, -0.014215212315320969, 0.03288224712014198, 0.04291651397943497, 0.012719494290649891, 0.04520131275057793, 0.0017356809694319963, 0.004887583199888468, 0.014862963929772377, -0.04275163263082504, -0.00687794853001833, -0.0024467359762638807, -0.018443265929818153, -0.01927945576608181, 0.003303535282611847, 0.023083526641130447, 0.03596790134906769, 0.0018681756919249892, 0.018443265929818153, 0.009569063782691956, -0.008232339285314083, -0.021046051755547523, 0.028430424630641937, 0.01927945576608181, -0.01759530045092106, 0.0012042298913002014, -0.010293368250131607, 0.012054075486958027, 0.01153587456792593, 0.014615640975534916, -0.02517988719046116, 0.04006640613079071, -0.02261243388056755, -0.006701288744807243, -0.04303428903222084, -0.020857613533735275, -0.033518221229314804, -0.015110287815332413, -0.018973244354128838, -0.004016062244772911, -0.0027500016149133444, -0.00775535823777318, -0.05426983907818794, -0.0031916508451104164, -0.014250543899834156, -0.015204505994915962, 0.04798075556755066, 0.023837273940443993, -0.03676876053214073, 0.04609638825058937, -0.06241973862051964, 0.02887796238064766, 0.01840793341398239, 0.04682658240199089, -0.016252687200903893, 0.059828732162714005, -0.0170888751745224, -0.03092721290886402, -0.01686510629951954, -0.009951826184988022, 0.001925590098835528, -0.01799572817981243, -0.052526798099279404, 0.009539620019495487, 0.044847991317510605, -0.041950773447752, -0.04437690228223801, -0.010263924486935139, -0.03615633770823479, 0.02485012263059616, -0.028854407370090485, 0.013567459769546986, 0.03825270012021065, -0.029019290581345558, 0.0029089953750371933, -0.02781800366938114, 0.008827093057334423, 0.06472808867692947, -0.025886526331305504, 0.021894017234444618, -0.041785892099142075, 0.0035390814300626516, -0.0011387185659259558, 0.017654186114668846, 0.010911677032709122, 0.0227066520601511, -0.033329784870147705, 0.018537484109401703, -0.03215205296874046, 0.03686297684907913, 0.02751179412007332, 0.026263399049639702, 0.022871533408761024, -0.0009937104769051075, 0.01281371247023344, 0.02175268903374672, 0.011453432962298393, 0.000857535342220217, 0.027346910908818245, 0.017889732494950294, 0.03453107178211212, -0.035426147282123566, -0.01388544775545597, -0.008426664397120476, 0.0029193004593253136, 0.024108150973916054, 0.005226180888712406, 0.061430443078279495, 0.008185230195522308, -0.022624211385846138, 0.02088116854429245, -0.03377732262015343, 0.03130408748984337, 0.019444337114691734, -0.010929343290627003, 0.01626446470618248, -0.009916494600474834, -0.01992720738053322, -0.03907711058855057, 0.02394326962530613, -0.027653122320771217, 0.03462528809905052, -0.025556759908795357, 0.009357072412967682, 0.06849683076143265, 0.0005741438362747431, -0.07155892997980118, 0.03092721290886402, 0.02435547485947609, 0.015699153766036034, 0.04454178363084793, -0.04779231920838356, 0.010676130652427673, -0.0025851193349808455, -0.02215311862528324, 0.019668105989694595, 0.0002607569913379848, -0.020221639424562454, 0.038488246500492096, 0.005809157621115446, -0.008297114633023739, 0.00222738366574049, 0.008220561780035496, -0.004507765173912048, -0.018572816625237465, -0.022553546354174614, -0.01575803942978382, 0.016417568549513817, -0.02649894542992115, 0.016370460391044617, -0.03295291215181351, -0.0023319071624428034, -0.015404720790684223, -0.00184462103061378, 0.029820146039128304, -0.03905355557799339, 0.002995853079482913, -0.00013424291682895273, -0.02384905144572258, -0.003556747455149889, 0.027535349130630493, -0.002878079889342189, 0.02444969303905964, -0.024920785799622536, 0.00476097734645009, 0.003147485898807645, 0.02101071923971176, 0.03636832907795906, -0.012566388584673405, 0.013061035424470901, -0.007690582890063524, 0.030079247429966927, -0.0034095309674739838, 0.0037422399036586285, -0.06208997219800949, 0.04875805974006653, -0.014427203685045242, -0.010923454537987709, 0.02741757594048977, 0.00971039105206728, 0.03563813865184784, -0.014815854839980602, -0.010952897369861603, 0.0002686698571778834, 0.006271417252719402, -0.0133672459051013, 0.0414796844124794, 0.030550340190529823, -0.002680809935554862, 0.002697003772482276, 0.02887796238064766, -0.006842616479843855, 0.0018004560843110085, 0.006801396142691374, -0.0454133041203022, -0.016606006771326065, 0.0014338874025270343, -0.006047648377716541, -0.024543913081288338, -0.021481812000274658, -0.022094231098890305, -0.028901517391204834, -0.048004310578107834, 0.009834052994847298, 0.02175268903374672, -0.0346488431096077, 0.040278397500514984, -0.018431488424539566, 0.01009904220700264, 0.005429339595139027, -0.013379023410379887, -0.005423450842499733, 0.012436838820576668, -0.0018490374786779284, -0.0009326156578026712, 0.05949896574020386, -0.006153644062578678, -0.014003220945596695, 0.01453319936990738, -0.06906214356422424, -0.002577758627012372, -0.017065320163965225, 0.02499145083129406, -0.0043841032311320305, 0.005061298608779907, -0.003141597146168351, 0.00043649651343002915, -0.00262633990496397, -0.011653647758066654, -0.06204286590218544, 0.019067462533712387, -0.0013337802374735475, 0.02864241600036621, -0.005196737591177225, -0.026051407679915428, -0.00872698612511158, 0.020256971940398216, -0.01827838458120823, 0.04011351615190506, 0.029278390109539032, -0.03377732262015343, -0.007496257312595844, -0.006324415095150471, 0.017442194744944572, -0.0031945949885994196, 0.00621253065764904, 0.01576981693506241, -0.017065320163965225, -0.009150968864560127, -0.01007548812776804, 0.01167131308466196, -0.0019682827405631542, 0.011659535579383373, 0.01507495529949665, 0.024661684408783913, -0.009527843445539474, 0.03672165051102638, 0.013732342049479485, 0.011977523565292358, 0.010428806766867638, -0.005950485356152058, 0.020304080098867416, 0.014886518940329552, -0.008385444059967995, -0.03705141320824623, 0.0343661867082119, 0.02737046591937542, -0.0008862424874678254, 0.04298717901110649, -0.0027765005361288786, -0.025980744510889053, -0.003206372493878007, -0.006130089517682791, 0.01475696824491024, 0.015475383959710598, 0.008774095214903355, -0.012542834505438805, 0.009333517402410507, -0.039595313370227814, -0.015263392589986324, 0.017065320163965225, -0.05709639564156532, -0.00024290700093843043, 0.00310626532882452, 0.006548183970153332, 0.006165421102195978, -0.021069606766104698, -0.014980737119913101, -0.014886518940329552, 0.004498932044953108, 0.006453965324908495, -0.024920785799622536, -0.004263386130332947, 0.04501287639141083, 0.0028162491507828236, 0.003153374418616295, -0.0033624216448515654, 0.014344762079417706, -0.03987796977162361, 0.006200753152370453, -0.01071146223694086, -0.026027852669358253, 0.020209861919283867, -0.05926341935992241, 0.02485012263059616, 0.0170888751745224, -0.02828909642994404, -0.019585665315389633, 0.03111565113067627, -0.02220022678375244, 0.004813975188881159, -0.014203434810042381, 0.006453965324908495, -0.009680948220193386, -0.001639990252442658, 0.02878374420106411, 0.05012422800064087, -0.00865632202476263, 0.03330622985959053, 0.026169180870056152, -0.03577946498990059, -0.029160616919398308, -0.013932556845247746, -0.05860389024019241, 0.014603863470256329, -0.011700756847858429, -0.035379037261009216, 0.013143477030098438, -0.010422918945550919, 0.0459786131978035, -0.01640579104423523, 0.0104641392827034, 0.01695932447910309, -0.016594229266047478, -0.006171309854835272, -0.027040701359510422, -0.025368323549628258, 0.005632498301565647, 0.011418101377785206, -0.0067601753398776054, -0.003630355466157198, -0.0024099319707602262, 0.018066391348838806, -0.01375589706003666, -0.007390261627733707, 0.0038129037711769342, 0.005915153305977583, 0.007831910625100136, 0.031633853912353516, -0.017430417239665985, 0.006636513862758875, -0.025203442201018333, -0.010581912472844124, -0.015569603070616722, 0.021069606766104698, -0.025980744510889053, 0.011200221255421638, -0.07834266126155853, 0.024284811690449715, -0.022789092734456062, 0.018949691206216812, -0.005214403383433819, -0.003503749379888177, -0.015298724174499512, 0.007490368559956551, 0.011482876725494862, 0.003474306082352996, -0.01205996423959732, 0.050736647099256516, -0.017171315848827362, -0.020857613533735275, -0.030809441581368446, 0.0074197049252688885, -0.024426139891147614, -0.03486083447933197, 0.04126768931746483, -0.0025895358994603157, 0.009345294907689095, 0.008732874877750874, -0.030856549739837646, 0.04866383969783783, -0.012778379954397678, -0.013814783655107021, -0.03957175835967064, 0.004154445603489876, -0.0025277049280703068, -0.0456017404794693, -0.04133835434913635, -0.007036942057311535, -0.020174531266093254, -0.009545508772134781, -0.033376894891262054, 0.013167032040655613, -0.005603055004030466, 0.05017133802175522, 0.0458843968808651, -0.001241033896803856, 0.019091017544269562, -0.03495505452156067, -0.011429878883063793, -5.1525727030821145e-05, -0.028571752831339836, 0.024190593510866165, 0.010252147912979126, 0.008744652383029461, 0.029961474239826202, 0.010923454537987709, -0.013096367940306664, -0.019020354375243187, -0.023601727560162544, 0.0012903513852506876, -0.027723785489797592, 0.0003945398493669927, 0.0264518354088068, 0.022553546354174614, -0.009610284119844437, -0.0011549124028533697, 0.008202895522117615, -0.1223897933959961, -0.0023260186426341534, 0.007890797220170498, -0.03504927083849907, 0.02220022678375244, -0.00025854873820208013, -0.015875812619924545, -0.024873677641153336, 0.023790163919329643, -0.04833407700061798, -0.018254829570651054, -0.01310814544558525, -0.009033195674419403, -0.02503855898976326, 0.03966597840189934, -0.015557825565338135, 0.004563707392662764, 0.019903652369976044, 0.006742509547621012, -0.024920785799622536, -0.038818009197711945, 0.015546048060059547, -0.04505998641252518, 0.012766603380441666, -0.005764992907643318, -0.020174531266093254, -0.0207869503647089, -0.02402571029961109, -0.01681799814105034, 0.012931485660374165, 0.01194807980209589, -0.01604069583117962, -0.03665098547935486, 0.007190047297626734, 0.011877416633069515, 0.0021964681800454855, 0.02056318148970604, 0.03052678517997265, 0.02800644189119339, 0.01650000922381878, -0.010051933117210865, -0.03431908041238785, -0.009692725725471973, -0.009463068097829819, 0.04112636297941208, 0.01635868288576603, -0.014556754380464554, 0.03285869210958481, -0.037852272391319275, 0.025274105370044708, 0.02727624773979187, -0.013379023410379887, 0.011206110008060932, -0.034790169447660446, 0.04305784031748772, 0.012766603380441666, -0.038865119218826294, -0.026286954060196877, -0.00514079537242651, 0.03980730473995209, -0.04965313524007797, 0.04595506191253662, 0.008344223722815514, 0.007213601842522621, -0.005385174416005611, -0.026122070848941803, 0.03448396176099777, -0.014215212315320969, 0.03973663970828056, -0.032552480697631836, -0.014474312774837017, -0.017300866544246674, -0.017194870859384537, 0.00017877586651593447, 0.012566388584673405, 0.032788027077913284, 0.0227066520601511, -0.021599585190415382, -0.00012145350046921521, -0.022624211385846138, 0.04447111859917641, -0.01429765298962593, 0.02435547485947609, -0.0003838666598312557, -0.023637060075998306, -0.030809441581368446, 0.006442188285291195, 0.003462528809905052, 0.00039233159623108804, 0.017489304766058922, 0.011936303228139877, 0.01927945576608181, 0.00301499105989933, -0.002538010012358427, -0.05445827916264534, -0.009315851144492626, 0.0003016095142811537, -0.01562848873436451, 0.003436029888689518, 0.015157396905124187, 0.021034274250268936, 0.0191499050706625, 0.006436299532651901, -0.020351190119981766, -0.05031266435980797, -0.008603324182331562, 0.037899382412433624, -0.0022023566998541355, -0.0027323358226567507, 0.040773045271635056, 0.03961886838078499, -0.0039012336637824774, 0.003377143293619156, 0.011094225570559502, 0.011188443750143051, -0.01251927949488163, 0.03627411276102066, 0.016617782413959503, 0.008997864089906216, -0.015157396905124187, -0.014497867785394192, 0.014250543899834156, -0.008308891206979752, 0.02567453309893608, 0.009516065940260887, 0.003465473186224699, 0.01617024466395378, -0.02932550013065338, -0.023377958685159683, 0.004528375342488289, 0.0422334298491478, 0.04856962338089943, -0.03973663970828056, 0.0070016104727983475, 0.007914351299405098, -0.009533731266856194, 0.03844113647937775, -0.026946483179926872, 0.004245719872415066, 0.009633839130401611, -0.00787901971489191, -0.04802786558866501, 0.004325216636061668, -0.052197035402059555, -0.01826660707592964, 0.0209282785654068, 0.01677088811993599, -0.03674520552158356, 0.01185386162251234, -0.00012633003643713892, -0.01654711924493313, 0.053892966359853745, -0.013744119554758072, 0.040419723838567734, -0.028171323239803314, 0.06420988589525223, 0.005679607391357422, 0.011965746060013771, -0.03613278269767761, -0.0074314819648861885, -0.015451829880475998, 0.01913812756538391, -0.01388544775545597, 0.011518208310008049, 0.001087192795239389, 0.02567453309893608, -0.020916501060128212, -0.009150968864560127, -0.03321201354265213, 0.00679550739005208, -0.013437910005450249, -0.003067989135161042, 0.023366181179881096, 0.024638131260871887, 0.015110287815332413, 0.03961886838078499, 0.03394220396876335, 0.0031916508451104164, 0.001960922032594681, -0.02572164312005043, -0.02115204744040966, 0.01375589706003666, 0.011088336817920208, 0.03646254912018776, 0.08771739900112152, -0.01818416453897953, -0.02974948287010193, 0.04477733001112938, -0.011329771019518375, 0.013967888429760933, 0.03198717162013054, 0.014980737119913101, -0.011429878883063793, 0.05436405912041664, -0.014085661619901657, -0.0068072848953306675, 0.015828702598810196, -0.026051407679915428, 0.015734484419226646, 0.006471631582826376, 0.025344768539071083, -0.007113494910299778, -0.011317994445562363, -0.026522500440478325, -0.005709050688892603, 0.021269820630550385, 0.0022774371318519115, 0.017901510000228882, -0.016570674255490303, 0.015180951915681362, -0.002337795915082097, -0.05954607576131821, 0.013626346364617348, -0.014839409850537777, -0.05342187359929085, 0.018113501369953156, 0.016664892435073853, -0.0188672486692667, -0.0025556760374456644, -0.005870988592505455, -0.021069606766104698, -0.014615640975534916, -0.05003000795841217, 0.012542834505438805, -0.05205570533871651, 0.01969166100025177, 0.01059957779943943, 0.05007711797952652, 0.005782658699899912, -0.006701288744807243, -0.008438441902399063, 0.004990634508430958, -0.025933634489774704, 0.022376887500286102, 0.0069839442148804665, -0.009427735581994057, 0.019161682575941086, -0.02494434081017971, 6.781153933843598e-05, 0.0018225385574623942, -0.005167294293642044, 0.00932173989713192, -0.005114296451210976, -0.037758052349090576, 0.023142412304878235, -0.003777571953833103, 0.018125278875231743, 0.03375376760959625, 0.013673455454409122, 0.027653122320771217, 0.017194870859384537, 0.0019682827405631542, 0.01648823358118534, -0.026781601831316948, 0.015840480104088783, -0.020539626479148865, -0.03307068347930908, 0.01567559875547886, 0.007720026187598705, 0.018796585500240326, -0.012931485660374165, 0.011830306611955166, 0.013626346364617348, 0.008055679500102997, -0.01288437657058239, 0.0011512319324538112, -0.019632773473858833, 0.008285337127745152, 0.010888122022151947, 0.04308139532804489, -0.032010726630687714, 0.02426125667989254, 0.026098517701029778, -0.003783460473641753, -0.014674527570605278, 0.014968959614634514, -0.03481372445821762, -0.010452361777424812, -0.03509638085961342, -0.013850115239620209, -0.01667666994035244, -0.015169174410402775, 0.028430424630641937, -0.017607077956199646, -0.012271956540644169, -0.02494434081017971, 0.0037069080863147974, -0.037169188261032104, -0.004351715557277203, 0.0133672459051013, 0.02280087023973465, 0.0006613695295527577, 0.026616718620061874, -0.04199788346886635, -0.007896685972809792, 0.01427409891039133, 0.006713066250085831, 0.03855891153216362, -0.0015487160999327898, -0.037027858197689056, -0.03229338303208351, 0.003020879812538624, 0.0030532674863934517, 0.02864241600036621, 0.0075963642448186874, -0.01718309335410595, -0.012001077644526958, -0.0418565571308136, -0.011176666244864464, -0.00794968381524086, 0.013543905690312386, -0.02741757594048977, 0.0020801671780645847, 0.006241973955184221, 0.012295510619878769, 0.061242006719112396, 0.0017018212238326669, -0.03236404433846474, -0.024237701669335365, 0.0009075888665392995, -0.022329777479171753, 0.03535548225045204, 0.0058621554635465145, 0.01813705638051033, -0.0011313577415421605, 0.011347437277436256, -0.0021051939111202955, -0.00786135345697403, -0.004734478425234556, -0.00011952128261327744, -0.029725927859544754, 0.010440584272146225, -0.0172302033752203, 0.042374759912490845, 0.004846362862735987, -0.00622430769726634, -0.006165421102195978, -0.01764240860939026, 0.007796578574925661, -0.010057821869850159, -0.00601820508018136, -0.01763063110411167, -0.018655257299542427, 0.01950322464108467, 0.033141348510980606, -0.0008707848028279841, -0.04663814231753349, 0.008356001228094101, -0.004725645296275616, 0.010976452380418777, 0.07311353832483292, 0.020351190119981766, -0.007113494910299778, 0.01576981693506241, -0.01918523572385311, -0.011865639127790928, -0.011765532195568085, 0.00865632202476263, -0.00679550739005208, -0.048004310578107834, -0.024284811690449715, 0.028430424630641937, 0.008297114633023739, -0.011323882266879082, 0.01786617748439312, -0.019491447135806084, 0.026569608598947525, -0.008514994755387306, 0.010929343290627003, -0.005405785050243139, 0.04725056514143944, 0.014285876415669918, 0.007714137434959412, -0.03288224712014198, 8.809979044599459e-05, -0.020904723554849625, 0.02101071923971176, -0.009009641595184803, 0.03142186254262924, 0.015640266239643097, 0.013449686579406261, -0.05450538545846939, 0.0031033209525048733, 0.011588872410356998, -0.024967895820736885, 0.021823354065418243, -0.01349679660052061, -0.029843701049685478, -0.007708248682320118, 0.02664027363061905, 0.04188011214137077, 0.028665971010923386, -0.010581912472844124, 0.007649362087249756, -0.019350118935108185, 0.011482876725494862, -0.0020345300436019897, 0.003341811476275325, 0.013096367940306664, 0.02517988719046116, -0.016606006771326065, 0.009097971022129059, 0.009103859774768353, -0.0010584857081994414, -0.014262321405112743, -0.0053704530000686646, -0.0067601753398776054, 0.036297667771577835, 0.017571745440363884, 0.002638117177411914, -0.047038573771715164, -0.01726553589105606, 0.010970563627779484, -0.027700230479240417, 0.003524359781295061, 0.00028578375349752605, -0.008497328497469425, -0.0346488431096077, 0.0022259114775806665, 0.030032137408852577, -0.011842084117233753, 0.027064256370067596, -0.008591546677052975, 0.00301499105989933, 0.0009613228612579405, -0.010399363934993744, -0.021352261304855347, -0.008126343600451946, 0.008073345758020878, 0.03665098547935486, 0.03135119751095772, 0.01429765298962593, -0.04188011214137077, 0.04647326096892357, -0.041691675782203674, -0.0264047272503376, 0.036933641880750656, -0.022588878870010376, -0.014038552530109882, 0.0018725921399891376, -0.0056413309648633, 0.03888867422938347, -0.029867256060242653, 0.0170417670160532, 0.02165847085416317, 0.0379229336977005, 0.007319597527384758, -0.005417562089860439, -0.020480740815401077, -0.007107606157660484, 0.01220129244029522, 0.006071202922612429, -0.01507495529949665, 0.024732349440455437, 0.00890953466296196, 0.04331694170832634, 0.0016959324711933732, 0.0021051939111202955, -0.02280087023973465, -0.017783736810088158, -0.015640266239643097, 0.007307820487767458, -0.004010173957794905, -0.0018298993818461895, 0.004919970873743296, -0.003980730660259724, -0.004540152847766876, -0.000930407433770597, -0.024567466229200363, -0.02389615960419178, 0.024661684408783913, -0.002511511091142893, 0.011011783964931965, -0.019573887810111046, 0.02791222184896469, -0.01261349767446518, 0.0003926996432710439, -0.017713073641061783, -0.0076140305027365685, -0.020551403984427452, -0.012931485660374165, 0.008803538978099823, -0.003659798763692379, 0.0012329370947554708, 0.02668738178908825, 0.0036951308138668537, 0.009445401839911938, 0.009292297065258026, -0.027582457289099693, 0.004460655618458986, -0.018195942044258118, 0.011047115549445152, -0.0010798320872709155, 0.006289083044975996, -0.015498938970267773, -0.002591008087620139, 0.006671845447272062, 0.01763063110411167, 0.01575803942978382, -0.0076552508398890495, 0.007896685972809792, -0.029254835098981857, 0.013061035424470901, 0.007319597527384758, 0.022694874554872513, -0.07438548654317856, 0.029584599658846855, 0.013025703839957714, -0.01653534173965454, -0.03358888626098633, 0.008467885665595531, 0.016606006771326065, 0.0066247363574802876, -0.0065658497624099255, 0.012071741744875908, 0.0531863272190094, -0.011512319557368755, -0.030738776549696922, 0.020904723554849625, -0.01567559875547886, 0.01996253803372383, -0.01089401077479124, 0.04673236235976219, 0.014650972560048103, -0.007937906309962273, -0.005002412013709545, -0.0067601753398776054, -0.025603869929909706, -0.014862963929772377, -0.008791761472821236, -0.027346910908818245, -0.03153963387012482, 0.032505374401807785, -0.004472433123737574, -0.03146896883845329, 0.029301945120096207, -0.017336199060082436, -0.019620997831225395, -0.004425324033945799, -0.03822914510965347, 0.00824411679059267, 0.005052465479820967, -0.01076446007937193, -0.0042074439115822315, -0.008273559622466564, 0.01631157286465168, 0.013803006149828434, -0.013308359310030937, 0.012071741744875908, -0.007455036509782076, 0.0052085150964558125, -0.028901517391204834, 0.005797380581498146, 0.022906865924596786, 0.019385451450943947, 0.019067462533712387, -0.002929605543613434, 0.0052674016915261745, 0.008503217250108719, -0.012366174720227718, -0.0009215744212269783, 0.03926554694771767, 0.01310814544558525, -0.03460173308849335, 0.015180951915681362, -0.0006102118059061468, 0.0005240902537479997, -0.004734478425234556, 0.011117779649794102, -0.01037580892443657, 0.006135978270322084, -3.4779866837197915e-05, 0.008567992597818375, -0.004928804002702236, 0.030503230169415474, -0.027982886880636215, 0.02083406038582325, -0.0005597902345471084, -0.01832549273967743, 0.010399363934993744, -0.005031855311244726, -0.03747539594769478, 0.008485550992190838, -0.02485012263059616, 0.016700224950909615, -0.030762331560254097, -0.007873130962252617, -0.02371950075030327, 0.04458889365196228, -0.03422486037015915, -0.009769277647137642, 0.036109231412410736, 0.03594434633851051, 0.0005075284279882908, -0.013967888429760933, 0.016193799674510956, 0.007637585047632456, -0.005588333122432232, -0.023130634799599648, 0.06463387608528137, -0.03203428164124489, 0.05945185571908951, -0.007990904152393341, 0.006895614322274923, -0.002661671955138445, 0.0003569996915757656, -0.00802034791558981, -0.009604395367205143, 0.005288011860102415, 0.03523770719766617, 0.011594761162996292, -0.009704502299427986, 0.0033153125550597906, 0.0027794449124485254, 0.04192722216248512, -0.006536406464874744, -0.019585665315389633, 0.0010283063165843487, -0.025109222158789635, -0.024543913081288338, -0.022412220016121864, 0.004175056237727404, -0.0023525175638496876, 0.010811570100486279, 0.0066011818125844, 0.007349040824919939, -0.044518228620290756, -0.014921850524842739, -0.0022008847445249557, -0.023790163919329643, 0.008326557464897633, -0.022000012919306755, -0.006082979962229729, -0.020021425560116768, 0.016876883804798126, 0.022789092734456062, -0.010381697677075863, 0.019267678260803223, 0.0013175864005461335, 0.008638656698167324, 0.03274092078208923, -0.0076729170978069305, 0.008891868405044079, -0.0016944603994488716, 0.024190593510866165, -0.00845021940767765, -0.012413283810019493, -0.01891435869038105, -0.009551397524774075, 0.005856267176568508, 0.01631157286465168, -0.012283733114600182, -0.0046991463750600815, 0.009580841287970543, -0.0074491482228040695, 0.0038894563913345337, 0.04218631982803345, 0.014721636660397053, -0.0209282785654068, 0.0020021426025778055, 0.023554617539048195, 0.021646693348884583, 0.0034801948349922895, -0.0013367246137931943, 0.013614569790661335, 0.019797656685113907, -0.027747340500354767, 0.0020860559307038784, -0.020775172859430313, 0.03933621197938919, 0.03752250596880913, -0.014709859155118465, 0.04294006898999214, 0.02960815466940403, 0.00015540527238044888, -0.007908463478088379, -0.008356001228094101, 0.023648837581276894, 0.05205570533871651, 0.023648837581276894, 0.007531589362770319, 0.015204505994915962, 0.042139213532209396, -0.008096899837255478, 0.007996792905032635, -0.019432559609413147, 0.001971227116882801, 0.0029222448356449604, 0.01613491401076317, -0.005965207237750292, -0.0005182016175240278, 0.002570397686213255, 0.014062107540667057, -0.007549255155026913, 0.020574958994984627, 0.0039836750365793705, -0.019350118935108185, -0.005632498301565647, -0.0024393750354647636, 0.033188458532094955, -0.015357610769569874, -0.018796585500240326, 0.01754819042980671, -0.0066011818125844, 0.024284811690449715, 0.032104942947626114, 0.0025129832793027163, -0.012354397214949131, -0.02485012263059616, 0.01626446470618248, 0.0015928810462355614, -0.014521421864628792, 0.017018212005496025, -0.0058798217214643955, -0.026710936799645424, -0.0015472440281882882, 0.01777195930480957, 0.019161682575941086, -0.00913330353796482, 0.00036620069295167923, 0.019856542348861694, -0.006241973955184221, -0.004389991983771324, -0.0013543905224651098, 0.01754819042980671, -0.05780303478240967, 0.0018195942975580692, 0.0014795244205743074, -0.006660068407654762, 0.009457179345190525, 0.035708799958229065, -0.010240370407700539, -0.02033941261470318, 0.00904497317969799, -0.03321201354265213, -0.04633193463087082, -0.0071782697923481464, -0.004917026497423649, -0.03194006159901619]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:18:00.451949", "url_path": "/api/pydantic_graph/persistence/", "chunk_size": 4462}
updated_dt: 2025-03-15T11:18:00.451949
---
```
defbuild_snapshot_list_type_adapter(
  state_t: type[StateT], run_end_t: type[RunEndT]
) -> pydantic.TypeAdapter[list[Snapshot[StateT, RunEndT]]]:
"""Build a type adapter for a list of snapshots.
  This method should be called from within
  [`set_types`][pydantic_graph.persistence.BaseStatePersistence.set_types]
  where context variables will be set such that Pydantic can create a schema for
  [`NodeSnapshot.node`][pydantic_graph.persistence.NodeSnapshot.node].
  """
  return pydantic.TypeAdapter(list[Annotated[Snapshot[state_t, run_end_t], pydantic.Discriminator('kind')]])

```
  
---|---  
In memory state persistence.
This module provides simple in memory state persistence for graphs.
###  SimpleStatePersistence `dataclass`
Bases: `BaseStatePersistence[](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.BaseStatePersistence "pydantic_graph.persistence.BaseStatePersistence")[StateT, RunEndT]`
Simple in memory state persistence that just hold the latest snapshot.
If no state persistence implementation is provided when running a graph, this is used by default.
Source code in `pydantic_graph/pydantic_graph/persistence/in_mem.py`
```
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
```
| ```
@dataclass
classSimpleStatePersistence(BaseStatePersistence[StateT, RunEndT]):
"""Simple in memory state persistence that just hold the latest snapshot.
  If no state persistence implementation is provided when running a graph, this is used by default.
  """
  last_snapshot: Snapshot[StateT, RunEndT] | None = None
"""The last snapshot."""
  async defsnapshot_node(self, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]) -> None:
    self.last_snapshot = NodeSnapshot(state=state, node=next_node)
  async defsnapshot_node_if_new(
    self, snapshot_id: str, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]
  ) -> None:
    if self.last_snapshot and self.last_snapshot.id == snapshot_id:
      return
    else:
      await self.snapshot_node(state, next_node)
  async defsnapshot_end(self, state: StateT, end: End[RunEndT]) -> None:
    self.last_snapshot = EndSnapshot(state=state, result=end)
  @asynccontextmanager
  async defrecord_run(self, snapshot_id: str) -> AsyncIterator[None]:
    if self.last_snapshot is None or snapshot_id != self.last_snapshot.id:
      raise LookupError(f'No snapshot found with id={snapshot_id!r}')
    assert isinstance(self.last_snapshot, NodeSnapshot), 'Only NodeSnapshot can be recorded'
    exceptions.GraphNodeStatusError.check(self.last_snapshot.status)
    self.last_snapshot.status = 'running'
    self.last_snapshot.start_ts = _utils.now_utc()
    start = perf_counter()
    try:
      yield
    except Exception:
      self.last_snapshot.duration = perf_counter() - start
      self.last_snapshot.status = 'error'
      raise
    else:
      self.last_snapshot.duration = perf_counter() - start
      self.last_snapshot.status = 'success'
  async defload_next(self) -> NodeSnapshot[StateT, RunEndT] | None:
    if isinstance(self.last_snapshot, NodeSnapshot) and self.last_snapshot.status == 'created':
      self.last_snapshot.status = 'pending'
      return self.last_snapshot
  async defload_all(self) -> list[Snapshot[StateT, RunEndT]]:
    raise NotImplementedError('load is not supported for SimpleStatePersistence')

```
  
---|---  
####  last_snapshot `class-attribute` `instance-attribute`
```
last_snapshot: Snapshot[](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.Snapshot "pydantic_graph.persistence.Snapshot")[StateT, RunEndT] | None = None

```

The last snapshot.
###  FullStatePersistence `dataclass`
Bases: `BaseStatePersistence[](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.BaseStatePersistence "pydantic_graph.persistence.BaseStatePersistence")[StateT, RunEndT]`
In memory state persistence that hold a list of snapshots.
Source code in `pydantic_graph/pydantic_graph/persistence/in_mem.py`
```
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
```
|