---
url: https://ai.pydantic.dev/api/pydantic_graph/persistence/
session_id: pydantic_ai_docs
chunk_number: 6
title: Snapshotting Graph State
summary: This documentation describes a method for snapshotting the state of a graph before running the next node. It specifies the required parameters, including the state of the graph and the next node to execute, and indicates that a NodeSnapshot will be added to persistence.
embedding: [0.05411944538354874, 0.031442634761333466, 0.012422222644090652, -0.032490722835063934, 0.0009401526185683906, 0.01841299794614315, 0.01730535924434662, -0.015018622390925884, -0.003787408350035548, -0.0200565904378891, 0.025106467306613922, -0.008164365775883198, 0.03003724478185177, -0.03068038821220398, -0.029322639107704163, 0.03210959956049919, -0.040232278406620026, 0.009420880116522312, 0.04294778034090996, 0.0634569525718689, 0.025201747193932533, -0.03992261737585068, 0.02889387495815754, -0.0076522319577634335, -0.006610099226236343, 0.0009736497886478901, 0.0014016685308888555, 0.04590148106217384, 0.008992116898298264, -0.03151409700512886, 0.02610691450536251, -0.014113455079495907, -0.041756771504879, 0.002483253600075841, 0.012529413215816021, 0.025392308831214905, -0.025630511343479156, 0.025701971724629402, -0.027083542197942734, 0.0055441465228796005, 0.02651185728609562, -0.06626773625612259, 0.02436804212629795, 0.02047344297170639, 0.01566176675260067, -0.004552631638944149, 0.006889986339956522, 0.04363856464624405, 0.03411049395799637, 0.026678599417209625, -0.0434003621339798, -0.009004027582705021, 0.002416259376332164, 0.03027544543147087, -0.052594952285289764, -0.042471375316381454, -0.02944174036383629, -6.299320375546813e-05, -0.025154108181595802, -0.015054352581501007, 0.03287184610962868, 0.0014574971282854676, 0.0011575117241591215, 0.05483404919505119, -0.03489656001329422, 0.03625430911779404, -0.01942535489797592, 0.05307135730981827, -0.03225252032279968, -0.04887900501489639, 0.036301951855421066, 0.03966059535741806, -0.05683494359254837, -0.030990051105618477, -0.005838921293616295, -0.017555471509695053, 0.013113007880747318, 0.048926644027233124, 0.02312939241528511, -0.014053904451429844, 0.003784430678933859, 0.022402876988053322, -4.5331612454901915e-06, 0.02720264345407486, -0.0001699979038676247, -0.02825073152780533, -0.05888348072767258, -0.044496092945337296, 0.007253244053572416, -0.05245203152298927, 0.018115244805812836, -0.009009982459247112, -0.00470746261999011, 0.03937475383281708, 0.03939857333898544, 0.014780419878661633, 0.052594952285289764, 0.0014098567189648747, -0.046878110617399216, 0.020163780078291893, 0.012374582700431347, -0.054881688207387924, -0.05049877613782883, -0.024582423269748688, 0.040184639394283295, 0.025035006925463676, -0.019806478172540665, 0.030466007068753242, 0.010064025409519672, -0.000629745947662741, -0.10299845039844513, -0.06693469732999802, 0.010064025409519672, 0.016471652314066887, -0.045448899269104004, -0.04702103137969971, -0.012172110378742218, -0.008098860271275043, 0.014720870181918144, 0.023022200912237167, -0.0362781323492527, 0.03763588145375252, -0.04304306209087372, 0.02917971834540367, 0.040780145674943924, 0.006097965408116579, -0.011183573864400387, -0.0006152305286377668, -0.04451991245150566, 0.007884479127824306, 0.05068933963775635, -0.023331863805651665, -0.0050260573625564575, -0.05221382901072502, 0.013815702870488167, -0.007711782585829496, -0.03449161723256111, 0.022128945216536522, -0.05064169690012932, -0.022140854969620705, -0.0067827957682311535, -0.024344220757484436, -0.012142335996031761, 0.014399297535419464, 0.008474028669297695, 0.06945963948965073, -0.007991669699549675, 0.04578237980604172, -0.005404202733188868, 0.0061158305034041405, 0.040780145674943924, 0.030847130343317986, -0.041923511773347855, -0.024892086163163185, -0.002118507167324424, -0.007961894385516644, 0.005145158618688583, 0.030299266800284386, -0.02482062578201294, -0.03527768328785896, -0.03811228275299072, 0.03994643688201904, -0.00938514992594719, 0.019115692004561424, 0.011118068359792233, -0.015911879017949104, -0.0666012167930603, -0.02399882860481739, -0.04328126460313797, -0.04711631312966347, 0.009653126820921898, -0.015923788771033287, -0.02390354871749878, 0.001045854645781219, 0.03558734431862831, -0.01046301331371069, -0.049212485551834106, 0.03706419840455055, -0.0035104986745864153, -0.007777288090437651, -0.0037516779266297817, -0.027821967378258705, -0.06726818531751633, 0.018484458327293396, -0.026940621435642242, -0.013684691861271858, 0.03384847193956375, 0.018758390098810196, -0.027417024597525597, 0.003105555661022663, -0.015780868008732796, 0.03801700472831726, -0.009510206058621407, -0.0005426534335128963, -0.00010858651512535289, 0.0013480731286108494, 0.0314188152551651, 0.044353172183036804, 0.03268128260970116, 0.02010422945022583, -0.03339589014649391, 0.027821967378258705, 0.005678134970366955, -0.004388867877423763, 0.03582554683089256, -0.026249835267663002, -0.029417918995022774, -0.03301476687192917, -0.02948937937617302, -0.027035901322960854, 0.021974114701151848, -0.007634366862475872, -0.00781301874667406, -0.01593569852411747, -0.013470310717821121, 0.03806464374065399, -0.043948229402303696, 0.021283328533172607, 0.03916037082672119, 0.005919313989579678, -0.014780419878661633, 0.01419682614505291, 0.024510962888598442, 0.008212006650865078, 0.04652080684900284, 0.005752572789788246, 0.02111658826470375, -0.04954596981406212, -0.003444993169978261, 0.04189969226717949, -0.04997473210096359, -0.0021423271391540766, -0.013410760089755058, -0.010730990208685398, -0.00943279080092907, -0.044996317476034164, -0.02472534403204918, -0.028631852939724922, 0.01946108601987362, -0.025725791230797768, -0.0023715964052826166, 0.025582870468497276, -0.033372070640325546, 0.010159306228160858, 0.01841299794614315, 0.01071312464773655, -0.01588805764913559, -0.05288079380989075, 0.01855591870844364, 0.028083989396691322, 0.036111388355493546, 0.012898625805974007, 0.001536401454359293, 0.02174782194197178, -0.015495025552809238, -0.06555312871932983, 0.031752295792102814, 0.0013063878286629915, -0.01635255292057991, 0.026083094999194145, 0.04354328662157059, 0.045091595500707626, -0.04292396083474159, 0.0034956110175698996, 0.02839365229010582, -0.0004589106247294694, 0.030990051105618477, -0.024284671992063522, 0.019663557410240173, -0.031990498304367065, -0.034968022257089615, 0.015125812962651253, -0.0026440396904945374, -0.012207841500639915, -0.021831192076206207, 0.00908739771693945, -0.009373240172863007, -0.007187738548964262, 0.010069980286061764, -0.005827011074870825, 0.030108705163002014, 0.0023328885436058044, -0.00056126294657588, 0.04166148975491524, 0.0010510653955861926, 0.02322467416524887, 0.009182678535580635, 0.0395653136074543, 0.04051812365651131, -0.01662648469209671, -0.011963684111833572, -0.036063749343156815, 0.029322639107704163, 0.007485490757972002, 0.029274998232722282, -0.04542507976293564, 0.040184639394283295, -0.01449457835406065, 0.03022780641913414, -0.013077277690172195, 0.03013252466917038, -0.03370555117726326, -0.0546911284327507, 0.021450070664286613, 0.024010738357901573, 0.005922291893512011, -0.01385143306106329, -0.030418366193771362, 0.001499926787801087, -0.008718185126781464, -0.0036861724220216274, -0.01749592088162899, -0.04463901370763779, -0.02285546064376831, -0.0034330831840634346, 0.009837733581662178, 0.059741005301475525, -0.04309070110321045, 0.00792616419494152, -0.01946108601987362, 0.014720870181918144, -0.05916932225227356, 0.05564393475651741, 0.03222870081663132, -0.015256823971867561, -0.0047283051535487175, -0.05654910206794739, 0.0031383084133267403, 0.01298199687153101, 0.0005768949049524963, -0.011237168684601784, -0.02216467447578907, -0.018162885680794716, -0.014970981515944004, 0.03827902674674988, -0.03363409265875816, 0.013934804126620293, 0.01357750128954649, 0.01900850236415863, 0.05564393475651741, -0.069412000477314, -0.009927059523761272, -0.040279921144247055, -0.0184487272053957, -0.011874358169734478, 0.01709097810089588, 0.01809142529964447, 0.02770286612212658, -0.032633643597364426, -0.024796804413199425, 0.037945542484521866, 0.02211703546345234, 0.004278699401766062, 0.032038137316703796, -0.030203985050320625, 0.04020845890045166, -0.008253691717982292, -0.02825073152780533, 0.009367285296320915, 0.01841299794614315, -0.06936435401439667, -0.0230341125279665, 0.007640322204679251, -0.02734556421637535, -0.018031874671578407, -0.030704209581017494, -0.020068500190973282, -0.033229146152734756, 0.019842207431793213, 0.018484458327293396, 0.04328126460313797, 0.034682177007198334, 0.042757220566272736, 0.012005369178950787, -0.008289421908557415, 0.011189528740942478, -0.029346458613872528, 0.007134143263101578, 0.03823138400912285, 0.049021925777196884, -0.005618584342300892, 0.01744828000664711, 0.009194588288664818, 0.0012915002880617976, 0.012457952834665775, 0.022248046472668648, -0.03746914118528366, -0.008319197222590446, 0.004665777087211609, 0.017162438482046127, 0.002483253600075841, -0.02670241892337799, 0.006011617369949818, -0.003942239563912153, 0.010772675275802612, 0.02110467664897442, -0.0101473955437541, 0.039684414863586426, 0.040137000381946564, -8.2067956100218e-05, -0.024987366050481796, 0.022700630128383636, 0.009266049601137638, 0.006449312902987003, -0.0026827475521713495, -0.02028288133442402, 0.034372515976428986, 0.024141749367117882, -0.0033586451318114996, 0.01635255292057991, 0.017150528728961945, 0.03430105745792389, -0.005112405866384506, -0.055167533457279205, -0.0041328007355332375, -0.03284802660346031, -0.007163918577134609, -0.003891621483489871, -0.01813906617462635, 0.011386045254766941, -0.008420432917773724, -0.059693366289138794, -0.015637947246432304, -0.030561288818717003, -0.007348524872213602, 0.02944174036383629, 0.01931816339492798, -0.05888348072767258, 0.06474324315786362, -0.06874503195285797, 0.026226015761494637, 0.027821967378258705, 0.04785473644733429, -0.00014599163841921836, 0.0628376305103302, -0.03027544543147087, -0.004311452154070139, -0.021188048645853996, -0.01598333939909935, -0.02308175154030323, 0.01197559479624033, -0.0553104542195797, 0.016269180923700333, 0.045448899269104004, -0.04182823374867439, -0.02349860593676567, -0.035420604050159454, -0.0498318113386631, 0.01476851012557745, -0.036016110330820084, 0.0030147412326186895, 0.029346458613872528, -0.036802176386117935, -0.01698378659784794, -0.03453925624489784, -0.010355822741985321, 0.0822748914361, -0.054024163633584976, 0.047378335148096085, -0.040327560156583786, 0.002437101909890771, -0.0025428039953112602, 0.040089357644319534, 0.06259942799806595, 0.0075152660720050335, 0.001238649245351553, 0.00029235545662231743, 0.0021542373578995466, -0.006490998435765505, 0.009492340497672558, 0.035468243062496185, 5.955044616712257e-05, 0.01385143306106329, 0.008777735754847527, -0.0012535369023680687, 0.007277064491063356, -0.0013674270594492555, 0.01996130868792534, 0.013148738071322441, 0.010266496799886227, -0.0422331765294075, -0.0033467349130660295, -0.005511393770575523, 0.0037338128313422203, 0.007932119071483612, 0.01360132172703743, 0.06898323446512222, -0.014994801953434944, -0.016019068658351898, 0.016697945073246956, 0.0011575117241591215, 0.04432934895157814, 0.008432342670857906, -0.011290764436125755, 0.02665477804839611, 0.013363120146095753, -0.04049430042505264, -0.034324876964092255, 0.044805753976106644, -0.008313242346048355, -0.020032769069075584, 0.0026693486142903566, 0.005832965951412916, 0.048616982996463776, -0.015542666427791119, -0.08427578955888748, 0.02739320509135723, 0.0284412931650877, 0.03751678019762039, 0.01933007501065731, -0.0368974544107914, -0.0003357156238052994, 0.035873185843229294, -0.01730535924434662, -0.003174038603901863, 0.013958624564111233, -0.02536848932504654, 0.029608480632305145, 0.010290317237377167, -0.006300436798483133, -0.03156173601746559, -0.016840865835547447, 7.141401147237048e-05, 0.0024981412570923567, -0.01675749570131302, -0.014315926469862461, 0.036849815398454666, -0.03210959956049919, 0.044996317476034164, -0.041470929980278015, 0.016733674332499504, -0.025630511343479156, -0.019949398934841156, 0.040970705449581146, -0.038541048765182495, 0.011642111465334892, 0.0015661766519770026, -0.01071312464773655, -0.021128498017787933, 0.031942859292030334, -0.01057615876197815, 0.014649408869445324, -0.02216467447578907, -0.009057622402906418, -0.03256218135356903, -0.0019428333034738898, 0.02065209485590458, -0.022379057481884956, 0.0003377626708243042, 0.007884479127824306, 0.0006837135297246277, 0.004496058449149132, 0.01648356392979622, -0.05569157376885414, 0.02998960390686989, -0.007437850348651409, -0.01881794072687626, 0.002167636062949896, 0.013506040908396244, 0.016281090676784515, -0.010683349333703518, -0.006961446721106768, 0.015185363590717316, 0.0022778045386075974, -0.009784137830138206, 0.07222277671098709, 0.025892533361911774, 0.0184487272053957, -0.015518845990300179, 0.013744242489337921, -0.012172110378742218, -0.02052108384668827, 0.012243571691215038, -0.027869608253240585, -0.007253244053572416, 0.005499483551830053, -0.010796495713293552, -0.008593128994107246, -0.04228081554174423, -0.013398850336670876, -0.007628411985933781, -0.05245203152298927, 0.012815255671739578, 0.026035454124212265, -0.023760627955198288, 0.06150369718670845, -0.024749165400862694, 0.014113455079495907, 0.013482220470905304, -0.010314136743545532, 0.003573026740923524, -0.008825375698506832, 0.0028182247187942266, 0.010087844915688038, 0.053833600133657455, -0.004656844772398472, 0.01149323582649231, -0.00447819335386157, -0.06679178029298782, 0.00895043183118105, -0.001086051226593554, 0.014625589363276958, -0.01449457835406065, -0.00390650937333703, -0.0003293883928563446, -0.010171215981245041, 0.0007600125391036272, -0.007122233044356108, -0.037492960691452026, 0.0016555023612454534, 0.00012272974709048867, -0.00427274452522397, -0.011403909884393215, -0.024844445288181305, -0.008146501146256924, 0.010945371352136135, -0.021366698667407036, 0.048069119453430176, 0.0617418996989727, -0.04964125156402588, 0.010939416475594044, 0.0025696016382426023, 0.012446043081581593, -0.009212453849613667, 0.011386045254766941, -0.00537144998088479, -0.02948937937617302, -0.009438745677471161, -0.03832666575908661, 0.0040762280113995075, 0.0006163471261970699, -0.0024519895669072866, 0.013672782108187675, 0.007979759946465492, -0.02486826479434967, 0.023296134546399117, 0.007973804138600826, 0.011802897788584232, 0.022402876988053322, -0.0004864526854362339, 0.026249835267663002, 0.025439949706196785, -0.038898348808288574, -0.011552786454558372, 0.029560839757323265, -0.004433530382812023, -0.005356562323868275, 0.04547271877527237, -0.002956679556518793, -0.027131183072924614, -0.039088912308216095, -0.019199064001441002, 0.028203090652823448, 0.013267839327454567, -0.001595951966010034, -0.024213211610913277, 0.011433685198426247, -0.03947003558278084, -0.030061064288020134, -0.008801555261015892, -0.03320532664656639, 0.0033139821607619524, -0.005091562867164612, -0.004022632725536823, -0.006907851435244083, 0.019842207431793213, 0.01058211363852024, -0.0012289723381400108, 0.0101473955437541, 0.005642404779791832, -0.017067156732082367, 0.019496815279126167, 0.0666012167930603, -0.0037189251743257046, -0.003117465879768133, 0.019818387925624847, 0.004457350820302963, -0.0208426546305418, 0.024677705019712448, 0.02977522276341915, -0.01580468751490116, 0.019068052992224693, -0.0289891567081213, 0.031061511486768723, 0.015435474924743176, -0.03906509280204773, -0.02404646947979927, 0.014125365763902664, 0.0010927506955340505, 0.003382465336471796, -0.009933014400303364, 0.01121930405497551, 0.0020544903818517923, -0.002937325742095709, 0.00431740703061223, 0.03027544543147087, -0.01002829521894455, 0.024844445288181305, 0.013589411042630672, -0.02486826479434967, -0.004969484638422728, -0.02261725813150406, -0.045353617519140244, 0.006401672959327698, -0.01295817643404007, -0.032181061804294586, 0.0075271762907505035, 0.021557260304689407, 0.030108705163002014, -0.04714013263583183, -0.003275274531915784, 0.021283328533172607, -0.023248493671417236, 0.016459742560982704, -0.026440396904945374, -0.03234780207276344, -0.015161543153226376, 0.01698378659784794, -0.01859164796769619, -0.0203305222094059, 0.011064472608268261, 0.001316809211857617, -0.025582870468497276, -0.030394546687602997, 0.0015468228375539184, -0.004939709324389696, -0.007783242966979742, 0.004939709324389696, -0.01643592305481434, -0.011237168684601784, -0.03341970965266228, -0.018984680995345116, -0.029417918995022774, 0.019079962745308876, -0.02417748048901558, -0.00924818404018879, -0.045687101781368256, 0.010594024322926998, -0.006023527588695288, 0.025177927687764168, -0.014863790944218636, 0.0002417375799268484, -0.023165123537182808, -0.02541613020002842, -0.0047967880964279175, -0.0043293172493577, -0.020592544227838516, 0.05178506672382355, 0.0005192054086364806, -0.00231353472918272, -0.01768648251891136, 0.007277064491063356, -0.002937325742095709, -0.05073697865009308, 0.05321427807211876, 0.012005369178950787, -0.012910536490380764, -0.009075487963855267, -0.03782644122838974, 0.0449724942445755, -0.007854703813791275, -0.022152764722704887, -0.03270510584115982, 0.012255481444299221, -0.023570066317915916, -0.02675005979835987, -0.0037248802836984396, -0.004716395400464535, -0.00938514992594719, -0.0004548165306914598, -0.020783105865120888, 0.01648356392979622, -0.012553233653306961, 0.04987945407629013, 0.06836391240358353, 0.031013870611786842, 0.046044401824474335, -0.024153660982847214, -0.0036534196697175503, -0.009861554019153118, -0.002740809228271246, 0.014839970506727695, 0.025678152218461037, 0.0101473955437541, 0.032395441085100174, -0.006002684589475393, -0.019079962745308876, -0.030990051105618477, -0.02551141008734703, 0.016197720542550087, -0.04421025142073631, -0.03937475383281708, 0.025987813249230385, 0.01058211363852024, 0.01357750128954649, -0.0006334678619168699, -0.005803190637379885, -0.09313689172267914, 0.018901310861110687, -0.0038826889358460903, -0.037492960691452026, 0.030656568706035614, 0.0037993183359503746, -0.0053029670380055904, -0.0033050496131181717, 0.020914116874337196, -0.04416260868310928, -0.006663694512099028, -0.03966059535741806, -0.009933014400303364, -0.036563973873853683, 0.05216618999838829, -0.01534019410610199, 0.010266496799886227, -0.006461223121732473, 0.005651337094604969, -0.03087094984948635, -0.024749165400862694, 0.003179993713274598, -0.034563079476356506, -0.003275274531915784, 0.006383807864040136, 0.005428023170679808, -0.0012676800834015012, -0.0235819760710001, -0.0027705843094736338, 0.003025162499397993, 0.014244466088712215, -0.01863928884267807, -0.0043620700016617775, 0.02156917005777359, -0.016007158905267715, 0.029608480632305145, 0.02089029550552368, 0.030156344175338745, 0.006717290263622999, 0.023784447461366653, -0.011338404379785061, -0.03599228709936142, 0.026988262310624123, -0.01900850236415863, 0.023462874814867973, 0.010016384534537792, 0.004242969211190939, 0.0069197616539895535, -0.03663543239235878, 0.010135485790669918, 0.013327389024198055, 0.007283019367605448, 0.024010738357901573, -0.04761653393507004, 0.06436212360858917, 0.01850827783346176, -0.018877491354942322, -0.025154108181595802, -0.002593421842902899, 0.029108257964253426, -0.018675019964575768, 0.03777880221605301, -0.001374126528389752, -0.008783690631389618, 0.013434580527245998, -0.02097366563975811, 0.03132353350520134, -0.034706000238657, 0.036849815398454666, -0.03344352915883064, 0.00043322949204593897, 0.001164211193099618, -0.011201438494026661, -0.013124917633831501, 0.023558156564831734, 0.025106467306613922, 0.020259061828255653, -0.03951767459511757, -0.010200991295278072, -0.05783539265394211, 0.02055681310594082, 0.008158410899341106, 0.04220935329794884, -0.014256376773118973, -0.01579277776181698, -0.007419985253363848, -0.0012550256215035915, -0.01928243413567543, 0.02591635286808014, 0.0037189251743257046, 0.010778630152344704, 0.013386939652264118, 0.009188633412122726, -0.03489656001329422, -0.05831179395318031, -0.023701077327132225, 0.030942410230636597, -0.039636775851249695, 0.01644783280789852, 0.007467625662684441, 0.0065624588169157505, -0.009992565028369427, -0.014935251325368881, -0.008712230250239372, -0.03687363490462303, 0.010534473694860935, 0.028274551033973694, 0.015209183096885681, -0.027417024597525597, 0.04537743702530861, 0.017281539738178253, -0.0211523175239563, 0.004058362916111946, 0.003668307326734066, -0.013827613554894924, 0.002070866758003831, 0.036706894636154175, -0.012047055177390575, -0.004525833763182163, -0.034706000238657, -0.02280781976878643, 0.006556503940373659, 0.004022632725536823, 0.02382017858326435, 0.005368472542613745, 0.0104213273152709, -0.009200544096529484, -0.021783553063869476, -0.018210526555776596, 0.008896836079657078, 0.02496354654431343, 0.010641664266586304, -0.05235674977302551, 0.023200852796435356, -0.01192795392125845, -0.015602216124534607, 0.039732057601213455, -0.04075632244348526, 0.012910536490380764, -0.016090530902147293, -0.01937771402299404, -0.034968022257089615, 0.022652989253401756, -0.021640632301568985, -0.03118061274290085, 0.011284809559583664, 0.014982892200350761, -0.03406285494565964, -0.0005594019894488156, 0.022402876988053322, -0.032395441085100174, 0.02948937937617302, 0.00846807286143303, 0.04859316349029541, -0.02829837054014206, 0.06574369221925735, -0.00261128693819046, 0.014875700697302818, -0.04642552509903908, 0.026821520179510117, -0.011892223730683327, 0.013720422051846981, -0.0241298396140337, 0.018615469336509705, 0.003233589231967926, 0.018341537564992905, -0.004320384934544563, 0.013696602545678616, -0.024439502507448196, -0.02258152887225151, -0.01389907393604517, 0.022319506853818893, 0.012898625805974007, 0.04637788608670235, 0.04680664837360382, 0.03458689898252487, 0.02486826479434967, 0.024987366050481796, -0.01854400895535946, -0.018401088193058968, -0.019842207431793213, 0.04297159984707832, 0.004981394857168198, 0.027178822085261345, 0.06278999149799347, -0.03430105745792389, -0.03537296503782272, 0.034825101494789124, -0.005353584885597229, 0.02134287916123867, 0.05230911076068878, 0.020628273487091064, -0.015542666427791119, 0.049164846539497375, -0.025749612599611282, 0.009694811888039112, 0.010838180780410767, -0.04461519420146942, 0.0031383084133267403, -0.0049367318861186504, 0.006163470912724733, 0.023284222930669785, -0.012719974853098392, -0.029370279982686043, 0.025701971724629402, 0.01195177435874939, -0.018484458327293396, 0.012862895615398884, -0.005067742895334959, 0.014077724888920784, -0.011552786454558372, -0.04642552509903908, 0.011689752340316772, -0.00787256844341755, -0.050117652863264084, 0.0034956110175698996, 0.0014842947712168097, -0.01868692971765995, 0.011082337237894535, -0.00840852316468954, -0.015923788771033287, -0.01236267201602459, -0.0241298396140337, 0.005353584885597229, -0.03330060839653015, 0.02884623594582081, -0.015447385609149933, 0.03892217203974724, 0.011129978112876415, -0.03013252466917038, -0.0062766168266534805, 0.03480127826333046, -0.038493406027555466, -0.004406732972711325, 0.02390354871749878, 0.004108980763703585, 0.023784447461366653, -0.011576605960726738, 0.010903686285018921, 0.027512304484844208, 0.0037606104742735624, -0.012970087118446827, -0.043305084109306335, -0.026464218273758888, 0.026916800066828728, -0.006157516036182642, 0.021783553063869476, 0.04382912814617157, 0.028203090652823448, 0.023736806586384773, 0.005422067828476429, -0.01176716759800911, 0.00986750889569521, -0.028036348521709442, 4.647726018447429e-05, -0.00476403534412384, -0.010528518818318844, -0.010969191789627075, 0.0011441129026934505, 0.011969638988375664, -0.009629307314753532, 0.029703762382268906, -0.008122680708765984, 0.011570651084184647, -0.015614126808941364, -0.003897576592862606, -0.0173530001193285, 0.03396757319569588, 0.025058826431632042, 0.02536848932504654, -0.01357750128954649, 0.012207841500639915, -0.002227186691015959, -0.008479983545839787, -0.008146501146256924, -0.012231661006808281, -0.044305529445409775, 0.0008508269675076008, -0.01772221177816391, -0.006800660863518715, 0.0008255180437117815, 0.01585232838988304, 0.010891776531934738, -0.002456455724313855, -0.01598333939909935, -0.006437403149902821, -0.029751401394605637, 0.004644934553653002, -0.01504244189709425, 0.007437850348651409, 0.032538361847400665, -0.005993752274662256, 0.03334824740886688, -0.04640170559287071, -0.006175381131470203, 0.03022780641913414, 0.006580323912203312, 0.033276788890361786, 0.006169426254928112, -0.06245650723576546, -0.026821520179510117, -0.0047283051535487175, -0.01607861928641796, 0.005270214285701513, 0.010945371352136135, -0.002903084270656109, -0.011266943998634815, -0.030299266800284386, -0.003709992626681924, -0.007687962148338556, -0.012457952834665775, -0.0009051667293533683, -0.02853657305240631, 0.018984680995345116, 0.013458400033414364, 0.06807807087898254, 0.025654330849647522, -0.01385143306106329, -0.041423290967941284, 0.01726962812244892, -0.02295074053108692, 0.019020412117242813, 0.004135778173804283, 0.028608033433556557, -0.02541613020002842, 0.0038945991545915604, -0.017805583775043488, -0.014327837154269218, 0.010129530914127827, -0.011731437407433987, -0.013172558508813381, 0.01588805764913559, 0.0013249973999336362, 0.030656568706035614, 0.0083847027271986, 0.02326040342450142, -0.006753020454198122, -0.0025472701527178288, 0.002929881913587451, -0.009998519904911518, -0.03932711482048035, -0.011880313977599144, -0.034229595214128494, 0.023712987080216408, 0.031347353011369705, -0.01978265680372715, -0.050308216363191605, 0.014720870181918144, 0.003114488208666444, 0.03484892100095749, 0.0763198509812355, 0.008575264364480972, -0.004299541935324669, 0.00017948876484297216, -0.0070090871304273605, -0.010641664266586304, 0.014697049744427204, 0.01859164796769619, 0.0023120460100471973, -0.04761653393507004, -0.025773432105779648, 0.05107046291232109, 0.005696000065654516, 0.014708959497511387, -0.007622457109391689, -0.01950872503221035, 0.01667412370443344, -0.0017329179681837559, -0.019997039809823036, -0.014732779935002327, 0.04897428676486015, 0.03365791216492653, -0.007771333213895559, -0.008176276460289955, 0.012696154415607452, -0.022105125710368156, -0.004001789726316929, 0.0075271762907505035, 0.038445767015218735, 0.004850383847951889, 0.026416577398777008, -0.04401968792080879, -0.002051512710750103, 0.005505438428372145, -0.029608480632305145, 0.015780868008732796, 0.019568275660276413, -0.003620666917413473, -0.0013391405809670687, 0.040684863924980164, 0.049069564789533615, 0.015161543153226376, -0.0013041547499597073, -0.020080409944057465, 0.022819729521870613, 0.0018311761086806655, -0.014387387782335281, -0.0009997030720114708, 0.004975439514964819, 0.033133868128061295, -0.01662648469209671, 0.005020102486014366, 0.0010562760289758444, -0.01538783498108387, -0.021330969408154488, -0.01809142529964447, -0.011987504549324512, 0.05893111974000931, 0.024034559726715088, 0.009438745677471161, -0.05111810192465782, -0.015768958255648613, 0.010844135656952858, 0.0002449011954013258, -0.010034250095486641, -0.014851881191134453, 0.0049486421048641205, -0.02083074487745762, 0.002964123385027051, 0.028703313320875168, -0.015911879017949104, 0.021866923198103905, -0.012755705043673515, -0.00822391640394926, -0.015423565171658993, -0.006538638845086098, -0.010945371352136135, 0.011231213808059692, 0.009152903221547604, 0.012850985862314701, 0.03539678454399109, 0.001847552484832704, -0.05683494359254837, 0.03022780641913414, -0.02161681093275547, -0.03072802908718586, 0.03363409265875816, -8.792995504336432e-05, -0.027131183072924614, 0.015911879017949104, 0.007414030376821756, 0.014982892200350761, -0.010314136743545532, 0.011844583787024021, 0.013148738071322441, 0.030466007068753242, 0.02065209485590458, -0.02839365229010582, -0.04299541935324669, 0.006461223121732473, 0.025225568562746048, 0.019723108038306236, -0.0020485352724790573, 0.031752295792102814, 0.03399139270186424, 0.012076830491423607, 0.02184310369193554, -0.0002921693667303771, -0.017007606104016304, 0.01000447478145361, -0.013720422051846981, 0.007741557899862528, -0.006973356939852238, -0.018162885680794716, 0.011296719312667847, -0.015054352581501007, -0.003397352760657668, -0.005984819494187832, -0.031347353011369705, -0.012291211634874344, 0.031942859292030334, -0.0029001065995544195, 0.0014947161544114351, -0.008325152099132538, 0.023927368223667145, -0.015923788771033287, 0.0024683659430593252, -0.021080857142806053, -0.022510068491101265, -0.005410158075392246, -0.005014147609472275, 0.013410760089755058, 0.0027512304950505495, -0.026226015761494637, 0.007479535881429911, 0.00927795935422182, 0.00454667629674077, -0.0011865425622090697, -0.02065209485590458, -0.008896836079657078, -0.009950879029929638, 0.020961755886673927, -0.003331847256049514, -0.007384255062788725, -0.00484442850574851, -0.001563199213705957, 0.017698392271995544, 0.0050260573625564575, 0.04139946773648262, 0.024379951879382133, -0.004141733516007662, -0.015911879017949104, 0.0030817354563623667, 0.029799042269587517, 0.00507369777187705, -0.08865869790315628, 0.026726240292191505, 0.01598333939909935, -0.01757929101586342, -0.03277656435966492, 0.0036147120408713818, 0.014887611381709576, 0.018246255815029144, -0.026035454124212265, -0.01451839879155159, 0.04456755146384239, -0.02739320509135723, -0.015530755743384361, 0.020175689831376076, -0.019758837297558784, 0.012946266680955887, -0.01996130868792534, 0.026630958542227745, 0.04404350742697716, 0.013077277690172195, -0.00867650005966425, 0.0033586451318114996, -0.04511541500687599, -0.010862001217901707, -0.005618584342300892, -0.028226910158991814, -0.006395717617124319, 0.007390209939330816, 0.013529861345887184, -0.016697945073246956, 0.010022339411079884, -0.004228081554174423, -0.04080396518111229, 0.016459742560982704, -0.025582870468497276, 0.017710302025079727, 0.00014375850150827318, -0.016197720542550087, -0.0009840710554271936, -0.010594024322926998, 0.0427810400724411, 0.03146645426750183, -0.012481773272156715, 0.00955189112573862, 0.026940621435642242, 0.0010190570028498769, -0.039231833070516586, -0.025130286812782288, 0.038445767015218735, 0.014899521134793758, 0.04116126894950867, 0.007938073948025703, 0.002064911648631096, -0.006854256149381399, -0.025297028943896294, -0.016424013301730156, 0.021128498017787933, 0.0048771812580525875, -0.017924683168530464, 0.027964888140559196, -0.012565143406391144, -0.005288079380989075, 0.006943581625819206, 0.010927506722509861, 0.003957127220928669, -0.010522563941776752, 0.005880606360733509, 0.014423117972910404, -0.0014694072306156158, 0.006717290263622999, -0.02675005979835987, 0.03827902674674988, 0.012291211634874344, -0.028703313320875168, -0.0047193728387355804, -0.0026499947998672724, -0.04228081554174423, -0.0056930226273834705, -0.04204261302947998, 0.007622457109391689, -0.038398128002882004, 0.012755705043673515, -0.024558603763580322, 0.025058826431632042, -0.05107046291232109, 0.008140545338392258, 0.018925130367279053, 0.03191903978586197, 0.024439502507448196, -0.012779525481164455, -0.007330659776926041, 0.04680664837360382, 0.0021884788293391466, -0.039136551320552826, 0.03375319018959999, -0.003972014412283897, 0.045496538281440735, -0.001664434908889234, -0.012094695121049881, -0.004311452154070139, -0.0002153120731236413, 0.030942410230636597, -0.036516331136226654, 0.001124014612287283, 0.01983029767870903, -0.004823585972189903, 0.01585232838988304, -0.017436370253562927, 0.001129969721660018, 0.028465112671256065, -0.008563353680074215, -0.009004027582705021, 0.010903686285018921, -0.029060617089271545, -0.012624694034457207, 0.01167784258723259, -0.011713572777807713, 0.014292106963694096, 0.020937936380505562, 0.008271556347608566, 0.03122825361788273, -0.033229146152734756, -0.0008768803090788424, -0.010230766609311104, -0.012767615728080273, 0.007288974244147539, -0.04101834446191788, -0.015518845990300179, -0.005419090390205383, 0.002481764880940318, -0.005731730256229639, -0.00279440451413393, 0.04113744571805, 0.003992857411503792, -0.004463305696845055, 0.04047048091888428, -0.01690041646361351, 0.014268286526203156, -0.023153211921453476, 0.011779078282415867, -0.029060617089271545, -0.014137275516986847, -0.032038137316703796, -0.018246255815029144, -0.003486678469926119, -0.006002684589475393, -0.0048086983151733875, -0.009784137830138206, 0.006687514949589968, 0.001773114432580769, -0.007288974244147539, 0.0082477368414402, 0.01667412370443344, -0.009694811888039112, -0.013184468261897564, 0.011969638988375664, 0.013470310717821121, -0.01969928666949272, -0.02184310369193554, 0.018067603930830956, 0.008664589375257492, -0.027012081816792488, -0.028155449777841568, -0.013768062926828861, 0.008348972536623478, 0.042114075273275375, 0.0086586344987154, 0.02092602662742138, 0.03539678454399109, 0.004880158696323633, 0.018794119358062744, -0.043114520609378815, 0.006735155358910561, 0.04113744571805, -0.003269319422543049, 0.005594764370471239, 0.01725771836936474, 0.04218553379178047, 0.009164812974631786, 0.016007158905267715, -0.011689752340316772, 0.02382017858326435, -0.012047055177390575, 0.03768352046608925, 0.0020664003677666187, -0.004269767086952925, 0.003331847256049514, 0.015971429646015167, -0.009760317392647266, -0.00840852316468954, 0.0031680837273597717, 0.0018430862110108137, 0.0202947910875082, -0.006169426254928112, 0.015137722715735435, -0.00968885701149702, 0.0053029670380055904, 0.01900850236415863, -0.0022852483671158552, 0.023069841787219048, 0.005648359656333923, 0.012422222644090652, 0.0035819592885673046, 0.0007808551890775561, 0.022009843960404396, -0.005606674123555422, 0.0005724286311306059, 0.01417300570756197, -0.028417471796274185, -0.02889387495815754, 0.01900850236415863, 0.021080857142806053, 0.007717737462371588, 0.0009729053708724678, -0.03461071848869324, 0.014065815135836601, -0.006693469826132059, -0.0015736204804852605, 0.004368024878203869, 0.0015393790090456605, -0.05526281148195267, 0.01818670518696308, -0.0028256685473024845, -0.026964440941810608, -0.018401088193058968, 0.01355368085205555, 0.009933014400303364, 0.019199064001441002, 0.003790385788306594, -0.014482667669653893, -0.028417471796274185, -0.023188943043351173, 0.006693469826132059, -0.02399882860481739]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:59.934949", "url_path": "/api/pydantic_graph/persistence/", "chunk_size": 4677}
updated_dt: 2025-03-15T11:17:59.934949
---
```

Snapshot the state of a graph, when the next step is to run a node.
This method should add a [`NodeSnapshot`](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.NodeSnapshot) to persistence.
Parameters:
Name | Type | Description | Default  
---|---|---|---  
`state` |  `StateT` |  The state of the graph. |  _required_  
`next_node` |  `BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.BaseNode "pydantic_graph.nodes.BaseNode")[StateT, Any[](https://docs.python.org/3/library/typing.html#typing.Any "typing.Any"), RunEndT]` |  The next node to run. |  _required_  
Source code in `pydantic_graph/pydantic_graph/persistence/__init__.py`
```
112
113
114
115
116
117
118
119
120
121
122
```
| ```
@abstractmethod
async defsnapshot_node(self, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]) -> None:
"""Snapshot the state of a graph, when the next step is to run a node.
  This method should add a [`NodeSnapshot`][pydantic_graph.persistence.NodeSnapshot] to persistence.
  Args:
    state: The state of the graph.
    next_node: The next node to run.
  """
  raise NotImplementedError

```
  
---|---  
####  snapshot_node_if_new `abstractmethod` `async`
```
snapshot_node_if_new(
  snapshot_id: str[](https://docs.python.org/3/library/stdtypes.html#str),
  state: StateT,
  next_node: BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.BaseNode "pydantic_graph.nodes.BaseNode")[StateT, Any[](https://docs.python.org/3/library/typing.html#typing.Any "typing.Any"), RunEndT],
) -> None

```

Snapshot the state of a graph if the snapshot ID doesn't already exist in persistence.
This method will generally call [`snapshot_node`](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.BaseStatePersistence.snapshot_node) but should do so in an atomic way.
Parameters:
Name | Type | Description | Default  
---|---|---|---  
`snapshot_id` |  `str[](https://docs.python.org/3/library/stdtypes.html#str)` |  The ID of the snapshot to check. |  _required_  
`state` |  `StateT` |  The state of the graph. |  _required_  
`next_node` |  `BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.BaseNode "pydantic_graph.nodes.BaseNode")[StateT, Any[](https://docs.python.org/3/library/typing.html#typing.Any "typing.Any"), RunEndT]` |  The next node to run. |  _required_  
Source code in `pydantic_graph/pydantic_graph/persistence/__init__.py`
```
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
```
| ```
@abstractmethod
async defsnapshot_node_if_new(
  self, snapshot_id: str, state: StateT, next_node: BaseNode[StateT, Any, RunEndT]
) -> None:
"""Snapshot the state of a graph if the snapshot ID doesn't already exist in persistence.
  This method will generally call [`snapshot_node`][pydantic_graph.persistence.BaseStatePersistence.snapshot_node]
  but should do so in an atomic way.
  Args:
    snapshot_id: The ID of the snapshot to check.
    state: The state of the graph.
    next_node: The next node to run.
  """
  raise NotImplementedError

```
  
---|---  
####  snapshot_end `abstractmethod` `async`
```
snapshot_end(state: StateT, end: End[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.End "pydantic_graph.nodes.End")[RunEndT]) -> None

```

Snapshot the state of a graph when the graph has ended.
This method should add an [`EndSnapshot`](https://ai.pydantic.dev/api/pydantic_graph/persistence/#pydantic_graph.persistence.EndSnapshot) to persistence.
Parameters:
Name | Type | Description | Default  
---|---|---|---  
`state` |  `StateT` |  The state of the graph. |  _required_  
`end` |  `End[](https://ai.pydantic.dev/api/pydantic_graph/nodes/#pydantic_graph.nodes.End "pydantic_graph.nodes.End")[RunEndT]` |  data from the end of the run. |  _required_  
Source code in `pydantic_graph/pydantic_graph/persistence/__init__.py`
```
140
141
142
143
144
145
146
147
148
149
150
```
| ```
@abstractmethod
async defsnapshot_end(self, state: StateT, end: End[RunEndT]) -> None:
"""Snapshot the state of a graph when the graph has ended.
  This method should add an [`EndSnapshot`][pydantic_graph.persistence.EndSnapshot] to persistence.
  Args:
    state: The state of the graph.
    end: data from the end of the run.
  """
  raise NotImplementedError

```
  
---|---  
####  record_run `abstractmethod`
```
record_run(
  snapshot_id: str[](https://docs.python.org/3/library/stdtypes.html#str),
) -> AbstractAsyncContextManager[](https://docs.python.org/3/library/contextlib.html#contextlib.AbstractAsyncContextManager "contextlib.AbstractAsyncContextManager")[None]