---
url: https://ai.pydantic.dev/api/models/openai/
session_id: pydantic_ai_docs
chunk_number: 4
title: Processing Responses in OpenAI Models
summary: This section outlines methods for processing both non-streamed and streamed responses from the OpenAI API. The non-streamed response method processes the completion response into a structured format, while the streamed response method adapts to handle incoming data in real-time.
embedding: [0.010001837275922298, 0.018817733973264694, -0.00938466377556324, -0.02613910287618637, 0.005869196727871895, -0.045089952647686005, -0.00570280198007822, 0.0033490725327283144, 0.028970837593078613, 0.0023688562214374542, 0.03536039590835571, -0.04521096497774124, 0.008900606073439121, 0.02589707262814045, -0.036643147468566895, -0.026090696454048157, -0.006359304767102003, 0.028753012418746948, 0.007841730490326881, 0.06312108784914017, 0.039474885910749435, 0.0071761514991521835, -0.013263174332678318, 0.0232105553150177, 0.012537088245153427, 0.001017277012579143, -0.01778911054134369, 0.07154369354248047, -0.03020518459379673, -0.029406489804387093, 0.01644585095345974, -0.01466694101691246, -0.0538271889090538, -0.07076919823884964, 0.02613910287618637, -0.005711877718567848, -0.03569923713803291, 0.033182136714458466, 0.0011488801101222634, 0.023500988259911537, 0.012827522121369839, -0.026550550013780594, -0.020136790350079536, 0.029188664630055428, -0.015683460980653763, 0.04424285143613815, -0.03373880311846733, 0.022690191864967346, -0.006480318959802389, 0.030689241364598274, -0.031802572309970856, 0.030665040016174316, 0.03589285910129547, -0.024977363646030426, -0.018442587926983833, -0.0009121457696892321, -0.052181392908096313, 0.00034092014539055526, -0.022823307663202286, 0.0022750699426978827, -0.019362296909093857, -0.0454045869410038, -0.015828678384423256, -0.019483312964439392, -0.03635271266102791, -0.02935808338224888, -0.05566660687327385, 0.0016563840908929706, -0.02882562018930912, 0.026477942243218422, -0.018152154982089996, 0.015078389085829258, -0.025945479050278664, 0.000744994671549648, -0.020536137744784355, -0.004032803699374199, -0.01029227115213871, 0.024360191076993942, -0.008325788192451, -0.010709770955145359, -0.02596968226134777, -0.00028703093994408846, -0.030229387804865837, -0.026550550013780594, -0.028970837593078613, -0.03323054313659668, -0.07919179648160934, -0.0322866328060627, -0.026550550013780594, -0.034295469522476196, -0.033714599907398224, 0.03310953080654144, -0.03388402238488197, 0.02848678082227707, 0.0757065862417221, 0.01140560396015644, -0.01042538695037365, 0.019350197166204453, 0.025509826838970184, 0.020027875900268555, 0.05421443283557892, 0.0027318992651998997, -0.05189095810055733, 0.012815420515835285, 0.04731661453843117, -0.030786054208874702, 0.0035941265523433685, 0.007539194542914629, -0.04223401099443436, -0.013359985314309597, -0.04383140057325363, 0.004698382690548897, -0.03199619799852371, 0.012083283625543118, -0.011375349946320057, -0.023198453709483147, -0.009632742963731289, 0.004634850192815065, 0.0009832417126744986, 0.003173601580783725, -0.03269807994365692, -0.0005808689165860415, 0.0040902853943407536, -0.035675033926963806, -0.028704605996608734, -0.030689241364598274, 0.01765599474310875, -0.06283065676689148, -0.04528357461094856, -0.001542933052405715, 0.029648518189787865, 0.016094909980893135, 0.00621408736333251, -0.07135006785392761, -0.012046979740262032, -0.0023824702948331833, -0.011278538033366203, -0.0011761083733290434, -0.021298527717590332, 0.0006254930049180984, -0.013831941410899162, -0.014243390411138535, -0.05532776564359665, 0.003427731804549694, -0.03388402238488197, -0.005478925071656704, -0.036013875156641006, -0.003842205973342061, -0.03410184755921364, -0.028849823400378227, -0.01967693492770195, 0.013263174332678318, -0.046130675822496414, 0.028680402785539627, 0.00834394060075283, -0.007121695205569267, 0.021141208708286285, 0.02976953238248825, 0.04286328703165054, -0.04402502626180649, -0.019822152331471443, -0.01597389578819275, -0.044484879821538925, -0.003476137528195977, -0.02149214968085289, -0.05116487294435501, -0.006114250514656305, 0.009541982784867287, -0.04269386827945709, -0.017547082155942917, 0.005152186378836632, 0.0003838424163404852, -0.051310088485479355, 0.028777215629816055, 0.005512204021215439, -0.039474885910749435, -0.05387559533119202, -0.06224978715181351, -0.015066288411617279, -0.039837926626205444, -0.03613488748669624, 0.009929228574037552, -0.04571922495961189, -0.030084170401096344, -0.03753865510225296, 0.005838942714035511, 0.02037881873548031, 0.009390714578330517, 0.011986472643911839, 0.02162526547908783, -0.004677204880863428, 0.030350401997566223, 0.055618200451135635, 0.01467904169112444, 0.0026154229417443275, -0.03277068957686424, 0.0766746997833252, -0.033448368310928345, -0.012682304717600346, 0.0021858219988644123, 0.012065132148563862, 0.02079026773571968, 0.04196777939796448, -0.043976619839668274, 0.02933388203382492, -0.013892448507249355, -0.011744443327188492, 0.04780067130923271, -0.026477942243218422, -0.04995472729206085, 0.012670204043388367, -0.045089952647686005, 0.02684098482131958, 0.009656946174800396, -0.020947586745023727, -0.02717982605099678, -0.050196755677461624, -0.004698382690548897, -0.06249181553721428, 0.020124688744544983, -0.04179836064577103, 0.07110803574323654, 0.03911184147000313, 0.01981005072593689, -0.03589285910129547, 0.03400503471493721, -0.008101911284029484, -0.04041879624128342, -0.019785847514867783, -0.007823578082025051, -0.003690937999635935, 0.009088178165256977, -0.0011738393222913146, -0.013989260420203209, 0.005796588025987148, -0.07711035013198853, 0.027567071840167046, -0.010758176445960999, 0.04985791817307472, -0.019398601725697517, -0.0031312466599047184, -0.006861514411866665, 0.038288943469524384, 0.001002150122076273, 0.019955268129706383, 0.023585699498653412, 0.008428649976849556, -0.024977363646030426, 0.01927758753299713, 0.05029356852173805, 0.06118486076593399, -0.06428282707929611, -0.0016624347772449255, -0.0055333818309009075, -0.028341563418507576, -0.019289689138531685, 0.01657896675169468, 0.02058454230427742, -0.059345442801713943, -0.0023703686892986298, 0.023694612085819244, 0.06215297430753708, -0.0403703898191452, 0.024602219462394714, -0.0038028762210160494, -0.021879397332668304, 0.014098173007369041, -0.029479097574949265, 0.027083013206720352, -0.013952955603599548, 0.034731119871139526, 0.030568227171897888, 0.023537293076515198, 0.00038024981040507555, -0.050099946558475494, -0.0003097211301792413, 0.02872880920767784, 0.013904550112783909, 0.015477736480534077, -0.042935896664857864, -0.002501972019672394, 0.024783741682767868, 0.056925155222415924, 0.020741861313581467, -0.00926970038563013, -0.00023824702657293528, 0.030277792364358902, -0.04334734380245209, -0.0018802606500685215, -0.014812157489359379, -0.016966212540864944, 0.03419865667819977, 0.003869434120133519, -0.017982734367251396, 0.04985791817307472, 0.0383373498916626, 0.021806787699460983, -0.005494052078574896, 0.009124482981860638, 0.009898974560201168, -0.00016374755068682134, 0.009632742963731289, 0.009802163578569889, 0.01981005072593689, -0.00943306926637888, 0.006873615551739931, 0.008906656876206398, -0.027470260858535767, 0.01839418336749077, -0.010298321954905987, 0.04177415743470192, 0.043540965765714645, -0.04584024101495743, -0.029043447226285934, -0.016119113191962242, -0.010776328854262829, -0.0013356959680095315, -0.010062344372272491, 0.0437345914542675, -0.02371881529688835, -0.026211710646748543, 0.030132576823234558, -0.009481474757194519, 0.0039692712016403675, 0.00923339556902647, 0.03591706231236458, 0.009178939275443554, 0.013214767910540104, 0.004764940589666367, 0.05024516209959984, -0.005472874268889427, -0.0296001136302948, -0.01964063011109829, 0.040176767855882645, 0.032335035502910614, 0.009832416661083698, -0.027978520840406418, -0.015029983595013618, 0.04286328703165054, 0.017038822174072266, -0.004069108050316572, -0.033182136714458466, -0.0645732656121254, 0.01207723282277584, -0.0003274951013736427, 0.0004265756288077682, 0.023767219856381416, 0.0322866328060627, -0.02831736020743847, 0.0025534029118716717, 0.005109831225126982, 0.003957169596105814, 0.007853832095861435, -0.007793324999511242, -0.0010044191731140018, 0.02011258713901043, 0.016796793788671494, -0.0027999698650091887, 0.012416073121130466, -0.010001837275922298, 0.005445646122097969, 0.014751650393009186, 0.002184309298172593, -0.021346934139728546, -0.016506358981132507, 0.0649121031165123, 0.010540351271629333, -0.04419444501399994, -0.024602219462394714, -0.03981372341513634, -0.0040902853943407536, -0.012936435639858246, -0.031003879383206367, 0.004870828241109848, -0.05905500799417496, -0.015029983595013618, -0.016240127384662628, 0.03260126709938049, -0.013057449832558632, 0.026381131261587143, 0.05905500799417496, -0.0017244546907022595, -0.012948536314070225, -0.0010187895968556404, -0.00480124494060874, 0.03243184834718704, 0.03139112517237663, 0.0066376375034451485, -0.05271385610103607, 0.031028082594275475, 0.01563505455851555, -0.07052716612815857, -0.030084170401096344, 0.029406489804387093, 0.04799429699778557, 0.06781645119190216, 0.0037242169491946697, 0.035263583064079285, 0.024565914645791054, -0.008216874673962593, 0.02071765810251236, 0.027083013206720352, 0.012282957322895527, 0.02109280228614807, -0.007393977604806423, 0.03925705701112747, -0.00033562578028067946, -0.006940173450857401, 0.03993473947048187, 0.02166157029569149, 0.06481529027223587, -0.05905500799417496, 0.019652731716632843, -0.0015565472422167659, 0.030616633594036102, -0.04632429778575897, -0.002842324785888195, 0.02529200166463852, 0.02128642611205578, -0.01876932755112648, -0.014013462699949741, -0.04208879545331001, -0.003869434120133519, 0.011768646538257599, -0.034295469522476196, 0.04668734222650528, 0.034731119871139526, -0.05566660687327385, 0.03635271266102791, -0.000349239882780239, -0.03804691508412361, -0.01358991302549839, 0.05721559002995491, 0.006341152358800173, -0.0014362891670316458, -0.004398872144520283, 0.0007113375468179584, 0.006692094262689352, -0.038724593818187714, -0.01803113892674446, 0.0339808315038681, -0.04351676255464554, -0.006159631069749594, 0.038458362221717834, -0.023864032700657845, -0.017619691789150238, -0.03054402396082878, 0.017885923385620117, -0.027083013206720352, -0.012452377937734127, 0.013577811419963837, -0.021806787699460983, 0.028535187244415283, 0.00482544768601656, -0.0454045869410038, -0.06767123192548752, 0.026308521628379822, 0.050535596907138824, 0.04390401020646095, -0.014836360700428486, 0.057506024837493896, 0.0011443420080468059, 0.016929909586906433, 3.583159559639171e-05, -0.014824259094893932, 0.0012396408710628748, -0.038095321506261826, 0.022351352497935295, -0.0036183292977511883, 0.0265747532248497, -0.014267593622207642, 0.04826052859425545, -0.004314161837100983, -0.005690700374543667, 0.022206135094165802, -0.07406079024076462, 0.029237069189548492, 0.039208654314279556, 0.005258074030280113, 0.025001566857099533, 0.0016170544549822807, -0.025485623627901077, 0.003554796800017357, 0.018793530762195587, -0.015126795507967472, 0.08795323967933655, -0.0069341231137514114, -0.036909379065036774, 0.006613434758037329, 0.05949065834283829, -0.008138216100633144, 0.012488681823015213, -0.02529200166463852, -0.01264600083231926, 0.00931810587644577, -0.0128638269379735, -0.022895917296409607, 0.014194984920322895, 0.02260548248887062, 0.028680402785539627, -0.05460168048739433, -0.02216983027756214, 0.004988817032426596, 0.011496364139020443, -0.00528832757845521, 0.045695021748542786, 0.001931691775098443, 0.01444911491125822, 0.012609696015715599, 0.04610647261142731, -0.011308792047202587, -0.013662521727383137, -0.010812632739543915, 0.00634720316156745, 0.014618534594774246, 0.022787004709243774, -0.006510572507977486, -0.019834253937005997, 0.00812611449509859, 0.009759807959198952, 0.0015868007903918624, -0.0082410778850317, 0.015223606489598751, 0.0005014532362110913, 0.002265993971377611, -0.00928180105984211, -0.02717982605099678, -0.01846679113805294, -0.03373880311846733, 0.02247236669063568, 0.061572108417749405, 0.006764702964574099, 0.022048816084861755, 0.01954381912946701, -0.021746281534433365, -0.007599702104926109, -0.02145584672689438, 0.008204773999750614, -0.0019301790744066238, 0.009699300862848759, -0.03461010754108429, 0.01826106756925583, -0.027639679610729218, -0.014824259094893932, 0.010401184670627117, 0.009590388275682926, 0.024904755875468254, 0.019652731716632843, 0.012803319841623306, -0.011811001226305962, 0.01158712524920702, -0.0267441738396883, 0.009360460564494133, -0.03949908912181854, 0.012500783428549767, 0.0181642547249794, -0.021818889304995537, 0.013759332709014416, -0.015949692577123642, -0.016566865146160126, 0.022109324112534523, 0.012682304717600346, 0.042330823838710785, 0.010237814858555794, -0.03349677473306656, 0.03485213592648506, 0.0353119894862175, 0.013275275006890297, -0.010836835950613022, 0.006988579407334328, -0.0012146816588938236, -0.010370930656790733, -0.011441907845437527, -0.05910341441631317, 0.007345571648329496, -0.0030177957378327847, 0.034053441137075424, 0.005388164427131414, -0.054069217294454575, -0.023053236305713654, -0.006419811863452196, -0.014437013305723667, -0.00586012052372098, -0.003276463830843568, -0.0294306930154562, 0.009929228574037552, -0.011968320235610008, 0.013251072727143764, -0.03151214122772217, -0.02761547639966011, 0.03175416961312294, -0.03158474713563919, -0.0008107962203212082, 0.024832146242260933, -0.027228230610489845, -0.02993895299732685, -0.006813108455389738, -0.018019039183855057, -0.04668734222650528, -0.014255492016673088, 0.051987770944833755, -0.005500102881342173, -0.022206135094165802, 0.0012903156457468867, -0.021080702543258667, -0.006897818762809038, 0.03153634071350098, -0.0189992543309927, -0.021334832534193993, 0.01765599474310875, 0.03572344034910202, -0.0004995624185539782, -0.006099123973399401, -0.01806744374334812, 0.02492895908653736, -0.009675098583102226, 0.01476375199854374, -0.0043020606972277164, 0.050971247255802155, -0.0003448909264989197, -0.020366717129945755, 0.042500242590904236, 0.015985997393727303, 0.0019150523003190756, 0.01140560396015644, -0.0035457208286970854, 0.014606432989239693, -0.005227820482105017, 0.026018086820840836, 0.03030199557542801, 0.05411762371659279, -0.0011768646072596312, 0.032238226383924484, 0.024711132049560547, -0.026453739032149315, 0.04022517427802086, 0.07038195431232452, -0.03446488827466965, -0.0033702498767524958, -0.03693358227610588, 0.007345571648329496, 0.01947121135890484, 0.008483106270432472, -0.01563505455851555, -0.004955538082867861, 0.007418180350214243, -0.019991572946310043, 0.029309678822755814, 0.0040781837888062, -0.008761439472436905, 0.015042085200548172, -0.03148793801665306, -0.015199404209852219, 0.005006968975067139, 0.013069551438093185, -0.014691143296658993, -0.010086546652019024, 0.010165206156671047, -0.003908763639628887, 0.02281120792031288, -0.02892243303358555, 0.010564553551375866, -0.0013992285821586847, 0.0443880669772625, 0.0020995992235839367, 0.029817938804626465, 0.006710246205329895, 0.018103748559951782, 0.028196346014738083, -0.004746788181364536, -0.021032296121120453, 0.00460762158036232, 0.01910816691815853, -0.03458590433001518, 0.04296009987592697, -0.02459011785686016, 0.010879190638661385, -0.03787749633193016, 0.0185030959546566, 0.008906656876206398, -0.020838672295212746, -0.01971323974430561, -0.04668734222650528, 0.02223033830523491, 0.03744184225797653, -0.008204773999750614, 0.039208654314279556, -0.001350066508166492, -0.013323681429028511, 0.010667416267096996, -0.012549188919365406, -0.08291903883218765, 0.01977374590933323, -0.012924334034323692, 0.04436386376619339, 0.004683255683630705, -0.03390822559595108, 0.040346186608076096, -0.003624380100518465, -0.019483312964439392, -0.01116962544620037, -0.011677885428071022, -0.008047454990446568, -0.01562295388430357, 0.009420967660844326, -0.0201851949095726, 0.01229505892843008, 0.013626216910779476, 0.02727663703262806, 0.004468455445021391, -0.02771228924393654, -0.03272228315472603, -0.01368672400712967, 0.024977363646030426, -0.03468271717429161, 0.007605752442032099, -0.011048611253499985, 0.006377456709742546, 0.03226242959499359, -0.0024112111423164606, 0.0036425322759896517, -0.0058661713264882565, -0.04375879466533661, 0.0267441738396883, -9.610241977497935e-05, -0.023464685305953026, -0.017135633155703545, 0.04934965819120407, 0.008101911284029484, 0.03678836673498154, -0.0030540998559445143, 0.005829866975545883, 0.019398601725697517, -0.028753012418746948, -0.0032038551289588213, -0.02337997406721115, -0.04683255776762962, -0.019398601725697517, -0.01597389578819275, 0.007859882898628712, 0.015235708095133305, 0.014424911700189114, 0.01427969429641962, -0.027421854436397552, -0.004892005585134029, -0.02243606187403202, -0.032673876732587814, 0.0359896719455719, -0.021709976717829704, 0.01436440460383892, -0.012633899226784706, 0.007369774393737316, -0.005188490729779005, -0.011732342652976513, 0.015078389085829258, -0.010800532065331936, 0.005530356429517269, -0.018043240532279015, -0.057699646800756454, -0.030858661979436874, -0.0003845987666863948, 0.03020518459379673, 0.0014226750936359167, 0.0148000568151474, -0.005058400332927704, -0.01820055954158306, 0.025267798453569412, -0.0033157935831695795, 0.01661527156829834, -0.03838575631380081, -0.010213611647486687, 0.0020527062006294727, 0.009886872954666615, 0.027421854436397552, 0.04780067130923271, -0.024904755875468254, 0.035433005541563034, -0.0173171553760767, 0.01829737052321434, -0.02952750399708748, -0.0379985086619854, 0.016760488972067833, -0.024033451452851295, -0.013844043016433716, 0.006220138166099787, 0.021649468690156937, -0.032141413539648056, -0.01937439851462841, -0.02492895908653736, 0.008755388669669628, -0.020899180322885513, 0.008489157073199749, 0.02727663703262806, 0.00636535556986928, 0.027591275051236153, -0.05629587918519974, 0.03105228580534458, -0.09100279957056046, 0.012682304717600346, 0.015150997787714005, -0.010655314661562443, 0.010413285344839096, -0.007018832955509424, -0.04980951175093651, 0.016034401953220367, -0.001260818331502378, -0.04627589136362076, 0.036981988698244095, 0.010201510973274708, 0.016542663797736168, 0.003072252031415701, 0.027591275051236153, -0.026381131261587143, -0.015150997787714005, -0.025606639683246613, -0.0015157049056142569, -0.04099966585636139, 0.006419811863452196, -0.009541982784867287, -0.035094164311885834, 0.02253287471830845, -0.010885241441428661, -0.0316089503467083, 0.0032613370567560196, 0.006011388264596462, 0.026550550013780594, -0.044218648225069046, -0.03436807915568352, 0.01256129052489996, 0.004792168736457825, 0.0058661713264882565, -0.05503733083605766, 0.04554980620741844, -0.0012464479077607393, 0.004879903979599476, -0.014824259094893932, -0.05431124567985535, 0.01264600083231926, -0.016760488972067833, 0.0326254703104496, 0.009505677968263626, 0.03369039669632912, 0.03606227785348892, -0.00636535556986928, -0.012767015025019646, -0.00958433747291565, 0.013323681429028511, -0.01337208691984415, 0.0027167724911123514, -0.03790169954299927, 0.015332520008087158, 0.04361357539892197, 0.03673996031284332, -0.040007349103689194, -0.010479843243956566, 0.0023340645711869, 0.03719981387257576, -0.0023749067913740873, 0.011944117024540901, 0.04477531462907791, -0.028631998226046562, -0.01453382521867752, -0.009777960367500782, -0.021673671901226044, 0.0024792817421257496, -0.03134271875023842, -0.02200041152536869, -0.012524986639618874, 0.020342513918876648, 0.005766334477812052, 0.020197296515107155, -0.02814793959259987, 0.0013099804054945707, 0.015296215191483498, 0.04041879624128342, 0.010147053748369217, 0.014194984920322895, 0.004904107190668583, 0.007091441657394171, -0.02213352732360363, 0.032915905117988586, -0.04584024101495743, -0.018248965963721275, -0.005215718876570463, 0.00625644251704216, -0.011042560450732708, 0.00464997673407197, 0.02899504080414772, -0.015259911306202412, -0.0009718965739011765, -0.018914544954895973, -0.03349677473306656, 0.010994154959917068, -0.0326254703104496, -0.005451696924865246, 0.027930114418268204, -0.023827727884054184, -0.0026834935415536165, 0.025170987471938133, -0.031124893575906754, -0.019422804936766624, 0.013626216910779476, -0.004002550151199102, 0.0002709587279241532, 0.02408185787498951, 0.027905911207199097, 0.020693454891443253, -0.0034852134995162487, 0.002048168098554015, -0.005109831225126982, 0.007605752442032099, -0.013965057209134102, -0.01735346019268036, 0.06631586700677872, -0.03657054156064987, -0.0062866960652172565, 0.01150241494178772, -0.022073019295930862, 0.03277068957686424, 0.0014468779554590583, 0.0010808095103129745, -0.004610646981745958, 0.009699300862848759, -0.024166567251086235, 0.03480372950434685, 0.024771640077233315, -0.014061869122087955, 0.00579356262460351, 0.0028120712377130985, -0.03932966664433479, 0.03562662750482559, -0.03054402396082878, 0.05619907006621361, -0.0017683223122730851, -0.014243390411138535, -0.051310088485479355, -0.024227075278759003, -0.003597151953727007, 0.005009994376450777, 0.02882562018930912, 0.009826365858316422, -0.030616633594036102, -0.03260126709938049, -0.009905025362968445, 0.026792580261826515, 0.010564553551375866, -0.005306479521095753, 0.009971583262085915, -0.008858251385390759, 0.006879666354507208, 0.014642737805843353, -0.04245183616876602, 0.01759548857808113, 0.004126589745283127, -0.025751855224370956, -0.03717561066150665, -0.003264362458139658, -0.02404555305838585, 0.06345993280410767, -0.025413015857338905, -0.018914544954895973, 0.006174757611006498, -0.03458590433001518, 0.00366976042278111, 0.0035850503481924534, -0.018019039183855057, 0.045791834592819214, -0.041120678186416626, 0.020874977111816406, 0.010994154959917068, -0.026792580261826515, 0.03054402396082878, 0.02062084712088108, 0.03882140666246414, 0.004828473087400198, -0.004628799390047789, 0.04511415213346481, 0.005666497629135847, 0.04085444658994675, 0.004135665949434042, -0.03105228580534458, -0.0036818620283156633, 0.006102149374783039, 0.013408390805125237, 0.019628528505563736, 0.002265993971377611, -0.007170100696384907, 0.028414171189069748, 0.038530971854925156, -0.03047141619026661, 0.05890979245305061, 0.006565029267221689, -0.009808214381337166, 0.03574764356017113, 0.031197503209114075, -0.04385560378432274, 0.024747436866164207, 0.03838575631380081, 0.028849823400378227, 0.013892448507249355, -0.026477942243218422, -0.0037574958987534046, 0.03676416352391243, -0.027494462206959724, -0.012839623726904392, -0.026647362858057022, 0.014061869122087955, 0.009330207481980324, -0.0050977300852537155, -0.02761547639966011, 0.008979265578091145, -0.03407764434814453, -0.030011560767889023, -0.013674622401595116, -0.014424911700189114, -0.004075158387422562, -0.01024386566132307, -0.0011201391462236643, 0.028244752436876297, -0.01247658021748066, 0.027421854436397552, -0.029842142015695572, 0.0031221704557538033, -0.0005237652803771198, 0.04523516818881035, 0.008380244486033916, 0.008773541077971458, 0.020439324900507927, -0.023392075672745705, -0.022036714479327202, 0.00934835895895958, 0.063895583152771, -0.04453328624367714, -0.0081563675776124, -0.025001566857099533, 0.024662727490067482, 0.04356516897678375, 0.02831736020743847, 0.0396927110850811, -0.00034659268567338586, -0.029842142015695572, 0.02822054922580719, -0.020596643909811974, 0.011599226854741573, 0.0029935927595943213, 0.01172024104744196, -0.0021933852694928646, -0.00941491685807705, 0.010038141161203384, 0.004250629339367151, 0.0007431037956848741, 0.017002517357468605, -0.031173299998044968, -0.008537563495337963, 0.03124590776860714, 0.00015703504323028028, 0.01570766419172287, 0.0018772352486848831, 0.0006345690344460309, 0.02606649324297905, -0.002128340071067214, 0.016240127384662628, -0.005848018918186426, -0.017268748953938484, 0.02882562018930912, 0.02020939812064171, 0.03337576240301132, -0.032044604420661926, -0.0003634212480392307, -0.018490994349122047, 0.034295469522476196, 0.030132576823234558, -0.04368618503212929, -0.01553824357688427, -0.008416548371315002, 0.015150997787714005, 0.007763071451336145, -0.019931064918637276, 0.0026139102410525084, -0.030592430382966995, -0.012791218236088753, 0.02536460943520069, -0.004444252233952284, 0.02814793959259987, -0.04329893738031387, 0.0032280581071972847, 0.012621797621250153, -0.005745156668126583, 0.00037514453288167715, -0.011441907845437527, -0.0390150286257267, 0.012633899226784706, 0.0015731867169961333, 0.030253591015934944, 0.013807738199830055, 0.03218981996178627, 0.011732342652976513, -0.011732342652976513, -0.018575703725218773, -0.014207085594534874, 0.016736285760998726, 0.012839623726904392, 0.009826365858316422, -0.01705092377960682, -0.050003133714199066, -0.009989735670387745, -0.0126944063231349, -0.04208879545331001, 0.0009446683689020574, 0.035868655890226364, 0.016288533806800842, 0.0316089503467083, 0.029140258207917213, 0.0019679961260408163, -0.02889822982251644, -0.004190122243016958, 0.012500783428549767, -0.04053981229662895, 0.04390401020646095, 0.009699300862848759, 0.009154736064374447, 0.016373243182897568, -0.025098377838730812, -0.01699041575193405, 0.015029983595013618, 0.011048611253499985, -0.0010361854219809175, 0.061668917536735535, 0.009572235867381096, 0.017547082155942917, 0.004447277635335922, -0.05058400332927704, -0.027397651225328445, -0.03891821950674057, -0.025509826838970184, -0.017341358587145805, -0.007309267297387123, -0.026550550013780594, 0.013868246227502823, -0.03504575788974762, -0.002759127411991358, 0.008228976279497147, -0.020003674551844597, 0.017075126990675926, 0.009420967660844326, -0.028970837593078613, -0.007036984898149967, 0.06738079339265823, -0.014061869122087955, -0.011883609928190708, 0.0376596674323082, 0.006002312526106834, 0.03729662671685219, 0.014424911700189114, 0.02434808947145939, -0.0023401151411235332, -0.034489091485738754, -0.00462577398866415, 0.035868655890226364, 0.011399553157389164, 0.014231288805603981, 0.007260861806571484, 0.00929995346814394, 0.01150241494178772, 0.012682304717600346, 0.015501939691603184, 0.019483312964439392, 0.023827727884054184, 0.01584077998995781, 0.0023552419152110815, -0.025413015857338905, 0.009439120069146156, 0.021818889304995537, -0.006667891517281532, -0.01037698145955801, 0.0440492257475853, 0.05048719048500061, -0.006456116214394569, -0.00726691260933876, -0.012706507928669453, -0.01876932755112648, -0.006401659920811653, 0.017099328339099884, -0.013662521727383137, -0.012670204043388367, 0.015102592296898365, -0.016421649605035782, 0.015320418402552605, -0.003173601580783725, -0.008797744289040565, -0.004898056387901306, 0.007938542403280735, 0.01755918376147747, -0.0052338712848722935, -0.02788170799612999, 0.0056695230305194855, 0.0014567103935405612, -0.001951356534846127, -0.006794956512749195, 0.006807057652622461, -0.03114909678697586, -0.01345679722726345, 0.006873615551739931, -0.005796588025987148, 0.043879806995391846, 0.02247236669063568, 0.0040902853943407536, -0.013710927218198776, 0.010927597060799599, 0.002633575117215514, 0.012658102437853813, -0.003808927023783326, -0.0126944063231349, 0.016760488972067833, -0.016893604770302773, -0.03373880311846733, 0.025098377838730812, 9.388066973770037e-05, 0.04027358070015907, 0.01846679113805294, -0.01527201198041439, -0.012137740850448608, -0.006649739108979702, 0.0031342720612883568, -0.020645050331950188, 0.03105228580534458, -0.007775172591209412, 0.012192197144031525, -0.044073428958654404, 0.007454484701156616, -0.009045823477208614, -0.02011258713901043, 0.004111462738364935, 0.027325043454766273, -0.028583591803908348, 0.007702563889324665, -0.0081563675776124, 0.021346934139728546, 0.011042560450732708, -0.010231764055788517, 0.010619009844958782, -0.011248284950852394, 0.015005780383944511, 0.03277068957686424, -0.021806787699460983, 0.043444156646728516, 0.01778911054134369, 0.0016064656665548682, 0.03761126473546028, 0.033278949558734894, 0.030132576823234558, -0.0635567456483841, -0.009880822151899338, -0.04615487903356552, 0.00808980967849493, 0.005503128282725811, 0.0019846356008201838, 0.023634104058146477, -0.00926970038563013, 0.012403972446918488, 0.026986202225089073, -0.01035882905125618, -0.01782541535794735, 0.0005820034421049058, -0.0021661571227014065, 0.011907813139259815, -0.04826052859425545, 0.04833313450217247, 0.01853940077126026, 0.028341563418507576, 0.00104677421040833, -0.030059967190027237, 0.009160786867141724, 0.009203142486512661, -0.02872880920767784, -0.018176356330513954, -0.006292746867984533, 0.003932966850697994, 0.03877300024032593, 0.02162526547908783, -0.027083013206720352, -0.04058821499347687, 0.002323475666344166, -0.006631587166339159, -0.03582024946808815, -0.023029033094644547, 0.004913182929158211, -0.015961794182658195, 0.029842142015695572, 0.015042085200548172, -0.015054186806082726, -0.019894760102033615, 0.011647632345557213, 0.013081652112305164, -0.0265747532248497, 0.02139533869922161, 0.0203546155244112, 0.002840812085196376, 0.027905911207199097, -0.024771640077233315, -0.033012717962265015, -0.0012842649593949318, -0.021637367084622383, -0.00213590357452631, -0.015586649999022484, -0.014957374893128872, 0.0032492356840521097, 0.01927758753299713, -0.02007628232240677, -0.001346284756436944, -0.0036485830787569284, 0.027083013206720352, 0.03528778627514839, 0.03245605155825615, 0.029116054996848106, 0.014437013305723667, -0.01180495135486126, -0.04184676706790924, 0.004767965991050005, -0.01829737052321434, 0.014110274612903595, 0.030495619401335716, -0.00965089537203312, -0.005521280225366354, 0.03216561675071716, -0.01553824357688427, -0.021746281534433365, -0.0047830925323069096, -0.015259911306202412, 0.01123618334531784, -0.02580026164650917, 0.02693779766559601, 0.02822054922580719, 0.01967693492770195, 0.004032803699374199, -0.010812632739543915, -0.015453534200787544, 0.007781223393976688, 0.010812632739543915, -0.025340408086776733, 0.027228230610489845, 0.01668788120150566, 0.011683936230838299, 0.010110749863088131, 0.007581549696624279, 0.047752268612384796, 0.012391870841383934, -0.010733974166214466, -0.023392075672745705, -0.03952328860759735, 0.02192780189216137, -0.015320418402552605, 0.009142635390162468, -0.004326263442635536, 0.003908763639628887, -0.0265747532248497, 0.003379326080903411, -0.016506358981132507, -0.0011269461829215288, 0.002217588247731328, 0.0016972264274954796, 0.032577067613601685, -0.005230845883488655, 0.033956628292798996, 0.0025458396412432194, -0.004383745137602091, -0.04247603937983513, -0.010673467069864273, 0.005763309076428413, 0.005376062821596861, -0.030084170401096344, 0.00910027977079153, 0.0008357554324902594, 0.02313794568181038, -0.011865458451211452, 0.005203617736697197, -0.015029983595013618, -0.005451696924865246, -0.018757225945591927, 0.02364620566368103, 0.029188664630055428, -0.021467948332428932, -0.004852675832808018, -0.00738187599927187, -0.032673876732587814, 0.022121425718069077, 0.0008289483957923949, -0.04487212374806404, 0.0146306362003088, -0.012004625052213669, 0.00039291850407607853, -0.007744919043034315, 0.0092515479773283, 0.007327419705688953, 0.00144385255407542, 0.0189992543309927, 0.04063662141561508, 0.02266599051654339, 0.02098388969898224, -0.012633899226784706, -0.011762595735490322, 0.009372562170028687, -0.015163099393248558, 0.018490994349122047, -0.036110684275627136, 7.449946861015633e-05, 0.05140690132975578, 0.013093753717839718, -0.0228717140853405, 0.03502155467867851, -0.002072370843961835, -0.011925965547561646, 0.008852200582623482, -0.021855194121599197, -0.0227022934705019, -0.0015338570810854435, 0.017716502770781517, -0.0035578222014009953, 0.011647632345557213, 0.014376506209373474, -0.008646476082503796, -0.005079577676951885, 0.008767490275204182, -0.00946937408298254, 0.013178464025259018, 0.007678361143916845, -0.02589707262814045, -0.021552657708525658, 0.0007911314023658633, -0.010655314661562443, 0.023125844076275826, -0.0185030959546566, 0.018333675339818, -0.005953906569629908, -0.003739343723282218, -0.013541506603360176, 0.005596914328634739, 0.020947586745023727, -0.014061869122087955, 0.005772384814918041, -0.019689036533236504, 0.010933647863566875, 0.03158474713563919, 0.0007896187016740441, -0.04312951862812042, 0.006450065411627293, 0.004214324988424778, -0.03722401708364487, -0.01553824357688427, 0.01674838736653328, -0.01836998015642166, 0.008616222068667412, 0.017026720568537712, -0.008713033981621265, -0.009324156679213047, -0.04409763216972351, 0.007793324999511242, 0.014860563911497593, -0.012403972446918488, 0.017885923385620117, -0.0014370455173775554, 0.013928753323853016, -0.0030571252573281527, -0.014993679709732533, -0.027736492455005646, 0.022242439910769463, -0.013142159208655357, 0.03976532071828842, 0.03649793192744255, -0.0013863707426935434, -0.0015383950667455792, 0.025679247453808784, -0.025655044242739677, -0.0339808315038681, -0.017643893137574196, 0.04141111299395561, -0.048284731805324554, -0.0005222525796853006, 0.028075331822037697, -0.020269906148314476, 0.027300840243697166, -0.011883609928190708, -0.006915970705449581, 0.02337997406721115, 0.001725967274978757, -0.003863383550196886, 0.0028438374865800142, -0.013759332709014416, -0.005058400332927704, -0.01640954799950123, -0.0032734384294599295, 0.002473230939358473, 0.05832892283797264, -0.05227820575237274, 0.0017426067497581244, -0.010667416267096996, -0.020608745515346527, -0.013831941410899162, -0.0021782584954053164, 0.009003468789160252, -0.021588962525129318, -0.0037574958987534046, 7.823389023542404e-05, -0.024674829095602036, 0.004202223848551512, -0.035094164311885834, 0.017438169568777084, -0.014194984920322895, 0.03410184755921364, 0.015175200998783112, 0.024904755875468254, -0.029212865978479385, 0.010540351271629333, -0.0427180677652359, 0.017329256981611252, 0.004819396883249283, -0.01617961935698986, -0.03548141196370125, 0.03342416509985924, 0.025267798453569412, -0.03250445798039436, 0.0011564434971660376, -0.029140258207917213, -0.004223401192575693, -0.021165411919355392, -0.0030238463077694178, 0.012488681823015213, 0.04228241741657257, -0.006474268157035112, 0.020088383927941322, 0.006667891517281532, -0.017280850559473038, 0.01853940077126026, 0.008071658201515675, -0.0029724151827394962, -0.015199404209852219]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:48.767348", "url_path": "/api/models/openai/", "chunk_size": 4999}
updated_dt: 2025-03-15T11:17:48.768866
---
raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) frome
      raise
  def_process_response(self, response: chat.ChatCompletion) -> ModelResponse:
"""Process a non-streamed response, and prepare a message to return."""
    timestamp = datetime.fromtimestamp(response.created, tz=timezone.utc)
    choice = response.choices[0]
    items: list[ModelResponsePart] = []
    if choice.message.content is not None:
      items.append(TextPart(choice.message.content))
    if choice.message.tool_calls is not None:
      for c in choice.message.tool_calls:
        items.append(ToolCallPart(c.function.name, c.function.arguments, c.id))
    return ModelResponse(items, model_name=response.model, timestamp=timestamp)
  async def_process_streamed_response(self, response: AsyncStream[ChatCompletionChunk]) -> OpenAIStreamedResponse:
"""Process a streamed response, and prepare a streaming response to return."""
    peekable_response = _utils.PeekableAsyncStream(response)
    first_chunk = await peekable_response.peek()
    if isinstance(first_chunk, _utils.Unset):
      raise UnexpectedModelBehavior('Streamed response ended without content or tool calls')
    return OpenAIStreamedResponse(
      _model_name=self._model_name,
      _response=peekable_response,
      _timestamp=datetime.fromtimestamp(first_chunk.created, tz=timezone.utc),
    )
  def_get_tools(self, model_request_parameters: ModelRequestParameters) -> list[chat.ChatCompletionToolParam]:
    tools = [self._map_tool_definition(r) for r in model_request_parameters.function_tools]
    if model_request_parameters.result_tools:
      tools += [self._map_tool_definition(r) for r in model_request_parameters.result_tools]
    return tools
  async def_map_message(self, message: ModelMessage) -> AsyncIterable[chat.ChatCompletionMessageParam]:
"""Just maps a `pydantic_ai.Message` to a `openai.types.ChatCompletionMessageParam`."""
    if isinstance(message, ModelRequest):
      async for item in self._map_user_message(message):
        yield item
    elif isinstance(message, ModelResponse):
      texts: list[str] = []
      tool_calls: list[chat.ChatCompletionMessageToolCallParam] = []
      for item in message.parts:
        if isinstance(item, TextPart):
          texts.append(item.content)
        elif isinstance(item, ToolCallPart):
          tool_calls.append(self._map_tool_call(item))
        else:
          assert_never(item)
      message_param = chat.ChatCompletionAssistantMessageParam(role='assistant')
      if texts:
        # Note: model responses from this model should only have one text item, so the following
        # shouldn't merge multiple texts into one unless you switch models between runs:
        message_param['content'] = '\n\n'.join(texts)
      if tool_calls:
        message_param['tool_calls'] = tool_calls
      yield message_param
    else:
      assert_never(message)
  @staticmethod
  def_map_tool_call(t: ToolCallPart) -> chat.ChatCompletionMessageToolCallParam:
    return chat.ChatCompletionMessageToolCallParam(
      id=_guard_tool_call_id(t=t, model_source='OpenAI'),
      type='function',
      function={'name': t.tool_name, 'arguments': t.args_as_json_str()},
    )
  @staticmethod
  def_map_tool_definition(f: ToolDefinition) -> chat.ChatCompletionToolParam:
    return {
      'type': 'function',
      'function': {
        'name': f.name,
        'description': f.description,
        'parameters': f.parameters_json_schema,
      },
    }
  async def_map_user_message(self, message: ModelRequest) -> AsyncIterable[chat.ChatCompletionMessageParam]:
    for part in message.parts:
      if isinstance(part, SystemPromptPart):
        if self.system_prompt_role == 'developer':
          yield chat.ChatCompletionDeveloperMessageParam(role='developer', content=part.content)
        elif self.system_prompt_role == 'user':
          yield chat.ChatCompletionUserMessageParam(role='user', content=part.content)
        else:
          yield chat.ChatCompletionSystemMessageParam(role='system', content=part.content)
      elif isinstance(part, UserPromptPart):
        yield await self._map_user_prompt(part)
      elif isinstance(part, ToolReturnPart):
        yield chat.ChatCompletionToolMessageParam(
          role='tool',
          tool_call_id=_guard_tool_call_id(t=part, model_source='OpenAI'),
          content=part.model_response_str(),
        )
      elif isinstance(part, RetryPromptPart):
        if part.tool_name is None:
          yield chat.ChatCompletionUserMessageParam(role='user', content=part.model_response())
        else:
          yield chat.ChatCompletionToolMessageParam(
            role='tool',
            tool_call_id=_guard_tool_call_id(t=part, model_source='OpenAI'),
            content=part.model_response(),
          )
      else:
        assert_never(part)
  @staticmethod
  async def_map_user_prompt(part: UserPromptPart) -> chat.ChatCompletionUserMessageParam:
    content: str | list[ChatCompletio