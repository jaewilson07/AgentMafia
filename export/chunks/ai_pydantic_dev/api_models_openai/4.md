---
url: https://ai.pydantic.dev/api/models/openai/
session_id: pydantic_ai_docs
chunk_number: 4
title: Processing Responses in OpenAI API Models
summary: This documentation chunk describes two methods for handling responses from the OpenAI API: a non-streamed response processing method that prepares a return message based on the response content and tool calls, and a streamed response processing method that handles asynchronous response streams.
embedding: [0.010104828514158726, 0.01886637881398201, -0.009336377494037151, -0.02616363950073719, 0.005893474444746971, -0.04496951028704643, -0.00570287462323904, 0.003364242147654295, 0.029019614681601524, 0.002326530870050192, 0.03548186272382736, -0.04523574560880661, 0.008930973708629608, 0.025897404178977013, -0.03657100722193718, -0.02609102986752987, -0.006250471342355013, 0.028680769726634026, 0.007726865820586681, 0.06317030638456345, 0.039572201669216156, 0.007000769954174757, -0.013202834874391556, 0.023271359503269196, 0.012682466767728329, 0.0011579709826037288, -0.017813540995121002, 0.07164141535758972, -0.030181366950273514, -0.029406864196062088, 0.016385553404688835, -0.014642925001680851, -0.05392468720674515, -0.07072169333696365, 0.02616363950073719, -0.005808763671666384, -0.035699691623449326, 0.0332067646086216, 0.0011209098156541586, 0.023549694567918777, 0.012839787639677525, -0.026720311492681503, -0.02027016505599022, 0.029285850003361702, -0.015659458935260773, 0.04431602358818054, -0.03383604809641838, 0.022521059960126877, -0.006419893819838762, 0.030689634382724762, -0.03173036873340607, 0.030568618327379227, 0.035941723734140396, -0.024953478947281837, -0.01841862127184868, -0.0010588892037048936, -0.05232727900147438, 0.0004651548806577921, -0.022932514548301697, 0.0023552721831947565, -0.019217325374484062, -0.04533255845308304, -0.01596199721097946, -0.019507763907313347, -0.03625636547803879, -0.02931005321443081, -0.055860940366983414, 0.0015868210466578603, -0.028947005048394203, 0.02657509222626686, -0.018128182739019394, 0.014981769025325775, -0.025776388123631477, 0.0007359279552474618, -0.020318571478128433, -0.0038452805019915104, -0.010044320486485958, 0.024457314983010292, -0.008295640349388123, -0.010794619098305702, -0.025945810601115227, -0.0002662350016180426, -0.03020557016134262, -0.026647701859474182, -0.02897120825946331, -0.033230967819690704, -0.07914440333843231, -0.03226283937692642, -0.026526685804128647, -0.03434431552886963, -0.03378764167428017, 0.033134154975414276, -0.033884454518556595, 0.028511347249150276, 0.0756591409444809, 0.01135129202157259, -0.010352910496294498, 0.019423052668571472, 0.025606965646147728, 0.019919218495488167, 0.05416671931743622, 0.002819670597091317, -0.05198843404650688, 0.01271877158433199, 0.04731721803545952, -0.030762244015932083, 0.00349735957570374, 0.007521138526499271, -0.042234551161527634, -0.013444866985082626, -0.043880365788936615, 0.004728696309030056, -0.03202080726623535, 0.011998726986348629, -0.011193971149623394, -0.02331976592540741, -0.009505799040198326, 0.004553223494440317, 0.0009930867236107588, 0.0032371755223721266, -0.0325290746986866, -0.0005665057105943561, 0.003969321493059397, -0.035627081990242004, -0.028680769726634026, -0.03054441511631012, 0.017728829756379128, -0.06278305500745773, -0.045284152030944824, -0.0016594305634498596, 0.029745709151029587, 0.016143521293997765, 0.006123404949903488, -0.07130257040262222, -0.012022930197417736, -0.0022917387541383505, -0.011290783993899822, -0.0010906558018177748, -0.0212261900305748, 0.0006073485710658133, -0.013941032811999321, -0.014255673624575138, -0.055183254182338715, 0.0034217247739434242, -0.033884454518556595, -0.00541848735883832, -0.0359659269452095, -0.0038483059033751488, -0.034223299473524094, -0.028874395415186882, -0.01972559280693531, 0.013239139690995216, -0.04608285799622536, 0.028825988993048668, 0.008410605601966381, -0.007176243234425783, 0.021189885213971138, 0.029697302728891373, 0.042888037860393524, -0.04390456900000572, -0.01993132010102272, -0.015840981155633926, -0.04441283643245697, -0.0033370135352015495, -0.02137140929698944, -0.05111711844801903, -0.006041719112545252, 0.009687323123216629, -0.04269441217184067, -0.017607813701033592, 0.005191582255065441, 0.0005578076816163957, -0.05126233771443367, 0.028850192204117775, 0.005488071125000715, -0.0393785759806633, -0.053876280784606934, -0.06239579990506172, -0.015018073841929436, -0.039838436990976334, -0.03618375584483147, 0.009923304431140423, -0.04571980983018875, -0.029987741261720657, -0.037587542086839676, 0.005748255643993616, 0.02034277468919754, 0.009433189406991005, 0.012028981000185013, 0.021528730168938637, -0.0048194583505392075, 0.03044760227203369, 0.05561891198158264, 0.01460662018507719, 0.0025413341354578733, -0.032819513231515884, 0.07686930149793625, -0.0335698127746582, -0.01279138121753931, 0.0022917387541383505, 0.01207133661955595, 0.02081473544239998, 0.041968315839767456, -0.04407399147748947, 0.029261646792292595, -0.013892626389861107, -0.011726440861821175, 0.04782548546791077, -0.026478279381990433, -0.04995536431670189, 0.012706669978797436, -0.04489690065383911, 0.026889733970165253, 0.009632865898311138, -0.020875243470072746, -0.02722857892513275, -0.05005217716097832, -0.004628858529031277, -0.062298987060785294, 0.02000392973423004, -0.04184729978442192, 0.07110894471406937, 0.03913654386997223, 0.01972559280693531, -0.03577230125665665, 0.03393286094069481, -0.00813226867467165, -0.04044351726770401, -0.01972559280693531, -0.00785998348146677, -0.0036274518352001905, 0.009045938961207867, -0.0009219899075105786, -0.014013641513884068, 0.005742204841226339, -0.07711133360862732, 0.02756742388010025, -0.01068570464849472, 0.0500037707388401, -0.019435154274106026, -0.00310708349570632, -0.006934211589396, 0.03816841542720795, 0.0009673708700574934, 0.020052336156368256, 0.02356179617345333, 0.00833799596875906, -0.02502608858048916, 0.019156817346811295, 0.05029420927166939, 0.06118564307689667, -0.06433205306529999, -0.0016488417750224471, -0.005512274336069822, -0.028438737615942955, -0.019229426980018616, 0.016627585515379906, 0.02047589048743248, -0.05944301187992096, -0.0023991402704268694, 0.02376752346754074, 0.06200854852795601, -0.04027409479022026, 0.024699347093701363, -0.003878559684380889, -0.021928081288933754, 0.014062047936022282, -0.02955208346247673, 0.02715596929192543, -0.0139531334862113, 0.03490098565816879, 0.030641227960586548, 0.023573897778987885, 0.0002605623740237206, -0.050148990005254745, -0.00024184271751437336, 0.028825988993048668, 0.013928931206464767, 0.015538441948592663, -0.043130069971084595, -0.0025201563257724047, 0.024977682158350945, 0.05687747523188591, 0.02068161778151989, -0.009287971071898937, -0.000264533213339746, 0.030253976583480835, -0.0431542731821537, -0.0018454925157129765, -0.014703432098031044, -0.016978532075881958, 0.03410228341817856, 0.0037756962701678276, -0.018019268289208412, 0.04985855147242546, 0.0383620411157608, 0.021855473518371582, -0.0055213505402207375, 0.009015684947371483, 0.009880948811769485, -0.0003216375771444291, 0.009566307067871094, 0.009753881953656673, 0.019834507256746292, -0.009451341815292835, 0.0068434495478868484, 0.008864414878189564, -0.02749481424689293, 0.018479129299521446, -0.010365012101829052, 0.041726283729076385, 0.04342050850391388, -0.04579241946339607, -0.02906802110373974, -0.01588938757777214, -0.010764365084469318, -0.0012683980166912079, -0.00998381245881319, 0.04366254061460495, -0.023876437917351723, -0.02633306197822094, 0.030108757317066193, -0.009487646631896496, 0.0039995755068957806, 0.009251666255295277, 0.03574809804558754, 0.009015684947371483, 0.013239139690995216, 0.004867864772677422, 0.050148990005254745, -0.005606061778962612, -0.02962469309568405, -0.019749796018004417, 0.04020148515701294, 0.03243226185441017, 0.009735729545354843, -0.02807568944990635, -0.01486075296998024, 0.04286383464932442, 0.017111649736762047, -0.004099413752555847, -0.03325517103075981, -0.06467089802026749, 0.011914015747606754, -0.0003568078391253948, 0.0006160466000437737, 0.02390064112842083, 0.03226283937692642, -0.028438737615942955, 0.002352246781811118, 0.005143175832927227, 0.0039753722958266735, 0.007829729467630386, -0.007757119368761778, -0.000932578812353313, 0.020161250606179237, 0.016869617626070976, -0.002834797604009509, 0.012537247501313686, -0.009971710853278637, 0.005445715971291065, 0.014872854575514793, 0.0021510578226298094, -0.021310901269316673, -0.016421858221292496, 0.06500974297523499, 0.010528383776545525, -0.04434022679924965, -0.02465094067156315, -0.0397174209356308, -0.00407521054148674, -0.012936600483953953, -0.03088326007127762, 0.004967703018337488, -0.05905576050281525, -0.014969667419791222, -0.016288740560412407, 0.032722700387239456, -0.013311749324202538, 0.026357265189290047, 0.059152573347091675, -0.0016881718765944242, -0.012948702089488506, -0.0010626709554344416, -0.004768026527017355, 0.03250487148761749, 0.03127051144838333, 0.006722433492541313, -0.05271453037858009, 0.030980071052908897, 0.015490035526454449, -0.07043125480413437, -0.0301329605281353, 0.029358459636569023, 0.04811592400074005, 0.0678173154592514, 0.003654680447652936, 0.03533664345741272, 0.02462673746049404, -0.00811411626636982, 0.020730024203658104, 0.02708335965871811, 0.012319419533014297, 0.021008361130952835, -0.0073456657119095325, 0.03923335671424866, -0.00039897431270219386, -0.006873703561723232, 0.03993524983525276, 0.021589238196611404, 0.0647193044424057, -0.05900735408067703, 0.01959247514605522, -0.001632202067412436, 0.030592821538448334, -0.046349093317985535, -0.002934635616838932, 0.025243917480111122, 0.02116568200290203, -0.018781669437885284, -0.014049946330487728, -0.04225875437259674, -0.0037968740798532963, 0.01186560932546854, -0.03444112837314606, 0.04663953185081482, 0.034610550850629807, -0.0558125339448452, 0.036304771900177, -0.0002475153305567801, -0.03804739937186241, -0.013614289462566376, 0.05726472660899162, 0.006383589003235102, -0.0014007590943947434, -0.004290014039725065, 0.0007586184656247497, 0.006667976267635822, -0.038676682859659195, -0.018091877922415733, 0.03402967378497124, -0.043468914926052094, -0.006096176337450743, 0.038434650748968124, -0.023840133100748062, -0.017692524939775467, -0.03061702474951744, 0.01780143938958645, -0.027059156447649002, -0.012500942684710026, 0.013723203912377357, -0.02171025425195694, 0.028511347249150276, 0.004768026527017355, -0.04530835524201393, -0.06767209619283676, 0.026284655556082726, 0.05053624138236046, 0.044049788266420364, -0.014715533703565598, 0.05745835229754448, 0.00106569635681808, 0.016893820837140083, 1.7313310536337667e-06, -0.014848651364445686, 0.0011942756827920675, -0.03795058652758598, 0.022412145510315895, -0.0035699692089110613, 0.026454076170921326, -0.014207267202436924, 0.04830954968929291, -0.004395902622491121, -0.0056484173983335495, 0.022266926243901253, -0.07401333004236221, 0.029116427525877953, 0.039257559925317764, 0.0052581410855054855, 0.024977682158350945, 0.0016488417750224471, -0.0255101528018713, 0.003630477236583829, 0.018757466226816177, -0.01503017544746399, 0.08785754442214966, -0.006940262392163277, -0.03681303933262825, 0.006625620648264885, 0.059394605457782745, -0.008047557435929775, 0.012500942684710026, -0.025219714269042015, -0.012646161951124668, 0.009124599397182465, -0.012912397272884846, -0.022968819364905357, 0.014316181652247906, 0.02260577119886875, 0.028608160093426704, -0.054602377116680145, -0.022109605371952057, 0.004925347398966551, 0.011411800049245358, -0.00524906488135457, 0.04571980983018875, 0.0019407925428822637, 0.014497705735266209, 0.012682466767728329, 0.04615546762943268, -0.011103209108114243, -0.013565883040428162, -0.010758314281702042, 0.006401741411536932, 0.014618721790611744, 0.02281149849295616, -0.006643773056566715, -0.01979820244014263, 0.007993100211024284, 0.00974178034812212, 0.0016125369584187865, -0.008241183124482632, 0.01506648026406765, 0.0006984886713325977, 0.0022024894133210182, -0.009306123480200768, -0.027204375714063644, -0.018539637327194214, -0.03376343846321106, 0.022448450326919556, 0.06147608160972595, 0.0067647891119122505, 0.02201279252767563, 0.0195198655128479, -0.021625543013215065, -0.007496935315430164, -0.02143191732466221, 0.008180675096809864, -0.0020315544679760933, 0.009584459476172924, -0.03456214442849159, 0.018237097188830376, -0.027736846357584, -0.014739736914634705, 0.010467875748872757, 0.009602611884474754, 0.025147104635834694, 0.01955617032945156, 0.012706669978797436, -0.011889812536537647, 0.011665933765470982, -0.026696108281612396, 0.009390834718942642, -0.03954799845814705, 0.01254934910684824, 0.018346011638641357, -0.02184337191283703, 0.013820016756653786, -0.015937793999910355, -0.01657917909324169, 0.02208540216088295, 0.01279138121753931, 0.042476583272218704, 0.010250046849250793, -0.03352140635251999, 0.03475576639175415, 0.0352640338242054, 0.013202834874391556, -0.010903533548116684, 0.006964465603232384, -0.0011549455812200904, -0.010419469326734543, -0.011417850852012634, -0.05900735408067703, 0.007357766851782799, -0.002973965834826231, 0.03410228341817856, 0.005327725317329168, -0.054021500051021576, -0.02311403863132, -0.006395690608769655, -0.014497705735266209, -0.005848093423992395, -0.003364242147654295, -0.029527880251407623, 0.009880948811769485, -0.011932168155908585, 0.013190734200179577, -0.031488340348005295, -0.02756742388010025, 0.03173036873340607, -0.031560949981212616, -0.0006565112853422761, 0.02483246475458145, -0.02722857892513275, -0.029915131628513336, -0.006758738309144974, -0.01807977631688118, -0.04668793827295303, -0.014376689679920673, 0.05198843404650688, -0.0054789949208498, -0.0222548246383667, 0.0012283114483579993, -0.02105676755309105, -0.006825297139585018, 0.031560949981212616, -0.01890268363058567, -0.021310901269316673, 0.017716728150844574, 0.03572389483451843, -0.0005574295064434409, -0.005981211084872484, -0.018224995583295822, 0.024880869314074516, -0.009614713490009308, 0.014763940125703812, -0.004296064842492342, 0.050971899181604385, -0.0003136959276162088, -0.020451687276363373, 0.042476583272218704, 0.015998302027583122, 0.0018833100330084562, 0.011514663696289062, -0.003624426433816552, 0.014558213762938976, -0.0051704044453799725, 0.026066826656460762, 0.030326586216688156, 0.054021500051021576, -0.001269910717383027, 0.03226283937692642, 0.024735651910305023, -0.026454076170921326, 0.04029829800128937, 0.07043125480413437, -0.03444112837314606, -0.0033854199573397636, -0.036982461810112, 0.007394071668386459, 0.019507763907313347, 0.008428758010268211, -0.01552634034305811, -0.004937449004501104, 0.007309360895305872, -0.02010074257850647, 0.029237443581223488, 0.004111515358090401, -0.008707094006240368, 0.01510278508067131, -0.03136732429265976, -0.015054378658533096, 0.00500098243355751, 0.013069718144834042, -0.014691331423819065, -0.010086676105856895, 0.010243996046483517, -0.003951169550418854, 0.022678380832076073, -0.02897120825946331, 0.010528383776545525, -0.0015671559376642108, 0.04448544606566429, 0.0021586213260889053, 0.029866725206375122, 0.00674663670361042, 0.01804347150027752, 0.02814829908311367, -0.004913245793431997, -0.021032564342021942, 0.0045713759027421474, 0.01920522376894951, -0.034634754061698914, 0.04298485070466995, -0.024396806955337524, 0.010921685956418514, -0.038023196160793304, 0.018515434116125107, 0.009051989763975143, -0.020802633836865425, -0.019737694412469864, -0.04663953185081482, 0.022145910188555717, 0.03736971318721771, -0.008289589546620846, 0.03911234065890312, -0.0013311749789863825, -0.013408562168478966, 0.010843025520443916, -0.01254934910684824, -0.08292009681463242, 0.019773999229073524, -0.012900295667350292, 0.04424341395497322, 0.004643985535949469, -0.03400547057390213, 0.040249891579151154, -0.0036607312504202127, -0.01955617032945156, -0.011024548672139645, -0.011641730554401875, -0.008089913055300713, -0.015586848370730877, 0.009475545026361942, -0.02020965702831745, 0.012361775152385235, 0.013565883040428162, 0.02722857892513275, 0.0044927154667675495, -0.02756742388010025, -0.032722700387239456, -0.01369900070130825, 0.02483246475458145, -0.03477996960282326, 0.0075453417375683784, -0.011072955094277859, 0.006383589003235102, 0.03228704258799553, -0.002294764155521989, 0.003630477236583829, -0.005863220430910587, -0.04378355294466019, 0.02667190507054329, -7.733672828180715e-05, -0.02341657690703869, -0.01722056418657303, 0.04942289739847183, 0.008089913055300713, 0.036764632910490036, -0.003039011964574456, 0.005957007873803377, 0.019459357485175133, -0.028680769726634026, -0.003215997712686658, -0.023380272090435028, -0.046760544180870056, -0.019338341429829597, -0.01588938757777214, 0.0078781358897686, 0.0152359027415514, 0.014449299313127995, 0.014219368807971478, -0.02725278213620186, -0.004810382146388292, -0.022484755143523216, -0.03255327790975571, 0.03606273978948593, -0.02178286388516426, 0.014219368807971478, -0.012537247501313686, 0.007369868457317352, -0.005218810867518187, -0.01169618684798479, 0.015126988291740417, -0.010903533548116684, 0.0054820203222334385, -0.01800716668367386, -0.05770038440823555, -0.03095586784183979, -0.00053284817840904, 0.03020557016134262, 0.0014658051077276468, 0.014739736914634705, -0.005052414257079363, -0.01818869076669216, 0.025195511057972908, -0.0031585150863975286, 0.016663890331983566, -0.038434650748968124, -0.010177437216043472, 0.0020255036652088165, 0.009844643995165825, 0.027470611035823822, 0.047849688678979874, -0.02500188536942005, 0.03540925309062004, -0.017305275425314903, 0.01828550361096859, -0.029576286673545837, -0.03795058652758598, 0.01671229675412178, -0.02400955557823181, -0.013965235091745853, 0.006220217328518629, 0.021794965490698814, -0.03211762011051178, -0.019265731796622276, -0.024880869314074516, 0.008743398822844028, -0.020826837047934532, 0.008471113629639149, 0.027180172502994537, 0.006365436594933271, 0.02766423672437668, -0.056345004588365555, 0.030980071052908897, -0.09110077470541, 0.012767178006470203, 0.015163293108344078, -0.01063124742358923, 0.010268199257552624, -0.007109684403985739, -0.04981014505028725, 0.01602250523865223, -0.0013402511831372976, -0.04632489010691643, 0.03695825859904289, 0.010165336541831493, 0.01654287427663803, 0.0030647278763353825, 0.027422204613685608, -0.02650248259305954, -0.015175394713878632, -0.02558276243507862, -0.0016579178627580404, -0.04112120345234871, 0.006335182581096888, -0.009626815095543861, -0.035118814557790756, 0.02253316156566143, -0.0108732795342803, -0.0315125435590744, 0.0032916327472776175, 0.005893474444746971, 0.026478279381990433, -0.04409819468855858, -0.034295909106731415, 0.012682466767728329, 0.004674239549785852, 0.005869271233677864, -0.05503803491592407, 0.04557459056377411, -0.0012986519141122699, 0.004846686962991953, -0.014715533703565598, -0.054360345005989075, 0.012670365162193775, -0.016833312809467316, 0.03255327790975571, 0.009433189406991005, 0.03376343846321106, 0.03599013015627861, -0.006444097030907869, -0.012730873189866543, -0.009657069109380245, 0.013275444507598877, -0.013432765379548073, 0.002716807182878256, -0.03795058652758598, 0.015465832315385342, 0.043541524559259415, 0.03681303933262825, -0.039983656257390976, -0.010492078959941864, 0.0023537594825029373, 0.036982461810112, -0.002418805379420519, 0.011907964944839478, 0.04489690065383911, -0.028704972937703133, -0.014521908946335316, -0.00977808516472578, -0.021722355857491493, 0.002467211801558733, -0.031318917870521545, -0.021976487711071968, -0.012525145895779133, 0.020318571478128433, 0.005781535059213638, 0.02017335221171379, -0.02814829908311367, 0.0012789868051186204, 0.015381122007966042, 0.04037090763449669, 0.010104828514158726, 0.014304080046713352, 0.004867864772677422, 0.0072185988537967205, -0.022182215005159378, 0.032819513231515884, -0.045865029096603394, -0.018273402005434036, -0.005300496704876423, 0.006329131778329611, -0.011066904291510582, 0.004598604515194893, 0.02889859862625599, -0.015381122007966042, -0.0011141026625409722, -0.0188300758600235, -0.033472999930381775, 0.010970091447234154, -0.03262588754296303, -0.0054396651685237885, 0.027833659201860428, -0.023743320256471634, -0.0027152944821864367, 0.02526812069118023, -0.031149493530392647, -0.01944725587964058, 0.013602187857031822, -0.003954194951802492, 0.0001901273353723809, 0.024203181266784668, 0.027785252779722214, 0.02051219530403614, -0.0035306389909237623, 0.002060295781120658, -0.005094769410789013, 0.007551392540335655, -0.014001539908349514, -0.017377883195877075, 0.0664135292172432, -0.03659521043300629, -0.0062867761589586735, 0.011599374935030937, -0.02204909734427929, 0.032819513231515884, 0.001384875737130642, 0.00109973200596869, -0.004728696309030056, 0.009687323123216629, -0.024094266816973686, 0.03494939208030701, 0.024784058332443237, -0.014170962385833263, 0.005748255643993616, 0.00285143731161952, -0.03928176313638687, 0.0356028787791729, -0.030496008694171906, 0.05619978532195091, -0.0018016243120655417, -0.014098352752625942, -0.051310744136571884, -0.02421528287231922, -0.0034459279850125313, 0.005022160243242979, 0.028922801837325096, 0.009802288375794888, -0.03061702474951744, -0.032577481120824814, -0.009971710853278637, 0.02674451470375061, 0.010594942606985569, -0.00523091247305274, 0.009856745600700378, -0.008943075314164162, 0.006837398745119572, 0.014618721790611744, -0.04233136400580406, 0.01757150888442993, 0.004132693167775869, -0.02567957527935505, -0.03707927465438843, -0.0032462517265230417, -0.023961149156093597, 0.06346073746681213, -0.02541333995759487, -0.018963191658258438, 0.006196014583110809, -0.03465895727276802, 0.0036214010324329138, 0.003566943807527423, -0.018237097188830376, 0.04574401304125786, -0.04116960987448692, 0.020875243470072746, 0.011066904291510582, -0.02681712433695793, 0.03061702474951744, 0.020669516175985336, 0.03872508928179741, 0.0048194583505392075, -0.004728696309030056, 0.045114729553461075, 0.005736154038459063, 0.040903374552726746, 0.004002600908279419, -0.03088326007127762, -0.003675858024507761, 0.006196014583110809, 0.013408562168478966, 0.019544068723917007, 0.0022130783181637526, -0.007121786009520292, 0.028366127982735634, 0.03862827643752098, -0.030496008694171906, 0.058910541236400604, 0.006510655861347914, -0.009868847206234932, 0.035796504467725754, 0.03119789995253086, -0.04375934973359108, 0.024784058332443237, 0.038337837904691696, 0.02880178578197956, 0.014001539908349514, -0.02657509222626686, -0.0038664580788463354, 0.03678883612155914, -0.027519017457962036, -0.012767178006470203, -0.026623498648405075, 0.014037844724953175, 0.009390834718942642, -0.005022160243242979, -0.02756742388010025, 0.009064091369509697, -0.03415068984031677, -0.030108757317066193, -0.013807915151119232, -0.014461400918662548, -0.004041931126266718, -0.010316605679690838, -0.001041493145748973, 0.028196705505251884, -0.012561450712382793, 0.027373798191547394, -0.029769912362098694, 0.003054138971492648, -0.0005729346885345876, 0.04525994881987572, 0.008459012024104595, 0.008773652836680412, 0.020354874432086945, -0.023440780118107796, -0.02201279252767563, 0.009360580705106258, 0.06389639526605606, -0.04455805569887161, -0.00813226867467165, -0.02502608858048916, 0.02468724548816681, 0.04358993098139763, 0.028293518349528313, 0.03964481130242348, -0.0002028907329076901, -0.029866725206375122, 0.02822090871632099, -0.020572703331708908, 0.011544917710125446, 0.002809081692248583, 0.011768796481192112, -0.0021056768018752337, -0.009402936324477196, 0.010074574500322342, 0.0042446330189704895, 0.000737440655939281, 0.01701483689248562, -0.03119789995253086, -0.00854372326284647, 0.03127051144838333, 0.00021064330940134823, 0.015744170174002647, 0.0018621322233229876, 0.0006402497529052198, 0.026042623445391655, -0.002117778407409787, 0.016276638954877853, -0.005835992284119129, -0.01725686900317669, 0.028777582570910454, 0.020245961844921112, 0.03327937424182892, -0.0321902297437191, -0.00035226973704993725, -0.018551738932728767, 0.03439272195100784, 0.030108757317066193, -0.04363833740353584, -0.015502137131989002, -0.008513469249010086, 0.015175394713878632, 0.007781322579830885, -0.019870812073349953, 0.0027062182780355215, -0.03061702474951744, -0.012694568373262882, 0.025389136746525764, -0.004610706120729446, 0.02807568944990635, -0.04325108602643013, 0.0033128103241324425, 0.012621958740055561, -0.005718001630157232, 0.0003084014751948416, -0.01157517172396183, -0.039015527814626694, 0.0125856539234519, 0.0016110242577269673, 0.03020557016134262, 0.013759508728981018, 0.03214182332158089, 0.01182930450886488, -0.011780898086726665, -0.018588043749332428, -0.014183063991367817, 0.01667599193751812, 0.012803482823073864, 0.009953558444976807, -0.016930125653743744, -0.05005217716097832, -0.010050371289253235, -0.01279138121753931, -0.04204092547297478, 0.0008902232511900365, 0.035869114100933075, 0.016312943771481514, 0.0315125435590744, 0.029285850003361702, 0.002054244978353381, -0.028947005048394203, -0.0042204298079013824, 0.012464637868106365, -0.04046772047877312, 0.04385616257786751, 0.009693373925983906, 0.009221412241458893, 0.016361350193619728, -0.024953478947281837, -0.017026938498020172, 0.01503017544746399, 0.011036650277674198, -0.0011012447066605091, 0.061621300876140594, 0.009511849842965603, 0.0176320169121027, 0.004395902622491121, -0.050487834960222244, -0.027446407824754715, -0.03889451175928116, -0.025534356012940407, -0.017377883195877075, -0.0073638176545500755, -0.026526685804128647, 0.013880524784326553, -0.03502200171351433, -0.0027652133721858263, 0.008138319477438927, -0.019882913678884506, 0.01699063368141651, 0.009481595829129219, -0.02897120825946331, -0.007043125573545694, 0.06738165766000748, -0.014110454358160496, -0.011932168155908585, 0.037660151720047, 0.0060628969222307205, 0.03736971318721771, 0.01436458807438612, 0.024360502138733864, -0.002262997440993786, -0.03444112837314606, -0.004637934733182192, 0.03582070767879486, 0.011290783993899822, 0.014304080046713352, 0.0073456657119095325, 0.009390834718942642, 0.011381546035408974, 0.012706669978797436, 0.01544163003563881, 0.019544068723917007, 0.023779625073075294, 0.01596199721097946, 0.0023386324755847454, -0.02543754316866398, 0.009342428296804428, 0.021867573261260986, -0.006619569845497608, -0.010280300863087177, 0.04402558505535126, 0.05053624138236046, -0.006504605058580637, -0.007285157684236765, -0.012876092456281185, -0.01876956783235073, -0.00648040184751153, 0.017063243314623833, -0.013614289462566376, -0.012621958740055561, 0.01506648026406765, -0.016349248588085175, 0.0152359027415514, -0.0032855819445103407, -0.008694992400705814, -0.0048043313436210155, 0.007974947802722454, 0.017656220123171806, -0.005318649113178253, -0.027833659201860428, 0.005739179439842701, 0.0013553781900554895, -0.0019407925428822637, -0.006801093928515911, 0.006831347942352295, -0.031173696741461754, -0.013481171801686287, 0.006910008378326893, -0.00579666206613183, 0.043880365788936615, 0.022593669593334198, 0.004114540759474039, -0.013807915151119232, 0.010879330337047577, 0.0026033546309918165, 0.012742974795401096, -0.00380897568538785, -0.012815584428608418, 0.016869617626070976, -0.016930125653743744, -0.033715032041072845, 0.025243917480111122, 0.00021839588589500636, 0.04020148515701294, 0.018491230905056, -0.015356918796896935, -0.012192352674901485, -0.006643773056566715, 0.0031403626780956984, -0.020596906542778015, 0.031004274263978004, -0.007757119368761778, 0.012216555885970592, -0.04407399147748947, 0.00744852889329195, -0.009064091369509697, -0.020112844184041023, 0.004214379005134106, 0.027301188558340073, -0.028511347249150276, 0.007805525790899992, -0.008174624294042587, 0.02137140929698944, 0.011139513924717903, -0.010310554876923561, 0.010516282171010971, -0.011224225163459778, 0.015018073841929436, 0.03274690359830856, -0.021855473518371582, 0.0434931181371212, 0.01774093136191368, 0.0016291766660287976, 0.03756333887577057, 0.033303577452898026, 0.030278179794549942, -0.06350914388895035, -0.009971710853278637, -0.046179670840501785, 0.008138319477438927, 0.005421512760221958, 0.001889360835775733, 0.023670710623264313, -0.009269818663597107, 0.012349673546850681, 0.026938140392303467, -0.01049812976270914, -0.01770462654531002, 0.0004889799165539443, -0.0019876861479133368, 0.011998726986348629, -0.04823694005608559, 0.04838215932250023, 0.01862434856593609, 0.028414534404873848, 0.0010248534381389618, -0.030157163739204407, 0.009136701002717018, 0.009312174282968044, -0.028704972937703133, -0.018224995583295822, -0.006383589003235102, 0.003936042543500662, 0.03879769891500473, 0.021686051040887833, -0.02715596929192543, -0.04058873653411865, 0.002296276856213808, -0.006565113086253405, -0.035796504467725754, -0.02304142899811268, 0.00475895032286644, -0.015913590788841248, 0.029866725206375122, 0.015054378658533096, -0.01506648026406765, -0.01993132010102272, 0.011569120921194553, 0.012985006906092167, -0.026792921125888824, 0.021419815719127655, 0.020451687276363373, 0.0028529500123113394, 0.027857862412929535, -0.024771956726908684, -0.03301313892006874, -0.001269910717383027, -0.02163764461874962, -0.0021374435164034367, -0.01559894997626543, -0.014909159392118454, 0.0032371755223721266, 0.019302036613225937, -0.020052336156368256, -0.0013689923798665404, -0.0035971978213638067, 0.027059156447649002, 0.035288237035274506, 0.03250487148761749, 0.029164833948016167, 0.014473502524197102, -0.011732491664588451, -0.04175048694014549, 0.0046197823248803616, -0.01824919879436493, 0.014170962385833263, 0.03054441511631012, -0.009663119912147522, -0.0054245381616055965, 0.032166026532649994, -0.015502137131989002, -0.0217465590685606, -0.004771051928400993, -0.015175394713878632, 0.011187920346856117, -0.025776388123631477, 0.026962343603372574, 0.0282451119273901, 0.01961667835712433, 0.003993524704128504, -0.010715958662331104, -0.015465832315385342, 0.007835780270397663, 0.010722009465098381, -0.02543754316866398, 0.027276985347270966, 0.01671229675412178, 0.01169618684798479, 0.010098777711391449, 0.0075453417375683784, 0.047752875834703445, 0.012331521138548851, -0.010746212676167488, -0.02348918654024601, -0.03947538882493973, 0.021928081288933754, -0.015369020402431488, 0.009124599397182465, -0.004495740868151188, 0.0038150264881551266, -0.026478279381990433, 0.003427775576710701, -0.016567077487707138, -0.0011193971149623394, 0.002170722698792815, 0.0017970862099900842, 0.03255327790975571, -0.005218810867518187, 0.0339086577296257, 0.00261545623652637, -0.004465486854314804, -0.042476583272218704, -0.010594942606985569, 0.005681696813553572, 0.0053065475076437, -0.030011944472789764, 0.009142751805484295, 0.0008947613532654941, 0.023029327392578125, -0.011835355311632156, 0.005227887071669102, -0.01503017544746399, -0.005451766774058342, -0.01873326301574707, 0.023670710623264313, 0.029189037159085274, -0.021383510902523994, -0.00485273776575923, -0.007236751262098551, -0.0328679196536541, 0.02204909734427929, 0.0007325243786908686, -0.0448484942317009, 0.01460662018507719, -0.011932168155908585, 0.0004522969538811594, -0.007757119368761778, 0.009287971071898937, 0.007394071668386459, 0.001561105134896934, 0.019011598080396652, 0.0407581552863121, 0.022521059960126877, 0.020935751497745514, -0.012621958740055561, -0.011768796481192112, 0.009354529902338982, -0.015126988291740417, 0.018551738932728767, -0.036038536578416824, 0.00012810667976737022, 0.051455963402986526, 0.013190734200179577, -0.022847803309559822, 0.0349251888692379, -0.0021132403053343296, -0.01186560932546854, 0.008791805244982243, -0.021831270307302475, -0.022726787254214287, -0.001592871849425137, 0.017898252233862877, -0.003551816800609231, 0.011550968512892723, 0.01440089289098978, -0.008658688515424728, -0.0051552774384617805, 0.008779703639447689, -0.009408987127244473, 0.01313022617250681, 0.007666357792913914, -0.025873200967907906, -0.021516628563404083, 0.0006890342920087278, -0.010764365084469318, 0.023138241842389107, -0.018491230905056, 0.018442824482917786, -0.005953982472419739, -0.0038150264881551266, -0.013553781434893608, 0.005651442799717188, 0.020875243470072746, -0.014025743119418621, 0.0057906112633645535, -0.019665084779262543, 0.010921685956418514, 0.031560949981212616, 0.0008062684792093933, -0.043130069971084595, 0.006371487397700548, 0.004159921780228615, -0.03736971318721771, -0.015635255724191666, 0.01674860157072544, -0.018430722877383232, 0.008567926473915577, 0.01701483689248562, -0.008616332896053791, -0.009402936324477196, -0.04419500753283501, 0.007769220974296331, 0.014884956181049347, -0.012452536262571812, 0.01783774420619011, -0.001467317808419466, 0.0139531334862113, -0.0031101086642593145, -0.014969667419791222, -0.027761049568653107, 0.02221851982176304, -0.013081819750368595, 0.03976582735776901, 0.036522600799798965, -0.0014158861013129354, -0.0014083225978538394, 0.025631168857216835, -0.025655372068285942, -0.03400547057390213, -0.01766832172870636, 0.04136323556303978, -0.04823694005608559, -0.0004814164130948484, 0.02797887660562992, -0.02020965702831745, 0.027519017457962036, -0.01169618684798479, -0.006885805167257786, 0.02341657690703869, 0.0016609432641416788, -0.0038906612899154425, 0.0028695897199213505, -0.013674797490239143, -0.0050917440094053745, -0.016494467854499817, -0.003167591290548444, 0.0023386324755847454, 0.05828126147389412, -0.052278872579336166, 0.0016427909722551703, -0.01063124742358923, -0.0205485001206398, -0.013880524784326553, -0.0021661848295480013, 0.00905804056674242, -0.02157713659107685, -0.003972346894443035, -1.9086004613200203e-05, -0.024663042277097702, 0.004359597805887461, -0.035288237035274506, 0.017377883195877075, -0.014183063991367817, 0.034126486629247665, 0.015260105952620506, 0.024905072525143623, -0.02921324037015438, 0.010492078959941864, -0.04262180253863335, 0.017317377030849457, 0.004861813969910145, -0.016107216477394104, -0.03550606593489647, 0.033472999930381775, 0.0251713078469038, -0.03245646506547928, 0.0012018391862511635, -0.029092224314808846, -0.00428093783557415, -0.021177783608436584, -0.0030269103590399027, 0.012452536262571812, 0.04225875437259674, -0.006468300241976976, 0.020149149000644684, 0.0066619254648685455, -0.01738998480141163, 0.018551738932728767, 0.008180675096809864, -0.0029936309438198805, -0.015199597924947739]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:07:33.799408", "url_path": "/api/models/openai/", "chunk_size": 4999}
updated_dt: 2025-03-14T10:07:35.382346
---
raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) frome
      raise
  def_process_response(self, response: chat.ChatCompletion) -> ModelResponse:
"""Process a non-streamed response, and prepare a message to return."""
    timestamp = datetime.fromtimestamp(response.created, tz=timezone.utc)
    choice = response.choices[0]
    items: list[ModelResponsePart] = []
    if choice.message.content is not None:
      items.append(TextPart(choice.message.content))
    if choice.message.tool_calls is not None:
      for c in choice.message.tool_calls:
        items.append(ToolCallPart(c.function.name, c.function.arguments, c.id))
    return ModelResponse(items, model_name=response.model, timestamp=timestamp)
  async def_process_streamed_response(self, response: AsyncStream[ChatCompletionChunk]) -> OpenAIStreamedResponse:
"""Process a streamed response, and prepare a streaming response to return."""
    peekable_response = _utils.PeekableAsyncStream(response)
    first_chunk = await peekable_response.peek()
    if isinstance(first_chunk, _utils.Unset):
      raise UnexpectedModelBehavior('Streamed response ended without content or tool calls')
    return OpenAIStreamedResponse(
      _model_name=self._model_name,
      _response=peekable_response,
      _timestamp=datetime.fromtimestamp(first_chunk.created, tz=timezone.utc),
    )
  def_get_tools(self, model_request_parameters: ModelRequestParameters) -> list[chat.ChatCompletionToolParam]:
    tools = [self._map_tool_definition(r) for r in model_request_parameters.function_tools]
    if model_request_parameters.result_tools:
      tools += [self._map_tool_definition(r) for r in model_request_parameters.result_tools]
    return tools
  async def_map_message(self, message: ModelMessage) -> AsyncIterable[chat.ChatCompletionMessageParam]:
"""Just maps a `pydantic_ai.Message` to a `openai.types.ChatCompletionMessageParam`."""
    if isinstance(message, ModelRequest):
      async for item in self._map_user_message(message):
        yield item
    elif isinstance(message, ModelResponse):
      texts: list[str] = []
      tool_calls: list[chat.ChatCompletionMessageToolCallParam] = []
      for item in message.parts:
        if isinstance(item, TextPart):
          texts.append(item.content)
        elif isinstance(item, ToolCallPart):
          tool_calls.append(self._map_tool_call(item))
        else:
          assert_never(item)
      message_param = chat.ChatCompletionAssistantMessageParam(role='assistant')
      if texts:
        # Note: model responses from this model should only have one text item, so the following
        # shouldn't merge multiple texts into one unless you switch models between runs:
        message_param['content'] = '\n\n'.join(texts)
      if tool_calls:
        message_param['tool_calls'] = tool_calls
      yield message_param
    else:
      assert_never(message)
  @staticmethod
  def_map_tool_call(t: ToolCallPart) -> chat.ChatCompletionMessageToolCallParam:
    return chat.ChatCompletionMessageToolCallParam(
      id=_guard_tool_call_id(t=t, model_source='OpenAI'),
      type='function',
      function={'name': t.tool_name, 'arguments': t.args_as_json_str()},
    )
  @staticmethod
  def_map_tool_definition(f: ToolDefinition) -> chat.ChatCompletionToolParam:
    return {
      'type': 'function',
      'function': {
        'name': f.name,
        'description': f.description,
        'parameters': f.parameters_json_schema,
      },
    }
  async def_map_user_message(self, message: ModelRequest) -> AsyncIterable[chat.ChatCompletionMessageParam]:
    for part in message.parts:
      if isinstance(part, SystemPromptPart):
        if self.system_prompt_role == 'developer':
          yield chat.ChatCompletionDeveloperMessageParam(role='developer', content=part.content)
        elif self.system_prompt_role == 'user':
          yield chat.ChatCompletionUserMessageParam(role='user', content=part.content)
        else:
          yield chat.ChatCompletionSystemMessageParam(role='system', content=part.content)
      elif isinstance(part, UserPromptPart):
        yield await self._map_user_prompt(part)
      elif isinstance(part, ToolReturnPart):
        yield chat.ChatCompletionToolMessageParam(
          role='tool',
          tool_call_id=_guard_tool_call_id(t=part, model_source='OpenAI'),
          content=part.model_response_str(),
        )
      elif isinstance(part, RetryPromptPart):
        if part.tool_name is None:
          yield chat.ChatCompletionUserMessageParam(role='user', content=part.model_response())
        else:
          yield chat.ChatCompletionToolMessageParam(
            role='tool',
            tool_call_id=_guard_tool_call_id(t=part, model_source='OpenAI'),
            content=part.model_response(),
          )
      else:
        assert_never(part)
  @staticmethod
  async def_map_user_prompt(part: UserPromptPart) -> chat.ChatCompletionUserMessageParam:
    content: str | list[ChatCompletio