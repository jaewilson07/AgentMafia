---
url: https://ai.pydantic.dev/examples/weather-agent/
session_id: pydantic_ai_docs
chunk_number: 3
title: Weather Agent Implementation with Pydantic
summary: This documentation chunk outlines the setup of a weather agent using Pydantic, including necessary imports, API key retrieval, and a function to stream messages from the agent. It specifies integration with Gradio for user interaction and details on required libraries and environment setup.
embedding: [-0.001561830285936594, 0.008533746935427189, 0.03905752673745155, -0.015305601060390472, -0.008816187269985676, 0.0016736297402530909, 0.009354169480502605, 0.017444081604480743, -0.02531207539141178, 0.011970109306275845, 0.014162387698888779, -0.015332499518990517, -0.01790136657655239, -0.03211755305528641, -0.022528015077114105, 0.00991232693195343, -0.029185548424720764, 0.03445777669548988, -0.024545449763536453, 0.04381867125630379, 0.038116056472063065, -0.0020123906433582306, 0.01098829135298729, -0.0023688040673732758, 0.010060272179543972, -0.022447317838668823, -0.03235964477062225, 0.06176038458943367, -0.0026411577127873898, -0.0030933991074562073, 0.0022006845101714134, -0.030557403340935707, 0.010006473399698734, -0.004562763497233391, 0.014686920680105686, 0.013341965153813362, 0.018990781158208847, -0.004525777418166399, 0.02268940955400467, -0.009744207374751568, 0.028943456709384918, -0.07574792951345444, 0.03720148652791977, 0.006899625062942505, -0.04715416207909584, 0.014216186478734016, -0.04720795899629593, 0.0576179213821888, 0.058209702372550964, 0.016045326367020607, -0.06660223007202148, 0.018587293103337288, -0.03117608278989792, 0.014323783107101917, -0.020981315523386, -0.026065248996019363, -0.017538227140903473, 0.015978079289197922, 0.009697133675217628, -0.005514319986104965, 0.029104851186275482, -0.007296387106180191, -0.007915066555142403, 0.04995167255401611, -0.03905752673745155, 0.006583560258150101, -0.015453546307981014, -0.009381068870425224, -0.035964127629995346, -0.01105553936213255, -0.005100746173411608, 0.057402726262807846, -0.013012450188398361, -0.08489362895488739, -0.011021915823221207, -0.009750931523740292, 0.029911823570728302, 0.010974842123687267, 0.030745698139071465, -0.04462564364075661, 0.0073569100350141525, -0.005174718797206879, -0.04836462438106537, 0.024101613089442253, -0.034592270851135254, -0.020389534533023834, -0.0464547835290432, -0.012064256705343723, -0.01301917526870966, -0.06670982390642166, -0.01518455520272255, 0.0066945189610123634, -0.01889663375914097, 0.005426898133009672, 0.09925775974988937, 0.036421410739421844, 0.010914319194853306, -0.028701363131403923, -0.011378329247236252, 0.0005909401224926114, 0.04263510927557945, -0.05132352560758591, -0.09430832415819168, 0.020376086235046387, 0.016314318403601646, -0.019448066130280495, 0.027759894728660583, 0.007020670920610428, -0.029454538598656654, -0.02536587230861187, -0.10700470954179764, -0.00991232693195343, -0.057402726262807846, -0.010120795108377934, 0.004263510927557945, 0.011472475714981556, -0.009011206217110157, -0.05702614039182663, 0.016677455976605415, -0.03908442705869675, -0.03790086507797241, -0.005621916614472866, 0.009569362737238407, 0.022084180265665054, 0.0012928390642628074, 0.010120795108377934, -0.01987845078110695, -0.046643078327178955, -0.05417483299970627, -0.005255416035652161, 0.03491505980491638, 0.011815439909696579, 0.04443735256791115, -0.03682490065693855, -0.026051800698041916, 0.010046822018921375, -0.06401991099119186, -0.005463884212076664, -0.013785799965262413, 0.032305847853422165, 0.011970109306275845, -0.03469986841082573, -0.02983112633228302, 0.013449561782181263, -0.03147197514772415, -0.007975589483976364, -0.058962877839803696, 0.01505005918443203, -0.034323278814554214, 0.01920597441494465, 0.022716309875249863, 0.030880192294716835, -0.027706095948815346, 0.01687919907271862, -0.0074712312780320644, 0.04336138442158699, 0.03679800033569336, 0.030745698139071465, -0.006334743462502956, -0.025621414184570312, -0.034188784658908844, -0.02563486434519291, -0.017161639407277107, -0.03044980764389038, -0.05355615168809891, -0.012299624271690845, 0.023375337943434715, 0.012447568587958813, -0.06558006256818771, -0.019596010446548462, -0.02540622092783451, -0.01884283497929573, -0.004892277996987104, 0.011216933839023113, 0.014148938469588757, -0.024101613089442253, -0.029804227873682976, -0.0073098368011415005, -0.008607719093561172, -0.010813447646796703, -0.00260753370821476, 0.008150434121489525, 0.02330808900296688, -0.04723485931754112, -0.03999899700284004, -0.020981315523386, 0.03252103924751282, -0.0059547931887209415, -0.006291032303124666, 0.03908442705869675, -0.0064927758648991585, 0.02459924854338169, 0.051377326250076294, 0.006482688710093498, -0.007652800530195236, -0.03456537425518036, 0.09075763821601868, -0.032440342009067535, 0.026159396395087242, -0.007874717935919762, 0.02554071694612503, 0.05452452227473259, 0.03604482486844063, -0.027975087985396385, 0.026979820802807808, -0.0567033514380455, 0.018103109672665596, 0.022810455411672592, -0.054928008466959, -0.034403979778289795, 0.0540403388440609, -0.05161941796541214, 0.02867446467280388, -0.0048250299878418446, -0.05724133178591728, -0.01888318359851837, -0.041290152817964554, 0.004888915456831455, -0.061114806681871414, 0.03233274444937706, -0.05412103608250618, 0.020308837294578552, 0.039138223975896835, -0.02679152600467205, 0.0021889160852879286, 0.03050360456109047, 0.05933946371078491, -0.023469485342502594, 0.011929760687053204, 0.032036855816841125, 0.031014688313007355, 0.025486918166279793, 0.007652800530195236, -0.030664999037981033, 0.038869231939315796, -0.054766613990068436, 0.04094046354293823, 0.00021056969126220793, 0.01751132868230343, 0.03857334330677986, -0.006748317275196314, 0.015816684812307358, 0.030799495056271553, -0.01722888834774494, 0.027342958375811577, 0.006808840669691563, -0.014108589850366116, -0.060845814645290375, 0.059500858187675476, 0.0334894061088562, 0.0674092024564743, -0.049682680517435074, 0.007625901140272617, -0.02469339407980442, -0.0050570350140333176, -0.020349185913801193, -0.007182065863162279, 0.008311828598380089, -0.04158604517579079, -0.028378574177622795, 0.004656910430639982, -0.0059144445694983006, -0.014417929574847221, 0.046912070363759995, 0.021357903257012367, -0.0212099589407444, 0.025661762803792953, 0.006744955200701952, 0.0007939444039948285, -0.028728263452649117, -0.008883435279130936, -0.0018039224669337273, 0.04656238108873367, 0.021586546674370766, -0.06342813372612, 2.1106880012666807e-05, 0.012077705934643745, 0.03607172518968582, 0.0020998127292841673, 0.015345949679613113, -0.055788781493902206, 0.013725277036428452, 0.011472475714981556, 0.01040323544293642, -0.01190286222845316, 0.02326774038374424, 0.0067718541249632835, -0.020214689895510674, 0.010093895718455315, 0.0063078440725803375, 0.016811951994895935, 0.010544456541538239, 0.030342210084199905, -0.010356162674725056, 0.020510580390691757, -0.0118356142193079, 0.042446814477443695, 0.03870783746242523, 0.014794517308473587, -0.014929013326764107, 0.017847567796707153, 0.005188168492168188, -0.01558804139494896, 0.014861765317618847, -0.029104851186275482, 0.04024108871817589, -0.011640595272183418, -0.018829386681318283, 0.040160391479730606, -0.01595117896795273, -0.0028580317739397287, 0.05573498085141182, -0.004186175763607025, -0.021223407238721848, 0.007525029592216015, -0.02781369350850582, 0.08064357191324234, -0.03402739018201828, 0.01901767961680889, -0.02617284655570984, -0.058209702372550964, -0.023065997287631035, 0.05059725046157837, -0.009212949313223362, -0.056918542832136154, -0.04357657954096794, 0.014135489240288734, 0.00398443266749382, -0.0045762131921947, -0.019394267350435257, -0.03171406686306, -0.052587784826755524, -0.004885553382337093, 0.062405966222286224, 0.03200995549559593, -0.008567370474338531, -0.019757404923439026, -0.015238353051245213, 0.014229635708034039, 0.04710036516189575, -0.017430631443858147, 0.00020069268066436052, -0.05890907719731331, -0.034672968089580536, -0.011580072343349457, 0.0038196754176169634, 0.04155914485454559, 0.010167868807911873, -0.04212402552366257, 0.010961392894387245, 0.01603187806904316, 0.023590531200170517, 0.0171885397285223, 0.008950683288276196, -0.008520296774804592, -0.012803982011973858, -0.012575339525938034, 0.03273623064160347, -0.0259038545191288, 0.018022412434220314, -0.029992522671818733, 0.04174743965268135, -0.014592774212360382, -0.014095140621066093, 0.007175340782850981, 0.02424955926835537, -0.02125030755996704, -0.052722278982400894, -0.03408118709921837, 0.029400741681456566, 0.06348192691802979, -0.03631381690502167, -0.02594420313835144, -0.020039847120642662, -0.057940710335969925, -0.041021160781383514, -0.019192524254322052, 0.015211453661322594, -0.012427394278347492, 0.01634121686220169, 0.00031417334685102105, -0.055842578411102295, -0.029804227873682976, -0.029400741681456566, 0.002151929773390293, 0.03550684079527855, -0.002400746801868081, 0.031956158578395844, -0.0025184303522109985, 0.0014912200858816504, 0.026132497936487198, -0.06751679629087448, -0.00032699244911782444, -0.012198751792311668, 0.025702111423015594, 0.011761641129851341, -0.010712575167417526, 0.030745698139071465, 0.04325379058718681, 0.009650059975683689, 0.009434867650270462, 0.016448814421892166, -0.003456537378951907, 0.01647571288049221, 0.002436051843687892, 0.006099375896155834, 0.006297756917774677, 0.002674781484529376, 0.02781369350850582, -0.05858628824353218, 0.04938678815960884, -0.050893139094114304, 0.009784555993974209, -0.016690906137228012, -0.006637358572334051, -0.020564379170536995, -0.009186050854623318, -0.02303909882903099, 0.038250554352998734, 0.051242828369140625, -0.010954667814075947, -0.06122240424156189, 0.03857334330677986, -0.0034094639122486115, -0.02736985683441162, 0.05455142259597778, 0.028593767434358597, -0.05681094899773598, 0.03004631958901882, -0.02438405528664589, -0.037658773362636566, -0.02853996865451336, 0.059285666793584824, 0.017618926241993904, 0.0025453295093029737, -0.005383186973631382, -0.023523282259702682, 0.04120945557951927, 0.01187596283853054, -0.02394021861255169, -0.015063508413732052, -0.03938031569123268, -0.024047816172242165, 0.042581312358379364, -0.040563877671957016, -0.015413197688758373, -0.0055950176902115345, 0.015695638954639435, -0.010107344947755337, -0.039272718131542206, 0.004996512085199356, -0.029051052406430244, -0.014135489240288734, 0.02496238611638546, -0.004996512085199356, -0.03792776167392731, 0.05955465883016586, 0.03854644298553467, 0.035345446318387985, 0.029911823570728302, 0.02630734257400036, 0.0017366745742037892, -0.03469986841082573, 0.02032228745520115, -0.024572348222136497, -0.0033405348658561707, 0.034672968089580536, 0.03456537425518036, 0.0010583123657852411, 0.019905351102352142, 0.029400741681456566, 0.01826450414955616, -0.007229139097034931, 0.009851804003119469, -0.05086624249815941, -0.02428990788757801, 0.022393519058823586, 0.04276960343122482, -0.03580273315310478, 0.013415937311947346, 0.016502611339092255, -0.015574592165648937, 0.002896699355915189, 0.028297876939177513, -0.03295142576098442, 0.041370850056409836, -0.01728268712759018, -0.023913320153951645, -0.00841942522674799, -0.007296387106180191, 0.037578076124191284, 0.03870783746242523, 0.011304356157779694, -0.016233621165156364, 0.010995016433298588, -0.004303859546780586, -0.019851552322506905, 0.015964629128575325, 0.010033372789621353, -0.03031531162559986, -0.012158403173089027, -0.04484083876013756, -0.01973050646483898, 0.020887168124318123, 0.03773947060108185, -0.018950432538986206, 0.015870481729507446, -0.021021664142608643, 0.03634071350097656, 0.02040298469364643, -0.0171885397285223, -0.028513070195913315, -0.004784681368619204, 0.03566823527216911, -0.00663063395768404, 0.004367745015770197, -0.0053697372786700726, -0.005800123326480389, -0.014579324051737785, -0.0017534865764901042, 0.014902113936841488, -0.006516312249004841, -0.004014694131910801, 0.009448316879570484, 0.003293461399152875, -0.022944951429963112, -0.018520046025514603, -0.06149139627814293, -0.022971849888563156, -0.019488414749503136, 0.025890406221151352, 0.00917932577431202, -0.0025688661262392998, 0.012662761844694614, -0.037040092051029205, -0.004902365151792765, -0.03857334330677986, -0.0155207933858037, -0.006728142965584993, -0.015843583270907402, -0.0022847442887723446, 0.010019923560321331, -0.024800991639494896, -0.008520296774804592, -0.011983559466898441, 0.025204477831721306, 0.019945699721574783, 0.006284307688474655, -0.022406969219446182, 0.020887168124318123, 0.022581813856959343, -0.042581312358379364, 0.044544946402311325, -0.03149887174367905, 0.013947195373475552, 0.022393519058823586, -0.017067493870854378, 0.010073721408843994, -0.005026773549616337, -0.022164877504110336, 0.015561142936348915, -0.014283434487879276, 0.023994017392396927, -0.003594395238906145, -0.003685179864987731, 0.015198004432022572, 0.0352647490799427, -0.0037221661768853664, -0.04223162308335304, 0.010349437594413757, 0.0014433061005547643, -0.015440096147358418, -0.02174794115126133, -0.004508965648710728, 0.011882687918841839, -0.01580323465168476, 0.008688416332006454, -0.03478056564927101, -0.06821617484092712, -0.01889663375914097, -0.014095140621066093, -0.0384119488298893, 0.017309585586190224, 0.009017931297421455, -0.019838102161884308, -0.038788534700870514, -0.015910830348730087, 0.009811455383896828, -0.0038297625724226236, -0.028862759470939636, 0.02197658270597458, -0.017565127462148666, 0.0008044518763199449, 0.003377521177753806, -0.02151929773390293, -0.007377084344625473, -0.010329263284802437, -0.003111892146989703, -0.050032369792461395, 0.006660895422101021, 0.04180123656988144, -0.024410953745245934, -0.013812699355185032, 0.0288089606910944, 0.022944951429963112, -0.0026932747568935156, 0.018331751227378845, -0.0221110787242651, -0.031633369624614716, -0.011062264442443848, -0.029992522671818733, -0.028593767434358597, -0.034054290503263474, -0.030933991074562073, -0.027073966339230537, 0.02375192567706108, -0.04804183170199394, 0.019905351102352142, 0.05729513242840767, -0.01982465386390686, -0.003520422615110874, 0.029508337378501892, 0.009730757214128971, 0.019084926694631577, 0.0035742209292948246, 0.0018896633991971612, -0.004458529409021139, -0.016247069463133812, 0.008648067712783813, 0.028190281242132187, -0.008600994944572449, 0.018600743263959885, 0.018560394644737244, 0.02178828977048397, -0.02505653351545334, -0.002481444040313363, 0.03445777669548988, -0.01437758095562458, -0.025567615404725075, -0.027759894728660583, 0.00984507892280817, 0.01426998432725668, 0.02045678347349167, 0.010887419804930687, 0.024195760488510132, 0.02625354379415512, -0.04002589359879494, 0.009643335826694965, 0.03518405184149742, 0.019448066130280495, -0.01572253741323948, -0.025204477831721306, 0.018923532217741013, -0.0032833742443472147, 0.03219825029373169, -0.019945699721574783, 0.006862638518214226, -0.0212099589407444, -0.04091356694698334, 0.021102361381053925, -0.03553374111652374, -0.00042492206557653844, 0.006822289898991585, 0.020120544359087944, 0.0074779558926820755, 0.026132497936487198, -0.011956660076975822, 0.01301917526870966, 0.01876213774085045, 0.03149887174367905, 0.010578080080449581, -0.01383959874510765, 0.04201642796397209, 0.007807470392435789, 0.0015097132418304682, -0.004189538303762674, 0.04134395346045494, -0.054632119834423065, -0.001294520334340632, 0.03464607149362564, -0.06009263917803764, 0.0056353663094341755, -0.08952028304338455, 0.024545449763536453, 0.052318792790174484, 3.8089576264610514e-05, 0.02402091585099697, 0.010490657761693, -0.013449561782181263, 0.027571599930524826, -0.013893396593630314, -0.04580920562148094, -0.006079201586544514, 0.019488414749503136, 0.007706598844379187, 0.04788043722510338, -0.009118802845478058, 0.05344855785369873, 0.023590531200170517, -0.055089402943849564, 0.002827770309522748, -0.00987197831273079, -0.005366375204175711, 0.00794869102537632, -0.028997253626585007, -0.029615934938192368, -0.002357035642489791, 0.008997756987810135, 0.019945699721574783, -0.03273623064160347, -0.0012163446517661214, 0.021546198055148125, -0.02523137629032135, 0.025433121249079704, -0.04155914485454559, 0.0030194264836609364, -0.002639476442709565, 0.016314318403601646, 0.011553172953426838, -0.030799495056271553, 0.008042837493121624, 0.047988034784793854, -0.023859521374106407, -0.0012625775998458266, -0.023119796067476273, -0.08715315908193588, -0.004683809820562601, 0.03604482486844063, -0.0028916557785123587, 0.03854644298553467, -0.006371729541569948, 0.004145827144384384, 0.018869735300540924, -0.03319351747632027, -0.01701369509100914, -0.0058068479411304, -0.059769850224256516, 0.008668242022395134, -0.0008666561334393919, -0.019838102161884308, 0.000850264448672533, -0.015292150899767876, -0.001033934997394681, 0.008338727988302708, 0.012696386314928532, 0.0005943024880252779, 0.005208342801779509, 0.032978326082229614, -0.045836105942726135, 0.013207469135522842, -0.03448467701673508, 0.011035365052521229, -0.012615688145160675, -0.003078268375247717, 0.004972975235432386, 0.011815439909696579, -0.009260023012757301, -0.03262863680720329, -0.04513672739267349, -0.006243959069252014, -0.026199745014309883, -0.0015719174407422543, -0.02348293364048004, 0.03187546133995056, -0.022528015077114105, -0.014902113936841488, 0.015883931890130043, -0.01364457979798317, -0.025796258822083473, -0.014525526203215122, -0.009192775003612041, -0.0343770794570446, 0.014364131726324558, 0.01813000813126564, 0.030288411304354668, -0.04411455988883972, -0.013382313773036003, 0.004320671781897545, 0.021990032866597176, -0.0006825652671977878, 0.01040323544293642, -0.004418180789798498, -0.025957653298974037, 0.005436985287815332, 0.009697133675217628, 0.0011448939330875874, -0.016408463940024376, 0.013853047974407673, -0.01301917526870966, -0.013503359630703926, -0.02059127762913704, -0.029938723891973495, 0.015749435871839523, -0.014014443382620811, 0.0290241539478302, 0.005618554074317217, 0.012131504714488983, -0.08629238605499268, -0.024141963571310043, 0.01639501564204693, -0.010255290195345879, -0.005326026119291782, 0.0038532994221895933, -0.012077705934643745, 0.012662761844694614, -0.026509085670113564, -0.0183048527687788, -0.007457781583070755, -0.00028328137705102563, -0.01978430524468422, -0.036905597895383835, 0.044679444283246994, -0.019273221492767334, 0.038788534700870514, 0.029481438919901848, 0.04255441203713417, -0.013146946206688881, -0.01687919907271862, -0.014095140621066093, -0.06122240424156189, 0.031687166541814804, -0.02800198644399643, -0.003390970639884472, 0.004071854520589113, 0.03964930772781372, 0.011970109306275845, 0.0016265562735497952, -0.016354667022824287, 0.004724158439785242, 0.012629138305783272, 0.0004257626715116203, -0.06224457174539566, 0.009165875613689423, -0.0028748437762260437, 0.035883430391550064, 0.005958155728876591, -0.02867446467280388, 0.009811455383896828, -0.018103109672665596, 0.02236662060022354, -0.01960946060717106, 0.024679945781826973, 0.02236662060022354, -0.0035742209292948246, -0.004593025427311659, -0.009784555993974209, 0.012958652339875698, 0.011822164058685303, 0.018103109672665596, -0.01223910041153431, 0.010134244337677956, 0.018183806911110878, 0.0611686035990715, -0.03160646930336952, 0.03235964477062225, 0.007047570310533047, 0.006734868045896292, 0.014364131726324558, 0.01938081718981266, -0.0018022411968559027, -0.03469986841082573, -0.027571599930524826, -0.003997881896793842, -0.020295388996601105, -0.010349437594413757, 0.003360709175467491, -0.0047376081347465515, -0.038788534700870514, 0.03031531162559986, -0.0018879821291193366, -0.03160646930336952, -0.006022041197866201, -0.0008994394447654486, 0.030745698139071465, 0.014929013326764107, 0.0234425850212574, 0.01938081718981266, 0.03693249449133873, -0.032305847853422165, 0.013947195373475552, 0.03327421471476555, -0.02049713209271431, -0.015265252441167831, 0.0007889008265919983, -0.01639501564204693, -0.002309962175786495, 0.02224557474255562, 0.028297876939177513, 0.013570607639849186, 0.02205727994441986, -0.031068487092852592, -0.005151181947439909, 0.008318553678691387, -0.03174096345901489, 0.014054792001843452, 0.012642587535083294, -0.00997957494109869, 0.02001294679939747, 0.02461269684135914, -0.01991880126297474, 0.005124283023178577, -0.020389534533023834, 0.022608712315559387, -0.04632028937339783, -0.004767869599163532, 0.013974093832075596, -0.023065997287631035, 0.016354667022824287, 0.0007691467762924731, -0.0032699245493859053, 0.011068988591432571, -0.017121290788054466, 0.00017494936764705926, 0.07316561043262482, -0.009508839808404446, -0.013436111621558666, 0.003880198346450925, 0.04303859546780586, 0.02567521296441555, 0.004502240568399429, 0.0004375310381874442, -0.015009710565209389, -0.0037557899486273527, -0.007558653596788645, -0.0012676211772486567, 0.02348293364048004, -0.006062389817088842, 0.019945699721574783, 0.0011995327658951283, -0.03292452543973923, 0.031229881569743156, -0.006566748488694429, -0.008580819703638554, 0.010544456541538239, 0.014054792001843452, -0.024141963571310043, -0.0055546690709888935, 0.009925776161253452, -0.01982465386390686, -0.050166863948106766, 0.018008962273597717, -0.05221119895577431, -0.007081193849444389, 0.038519542664289474, 0.014122039079666138, -0.03999899700284004, 0.016986796632409096, -0.004707346670329571, -0.020295388996601105, -0.011257282458245754, 0.025258276611566544, -0.003384245792403817, 0.061598990112543106, 0.0004026462556794286, -0.032709334045648575, -0.009226399473845959, -0.04656238108873367, -0.0016425276407971978, 0.029615934938192368, 0.012904854491353035, -0.044006966054439545, -0.012286174111068249, -0.014727269299328327, 0.013274717144668102, -0.004895640537142754, -0.00022822224127594382, 0.0048183053731918335, -0.014000993221998215, 0.0562729649245739, 0.012010457925498486, -0.0006695359479635954, 6.603945075767115e-05, 0.0486874133348465, 0.03276313096284866, -0.02170759253203869, -0.0117212925106287, 0.04193573072552681, -0.0072022401727736, 0.049359891563653946, 0.02546001970767975, 0.010544456541538239, 0.02813648246228695, 0.025029633194208145, 0.004213075153529644, 0.019891900941729546, -0.018385550007224083, 0.0042332494631409645, 0.022043831646442413, 0.011580072343349457, 0.0008498441311530769, 0.029535235837101936, -0.027248810976743698, 0.031767863780260086, 0.04449114948511124, 0.00194850517436862, 0.00969040859490633, -0.016717804595828056, -0.002925279550254345, 0.051108334213495255, 0.011512824334204197, -0.024128513410687447, 0.008762389421463013, 0.05519700050354004, -0.025661762803792953, -0.021183058619499207, -0.008298379369080067, 0.022487666457891464, -0.03741667792201042, -0.03031531162559986, -0.008412701077759266, -0.02267596125602722, -0.0004867060051765293, 0.023496383801102638, -0.014095140621066093, 0.005638728383928537, -0.03464607149362564, -0.005305851809680462, -0.010033372789621353, 0.004761144518852234, 0.00030891961068846285, 0.0103830611333251, -0.020819921046495438, -0.0023032373283058405, -0.007921791635453701, 0.0024326893035322428, 0.01109588798135519, 0.01969015784561634, 0.0013701741117984056, -0.0005716063315048814, -0.0018644453957676888, 0.015440096147358418, 0.03316661715507507, -0.03071879781782627, 0.01566873863339424, -0.0067247808910906315, 0.032978326082229614, 0.013691653497517109, 0.009071729145944118, 0.016233621165156364, 0.00862116925418377, -0.026293892413377762, 0.030207714065909386, 0.019031129777431488, 0.05551978945732117, 0.013355414383113384, -0.018923532217741013, 0.0005985054885968566, 0.006472601555287838, 0.018520046025514603, 0.02263561263680458, -0.020658526569604874, 0.012689661234617233, -0.02983112633228302, 0.00833200290799141, 0.028782062232494354, -0.02706051804125309, 0.008715315721929073, 0.027410205453634262, 0.010578080080449581, 0.01791481487452984, 0.010457034222781658, 0.01634121686220169, -0.01763237453997135, -0.029642833396792412, 0.0005774905439466238, 0.026145948097109795, 0.007800745777785778, -0.0073501854203641415, 0.004754419904202223, 0.018735239282250404, 0.027383306995034218, 0.011694394052028656, -0.012730009853839874, -0.030691899359226227, -0.0183048527687788, -0.01866799034178257, -0.008816187269985676, -0.023725025355815887, 0.015238353051245213, 0.0046669975854456425, 0.006502863019704819, 0.0006548255332745612, -0.038734737783670425, 0.0071955155581235886, -0.011896137148141861, -0.005749687552452087, 0.028835859149694443, 0.023200493305921555, 0.021236857399344444, -0.016314318403601646, -0.0009431504877284169, 0.003997881896793842, 0.015493894927203655, -0.010564630851149559, 0.0062204222194850445, -0.0013895077863708138, -0.007908342406153679, 0.005406723823398352, -0.002743710530921817, -0.00064473832026124, 0.006149812135845423, 0.011156410910189152, 0.01630086824297905, -0.0160722266882658, -0.03265553340315819, 0.024935487657785416, 0.014929013326764107, -0.033516306430101395, 0.01969015784561634, 0.022931501269340515, -0.01934046857059002, 0.02313324622809887, 0.0034212321043014526, -0.03631381690502167, 0.011674218811094761, -0.01973050646483898, -0.004905727691948414, -0.019986048340797424, 0.03184856101870537, -0.0028008711524307728, 0.023913320153951645, 0.02045678347349167, -0.02032228745520115, 0.010867245495319366, 0.0034767116885632277, 0.02638803981244564, -0.014189287088811398, 0.031767863780260086, 0.01647571288049221, -0.009582812897861004, -0.0012886361218988895, -0.045217424631118774, -0.025285175070166588, -0.05452452227473259, -0.00455603888258338, 0.0004329077492002398, -0.03870783746242523, -0.030611202120780945, 0.006243959069252014, -0.022164877504110336, 0.020080195739865303, 0.004337483551353216, -0.018950432538986206, 0.0013264629524201155, 0.0117212925106287, 0.0006909712101332843, 0.0038936480414122343, 0.07472576200962067, -0.004434993024915457, -0.016408463940024376, 0.00260753370821476, 0.016771603375673294, 0.00402814382687211, 0.013543708249926567, -0.008668242022395134, -0.00023557747772429138, -0.02392677031457424, -0.007491405587643385, 0.006196885369718075, 0.006660895422101021, -0.01250136736780405, 0.03693249449133873, -0.014606223441660404, -0.03472676873207092, 0.02759850025177002, 0.01638156548142433, -0.021156160160899162, 0.010046822018921375, 0.05027446150779724, 0.0030143829062581062, -0.014350681565701962, -0.010140969417989254, 0.014888664707541466, -0.0017232249956578016, -0.05756412446498871, 0.04736935347318649, 0.05172701179981232, 0.01626051962375641, -0.040214188396930695, -0.01364457979798317, -0.02053748071193695, -0.02921244688332081, 0.014364131726324558, -0.01714819110929966, 0.007040845230221748, -0.012676212005317211, -0.0017333122668787837, -0.013987543992698193, 0.014713820070028305, -0.012252550572156906, 0.0014491901965811849, 0.00716861616820097, 0.03695939481258392, 0.012508092448115349, -0.012911578640341759, -0.022339722141623497, -0.018815936520695686, 0.02558106556534767, 0.006633996032178402, 0.017753420397639275, -0.030530504882335663, -0.050435855984687805, -0.03225204721093178, -0.004727520979940891, 0.03631381690502167, -0.012104605324566364, 0.029185548424720764, -0.03779326751828194, 0.013604231178760529, 0.0209947656840086, 0.033247314393520355, 0.0015920918667688966, -0.04077906906604767, 0.02313324622809887, -0.01626051962375641, -0.038331251591444016, 0.025594515725970268, -0.013543708249926567, 0.002816001884639263, 0.0045392271131277084, -0.011728017590939999, 0.006966872606426477, 0.023684676736593246, 0.0017249062657356262, -0.011593521572649479, 0.0261190477758646, 0.05568118393421173, 0.002010709373280406, -0.025083431974053383, -0.0012541715987026691, -0.01371182780712843, -0.025823157280683517, 0.012777083553373814, 0.01901767961680889, 0.019528763368725777, -0.005346200428903103, -0.021694142371416092, 0.020550929009914398, -0.02063162624835968, -0.007087918929755688, 0.015978079289197922, 0.007148441858589649, 0.020376086235046387, -0.017027145251631737, 0.023590531200170517, -0.021909335628151894, -0.015843583270907402, -0.01116313599050045, 0.005023411009460688, -0.015399747528135777, -0.004925902001559734, -0.013725277036428452, 0.0009944268967956305, -0.024572348222136497, -0.00014552845095749944, -0.021062012761831284, 0.029400741681456566, 0.0171885397285223, 0.013046074658632278, 0.013348689302802086, 0.011983559466898441, -0.007148441858589649, -0.014740719459950924, -0.005608466919511557, 0.0018778949743136764, -0.017000244930386543, -0.0495750829577446, 0.013382313773036003, 0.005332751199603081, -3.908778671757318e-05, -0.011976834386587143, -0.015816684812307358, 0.02956213615834713, 0.015883931890130043, -0.02303909882903099, 0.0029538599774241447, -0.03591032698750496, -0.0023385423701256514, 0.02840547449886799, 0.026872223243117332, -0.017874466255307198, -0.02558106556534767, -0.0022729758638888597, -0.007962140254676342, -0.017403732985258102, -0.025621414184570312, -0.019461514428257942, 0.007161891553550959, 0.01862764172255993, 0.01897733099758625, -0.015171105042099953, 0.006755042355507612, -0.007545203901827335, -0.007551928516477346, -0.019797753542661667, 0.0207661222666502, 0.009031380526721478, 0.010947942733764648, -0.01111606229096651, 0.009165875613689423, -0.0019216061336919665, 0.010981567203998566, -0.02442440390586853, 0.00790161732584238, -0.03550684079527855, -0.014660022221505642, -0.003923909738659859, -0.006280945148319006, -0.02045678347349167, -0.006818927824497223, 0.005618554074317217, 0.008022663183510303, 0.025796258822083473, 0.014122039079666138, 0.019932249560952187, 0.00715516647323966, -0.0023940219543874264, 0.009576087817549706, -0.01248119305819273, -0.009145701304078102, 0.006122912745922804, 0.053959641605615616, 0.008796012960374355, -0.010140969417989254, 0.0016450494294986129, 0.0038633865769952536, -0.011277456767857075, -0.00014258635928854346, -0.013698378577828407, 0.01121020969003439, 0.004344208166003227, -0.009300371631979942, 0.004972975235432386, -0.0052520534954965115, -0.016906099393963814, -0.0052520534954965115, -0.004986424930393696, 0.0026983183342963457, 0.009401243180036545, -0.006270857993513346, -0.009441591799259186, 0.002674781484529376, -0.005793398711830378, 0.011795265600085258, -0.012958652339875698, 0.007114817854017019, 0.0522380955517292, -0.002441095421090722, -0.017753420397639275, -0.010134244337677956, 0.003360709175467491, -0.024774091318249702, 0.012750184163451195, -0.040967363864183426, -0.012198751792311668, -0.0034430876839905977, 0.0276791974902153, 0.008473224006593227, -0.000857409555464983, 0.02357708103954792, 0.0022242211271077394, 0.028513070195913315, 0.003374158637598157, 0.01862764172255993, 0.007693149149417877, -0.007101368624716997, -0.02161344513297081, -0.025527266785502434, 0.010820171795785427, 0.01661020889878273, -0.005608466919511557, -0.015413197688758373, -0.012602238915860653, 0.03381219878792763, -0.006082564126700163, 0.011990283615887165, -0.009724033065140247, 0.05062415078282356, -0.017134740948677063, -0.006876088213175535, -0.01643536426126957, -0.01691954769194126, 0.0009759337990544736, -0.02711431495845318, -0.03962240740656853, 0.025742460042238235, -0.00999974925071001, -0.019300119951367378, 0.036367613822221756, -0.019972598180174828, 0.006011954043060541, 0.005046947859227657, 0.003241344355046749, 0.0033892893698066473, 0.00982490461319685, 0.0047376081347465515, 0.025258276611566544, 0.04145154729485512, 0.024410953745245934, 0.0051713562570512295, -0.03679800033569336, 0.005006599240005016, 0.0034666245337575674, -0.0005030976608395576, -0.011048814281821251, -4.418391108629294e-05, -0.002520111622288823, -0.010174592956900597, -0.017484430223703384, 0.0028613940812647343, -0.012205476872622967, 0.004293772391974926, 0.007161891553550959, -0.00042408148874528706, -0.026468737050890923, -0.009945950470864773, 0.02184208855032921, 0.02671082876622677, 0.0035876703914254904, 0.0039205471985042095, -0.004371107555925846, -0.004838479682803154, 0.0033186792861670256, 0.018950432538986206, 0.0016013383865356445, 0.0034111449494957924, -0.03951480984687805, 0.0006405353778973222, 0.015372849069535732, -0.029185548424720764, -0.006059027276933193, 0.0042332494631409645, 0.00864134356379509, -0.0008200029260478914, -0.011559898033738136, 0.00718879047781229, -0.00776039669290185, 0.05175391212105751, 0.013288166373968124, 0.02001294679939747, -0.0036011200863868, 0.035210952162742615, 0.022662511095404625, 0.009333995170891285, 0.013120046816766262, -0.014700370840728283, -0.017847567796707153, -0.005006599240005016, -0.0117212925106287, 0.027921289205551147, -0.040214188396930695, 0.004848566837608814, 0.02371157705783844, -0.01705404371023178, 0.02107546292245388, -0.03835814818739891, 0.016139473766088486, 0.012945203110575676, 0.010100620798766613, 0.006647445727139711, -0.019044578075408936, 0.014391031116247177, 0.03956861048936844, 0.017497878521680832, -0.010954667814075947, -0.016085674986243248, 0.018829386681318283, -0.011580072343349457, 0.015332499518990517, 0.005608466919511557, -0.01433723233640194, 0.014552425593137741, -0.013187294825911522, -0.026872223243117332, -0.014014443382620811, 0.006738230120390654, 0.004925902001559734, 0.03287072852253914, 0.009091903455555439, 0.015292150899767876, 0.00017568489420227706, 0.044275954365730286, -0.025621414184570312, -0.00725603848695755, 0.0005152863450348377, 0.009858528152108192, 0.0028983803931623697, -0.03044980764389038, -0.024047816172242165, 0.004508965648710728, -0.013705102726817131, -0.03117608278989792, 0.04053697735071182, -0.022931501269340515, -0.04010659083724022, 0.004663635510951281, 0.0038701111916452646, -0.018372101709246635, -1.3298516932991333e-05, 0.008991031907498837, -0.029804227873682976, -0.022299373522400856, -0.01187596283853054, -0.028513070195913315, 0.04763834550976753, -0.027047067880630493, 0.019232872873544693, -0.010329263284802437, 0.0008279886096715927, 0.015601491555571556, 0.020550929009914398, -0.05250708758831024, 0.06245976313948631, -0.01433723233640194, -0.004949438385665417, -6.283466791501269e-05, 0.009340720251202583, 0.014108589850366116, -0.0032228510826826096, 0.041290152817964554, -0.029454538598656654, 0.033919792622327805, -0.0196498092263937, -0.0366097055375576, 8.253617852460593e-05, -0.004169363994151354, -0.023913320153951645, 0.024047816172242165, -0.004108841065317392, 0.01572253741323948, 0.0062674954533576965, 0.020039847120642662, 0.013422662392258644, -0.02875516191124916, 0.014041341841220856, -0.015332499518990517]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:18:07.029386", "url_path": "/examples/weather-agent/", "chunk_size": 4388}
updated_dt: 2025-03-15T11:18:07.029386
---
```
from__future__import annotations as _annotations
importjson
importos
fromhttpximport AsyncClient
frompydantic_ai.messagesimport ToolCallPart, ToolReturnPart
frompydantic_ai_examples.weather_agentimport Deps, weather_agent
try:
  importgradioasgr
except ImportError as e:
  raise ImportError(
    'Please install gradio with `pip install gradio`. You must use python>=3.10.'
  ) frome
TOOL_TO_DISPLAY_NAME = {'get_lat_lng': 'Geocoding API', 'get_weather': 'Weather API'}
client = AsyncClient()
weather_api_key = os.getenv('WEATHER_API_KEY')
# create a free API key at https://geocode.maps.co/
geo_api_key = os.getenv('GEO_API_KEY')
deps = Deps(client=client, weather_api_key=weather_api_key, geo_api_key=geo_api_key)

async defstream_from_agent(prompt: str, chatbot: list[dict], past_messages: list):
  chatbot.append({'role': 'user', 'content': prompt})
  yield gr.Textbox(interactive=False, value=''), chatbot, gr.skip()
  async with weather_agent.run_stream(
    prompt, deps=deps, message_history=past_messages
  ) as result:
    for message in result.new_messages():
      for call in message.parts:
        if isinstance(call, ToolCallPart):
          call_args = (
            call.args.args_json
            if hasattr(call.args, 'args_json')
            else json.dumps(call.args.args_dict)
          )
          metadata = {
            'title': f'🛠️ Using {TOOL_TO_DISPLAY_NAME[call.tool_name]}',
          }
          if call.tool_call_id is not None:
            metadata['id'] = {call.tool_call_id}
          gr_message = {
            'role': 'assistant',
            'content': 'Parameters: ' + call_args,
            'metadata': metadata,
          }
          chatbot.append(gr_message)
        if isinstance(call, ToolReturnPart):
          for gr_message in chatbot:
            if (
              gr_message.get('metadata', {}).get('id', '')
              == call.tool_call_id
            ):
              gr_message['content'] += (
                f'\nOutput: {json.dumps(call.content)}'
              )
        yield gr.skip(), chatbot, gr.skip()
    chatbot.append({'role': 'assistant', 'content': ''})
    async for message in result.stream_text():
      chatbot[-1]['content'] = message
      yield gr.skip(), chatbot, gr.skip()
    past_messages = result.all_messages()
    yield gr.Textbox(interactive=True), gr.skip(), past_messages

async defhandle_retry(chatbot, past_messages: list, retry_data: gr.RetryData):
  new_history = chatbot[: retry_data.index]
  previous_prompt = chatbot[retry_data.index]['content']
  past_messages = past_messages[: retry_data.index]
  async for update in stream_from_agent(previous_prompt, new_history, past_messages):
    yield update

defundo(chatbot, past_messages: list, undo_data: gr.UndoData):
  new_history = chatbot[: undo_data.index]
  past_messages = past_messages[: undo_data.index]
  return chatbot[undo_data.index]['content'], new_history, past_messages

defselect_data(message: gr.SelectData) -> str:
  return message.value['text']

with gr.Blocks() as demo:
  gr.HTML(
"""
<div style="display: flex; justify-content: center; align-items: center; gap: 2rem; padding: 1rem; width: 100%">
  <img src="https://ai.pydantic.dev/img/logo-white.svg" style="max-width: 200px; height: auto">
  <div>
    <h1 style="margin: 0 0 1rem 0">Weather Assistant</h1>
    <h3 style="margin: 0 0 0.5rem 0">
      This assistant answer your weather questions.
    </h3>
  </div>
</div>
"""
  )
  past_messages = gr.State([])
  chatbot = gr.Chatbot(
    label='Packing Assistant',
    type='messages',
    avatar_images=(None, 'https://ai.pydantic.dev/img/logo-white.svg'),
    examples=[
      {'text': 'What is the weather like in Miami?'},
      {'text': 'What is the weather like in London?'},
    ],
  )
  with gr.Row():
    prompt = gr.Textbox(
      lines=1,
      show_label=False,
      placeholder='What is the weather like in New York City?',
    )
  generation = prompt.submit(
    stream_from_agent,
    inputs=[prompt, chatbot, past_messages],
    outputs=[prompt, chatbot, past_messages],
  )
  chatbot.example_select(select_data, None, [prompt])
  chatbot.retry(
    handle_retry, [chatbot, past_messages], [prompt, chatbot, past_messages]
  )
  chatbot.undo(undo, [chatbot, past_messages], [prompt, chatbot, past_messages])

if __name__ == '__main__':
  demo.launch()

```

© Pydantic Services Inc. 2024 to present