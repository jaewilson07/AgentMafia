---
url: https://ai.pydantic.dev/graph/
session_id: pydantic_ai_docs
chunk_number: 5
title: Pydantic AI Email Writer Agent
summary: This document introduces the `WriteEmail` class using Pydantic, which integrates an email writing agent based on a specified system prompt. It defines user and email data models, sets up an agent to generate welcome emails, and prepares the class to handle user state and feedback for email content.
embedding: [-0.018922019749879837, 0.021877435967326164, 0.008437038399279118, -0.014114870689809322, 0.05513506382703781, -0.02945605479180813, -0.015083658508956432, 0.02502906322479248, 0.010846744291484356, 0.033306680619716644, 0.03762330487370491, -0.02894100360572338, -0.008234696462750435, -0.014642185531556606, -0.016493918374180794, -0.040934350341558456, -0.010859007947146893, -0.010901928879320621, 0.03696109354496002, 0.007210724521428347, 0.01933896727859974, -0.0036513491068035364, 0.05665569379925728, -0.007682855241000652, -0.019204072654247284, 0.012839504517614841, -0.01643260382115841, 0.05145612359046936, -0.0304125789552927, -0.007707381621003151, 0.010767034254968166, -0.026831744238734245, -0.02111712284386158, -0.00116729736328125, 0.005518411751836538, 0.020123807713389397, -0.018431495875120163, 0.026537427678704262, 0.02778826840221882, 0.02506585232913494, -0.003329441649839282, -0.05022981017827988, 0.022735856473445892, 0.023876328021287918, -0.057636745274066925, -0.0036360202357172966, -0.03146721050143242, 0.07603144645690918, 0.06308157742023468, 0.047752656042575836, -0.032252050936222076, 0.03156531602144241, -0.01871354691684246, -0.013342292979359627, -0.02666006051003933, 0.006947067100554705, -0.023312224075198174, 0.026684585958719254, -0.017916442826390266, -0.00308111310005188, 0.024084800854325294, -0.037451621145009995, -0.0168618131428957, 0.04125319421291351, -0.029431529343128204, 0.025360167026519775, -0.053957801312208176, 0.0038077039644122124, -0.00868230126798153, 0.01218342687934637, 0.01747496984899044, 0.04071361571550369, -0.03178605064749718, -0.017058024182915688, -0.0050432151183485985, -0.06970366835594177, 0.007872933521866798, 0.03970803692936897, -0.013783765956759453, -0.0230546984821558, -0.0072904350236058235, 0.020430386066436768, -0.017965495586395264, 0.008927564136683941, 0.012655557133257389, -0.05278054252266884, -0.04897896945476532, -0.010012851096689701, -0.04662444815039635, -0.09751646220684052, -0.021399173885583878, -0.01022745668888092, -0.014323344454169273, 0.034704677760601044, 0.0830950140953064, 0.060040317475795746, 0.026831744238734245, -0.009528457187116146, 0.008271485567092896, -0.02127654291689396, -0.0026396403554826975, -0.06636809557676315, -0.045594342052936554, -0.0037463882472366095, 0.023741433396935463, -0.03318404778838158, 0.011508953757584095, 0.06514178216457367, -0.018272073939442635, -0.01933896727859974, -0.09776172786951065, -0.029039109125733376, -0.005211833398789167, -0.0021705753169953823, -0.010668929666280746, -0.013207398355007172, -0.010301034897565842, -0.042528558522462845, 0.035980045795440674, -0.0204917024821043, 0.004460716154426336, 0.019584229215979576, -0.004804084077477455, -0.007707381621003151, 0.00902566872537136, 0.006689541041851044, -0.0037647830322384834, -0.050475072115659714, -0.04917518049478531, 0.02076149173080921, 0.037917621433734894, -0.018492810428142548, 0.023238644003868103, -0.01255745254456997, -0.02030775509774685, 0.004095887765288353, -0.02692984975874424, 0.011668374761939049, -0.02488190494477749, 0.016910865902900696, 0.03708372637629509, -0.037181831896305084, -0.06813398748636246, 0.0392175130546093, -0.011398585513234138, 0.02921079285442829, -0.07509945333003998, 0.028646688908338547, 0.011306612752377987, 0.028646688908338547, 0.04731118306517601, 0.03970803692936897, -0.05032791569828987, 0.021693488582968712, 0.024587590247392654, 0.005092267878353596, -0.0011872249888256192, 0.018321126699447632, 0.02972584404051304, -0.06690767407417297, 0.02146049030125141, -0.013121556490659714, -0.03487636148929596, -0.025237536057829857, -0.05400685593485832, -0.008197907358407974, -0.02565448358654976, -0.002299338113516569, -0.02111712284386158, -0.04368129372596741, -0.01747496984899044, -0.005429503973573446, -0.03119742125272751, 0.02999563328921795, 0.011012297123670578, -0.017891917377710342, -0.03472920507192612, -0.00048094490193761885, -0.014029028825461864, -0.01001898292452097, -0.015905288979411125, -0.01646939292550087, -0.05106370151042938, -0.02479606308043003, -0.03823646157979965, -0.028303319588303566, 0.023925380781292915, 0.006818304304033518, -0.03583288565278053, 0.026488376781344414, 0.021166173741221428, 0.03080500103533268, 0.0027990611270070076, 0.013612082228064537, -0.03073142096400261, -0.025679009035229683, 0.07706155627965927, -0.006603699177503586, 0.02057754434645176, 0.0811329111456871, 0.021362384781241417, 0.0331595242023468, -0.00026001682272180915, -0.03561215102672577, 0.03546499088406563, -0.01813717931509018, 0.004221585113555193, -0.004095887765288353, -0.054693590849637985, 0.004847005009651184, 0.009154431521892548, -0.057832952588796616, 0.01713160239160061, -0.0024372984189540148, -0.034655626863241196, -0.01055856142193079, -0.07931797206401825, -0.0007430694531649351, 0.01102455984801054, 0.027077006176114082, -0.039462774991989136, 0.06053084507584572, 0.04422087222337723, 0.008412512019276619, 0.015120447613298893, -0.008878511376678944, 0.009865693747997284, 0.010209061205387115, -0.007590882014483213, 0.036862991750240326, 0.020871859043836594, -0.012404163368046284, -0.014482764527201653, -0.01092645525932312, 0.01693539135158062, -0.07809165865182877, 0.013612082228064537, -0.023937642574310303, -0.013403608463704586, 0.013685661368072033, -0.05503695830702782, 0.009761457331478596, 0.03681393712759018, 0.031050262972712517, 0.01731554977595806, 0.022883012890815735, 0.004402466118335724, -0.009252537041902542, 0.048218656331300735, 0.06695672869682312, 0.029308898374438286, -0.008216301910579205, 0.01329324021935463, -0.017266497015953064, -0.022564172744750977, -0.032840680330991745, 0.01566002517938614, 0.025679009035229683, -0.019633281975984573, -0.015095921233296394, 0.0027975281700491905, -0.009252537041902542, 6.141149060567841e-05, 0.028916476294398308, 0.04836581274867058, -0.013268713839352131, 0.028303319588303566, -0.020136071369051933, -0.03620078042149544, -0.04866012930870056, -0.010895797051489353, 0.05572369322180748, 0.023471644148230553, -0.0070696985349059105, -0.014948763884603977, -0.0038720855955034494, 0.04856202378869057, 0.05861779674887657, 0.005328333005309105, 0.0023989761248230934, -0.004831675905734301, 0.04650181531906128, 0.040664561092853546, 0.02491869404911995, 0.008314406499266624, 0.03956088051199913, -0.03367457538843155, -0.0011351066641509533, -0.00643201544880867, -0.0017750890692695975, 0.03521972894668579, -0.00137347134295851, 0.024048011749982834, -0.012005611322820187, 0.04336245357990265, -0.04220971837639809, 0.024771537631750107, 0.027493953704833984, 0.02131333202123642, -0.010435929521918297, 0.00080170261207968, -0.00833280198276043, 0.00154055655002594, 0.005858713760972023, 0.0018532666144892573, 0.033650048077106476, -0.0007472849101759493, 0.030584264546632767, 0.023704644292593002, 0.027763742953538895, 0.012017874047160149, 0.04478497803211212, 0.016027919948101044, 0.01759760081768036, -0.0327916294336319, -0.012404163368046284, 0.02685626968741417, -0.02773921564221382, -0.002247219905257225, -0.01731554977595806, -0.03568572923541069, 0.0016263985307887197, 0.041670139878988266, -0.03907035291194916, -0.04189087450504303, 0.006640488747507334, 0.04476045072078705, -0.013415872119367123, -0.023201854899525642, -0.007321092765778303, -0.001150435535237193, -0.043386977165937424, 0.0017229707445949316, 0.022036857903003693, 0.028278794139623642, 0.010000588372349739, -0.011711295694112778, 0.030093738809227943, 0.015341184101998806, 0.07421650737524033, -0.049739282578229904, -0.022233067080378532, -0.03674035891890526, -0.01513271126896143, -0.05807821825146675, -0.004877662751823664, 0.007597013376653194, 0.04358318820595741, -0.018186232075095177, 0.004184795543551445, -0.00800169724971056, 0.04652634263038635, 0.04892991855740547, 0.032570891082286835, 0.01991533488035202, -2.9508173611247912e-05, 0.002834317507222295, -0.007204593159258366, -0.03487636148929596, 0.01426202803850174, -0.028965529054403305, -0.018958810716867447, 0.00846769567579031, -0.02057754434645176, -0.012336716055870056, -0.02244153991341591, -0.024305537343025208, -0.042724769562482834, 0.014666711911559105, -0.0042062560096383095, 0.032644469290971756, 0.016150550916790962, -0.023385802283883095, 0.001841003424488008, -0.03293878585100174, -0.04034572094678879, -0.024133853614330292, 0.001726036542095244, 0.010362350381910801, 0.06626999378204346, 8.579405402997509e-05, 0.012005611322820187, -0.029652265831828117, -0.03306141868233681, -0.01127595454454422, 0.019792703911662102, -0.003724927781149745, 0.010767034254968166, -0.013415872119367123, 0.01259424164891243, 0.060972318053245544, -0.029161740094423294, 0.015991130843758583, 0.006303252652287483, 0.03261994570493698, 0.019633281975984573, 0.0232876967638731, 0.03701014816761017, 0.06401357799768448, 0.00266876514069736, 0.01887296698987484, -0.01783060096204281, -0.020258702337741852, 0.03220299631357193, -0.0060181342996656895, -0.037991199642419815, -0.0020372136496007442, -0.001260037301108241, -0.018112653866410255, -0.002733146771788597, 0.027984479442238808, -0.049886442720890045, 0.003960993140935898, -0.007480513770133257, 0.01654297113418579, -0.059500742703676224, -0.016260920092463493, -0.015782658010721207, 0.015046869404613972, 0.027150586247444153, -0.03436131030321121, -0.06425883620977402, 0.029284371063113213, -0.017021235078573227, -0.019547440111637115, 0.03313499689102173, 0.04409823939204216, -0.05851969122886658, 0.022797171026468277, -0.05018075555562973, 2.7472300644149072e-05, 0.006340041756629944, -0.03318404778838158, -0.003964059054851532, 0.03114836849272251, 0.004322755616158247, 0.02220854163169861, 0.047409288585186005, -0.02255190908908844, -0.04682065546512604, 0.0040805586613714695, -0.033699098974466324, 0.018934283405542374, 0.025556378066539764, -0.04277382045984268, -0.013587555848062038, -0.07308829575777054, -0.020786017179489136, -0.007241382263600826, -0.04458876699209213, -0.012115979567170143, -0.008939826861023903, -0.011085876263678074, 0.006073318421840668, -0.04650181531906128, -0.013906397856771946, 0.08157438784837723, 0.021166173741221428, 0.015905288979411125, 0.0006185219972394407, 0.04355866089463234, -0.017842864617705345, 0.01282724179327488, 0.05557653680443764, -0.02859763614833355, 0.010393008589744568, 0.042136140167713165, 0.02894100360572338, -0.015267605893313885, 0.026488376781344414, 0.029284371063113213, 0.014666711911559105, 0.007143277209252119, -0.011190112680196762, -0.04022308811545372, -0.042675718665122986, 0.03247278556227684, 0.027493953704833984, -0.02204911969602108, -0.0009618898038752377, -0.009387431666254997, 0.011686769314110279, 0.009761457331478596, 0.046403709799051285, -0.002024950459599495, 0.009522326290607452, 0.0008300610934384167, -0.06504368036985397, 0.009203484281897545, -0.001308323466219008, -0.042332347482442856, -0.005496951285749674, 0.05292769894003868, -0.01259424164891243, 0.03235015645623207, 0.0089888796210289, 0.006156094837933779, -0.03436131030321121, 0.01604018360376358, -0.04100792855024338, -0.01976817660033703, 0.02038133330643177, -0.04733571037650108, 0.016677865758538246, 0.002438831375911832, -0.040787193924188614, 0.02224533073604107, 0.03100121021270752, 0.005598122254014015, 0.027248689904808998, -0.02511490508913994, -0.04488307982683182, 0.011521217413246632, 0.010534035041928291, -0.005414174869656563, 0.016052447259426117, -0.0013021918712183833, 0.042258769273757935, -0.020749228075146675, 0.0016325301257893443, -0.012716873548924923, -0.016788234934210777, -0.0010622942354530096, -0.030584264546632767, -0.012330584228038788, -0.008676169440150261, 0.023532960563898087, -0.02084733359515667, 0.014335607178509235, -0.019007861614227295, 0.012361242435872555, 0.0033263759687542915, 0.015120447613298893, 0.012974399141967297, -0.06690767407417297, 0.028475003316998482, -0.03661772608757019, -0.025556378066539764, -0.044466134160757065, -0.019510651007294655, -0.01280271541327238, 0.02174254134297371, 0.017070285975933075, -0.004681452643126249, -0.004715176299214363, 0.0179777592420578, 0.010932587087154388, -0.02518848329782486, -0.009099247865378857, 0.014237501658499241, 0.025507325306534767, 0.0026227785274386406, 0.012103715911507607, -0.07142051309347153, 0.007572486996650696, 0.004420860670506954, -0.008780405856668949, -0.014445975422859192, -0.027077006176114082, -0.00354098086245358, 0.002834317507222295, -0.04456423968076706, 0.022662276402115822, 0.029088161885738373, -0.024305537343025208, 0.07706155627965927, 0.014813869260251522, -0.03602909669280052, -0.020123807713389397, 0.04316624253988266, 0.0018655296880751848, 0.0258506927639246, -0.03507257252931595, -0.029971105977892876, 0.011791006661951542, -0.02038133330643177, -0.022968854755163193, 0.015794919803738594, -0.015034605748951435, 0.018186232075095177, -0.03249731287360191, -0.03732898831367493, -0.006444278638809919, 0.005966016091406345, -0.018885230645537376, 0.0065914359875023365, -0.007468250580132008, 0.0332576259970665, 9.681171650299802e-05, 0.004466847516596317, -0.004561887122690678, -0.015709077939391136, -0.0057115559466183186, 0.006186752580106258, -0.032840680330991745, -0.017291022464632988, 0.008375722914934158, -0.020209649577736855, -0.056557588279247284, 0.0207737535238266, 0.04458876699209213, -0.012790451757609844, -0.03963445872068405, 0.015279868617653847, 0.03053521178662777, -0.010448193177580833, 0.004423926584422588, 0.020136071369051933, -0.002115391194820404, -0.004485242534428835, -0.018823916092514992, 0.002044878201559186, -0.009166695177555084, -0.008504485711455345, -0.031123841181397438, 0.002976876450702548, -0.0295296348631382, 0.030363528057932854, 0.04718855023384094, -0.03141815587878227, 0.025777114555239677, 0.04152298346161842, 0.014053555205464363, 0.005156649276614189, -0.01057695597410202, 0.016653340309858322, -0.02165669947862625, -0.0009220346109941602, -0.014482764527201653, -0.004702913109213114, -0.043264348059892654, 0.02967679128050804, 0.04044382646679878, -0.0100373774766922, -0.027224164456129074, -0.02979942224919796, 0.008400249294936657, -0.030510684475302696, -0.014041291549801826, -0.019927598536014557, 0.003994716797024012, 0.019890807569026947, 0.015905288979411125, 0.024857379496097565, 0.010797692462801933, 0.010773166082799435, -0.036593202501535416, 0.0036329543218016624, 0.02181612141430378, -0.004215453285723925, -0.04552076384425163, -0.012091453187167645, 0.02639027126133442, -0.02161991037428379, 0.008228564634919167, -0.011637717485427856, -0.03107478842139244, -0.027027953416109085, -0.0026059166993945837, 0.01708254963159561, -0.04799791797995567, -0.00646267319098115, -0.005380451213568449, 0.0022518185433000326, -0.011907505802810192, 0.03902130201458931, 0.00468758400529623, 0.017658917233347893, 0.014176186174154282, 0.011613191105425358, -0.050475072115659714, 0.022073647007346153, 0.042479507625103, 1.828692438721191e-05, -0.016138289123773575, -0.03249731287360191, 0.007658328860998154, -0.0326935239136219, -0.010632139630615711, 0.0493713915348053, -0.038653407245874405, -0.02925984561443329, -0.045275501906871796, 0.03347836434841156, 0.050156231969594955, -0.027837321162223816, 0.009209616109728813, -0.026537427678704262, -0.01034395582973957, 0.0054908194579184055, 0.00013048744585830718, 0.008921432308852673, -0.011600927449762821, 0.011128797195851803, 0.0037463882472366095, 0.013575293123722076, 0.0022702133283019066, 0.03539141267538071, -0.010429797694087029, -0.04615844786167145, -0.01666560396552086, -0.012312189675867558, -0.005457095801830292, 0.023079223930835724, -0.0008936761296354234, -0.024133853614330292, -0.03929109126329422, 0.03889866918325424, 0.023815011605620384, 0.005092267878353596, -0.03060878999531269, 0.01156413834542036, -0.018701283261179924, 0.0645531564950943, -0.03352741524577141, -0.01991533488035202, -0.001753628603182733, -0.005818858742713928, 0.019964387640357018, -0.018762599676847458, 0.006499462760984898, -0.009307720698416233, -0.016359025612473488, -0.0035287176724523306, 0.009491668082773685, -0.054399274289608, -0.008142722770571709, 0.01453181728720665, 0.012134374119341373, 0.0026396403554826975, -0.024587590247392654, -0.006953198928385973, 0.010521771386265755, -0.01627318374812603, -0.02933342382311821, 0.015451552346348763, -0.04664897173643112, -0.005331398919224739, -0.03727993741631508, 0.00496963644400239, 0.0028143899980932474, 0.001267701736651361, 0.0039916508831083775, -0.004748899955302477, 0.00879880040884018, 0.002976876450702548, -0.0075173028744757175, 0.07112619280815125, -0.04068908840417862, -0.0019084507366642356, -0.030216369777917862, 0.00862098578363657, -0.02852405607700348, -0.006456541828811169, 0.02135012112557888, -0.019621018320322037, -0.00419399281963706, 0.017143866047263145, -0.06793777644634247, -0.0006898014689795673, -0.010662797838449478, 0.012655557133257389, -0.03448394313454628, 0.005392714403569698, 0.0031669551972299814, -0.018995599821209908, 0.049420442432165146, 0.009461009874939919, 0.0262676402926445, -0.003357033710926771, -0.04679613187909126, 0.010975508019328117, -0.007351750507950783, 0.05184854194521904, 0.022833961993455887, -0.031172893941402435, 0.03335573151707649, -0.008461564779281616, 0.023704644292593002, -0.00976758822798729, 0.027690162882208824, 0.008964353241026402, 0.015034605748951435, -0.017340075224637985, 0.015525131486356258, -0.007455987390130758, -0.0008078341488726437, -0.01393092330545187, -0.044539712369441986, -0.019964387640357018, -0.037991199642419815, -0.024354590103030205, -0.0004882261564489454, -0.004279834683984518, 0.02631669119000435, -0.0031041065230965614, -0.003329441649839282, -0.07063566893339157, 0.019363492727279663, 0.017229707911610603, -0.02538469433784485, 0.011674506589770317, -0.019743651151657104, 0.009123774245381355, -0.006879619788378477, 0.003884348552674055, -0.03848172351717949, -0.00835119653493166, -0.04041929915547371, -0.018198495730757713, -0.02414611726999283, 0.02778826840221882, -0.013918660581111908, 0.014114870689809322, -0.008204038254916668, 0.051014650613069534, -0.02100675366818905, -0.013513976708054543, -0.0147402910515666, -0.056950006633996964, 0.01960875652730465, 0.009877956472337246, -0.012030137702822685, -0.004267571493983269, 0.03600456938147545, 0.034704677760601044, 0.018664494156837463, 0.0036482831928879023, -0.06626999378204346, 0.01634676195681095, -0.0017382997320964932, -0.010172272101044655, 0.044073715806007385, 0.023729169741272926, 0.0461093969643116, -0.00042154532275162637, -0.007866802625358105, -0.0066343569196760654, -0.021914225071668625, 0.007639934308826923, -0.018848441541194916, 0.012447084300220013, 0.013146082870662212, -0.010049641132354736, -0.006971593480557203, -0.02421969547867775, -0.012949872761964798, -0.00678151473402977, 0.005892437417060137, -0.01639581471681595, 0.006560778245329857, 0.030682368203997612, 0.03463109955191612, -0.0451773963868618, -0.01253292616456747, 0.00021326361456885934, 0.01786739006638527, -0.01389413420110941, 0.02825426682829857, 0.02506585232913494, -0.0008936761296354234, 0.013342292979359627, -0.026709113270044327, 0.024501748383045197, 0.013403608463704586, -0.050818439573049545, -0.010258113965392113, 0.009963799268007278, 0.005089201964437962, 0.009632694534957409, -0.015365710482001305, 0.030240895226597786, 0.0168127603828907, 0.014311080798506737, 0.013538503088057041, 0.008142722770571709, -0.019633281975984573, -0.001857865252532065, 0.0044699134305119514, -0.0012278466019779444, 0.015868499875068665, -0.008173380978405476, 0.024857379496097565, 0.012949872761964798, -0.014041291549801826, -0.006070252973586321, 0.020013440400362015, 0.0007292734226211905, 0.006885751616209745, 0.01844375766813755, -0.025948798283934593, -0.015586446970701218, -0.0025675944052636623, -0.02220854163169861, 0.00835119653493166, 0.02197554148733616, 0.007872933521866798, 0.01971912384033203, 0.026414796710014343, 0.005076938774436712, 0.013820555061101913, -0.030363528057932854, 0.006156094837933779, -0.0168127603828907, -0.018382443115115166, -0.02309148758649826, 0.0034306126181036234, 0.004445387050509453, -0.010920323431491852, -0.02751847915351391, -0.0002613581018522382, -0.040198564529418945, 0.035587623715400696, 0.044809501618146896, -0.012814978137612343, -0.01991533488035202, -3.159194966428913e-05, -0.009638825431466103, 0.026439324021339417, 0.022367961704730988, 0.009099247865378857, -0.0172787606716156, -0.0021537134889513254, 0.008896905928850174, -0.03487636148929596, -0.007413066457957029, 0.011042955331504345, 0.02967679128050804, 0.010920323431491852, -0.037844039499759674, 0.009571378119289875, -0.020859595388174057, -0.002553798258304596, 0.02142370119690895, -0.014617659151554108, 0.012269268743693829, -0.020479438826441765, 0.017560811713337898, -0.034385837614536285, 0.013158345595002174, -0.007885197177529335, -0.045741502195596695, -0.02751847915351391, 0.012937609106302261, 0.027297742664813995, -0.020197385922074318, -0.0033692969009280205, -0.016984444111585617, -0.0029293568804860115, -0.001813411363400519, 0.0013405141653493047, 0.017818337306380272, 0.01195655856281519, -2.216705797764007e-05, -0.03926656395196915, -0.02170575223863125, 0.011876848526299, -0.0017582272412255406, 0.03593099117279053, -0.004347281996160746, -0.006714067421853542, -0.03600456938147545, -0.026537427678704262, -0.03154078871011734, 0.013379082083702087, -0.01786739006638527, 0.0005809661233797669, -0.036912042647600174, 0.019007861614227295, 0.02003796584904194, 0.007805486675351858, 0.04851296916604042, 0.06666241586208344, 0.055233169347047806, -0.003960993140935898, -0.05390875041484833, 0.022833961993455887, -0.013599818572402, 0.01540250051766634, -0.0027515413239598274, 0.011692901141941547, 0.034189626574516296, -0.020172860473394394, 0.0021031280048191547, 0.014678974635899067, 0.009013406001031399, 0.00908698420971632, 0.04068908840417862, 0.012729136273264885, -0.007462118752300739, 0.02414611726999283, -0.00608251616358757, 0.01577039435505867, 0.02545827254652977, 0.039732564240694046, -0.0006882685702294111, -0.017720233649015427, 0.008179512806236744, 0.035587623715400696, -0.009835035540163517, -0.020786017179489136, 0.0086393803358078, 0.059108320623636246, -0.03127099946141243, -0.018958810716867447, -0.04736023396253586, 0.0025154759641736746, -0.005693161394447088, -0.03929109126329422, -0.0005345961544662714, -0.0186767578125, -0.03499899432063103, 0.01489971112459898, -0.006389094516634941, 0.026218587532639503, -0.018088126555085182, 0.006756988354027271, -0.05057317763566971, -0.02666006051003933, -0.014029028825461864, 0.01700897142291069, -0.02533564157783985, 0.030093738809227943, -0.01634676195681095, 0.016996707767248154, 0.021301068365573883, 0.007799355313181877, 0.00906858965754509, 0.02158312126994133, 0.004059098195284605, -0.025973323732614517, 0.024747010320425034, -0.03387078270316124, -0.005509214475750923, 0.00843090657144785, 0.023631064221262932, 0.02533564157783985, -0.007308829575777054, 0.017990022897720337, -0.019044652581214905, -0.03480278328061104, -0.011398585513234138, 0.007934249937534332, 0.03931561857461929, 0.022956592962145805, -0.016677865758538246, -0.0350235179066658, -0.034312255680561066, -0.005119859706610441, 0.018308863043785095, 0.011141059920191765, 0.015745867043733597, -0.02502906322479248, 0.005454030353575945, 0.05121086165308952, -0.01323192473500967, 0.007682855241000652, 1.3448733625409659e-05, 0.028082583099603653, -0.009896351955831051, -0.020712438970804214, 0.0051750438287854195, -0.014666711911559105, -0.0033263759687542915, 0.04691876098513603, 0.03674035891890526, 0.0340915210545063, -0.019817229360342026, 0.022171752527356148, 0.01426202803850174, 0.008130460046231747, -0.005355925299227238, 0.007977170869708061, -0.04863560199737549, -0.0007001484627835453, -0.002696357201784849, -0.03308594226837158, -0.002540002344176173, 0.00225641718134284, -0.018345652148127556, -0.002026483416557312, 0.015991130843758583, -0.02076149173080921, -0.022110436111688614, -0.022919803857803345, -0.013109293766319752, 0.010613745078444481, 0.04669802635908127, 0.03683846443891525, -0.013047977350652218, -0.038064777851104736, 0.01022745668888092, 0.008768143132328987, 0.0014861389063298702, -3.2454199754283763e-06, 0.015218553133308887, -0.03114836849272251, 0.015561920590698719, 0.006609831005334854, 0.018811652436852455, 0.02285848744213581, 0.01790417917072773, -0.009749193675816059, -0.003865954000502825, -0.0636211559176445, 0.03887414559721947, 0.027150586247444153, -0.02960321307182312, -0.014176186174154282, 0.01596660353243351, -0.01137405913323164, 0.020087018609046936, 0.03561215102672577, -0.03693656995892525, -0.0075173028744757175, -0.035121623426675797, -0.003390757367014885, -0.02673363871872425, 0.007915855385363102, -0.019866282120347023, 0.008835590444505215, 0.008216301910579205, -0.009595904499292374, -0.0001195655859191902, 0.00045220318133942783, 0.010791560634970665, 0.0004951241426169872, 0.024599852040410042, 0.01135566458106041, 0.00906858965754509, 0.022098172456026077, -0.03345383703708649, 0.0026932915206998587, -0.05096559599041939, 0.0075173028744757175, -0.0073701455257833, 0.009565247222781181, -0.04265119135379791, -0.015758130699396133, -0.02298111841082573, 0.01125755999237299, 0.007879065349698067, -0.014274291694164276, 0.011398585513234138, -0.012949872761964798, -0.004984965082257986, -0.007505039684474468, 0.057097166776657104, -0.01770796999335289, -0.0345575213432312, 0.012937609106302261, 0.008338932879269123, -0.01443371269851923, 0.019755912944674492, 0.020430386066436768, -0.01589302532374859, -0.034042470157146454, -0.03166342154145241, 0.001867062645033002, -0.003973256330937147, 0.004518966190516949, 0.021019017323851585, -0.02840142510831356, 0.00015578015882056206, -0.008903037756681442, 0.01520628947764635, -0.014311080798506737, 0.018431495875120163, 0.054693590849637985, -0.009240273386240005, -0.008829458616673946, 0.010497245006263256, -0.0168127603828907, 0.023569749668240547, -0.015880761668086052, 0.0073394873179495335, 0.04368129372596741, -0.00021019783162046224, -0.022576434537768364, 0.0028864359483122826, 0.006793777924031019, -0.05493885278701782, 0.00019391084788367152, -0.015880761668086052, 0.005450964439660311, -0.02061433345079422, 0.042381402105093, 0.0086393803358078, 0.013146082870662212, 0.0010193733032792807, -0.0015267605194821954, 0.010135482996702194, 0.005282346159219742, 0.03629888594150543, 0.0054019116796553135, 0.0008622518507763743, 0.00528847798705101, 0.002098529366776347, 0.00548162218183279, 0.03132005035877228, -0.00643201544880867, 0.009853431023657322, -0.030388053506612778, 0.0063645681366324425, 0.0663190484046936, 0.025311114266514778, 0.0410815104842186, -0.0020157531835138798, 0.008823326788842678, 0.004460716154426336, 0.01948612555861473, -0.016420340165495872, -0.028107110410928726, -0.01910596713423729, -0.0015597176970914006, -0.014127133414149284, 0.032718051224946976, -0.012765925377607346, -0.004233847837895155, 0.0068121724762022495, 0.006425883620977402, 0.015794919803738594, 0.02894100360572338, 0.0029891396407037973, -0.0484393909573555, 0.028229741379618645, 0.04127771779894829, 0.006241936702281237, -0.026611007750034332, -0.01386960782110691, 0.014666711911559105, -0.012974399141967297, -0.012839504517614841, 0.018811652436852455, 0.011300480924546719, -0.019854018464684486, -0.0005223329644650221, 0.024391379207372665, 0.02235569804906845, 0.03843267261981964, 0.026611007750034332, -0.016788234934210777, 0.003611493855714798, -0.0008446235442534089, 0.011183980852365494, -0.03394436463713646, 0.03227657824754715, 0.009485536254942417, 0.006701804231852293, -0.007676723878830671, -0.002149114850908518, 0.01917954720556736, 0.01296213548630476, -0.007799355313181877, -0.004114282317459583, -0.021374648436903954, 0.029308898374438286, -0.010435929521918297, -0.00776869710534811, 0.02558090351521969, -0.005913897883147001, 0.0019038519822061062, -0.011128797195851803, -0.032325629144907, 0.004381005652248859, -0.03060878999531269, -0.010515639558434486, 0.02192648872733116, -0.010172272101044655, -0.008148854598402977, -0.0032711918465793133, 0.007535697892308235, 0.004252242855727673, 0.03907035291194916, -0.03833456709980965, -0.015181764028966427, -0.012741398997604847, 0.0007833078852854669, 0.035048045217990875, 0.021252015605568886, -0.006714067421853542, 0.01228153146803379, 0.007688987068831921, -0.01693539135158062, -0.025629956275224686, -0.02879384532570839, -0.0016340629663318396, -0.032718051224946976, 0.04292098060250282, 0.02057754434645176, -0.030854051932692528, 0.02251511998474598, -0.020724700763821602, 0.035121623426675797, 0.02425648458302021, 0.013673397712409496, 0.016064709052443504, 0.024906430393457413, -0.006523988675326109, 0.02746942639350891, 0.01971912384033203, -0.024771537631750107, -0.04220971837639809, 0.026145007461309433, -0.010086430236697197, -0.033429309725761414, -0.013391345739364624, 0.010730245150625706, -0.011416980996727943, -0.035244256258010864, -0.0290636345744133, 0.0032221393194049597, 0.016555234789848328, 0.0021659766789525747, -0.017683442682027817, 0.011300480924546719, -0.0006875020917505026, 0.0037739803083240986, 0.004791820887476206, 0.017217444255948067, 0.011423111893236637, 0.03519520163536072, -0.013035714626312256, 0.02565448358654976, -0.012618768028914928, -0.011803269386291504, 0.02177933044731617, -0.006830567494034767, -0.03266899660229683, 6.610597483813763e-05, 0.011233033612370491, -0.02727321721613407, 0.001577346003614366, 0.023152802139520645, -0.00941808894276619, -0.011729690246284008, -0.017720233649015427, -0.01386960782110691, -0.021668963134288788, -0.020933175459504128, -0.010184535756707191, 0.004013111814856529, 0.029112687334418297, 0.0014064285205677152, -0.015745867043733597, 0.012220215983688831, 0.026243112981319427, -0.022233067080378532, -0.00740080326795578, -0.033429309725761414, 0.010969376191496849, -0.0309276320040226, 0.040664561092853546, -0.00324053387157619, 0.012526794336736202, -0.00112820859067142, 0.019927598536014557, -0.008418643847107887, 0.0016877142479643226, 0.006940935738384724, 0.01119624450802803, 0.017573075369000435, -0.007603144738823175, 0.019167283549904823, -0.012949872761964798, 0.03507257252931595, -0.002720883581787348, 0.011815532110631466, 0.0040744272992014885, 0.017695706337690353, -0.027346795424818993, 0.0006311683100648224, -0.003884348552674055, 0.016886340454220772, 0.020994490012526512, 0.004669189453125, -0.005496951285749674, 0.02692984975874424, -0.001813411363400519, -0.019130494445562363, -0.02239248901605606, -0.012765925377607346, -0.005254754330962896, -0.03634793683886528, -0.044269923120737076, 0.047531917691230774, -0.012986661866307259, 0.002495548455044627, 0.04709044471383095, -0.007566355634480715, 0.007474381942301989, 0.008228564634919167, -0.01416392344981432, 0.013967713341116905, -0.008498353883624077, -0.02271132916212082, 0.00838798563927412, 0.04618297517299652, 0.031908683478832245, -0.019780440255999565, -0.01856638863682747, -0.008743616752326488, -0.018897494301199913, 0.012581978924572468, 0.0014731093542650342, -0.0030182646587491035, 0.019081441685557365, -0.007891329005360603, 0.02418290637433529, -0.015328921377658844, -0.022184014320373535, 0.00999445654451847, 0.011269822716712952, -0.024538537487387657, -0.009730799123644829, -0.04718855023384094, 0.00031079386826604605, 0.015684552490711212, 0.012391899712383747, -0.009681746363639832, -0.02317732945084572, -0.006266463082283735, -0.006879619788378477, 0.02228211984038353, 0.020516227930784225, 0.0022134962491691113, -0.03740256652235985, 0.013673397712409496, -0.012177295051515102, -0.0232876967638731, -0.02867121435701847, 0.007921986281871796, 0.011104270815849304, -0.008130460046231747, 0.0014838395873084664, -0.02348390780389309, -0.0005579727585427463, 0.009062457829713821, -0.0059384242631495, 0.044466134160757065, 0.00017704903439152986, 0.010613745078444481, 0.01716839149594307, 0.02251511998474598, -0.00943648349493742, -0.004531228914856911, -0.033650048077106476, -0.0055276090279221535, -0.010711850598454475, 0.04468687251210213, -0.041596561670303345, 0.001998891355469823, 0.021901963278651237, 0.009221878834068775, 0.02138691022992134, -0.02572806179523468, 0.0014163922751322389, 0.00627566035836935, -0.036912042647600174, 0.009822772815823555, -0.024440431967377663, 0.03146721050143242, 0.03720635920763016, 0.01447050180286169, 0.00595681881532073, -0.0028220543172210455, 0.012876293621957302, 0.02867121435701847, 0.01883617788553238, 0.0019069177797064185, -0.026978900656104088, 0.028573108837008476, 0.025311114266514778, -0.03247278556227684, 0.00561958272010088, -0.005506148561835289, 0.005365122575312853, -0.0013175207423046231, 0.029774896800518036, 0.017192918807268143, -0.02612048201262951, 0.00020215014228597283, -0.017376864328980446, 0.00451283436268568, 0.013820555061101913, 0.01720518060028553, 0.024072537198662758, -0.033429309725761414, -0.012490005232393742, -0.01627318374812603, 0.006701804231852293, -0.015059132128953934, 0.055625591427087784, 0.010748639702796936, -0.011594795621931553, -0.02418290637433529, 0.009602036327123642, 3.3508062188047916e-05, -0.009969930164515972, 0.017376864328980446, 0.005334464833140373, -0.013342292979359627, 0.003565507009625435, -0.0026534362696111202, 0.002009621588513255, 0.0002749625127762556, 0.033650048077106476, -0.03188415616750717, 0.0023989761248230934, 0.019167283549904823, -0.038530778139829636, -0.034925416111946106, 0.02212269976735115, -0.002800593851134181, -0.005362056661397219, 0.005070806946605444, -0.005506148561835289, 0.006315515376627445, -0.00016028303070925176, 0.019817229360342026, -0.006140765734016895, -0.0046906499192118645, -0.04451518878340721, -0.02705248072743416, -0.017266497015953064, 0.01817396841943264, -0.031099315732717514, 0.013403608463704586, -0.03421415388584137, -0.014936501160264015, -0.00578206917271018, 0.032767102122306824, -0.0036084281746298075, -0.01855412684381008, 0.018922019749879837, -0.021374648436903954]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:24:54.783007", "url_path": "/graph/", "chunk_size": 3417}
updated_dt: 2025-03-15T11:24:54.783007
---
```
from__future__import annotations as _annotations
fromdataclassesimport dataclass, field
frompydanticimport BaseModel, EmailStr
frompydantic_aiimport Agent
frompydantic_ai.format_as_xmlimport format_as_xml
frompydantic_ai.messagesimport ModelMessage
frompydantic_graphimport BaseNode, End, Graph, GraphRunContext

@dataclass
classUser:
  name: str
  email: EmailStr
  interests: list[str]

@dataclass
classEmail:
  subject: str
  body: str

@dataclass
classState:
  user: User
  write_agent_messages: list[ModelMessage] = field(default_factory=list)

email_writer_agent = Agent(
  'google-vertex:gemini-1.5-pro',
  result_type=Email,
  system_prompt='Write a welcome email to our tech blog.',
)

@dataclass
classWriteEmail(BaseNode[State]):
  email_feedback: str | None = None
  async defrun(self, ctx: GraphRunContext[State]) -> Feedback:
    if self.email_feedback:
      prompt = (
        f'Rewrite the email for the user:\n'
        f'{format_as_xml(ctx.state.user)}\n'
        f'Feedback: {self.email_feedback}'
      )
    else:
      prompt = (
        f'Write a welcome email for the user:\n'
        f'{format_as_xml(ctx.state.user)}'
      )
    result = await email_writer_agent.run(
      prompt,
      message_history=ctx.state.write_agent_messages,
    )
    ctx.state.write_agent_messages += result.all_messages()
    return Feedback(result.data)

classEmailRequiresWrite(BaseModel):
  feedback: str

classEmailOk(BaseModel):
  pass

feedback_agent = Agent[None, EmailRequiresWrite | EmailOk](
  'openai:gpt-4o',
  result_type=EmailRequiresWrite | EmailOk, # type: ignore
  system_prompt=(
    'Review the email and provide feedback, email must reference the users specific interests.'
  ),
)

@dataclass
classFeedback(BaseNode[State, None, Email]):
  email: Email
  async defrun(
    self,
    ctx: GraphRunContext[State],
  ) -> WriteEmail | End[Email]:
    prompt = format_as_xml({'user': ctx.state.user, 'email': self.email})
    result = await feedback_agent.run(prompt)
    if isinstance(result.data, EmailRequiresWrite):
      return WriteEmail(email_feedback=result.data.feedback)
    else:
      return End(self.email)

async defmain():
  user = User(
    name='John Doe',
    email='john.joe@example.com',
    interests=['Haskel', 'Lisp', 'Fortran'],
  )
  state = State(user)
  feedback_graph = Graph(nodes=(WriteEmail, Feedback))
  result = await feedback_graph.run(WriteEmail(), state=state)
  print(result.output)
"""
  Email(
    subject='Welcome to our tech blog!',
    body='Hello John, Welcome to our tech blog! ...',
  )
  """

```

_(This example is complete, it can be run "as is" with Python 3.10+ — you'll need to add`asyncio.run(main())` to run `main`)_
## Custom Control Flow
In many real-world applications, Graphs cannot run uninterrupted from start to finish — they might require external input, or run over an extended period of time such that a single process cannot execute the entire graph run from start to finish without interruption.
In these scenarios the [`next`](https://ai.pydantic.dev/api/pydantic_graph/graph/#pydantic_graph.graph.Graph.next) method can be used to run the graph one node at a time.
In this example, an AI asks the user a question, the user provides an answer, the AI evaluates the answer and ends if the user got it right or asks another question if they got it wrong.
`ai_q_and_a_graph.py` — `question_graph` definition
ai_q_and_a_graph.py