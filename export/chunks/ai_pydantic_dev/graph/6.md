---
url: https://ai.pydantic.dev/graph/
session_id: pydantic_ai_docs
chunk_number: 6
title: Pydantic Graph Example Implementation
summary: This document snippet introduces a Pydantic Graph example where an agent is utilized to ask questions and manage message history. It defines data classes for managing question states and provides an asynchronous method to run an agent that retrieves answers.
embedding: [0.00665754871442914, 0.008162898011505604, 0.012200257740914822, -0.025597237050533295, 0.007866866886615753, -0.011507418937981129, -0.024400515481829643, 0.015431405045092106, -0.012483691796660423, 0.04678549990057945, 0.020986709743738174, -0.0426032729446888, 0.004947497509419918, -0.022573940455913544, -0.007734598126262426, -0.026730971410870552, -0.023430541157722473, 0.004270405042916536, 0.03076203353703022, 0.022586537525057793, 0.016980843618512154, -0.002287941984832287, 0.03146746754646301, -0.006493786815553904, -0.002366673666983843, -0.010266607627272606, -0.001325841061770916, 0.04320793226361275, -0.026730971410870552, 0.029502326622605324, 0.01051225047558546, -0.007980240508913994, -0.036531489342451096, -0.012571871280670166, -0.026126312091946602, 0.005668679252266884, -0.013252112083137035, 0.004723899532109499, 0.006216651760041714, 0.013037961907684803, -0.0009164364892058074, -0.07769870012998581, 0.023014837875962257, 0.017346158623695374, -0.041167207062244415, -0.011740464717149734, -0.03368455171585083, 0.06479930132627487, 0.021100083366036415, 0.020835544914007187, -0.046760305762290955, 0.04101604223251343, -0.01070750504732132, 0.022473163902759552, -0.02761276625096798, -0.03960517421364784, -0.010959446430206299, 0.033734939992427826, -0.0014596849214285612, -0.025483863428235054, 0.03758964315056801, -0.00413498654961586, -0.0007999136578291655, 0.08303984999656677, -0.009932786226272583, 0.036430712789297104, -0.031039169058203697, 0.0030673854053020477, -0.022321999073028564, -0.002327307825908065, 0.006052889861166477, 0.04519826918840408, -0.03038412146270275, -0.019915960729122162, -0.015431405045092106, -0.02225901372730732, 0.0038704483304172754, 0.06127212569117546, -0.003043765900656581, -0.022649522870779037, -0.013012767769396305, 0.010972043499350548, 0.016968246549367905, -0.020029334351420403, 0.018568074330687523, -0.03821949660778046, -0.07926073670387268, -0.008125106804072857, -0.042981185019016266, -0.08843139559030533, -0.037766002118587494, 0.007281103637069464, -0.030711645260453224, 0.015292837284505367, 0.06908230483531952, 0.027411213144659996, 0.024728039279580116, -0.003457894315943122, -0.01221285481005907, -0.028141843155026436, 0.004934900440275669, -0.06832648068666458, -0.03212251514196396, 0.04207419604063034, 0.028519755229353905, 0.002731988439336419, 0.013025364838540554, 0.06998929381370544, -0.017837444320321083, -0.03234926238656044, -0.0777490884065628, -0.0005050635663792491, -0.004068851936608553, -0.009391112253069878, -0.03003140352666378, -0.012206556275486946, -0.017232785001397133, -0.092361681163311, 0.045299045741558075, -0.02214564010500908, -0.03391129896044731, 0.0039460305124521255, -0.0006684317486360669, -0.014310265891253948, 0.02162916027009487, 0.007293700706213713, -0.017950817942619324, -0.02675616554915905, -0.024224156513810158, 0.017812250182032585, -0.016728902235627174, 0.0003668895224109292, 0.013617427088320255, -0.030006209388375282, -0.0068716988898813725, 0.01607385464012623, -0.03683381900191307, 0.013100947253406048, -0.0352717824280262, 0.036430712789297104, 0.05935737118124962, -0.019878169521689415, -0.06636133790016174, 0.042628467082977295, -0.02665538899600506, 0.02919999696314335, -0.04174667224287987, 0.028141843155026436, -0.024891801178455353, 0.009472993202507496, 0.060012418776750565, 0.0426032729446888, -0.040562547743320465, -0.0015636107418686152, -0.0010235115187242627, -0.022699911147356033, 0.008742363192141056, 0.009687143377959728, 0.0004369606904219836, -0.015771524980664253, -0.014574804343283176, 0.004005866590887308, -0.03814391419291496, -0.025357892736792564, -0.0498339906334877, 0.02300224080681801, -0.03927765041589737, 0.008421137928962708, -0.027335630729794502, -0.0309887807816267, -0.01995375193655491, -0.024753233417868614, 0.017925623804330826, 0.024287141859531403, 0.030056597664952278, -0.012697841972112656, -0.05240378901362419, -0.012345124036073685, -0.005640335846692324, -0.028746502473950386, -0.016565140336751938, -0.013012767769396305, -0.03320586308836937, -0.005895426496863365, -0.04174667224287987, -0.016804484650492668, 0.004692406859248877, 0.0004971903981640935, -0.02443830668926239, 0.02834339626133442, -0.006953579839318991, 0.019852975383400917, 0.03476789966225624, -0.014940119348466396, 0.006355219520628452, -0.032777562737464905, 0.0960400253534317, -0.009233648888766766, 0.04570215195417404, 0.024539083242416382, 0.015973078086972237, 0.02480362169444561, 0.012307332828640938, -0.02563502825796604, 0.042124584317207336, -0.035548917949199677, -0.0030264449305832386, -0.03963036835193634, -0.041671089828014374, -0.04313234984874725, 0.04325832054018974, -0.07281103730201721, 0.06152406707406044, 0.012798618525266647, -0.02175513096153736, -0.016451766714453697, -0.05724106356501579, 0.030056597664952278, 0.012256944552063942, 0.012565572746098042, -0.02442570962011814, 0.07507850974798203, 0.05205107107758522, 0.015809316188097, -0.0019462466007098556, 0.015204657800495625, 0.016325796023011208, 0.00419167336076498, -0.014096115715801716, 0.03600241243839264, 0.019966349005699158, -0.009151767939329147, -0.020633991807699203, -0.0017132008215412498, 0.03474270552396774, -0.06590784341096878, 0.031920962035655975, -0.019878169521689415, -0.00593006843701005, -0.007463761139661074, -0.0006680380902253091, 0.026579806581139565, 0.026605000719428062, -0.0005212035612203181, 0.032298874109983444, 0.007759792264550924, -0.0004117665521334857, -0.03466712310910225, 0.03517100587487221, 0.004884512163698673, 0.020394647493958473, -0.018429506570100784, 0.005372648127377033, -0.015444002114236355, -0.038597408682107925, -0.0340624637901783, -0.02455168031156063, -0.003549223067238927, -0.029477132484316826, -0.004752242937684059, -0.02894805558025837, 0.014335460029542446, -0.028771696612238884, 0.01715720258653164, 0.010052458383142948, -0.008219584822654724, 0.028167037293314934, -0.00971863605082035, -0.03673304244875908, -0.06177600845694542, -0.025874370709061623, 0.017824847251176834, 0.02965349145233631, -0.012565572746098042, -0.010386279784142971, -0.011595598421990871, 0.011551508679986, 0.025320101529359818, -0.006210353225469589, -0.0024816219229251146, -0.025206727907061577, 0.03184537962079048, 0.03585124760866165, 0.08072198927402496, -0.025798790156841278, 0.01356703881174326, -0.036430712789297104, 0.0006011162186041474, -0.007955046370625496, -0.014234683476388454, 0.04265366122126579, -0.013604830019176006, 0.043611038476228714, 0.000558994768653065, 0.028721308335661888, -0.05371388420462608, 0.0030878556426614523, 0.05814805254340172, 0.01898377761244774, 0.0022784941829741, 0.026101117953658104, -0.005136453080922365, 0.0035051333252340555, 0.011948316358029842, 0.005656082183122635, 0.046256422996520996, -0.0013691434869542718, 0.023153405636548996, 0.025332698598504066, 0.010247712023556232, 0.003097303444519639, 0.057442616671323776, 0.02758757211267948, 0.01331509742885828, -0.015343225561082363, -0.05436893180012703, 0.030711645260453224, -0.030006209388375282, 0.025748401880264282, -0.03305469825863838, -0.0028296157252043486, -0.009838308207690716, 0.046634335070848465, -0.020218288525938988, -0.0790087953209877, -0.012792319990694523, 0.027360824868083, -0.001730521791614592, -0.002950862515717745, 0.013390679843723774, -0.007507850881665945, -0.031165139749646187, -0.0017336710589006543, 0.0449715219438076, 0.011381448246538639, -0.004670361988246441, -0.0194624662399292, 0.054318543523550034, 0.02577359601855278, 0.08414839208126068, -0.06364037096500397, -2.186033634643536e-05, -0.030358927324414253, -0.0020328513346612453, -0.040814489126205444, 0.026907330378890038, 0.02359430305659771, 0.032399650663137436, 0.01252148300409317, 0.006707936991006136, 0.03474270552396774, 0.016464363783597946, 0.043837785720825195, 0.019664019346237183, 0.025698013603687286, -0.006481189746409655, -0.031165139749646187, -0.0036877908278256655, 0.002728839172050357, 0.020167900249361992, -0.054772038012742996, -0.02675616554915905, -0.0076968069188296795, 0.005212035495787859, -0.03912648558616638, -0.017358755692839622, -0.0053506032563745975, -0.018164968118071556, 0.046206034719944, 0.014007936231791973, 0.010241413488984108, 0.0015714839100837708, -0.01215616799890995, 0.003457894315943122, -0.027159271761775017, -0.028771696612238884, -0.024652456864714622, -0.00035429245326668024, -0.012672647833824158, 0.05462087318301201, -0.004692406859248877, -0.004963243845850229, -0.0023351809941232204, -0.008112509734928608, 0.008641586638987064, 0.028721308335661888, 0.001515584415756166, -0.01773666776716709, -0.013655218295753002, 0.030711645260453224, 0.06797376275062561, -0.04799481853842735, -0.007791284937411547, 0.00947929173707962, 0.01083347573876381, 0.025471266359090805, -0.0004975840565748513, -0.0015502263559028506, 0.04812078922986984, 0.0510433092713356, 0.012427004985511303, -0.0033634162973612547, -0.025433475151658058, 0.02089853025972843, -0.004897109232842922, -0.0018580671167001128, 0.023669885471463203, 0.013504053466022015, -0.016149437054991722, -0.0031177736818790436, 0.02758757211267948, -0.05910542979836464, 0.014751163311302662, -0.00629538344219327, -0.0035429245326668024, -0.05482242628931999, -0.023808453232049942, -0.009781621396541595, 0.015960481017827988, 0.02564762532711029, -0.005851336754858494, -0.0680241510272026, 0.012263243086636066, -0.01932389847934246, -0.026957718655467033, 0.052706118673086166, 0.06066746637225151, -0.04587851092219353, 0.04900258406996727, -0.04910336062312126, 0.019235718995332718, 0.011293268762528896, -0.0018895597895607352, 0.012836409732699394, 0.06888075172901154, 0.011771957390010357, -0.0009550150134600699, 0.0136804124340415, -0.02141501009464264, -0.03597721830010414, 0.007274805102497339, -0.04915374889969826, 0.01810198277235031, 0.006342622451484203, -0.06409386545419693, -0.007438567001372576, -0.040940459817647934, -0.03622915968298912, 0.0007459824555553496, -0.02176772803068161, -0.005407290067523718, -0.0054419320076704025, -0.013025364838540554, 0.006159964948892593, -0.009466694667935371, -0.00826997309923172, 0.0912531390786171, 0.04119240120053291, 0.03207212686538696, -0.020344259217381477, 0.024967383593320847, -0.0023902931716293097, 0.0010313846869394183, 0.05084175616502762, -0.011173596605658531, 0.009139170870184898, 0.019399480894207954, 0.014486624859273434, -0.009567471221089363, 0.003564969403669238, -0.007482656743377447, -0.026957718655467033, 0.0012439602287486196, 0.006443399004638195, -0.03245003893971443, -0.042023807764053345, 0.0077094039879739285, 0.07009007036685944, -0.0012266392586752772, -0.02213304303586483, -0.028041066601872444, -0.010298100300133228, 0.016262810677289963, 0.024387918412685394, 0.015481793321669102, 0.010732699185609818, -0.006525279488414526, -0.0535123310983181, 0.006093830335885286, 0.0007778687868267298, -0.0010494929738342762, 0.02178032509982586, 0.016804484650492668, -0.013693009503185749, 0.04681069403886795, 0.00797394197434187, 0.001581719028763473, -0.011520016007125378, -0.01209948118776083, -0.01570853963494301, -0.025597237050533295, -0.0005704108625650406, -0.008049524389207363, 0.042855214327573776, -0.0031980799976736307, -0.07427229732275009, 0.0328531451523304, 0.024866607040166855, 0.05814805254340172, 0.03711095452308655, -0.026201894506812096, -0.040688518434762955, 0.024249350652098656, -0.000294653233140707, -0.011759360320866108, 0.013541844673454762, 0.002615465549752116, 0.018769627436995506, -0.007104744669049978, 0.010480757802724838, -0.004698705393821001, -0.01861846260726452, 0.013151335529983044, -0.007734598126262426, -0.014826745726168156, -0.013088350184261799, 0.0225109551101923, -0.03756444901227951, 0.012471094727516174, -0.03832027316093445, 0.01538101676851511, 0.018026400357484818, -0.010776788927614689, 0.041545119136571884, -0.056737180799245834, 0.019626228138804436, -0.00629538344219327, 0.016691111028194427, -0.027637960389256477, -0.01677929051220417, -0.0055993953719735146, 0.013365485705435276, -0.011205089278519154, -0.012301034294068813, 0.004824676085263491, 0.018391715362668037, 0.032298874109983444, -0.031039169058203697, -0.010291801765561104, 0.02164175733923912, 0.018631059676408768, 0.008068419992923737, -0.01142553798854351, -0.056132521480321884, 0.02067178301513195, 0.0023902931716293097, -0.012697841972112656, -0.014700775034725666, -0.010663415305316448, -0.0040373592637479305, 0.011942017823457718, -0.015078687109053135, 0.009624158032238483, 0.00353977526538074, -0.01288679800927639, 0.05119447410106659, 0.03189576789736748, -0.02907402627170086, -0.017421741038560867, 0.030232956632971764, 0.003524028928950429, 0.004884512163698673, -0.01691785827279091, -0.0213016364723444, 0.018328730016946793, -0.03476789966225624, -0.027663154527544975, -0.009863502345979214, -0.01428507175296545, -0.014637789689004421, -0.022548746317625046, -0.05935737118124962, 0.012086884118616581, 0.013453665189445019, -0.027360824868083, 0.022662119939923286, 0.0013337142299860716, 0.02238498441874981, -0.016716305166482925, -0.00522778183221817, 0.004853019490838051, -0.003147691721096635, -0.005693873390555382, 0.015431405045092106, -0.05290767177939415, -0.020646588876843452, 0.012559274211525917, -0.007621224503964186, -0.058551158756017685, 0.032903533428907394, 0.03806833177804947, -0.01700603775680065, -0.021477995440363884, 0.03862260282039642, 0.0018927090568467975, -0.008918722160160542, 0.006433951202780008, 0.01691785827279091, 0.008433734998106956, -0.0036846415605396032, -0.04804520681500435, -0.002080090343952179, -0.008125106804072857, -0.025483863428235054, -0.02102450095117092, -0.014322862960398197, -0.041897837072610855, 0.04681069403886795, 0.0450219102203846, -0.03214770928025246, 0.008962811902165413, 0.026327865198254585, 0.035322170704603195, 0.024866607040166855, -0.0051805428229272366, 0.016930455341935158, -0.014625192619860172, 0.008427436463534832, -0.003498834790661931, 0.012899395078420639, -0.05487281456589699, 0.035196200013160706, 0.019147539511322975, -0.007381880190223455, -0.024879204109311104, -0.0035555216018110514, -0.0121687650680542, -0.00543878274038434, -0.012124675326049328, 0.004563286900520325, 0.018933389335870743, 0.0014840917428955436, -0.025143742561340332, 0.003930284176021814, 0.04315754398703575, 0.0053254091180861, -0.02336755581200123, 0.0025635026395320892, 0.010291801765561104, -0.023191196843981743, -0.034843482077121735, -0.010323294438421726, 0.0029981015250086784, -0.029149608686566353, 0.0004641231207642704, -0.03025815077126026, -0.052353400737047195, -0.024135977029800415, -0.04038618877530098, 0.008081017062067986, -0.0426032729446888, -0.009995771571993828, 0.002366673666983843, 0.0011975085362792015, -0.03076203353703022, 0.04781845957040787, 0.004859318025410175, 0.017812250182032585, 0.013516650535166264, -0.007879463955760002, -0.03194615617394447, 0.008723467588424683, 0.037690419703722, 0.014070921577513218, 0.0013447366654872894, -0.014952716417610645, 0.00954857561737299, -0.03295392170548439, -0.02358170598745346, 0.035826053470373154, -0.02092372439801693, -0.00720552122220397, -0.03852182626724243, 0.05764416977763176, 0.0571906752884388, -0.010405175387859344, -0.004919154103845358, -0.004478256683796644, -0.0011345231905579567, 0.020974112674593925, -0.005863933824002743, -0.006166263483464718, -0.011872733943164349, 0.029401550069451332, 0.006588264834135771, 0.038950126618146896, 0.0021430756896734238, 0.051496803760528564, 0.00020922937255818397, -0.07840413600206375, -0.01631319895386696, -0.0206591859459877, -0.01259076688438654, -0.015444002114236355, 0.0012274265754967928, -0.040335800498723984, -0.02758757211267948, 0.04560137540102005, 0.04660914093255997, -0.021692145615816116, -0.01288679800927639, 0.006726832594722509, -0.03612838312983513, 0.021553577855229378, -0.018442103639245033, 0.001060515409335494, 0.016376184299588203, 0.010405175387859344, -0.00898800604045391, -0.02494218945503235, 0.0005704108625650406, 0.020218288525938988, -0.01870664209127426, -0.011457030661404133, 0.002572950441390276, -0.05265573039650917, -0.010927953757345676, 0.00689689302816987, 0.0017132008215412498, 0.017081620171666145, -0.028544949367642403, 0.0034295509103685617, 0.011828644201159477, -0.020243482664227486, -0.023518720641732216, 0.0014431512681767344, -0.05195029452443123, 0.017081620171666145, -0.037866778671741486, -0.013000170700252056, -0.002796548418700695, -0.007180327083915472, -0.0048215268179774284, -0.012515184469521046, 0.005149050150066614, 0.015607764013111591, -0.011841241270303726, 0.046861082315444946, -0.034238822758197784, 0.024413112550973892, -0.027889901772141457, 0.009403709322214127, 0.00024052521621342748, -0.009378515183925629, 0.03275236859917641, 0.0002165120531572029, 0.02321639098227024, -0.020382050424814224, -0.02345573529601097, 0.03622915968298912, -0.009693441912531853, -0.004197971895337105, -0.026428641751408577, -0.0029697581194341183, -0.0007428331882692873, -0.02188110165297985, 0.05542708560824394, 0.003135094651952386, 0.022662119939923286, 0.011570404283702374, -0.0449715219438076, 0.0008589623612351716, 0.020508021116256714, 0.04509749263525009, 0.02713407762348652, -0.014499221928417683, 0.05220223590731621, -0.02383364737033844, 0.026907330378890038, 0.00473964586853981, -0.004361733794212341, 0.019399480894207954, 0.0027351377066224813, 0.003124072216451168, 0.037614837288856506, 0.009888696484267712, 0.01391975674778223, -0.013403276912868023, -0.04660914093255997, -0.003234296338632703, -0.04658394679427147, -0.02652941830456257, -0.007740896660834551, 0.0018549178494140506, 0.041519924998283386, -0.011885331012308598, 0.004157031420618296, -0.08157858997583389, 0.008005434647202492, 0.030610868707299232, -0.036279547959566116, 0.020646588876843452, -0.0118601368740201, 0.0040247621946036816, 0.004487704485654831, -0.003681492293253541, -0.03940362110733986, 0.005778903607279062, -0.003939731977880001, -0.003445297246798873, -0.0011329485569149256, 0.03912648558616638, -0.028897667303681374, 0.014877134002745152, -0.006972475443035364, 0.05169835686683655, -0.03365935757756233, -0.009598963893949986, -0.01798860915005207, -0.016565140336751938, 0.04315754398703575, 0.011809748597443104, 0.012288437224924564, 0.00040822362643666565, 0.033382222056388855, 0.01579671911895275, 0.02224641665816307, 0.001255769981071353, -0.039806727319955826, 0.019601034000515938, 0.027511989697813988, -0.02091112732887268, 0.009598963893949986, -0.000331460265442729, 0.047364965081214905, 0.025017771869897842, -0.000618043530266732, -0.016502154991030693, -0.04270404949784279, 0.008433734998106956, -0.010020965710282326, 0.03053528629243374, -0.007255909498780966, -0.017169799655675888, 0.006232398096472025, -0.019764795899391174, -0.02407299168407917, -0.0066764443181455135, 0.02300224080681801, -0.006068636197596788, -0.025823984295129776, 0.04633200541138649, 0.047591712325811386, -0.04509749263525009, -0.0028800040017813444, 0.0009479291620664299, 0.011979809030890465, -0.01046816073358059, 0.02726004831492901, 0.010046159848570824, -0.03464192897081375, 0.010247712023556232, -0.02030646800994873, 0.011784554459154606, 0.009315529838204384, -0.01331509742885828, -0.026554612442851067, -0.021855907514691353, -0.011557807214558125, -0.0008566004107706249, -0.025017771869897842, 0.006644951645284891, 0.013466262258589268, 0.04096565395593643, 0.0033319236245006323, 0.009019498713314533, -0.008559705689549446, 0.004386927932500839, -0.023380152881145477, 0.015028298832476139, 0.046155646443367004, -0.014511818997561932, -0.013403276912868023, 0.02358170598745346, -0.022410178557038307, -0.010128039866685867, 0.02831820212304592, -0.020394647493958473, 0.005369498860090971, 0.010568937286734581, -0.012685244902968407, -0.03638032451272011, 0.002287941984832287, -0.014940119348466396, 0.011627091094851494, 0.006915788631886244, 0.0014730693073943257, 0.011211387813091278, 0.028620531782507896, 0.010732699185609818, -0.013957547955214977, -0.024992577731609344, 0.055023979395627975, -0.031920962035655975, 0.0019352241652086377, -0.02758757211267948, 0.018202759325504303, 0.03731250762939453, 0.006544175092130899, -0.01296237949281931, -0.018089385703206062, -0.034339599311351776, 0.03489387035369873, 0.034112852066755295, -0.002623338717967272, -0.008477824740111828, -0.028293007984757423, 0.006040292792022228, 0.013491456396877766, 0.0009479291620664299, 0.004830974619835615, -0.011469627730548382, -0.024110782891511917, -0.009567471221089363, -0.019512854516506195, -0.006594563368707895, 0.018681447952985764, 0.01715720258653164, 0.015003104694187641, -0.0644969716668129, 0.028494561091065407, -0.009164365008473396, -0.005678127054125071, 0.018568074330687523, -0.01296237949281931, 0.006175711285322905, -0.03454115241765976, -0.0017604398308321834, -0.005892277229577303, 0.033155474811792374, -0.02942674420773983, -0.02773873694241047, -0.035800859332084656, 0.02224641665816307, 0.0005152986850589514, -0.023317167535424232, 0.025735804811120033, -0.006087531801313162, 0.01342847105115652, 0.028746502473950386, 0.0026737269945442677, 0.007060654927045107, 0.03965556249022484, 0.008440033532679081, -0.04655875265598297, -0.004431017674505711, -0.01764848828315735, -0.010927953757345676, 0.02406039461493492, 0.011463329195976257, 0.015658151358366013, 0.006487488280981779, -0.035070229321718216, -0.0005444294074550271, -0.016363587230443954, -0.04519826918840408, 0.029577909037470818, -0.02467765100300312, 0.04534943401813507, 0.007318894844502211, 0.003892493201419711, 0.0498591847717762, 0.03731250762939453, 0.07235754281282425, -0.013516650535166264, -0.0401342511177063, 0.025735804811120033, -0.027285242453217506, 0.02713407762348652, 0.0014281922485679388, 0.0027871006168425083, 0.03552372381091118, -0.027789125218987465, 0.017308367416262627, 0.010858669877052307, 0.02214564010500908, 0.009567471221089363, 0.03693459555506706, -0.0055332607589662075, 0.0029477132484316826, 0.02589956484735012, 0.025584639981389046, 0.037891972810029984, 0.048826225101947784, 0.02640344761312008, 0.004827825352549553, -0.023758064955472946, 0.014133906923234463, 0.04071371257305145, 0.0010156383505091071, -0.027688348665833473, 4.0448387153446674e-05, 0.05179912969470024, -0.02078515663743019, -0.038597408682107925, -0.0309887807816267, -0.003643701085820794, -0.017950817942619324, -0.04643278196454048, 0.017963415011763573, -0.017333561554551125, -0.016363587230443954, 0.002092687413096428, -0.0200545284897089, 0.018945986405014992, -0.04655875265598297, -0.006021397188305855, -0.027663154527544975, -0.024362724274396896, -0.02965349145233631, 0.035548917949199677, -0.01526764314621687, 0.011967211961746216, 0.0020863888785243034, 0.007274805102497339, 0.000333231728291139, -0.025143742561340332, 0.03187057375907898, 0.011935719288885593, -0.020759962499141693, -0.00997057743370533, 0.020520618185400963, -0.007829075679183006, -0.0010738997953012586, 0.007608627434819937, 0.02151578664779663, 0.01391975674778223, 0.009983174502849579, 0.006172562018036842, -0.020482826977968216, -0.016338393092155457, 0.004805780481547117, 0.0012116802390664816, 0.030560480430722237, 0.023896632716059685, -0.014814148657023907, -0.026579806581139565, -0.023153405636548996, 0.010361085645854473, 0.0034547450486570597, -0.01922312192618847, 0.012011301703751087, -0.0474405474960804, 0.035095423460006714, 0.007646418642252684, -0.0025052414275705814, 0.015771524980664253, -0.01094684936106205, 0.0182279534637928, -0.00985720381140709, -0.04061293601989746, 0.006764623802155256, -0.024035200476646423, -0.019298704341053963, 0.021352024748921394, 0.027637960389256477, 0.04270404949784279, -0.017182396724820137, 0.014801551587879658, 0.02346833236515522, 0.03234926238656044, -0.004223166033625603, -0.007425969932228327, -0.03559930622577667, -0.003939731977880001, -0.003095728810876608, -0.03141707926988602, 0.004399525001645088, 0.02713407762348652, -0.015406210906803608, 0.0060560391284525394, 0.00229266588576138, 0.006046591326594353, 0.0011235007550567389, -0.041771866381168365, -0.016854872927069664, -0.0003338222159072757, 0.0450219102203846, -0.0007211819756776094, -0.013214320875704288, -0.01728317327797413, 0.029955821111798286, 0.01908455416560173, 0.0031051766127347946, -0.00203914986923337, 0.007306297775357962, -0.04756651818752289, 0.01968921348452568, 0.017610697075724602, -0.007898359559476376, 0.007551940623670816, 0.015809316188097, 0.0005715918377973139, 0.014272474683821201, -0.03978153318166733, 0.027637960389256477, 0.017913026735186577, -0.02286367304623127, -0.010720102116465569, 0.017585502937436104, -0.019865572452545166, 0.03905090317130089, 0.03469231724739075, -0.04353545606136322, 0.005208886228501797, -0.05300844833254814, 0.03270198032259941, -0.03915167972445488, 0.015103881247341633, -0.001961992820724845, 0.01167747937142849, -0.0014573229709640145, -0.014864536933600903, 0.0036751937586814165, 0.007092147599905729, 0.033029504120349884, -0.017459532245993614, 0.009050991386175156, 0.030610868707299232, 0.006940982770174742, 0.030484898015856743, -0.016955649480223656, 0.015418807975947857, -0.05154719203710556, -0.00826997309923172, -0.006953579839318991, -0.013239515013992786, -0.009227350354194641, -0.010323294438421726, -0.009120275266468525, -0.006644951645284891, 0.02199447527527809, -0.038118720054626465, 0.025257116183638573, -0.007507850881665945, 0.004475107416510582, 0.020633991807699203, 0.07094667106866837, 0.012458497658371925, -0.0038295078556984663, 0.011160999536514282, 0.020243482664227486, -0.010310697369277477, 0.0023367556277662516, 0.009252544492483139, -0.02190629579126835, -0.04781845957040787, -0.0237202737480402, 0.0003157139290124178, 0.003176035126671195, 0.006260741502046585, -0.009063588455319405, -0.01452441606670618, 0.0077534937299788, 0.022082654759287834, 0.03184537962079048, 0.00028796104015782475, 0.03129110857844353, 0.04837273061275482, 0.026479030027985573, 0.0037003878969699144, 0.01800120621919632, -0.007747195195406675, 0.021578771993517876, -0.0015525883063673973, 0.025345295667648315, 0.04786884784698486, 0.030232956632971764, -0.02469024807214737, 0.008414839394390583, 0.005234080366790295, -0.030308539047837257, 0.01331509742885828, -0.011771957390010357, 0.01032959297299385, -0.00638041365891695, 0.03461673483252525, 0.02103709802031517, 0.022914061322808266, -0.017799653112888336, 0.0012589191319420934, 0.019978946074843407, 0.010279204696416855, 0.012792319990694523, 0.00309887807816267, -0.005070318467915058, 0.015406210906803608, -0.0025414577685296535, -0.007104744669049978, 0.011217686347663403, -0.01331509742885828, -0.01259076688438654, -0.038723379373550415, 0.006210353225469589, 0.040940459817647934, 0.01774926483631134, 0.024022603407502174, -0.016602931544184685, -0.0011022432008758187, 0.010795684531331062, 0.0243375301361084, -0.01617463119328022, -0.04449283331632614, -0.018404312431812286, -0.0017746115336194634, -0.022397581487894058, 0.03517100587487221, -0.020369453355669975, -0.005552156362682581, 0.026126312091946602, -0.007866866886615753, 0.011967211961746216, 0.0328531451523304, 0.01824055053293705, -0.018038997426629066, 0.029275579378008842, 0.04020983353257179, 0.013705606572329998, -0.022321999073028564, -0.005693873390555382, -0.005360051058232784, -0.00473964586853981, -0.011205089278519154, 0.021843310445547104, 0.0023367556277662516, -0.0075141494162380695, 0.0170186348259449, -0.005583649035543203, 0.008345555514097214, 0.028116649016737938, 0.0309887807816267, -0.019386883825063705, 0.007772389333695173, -0.005338006187230349, 0.0044436147436499596, -0.011967211961746216, 0.02004193142056465, 0.024967383593320847, 0.018883001059293747, -0.01594788394868374, -0.017673682421445847, 0.022347193211317062, -0.0015840809792280197, -0.008799050003290176, -0.01908455416560173, 0.010814580135047436, 0.04041138291358948, 0.006764623802155256, 0.0023225839249789715, 0.0035555216018110514, -0.01342847105115652, -0.019172733649611473, -0.01593528687953949, -0.03728731349110603, -0.007098446134477854, -0.040058668702840805, -0.027436407282948494, 0.007362984586507082, 0.00838334672152996, -0.014133906923234463, 0.006125323008745909, 0.004512898623943329, -0.0040373592637479305, 0.021226054057478905, -0.03194615617394447, 0.0036909400951117277, -0.019601034000515938, 0.018996374681591988, 0.0285701435059309, 0.02418636530637741, -0.002355651231482625, 0.0016281706048175693, -0.000825895054731518, -0.030358927324414253, -0.012924589216709137, -0.02031906507909298, -0.0032185502350330353, -0.028872473165392876, 0.050035543739795685, 0.022926658391952515, -0.02602553553879261, 0.027637960389256477, -0.0018974329577758908, 0.027436407282948494, 0.01897118054330349, -0.006172562018036842, 0.023027434945106506, -0.00035389879485592246, -0.01069490797817707, 0.0014392146840691566, 0.0206843800842762, -0.00598675524815917, -0.04038618877530098, 0.03736289590597153, 0.0061347708106040955, -0.022460566833615303, -0.039328038692474365, 0.01691785827279091, -0.006106427405029535, -0.0340876579284668, -0.02713407762348652, 0.013000170700252056, 0.01356703881174326, -0.00366574595682323, 0.01752251759171486, -0.00917066354304552, -0.0008865184499882162, 0.02457687444984913, 0.014990507625043392, 0.018681447952985764, 0.0053757973946630955, 0.02152838371694088, -0.008301465772092342, 0.005605693906545639, -0.012798618525266647, -0.025219324976205826, 0.006890594493597746, 0.0038578512612730265, -0.029401550069451332, -0.026126312091946602, -0.0019352241652086377, 0.008950214833021164, 0.01106022298336029, 0.0218936987221241, -0.01725797913968563, -0.008622691035270691, -0.03086281009018421, 0.011192492209374905, -0.025017771869897842, -0.014033130370080471, 0.0033382221590727568, -0.008843139745295048, 0.04146953672170639, -0.016250213608145714, -0.010386279784142971, 0.026176700368523598, 0.04527385160326958, -0.02700810693204403, -0.010827177204191685, -0.03222329169511795, -0.0016533647431060672, -0.012105779722332954, 0.053562719374895096, -0.0005168733187019825, 0.02955271489918232, -0.010594131425023079, 0.02103709802031517, 0.004330241121351719, -0.0020375752355903387, 0.006997669581323862, -0.006027695722877979, -0.00801803171634674, -0.006632354576140642, 0.011652285233139992, -0.0061883083544671535, 0.011753061786293983, 0.014549610204994678, -0.010348488576710224, -0.011532613076269627, 0.029124414548277855, -0.026126312091946602, -0.015973078086972237, -0.010247712023556232, 0.031618632376194, 0.017850041389465332, -0.01762329414486885, -0.021188262850046158, 0.038597408682107925, -0.030056597664952278, -0.011998704634606838, 0.0035082825925201178, 0.006537876557558775, -0.004175927024334669, -0.017434338107705116, -0.047012247145175934, 0.04220016673207283, -0.004938049707561731, 0.0033445206936448812, 0.04610525816679001, -0.00016720635176170617, -0.004169628489762545, -0.01847989484667778, 0.0001803939085220918, 0.03479309380054474, -0.019147539511322975, -0.011866435408592224, 0.0014927522279322147, 0.05376427248120308, 0.028015872463583946, -0.030484898015856743, -0.02821742556989193, -0.0091139767318964, -0.0020989859476685524, 0.02358170598745346, -0.008364451117813587, 0.024362724274396896, 0.008597496896982193, -0.022939255461096764, 0.01885780692100525, -0.016212422400712967, -0.0070165651850402355, 0.03250042721629143, -0.01380638312548399, -0.025483863428235054, -0.006185159087181091, -0.023191196843981743, -0.01957583986222744, 0.000793615123257041, 0.0068465047515928745, 0.0033319236245006323, -0.013264709152281284, -0.0002909134782385081, -0.0009621008648537099, 0.01428507175296545, 0.0015037746634334326, -0.009869800880551338, -0.024765830487012863, 0.02140241302549839, -0.019752198830246925, 0.012552975676953793, -0.011387746781110764, 0.006972475443035364, 0.017547711730003357, 0.0034547450486570597, 0.0016596632776781917, -0.0091139767318964, 0.007923553697764874, 0.03184537962079048, 0.007690508384257555, 0.029099220409989357, 0.009649352170526981, -0.019235718995332718, 0.00018206695676781237, 0.02296444959938526, -0.02203226648271084, -0.012332526966929436, -0.016968246549367905, -0.017799653112888336, 0.009189559146761894, 0.05127005651593208, -0.01294978242367506, 0.020860739052295685, 0.009498187340795994, -0.011645986698567867, 0.017900429666042328, -0.007306297775357962, 0.007218118291348219, 0.01652734912931919, -0.014990507625043392, 0.015771524980664253, -0.029275579378008842, 0.034465570002794266, 0.03307989239692688, 0.013289903290569782, -0.00022753448865842074, -0.027159271761775017, 0.02263692580163479, 0.028519755229353905, 0.005948964040726423, -0.0035177303943783045, -0.02663019485771656, 0.02783951349556446, 0.00978791993111372, -0.035926830023527145, 0.008332958444952965, -0.008414839394390583, -0.029603103175759315, -0.0012833259534090757, 0.020986709743738174, 0.037388090044260025, -0.03345780447125435, 0.016262810677289963, -0.015444002114236355, -0.00024288716667797416, 0.0010715378448367119, 0.024123379960656166, 0.03307989239692688, -0.026453835889697075, 0.004664063453674316, -0.01897118054330349, -0.003536625998094678, -0.01981518417596817, 0.025710610672831535, 0.007703105453401804, -0.009164365008473396, 0.008440033532679081, 0.006052889861166477, -0.009252544492483139, 0.009920189157128334, 0.012181362137198448, 0.00930923130363226, 0.001899007591418922, -0.0027524586766958237, 0.004897109232842922, 0.010896461084485054, -0.01921052485704422, 0.0261515062302351, -0.0364559069275856, 0.0028815786354243755, -0.013453665189445019, -0.0243375301361084, -0.03753925487399101, 0.019412077963352203, -0.004509749356657267, 0.017056426033377647, -0.013970145024359226, -0.030207762494683266, -0.003122497582808137, 0.008597496896982193, 0.049430884420871735, -0.019008971750736237, -0.003278386080637574, -0.047238994389772415, -0.010613027028739452, -0.007596030365675688, 0.0055332607589662075, -0.04854908958077431, -0.0013305649627000093, -0.034112852066755295, 0.01932389847934246, -0.03247523307800293, 0.009920189157128334, -0.0037633732426911592, -0.025131145492196083, 0.008811647072434425, -0.01859326846897602]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:14:05.968400", "url_path": "/graph/", "chunk_size": 4053}
updated_dt: 2025-03-14T10:14:05.970159
---
```
from__future__import annotations as _annotations
fromdataclassesimport dataclass, field
frompydantic_graphimport BaseNode, End, Graph, GraphRunContext
frompydantic_aiimport Agent
frompydantic_ai.format_as_xmlimport format_as_xml
frompydantic_ai.messagesimport ModelMessage
ask_agent = Agent('openai:gpt-4o', result_type=str)

@dataclass
classQuestionState:
  question: str | None = None
  ask_agent_messages: list[ModelMessage] = field(default_factory=list)
  evaluate_agent_messages: list[ModelMessage] = field(default_factory=list)

@dataclass
classAsk(BaseNode[QuestionState]):
  async defrun(self, ctx: GraphRunContext[QuestionState]) -> Answer:
    result = await ask_agent.run(
      'Ask a simple question with a single correct answer.',
      message_history=ctx.state.ask_agent_messages,
    )
    ctx.state.ask_agent_messages += result.all_messages()
    ctx.state.question = result.data
    return Answer(result.data)

@dataclass
classAnswer(BaseNode[QuestionState]):
  question: str
  answer: str | None = None
  async defrun(self, ctx: GraphRunContext[QuestionState]) -> Evaluate:
    assert self.answer is not None
    return Evaluate(self.answer)

@dataclass
classEvaluationResult:
  correct: bool
  comment: str

evaluate_agent = Agent(
  'openai:gpt-4o',
  result_type=EvaluationResult,
  system_prompt='Given a question and answer, evaluate if the answer is correct.',
)

@dataclass
classEvaluate(BaseNode[QuestionState]):
  answer: str
  async defrun(
    self,
    ctx: GraphRunContext[QuestionState],
  ) -> End[str] | Reprimand:
    assert ctx.state.question is not None
    result = await evaluate_agent.run(
      format_as_xml({'question': ctx.state.question, 'answer': self.answer}),
      message_history=ctx.state.evaluate_agent_messages,
    )
    ctx.state.evaluate_agent_messages += result.all_messages()
    if result.data.correct:
      return End(result.data.comment)
    else:
      return Reprimand(result.data.comment)

@dataclass
classReprimand(BaseNode[QuestionState]):
  comment: str
  async defrun(self, ctx: GraphRunContext[QuestionState]) -> Ask:
    print(f'Comment: {self.comment}')
    ctx.state.question = None
    return Ask()

question_graph = Graph(nodes=(Ask, Answer, Evaluate, Reprimand))

```

_(This example is complete, it can be run "as is" with Python 3.10+)_
ai_q_and_a_run.py```
fromrich.promptimport Prompt
frompydantic_graphimport End, HistoryStep
fromai_q_and_a_graphimport Ask, question_graph, QuestionState, Answer

async defmain():
  state = QuestionState() [](https://ai.pydantic.dev/graph/#__code_11_annotation_1)
  node = Ask() [](https://ai.pydantic.dev/graph/#__code_11_annotation_2)
  history: list[HistoryStep[QuestionState]] = [] [](https://ai.pydantic.dev/graph/#__code_11_annotation_3)
  while True:
    node = await question_graph.next(node, history, state=state) [](https://ai.pydantic.dev/graph/#__code_11_annotation_4)
    if isinstance(node, Answer):
      node.answer = Prompt.ask(node.question) [](https://ai.pydantic.dev/graph/#__code_11_annotation_5)
    elif isinstance(node, End): [](https://ai.pydantic.dev/graph/#__code_11_annotation_6)
      print(f'Correct answer! {node.data}')
      #> Correct answer! Well done, 1 + 1 = 2
      print([e.data_snapshot() for e in history])
"""
      [
        Ask(),
        Answer(question='What is the capital of France?', answer='Vichy'),
        Evaluate(answer='Vichy'),
        Reprimand(comment='Vichy is no longer the capital of France.'),
        Ask(),
        Answer(question='what is 1 + 1?', answer='2'),
        Evaluate(answer='2'),
        End(data='Well done, 1 + 1 = 2'),
      ]
      """
      return
    # otherwise just continue

```

_(This example is complete, it can be run "as is" with Python 3.10+ — you'll need to add`asyncio.run(main())` to run `main`)_
A [mermaid diagram](https://ai.pydantic.dev/graph/#mermaid-diagrams) for this graph can be generated with the following code:
ai_q_and_a_diagram.py```
fromai_q_and_a_graphimport Ask, question_graph
question_graph.mermaid_code(start_node=Ask)