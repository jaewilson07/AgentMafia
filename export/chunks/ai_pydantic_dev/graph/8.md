---
url: https://ai.pydantic.dev/graph/
session_id: pydantic_ai_docs
chunk_number: 8
title: Pydantic Graph Order Workflow Implementation
summary: This document snippet details an implementation of an order workflow using Pydantic with a graph structure. It defines data classes for managing order states and stored run states, includes a method for assessing whether an order requires human review based on its amount, and employs a global dictionary for persisting and loading the run states.
embedding: [0.025335539132356644, 0.04026918113231659, -0.051563337445259094, -0.051046766340732574, -0.005089414305984974, -0.021966075524687767, -0.03315456956624985, 0.009697476401925087, 0.001234931405633688, 0.0060286372900009155, 0.05856055021286011, -0.0046344781294465065, -0.010302101261913776, -0.022740935906767845, 0.006762404926121235, -0.025241615250706673, -0.00892848800867796, 0.022529609501361847, 0.01193987112492323, 0.021273398771882057, 0.022189142182469368, -0.012914314866065979, 0.03303716704249382, -0.020921191200613976, -0.04327469691634178, 0.003944736439734697, 0.008482356555759907, -0.0031874878332018852, -0.006509989034384489, -0.02025199495255947, 0.055085424333810806, -0.007091132923960686, -0.010724751278758049, 0.020932931452989578, -0.007167445030063391, -0.004860478453338146, -0.0411849245429039, 0.04231199249625206, 0.016401180997490883, 0.036136601120233536, 0.005330089945346117, -0.049966659396886826, 0.0007858654134906828, 0.0118165984749794, -0.012245118618011475, 0.040081337094306946, -0.015356294810771942, 0.033624179661273956, 0.038860347121953964, 0.0061695207841694355, -0.04696114733815193, -0.011241324245929718, -0.02782447822391987, 0.05588376522064209, -0.04578711837530136, 0.007361159659922123, -0.0020589528139680624, -0.020522020757198334, -0.017892196774482727, -0.008905007503926754, 0.049450088292360306, -0.02205999754369259, 0.023562755435705185, 0.0351269356906414, -0.06490030139684677, 0.01664772629737854, -0.05804397538304329, 0.020099369809031487, 0.01449925359338522, 0.02315184473991394, -0.021038593724370003, 0.03775675967335701, 0.027777517214417458, -0.03446948155760765, 0.014240967109799385, -0.0009869178757071495, 0.04869870841503143, 0.04240591451525688, 0.03543218597769737, -0.020298955962061882, -0.0646185353398323, -0.019453654065728188, -0.001670055789873004, 0.032614514231681824, 0.03637140616774559, -0.07734500616788864, -0.049309201538562775, -0.011047609150409698, -0.02899850718677044, -0.09429798275232315, 0.01734040305018425, 0.029280275106430054, 0.014358370564877987, 0.08401349186897278, 0.06743620336055756, 0.018455730751156807, 0.027331387624144554, -0.009744437411427498, -0.024865927174687386, 0.01656554453074932, 0.02418499067425728, -0.035526107996702194, -0.04498877748847008, 0.0006780015537515283, 0.023832781240344048, 0.01380657684057951, -0.02250612899661064, 0.08467094600200653, -0.028317570686340332, -0.04477745294570923, -0.06959641724824905, -0.02432587370276451, -0.01329000387340784, 0.013008237816393375, 0.006210611667484045, -0.025429461151361465, -0.0028543572407215834, -0.025241615250706673, -0.012761691585183144, -0.006650872528553009, -0.052737366408109665, 0.02249438874423504, -0.007595965173095465, -0.010384283028542995, 0.003903645323589444, 0.026767853647470474, -0.022682232782244682, -0.012069014832377434, 0.002245329786092043, -0.0070383017882704735, 0.009556593373417854, -0.02878718264400959, 0.018702276051044464, -0.06203567236661911, -0.037169747054576874, 0.04912135750055313, -0.011264804750680923, 0.003269669832661748, -0.012573846615850925, 0.02176649123430252, 0.0041208406910300255, -0.08499967306852341, -0.031017836183309555, 0.04386170953512192, -0.009192644618451595, 0.031417008489370346, -0.07865992188453674, 0.05198599025607109, -0.03653577342629433, 0.005465103313326836, 0.05569591745734215, 0.009762047789990902, -0.0012664834503084421, 0.012843873351812363, 0.03850813955068588, -0.012585586868226528, -0.004534685518592596, 0.04355646297335625, -0.011634623631834984, -0.0005132706719450653, -0.003178682643920183, 0.021789971739053726, 0.011975091882050037, -0.004396737087517977, -0.02089771069586277, -0.023010961711406708, -0.030618667602539062, -0.03324849158525467, -0.03909515589475632, -0.03949432447552681, 0.022177401930093765, -0.009715086780488491, -0.019876305013895035, 0.026673931628465652, 0.004883959423750639, 0.01140568871051073, -0.001670055789873004, 0.020310696214437485, 0.00027516295085661113, -0.023997144773602486, 0.018326587975025177, -0.03099435567855835, -0.07048868387937546, -0.0372871495783329, -0.04275812208652496, 0.0016950038261711597, 0.00018967900541611016, 0.0011314700823277235, -0.04578711837530136, 0.03940040245652199, 0.03775675967335701, 0.042030226439237595, -0.0068152365274727345, 0.007320068776607513, 0.01019056886434555, -0.025593824684619904, 0.05128157138824463, 0.045928001403808594, -0.001270152279175818, 0.029937731102108955, -0.020533761009573936, -0.014628397300839424, -0.015121488831937313, -0.0190779659897089, 0.02996121160686016, -0.03954128548502922, 0.01634247973561287, -0.006128429435193539, -0.02986728958785534, -0.037568915635347366, 0.036958422511816025, -0.020439838990569115, 0.0019386147614568472, 0.03390594571828842, -0.040856197476387024, -0.026650451123714447, -0.0754195973277092, 0.0071967956610023975, 0.036347925662994385, 0.034915611147880554, 0.00990880187600851, 0.017316922545433044, -0.013900498859584332, -0.009462671354413033, -0.0025784603785723448, 0.044284362345933914, 0.021003372967243195, -0.05137549340724945, -0.0009084046469070017, 0.028153207153081894, -0.002282018307596445, -0.0025432396214455366, 0.0216725692152977, 0.011517221108078957, 0.012327300384640694, -0.057292599231004715, -0.021707789972424507, -0.03052474558353424, 0.0019415499409660697, -0.04153713211417198, -0.014910164289176464, 0.04388519003987312, 0.004851673264056444, -0.0355495885014534, 0.03367114067077637, 0.03291976451873779, -0.01795089803636074, -0.009926412254571915, 0.019653240218758583, 0.022271323949098587, -0.005476843565702438, -0.025265095755457878, -0.039517804980278015, -0.02051028050482273, -0.02150820568203926, -0.038860347121953964, 0.016154633834958076, 0.02059246227145195, -0.006357365287840366, 0.04318077489733696, -0.010478205978870392, 0.037733279168605804, -0.0032197735272347927, 0.04977881535887718, -0.000839430489577353, 0.0021719529759138823, 0.06560472398996353, -0.048229098320007324, 0.002512421226128936, -0.022693973034620285, 0.014264448545873165, 0.03550262749195099, 0.009133943356573582, 0.017223000526428223, -0.007513783406466246, -0.005526740103960037, 0.030031653121113777, 0.044589608907699585, -0.020745085552334785, -0.008987189270555973, 0.011963351629674435, -0.010595608502626419, 0.04921527951955795, 0.022435687482357025, -0.014029642567038536, 0.04407303407788277, 0.010889115743339062, -0.007789680268615484, 0.00864672102034092, 0.03026645816862583, 0.015720244497060776, 0.017234740778803825, -0.002892513060942292, -0.03291976451873779, 0.05428708344697952, -0.042499836534261703, -0.014510993845760822, 0.018021339550614357, 0.02796536311507225, -0.003959411755204201, 0.015638060867786407, 0.004473049193620682, 0.00710874330252409, 0.0407622754573822, -0.0035103457048535347, 0.018831418827176094, -0.02632172219455242, -0.03841421753168106, 0.0006336086080409586, 0.02011111006140709, -0.016506843268871307, 0.0580909363925457, 0.007666407153010368, 0.025030290707945824, -0.01790393702685833, 0.022048257291316986, 0.055601995438337326, -0.00897544901818037, 0.0028851754032075405, -0.05428708344697952, 0.01400616206228733, -0.05799701437354088, 0.039987415075302124, 0.021015113219618797, 0.004094425123184919, -0.0034076182637363672, -0.01708211749792099, 0.004710789769887924, 0.010484076105058193, 0.03592527657747269, -0.044378284364938736, -0.03658273443579674, -0.010055555030703545, -0.012996497564017773, 0.014663618057966232, -0.00014134203956928104, 0.0020457450300455093, 0.02930375561118126, 0.033624179661273956, 0.04219458997249603, -0.048276059329509735, -0.04456612840294838, -0.015015826560556889, -0.013994421809911728, -0.021789971739053726, 0.02063942328095436, 0.0075431340374052525, 0.011194363236427307, -0.0203693974763155, 0.000652686576358974, -0.005036582704633474, 0.007648796774446964, -0.0007337679271586239, 0.053347863256931305, -0.015238892287015915, 0.0060286372900009155, 0.019101446494460106, 0.004666763823479414, -0.022189142182469368, -0.005465103313326836, -0.04156061261892319, 0.018526172265410423, -0.011417428962886333, -0.008905007503926754, -0.03975261002779007, -0.02323402650654316, -0.008100797422230244, -0.022705713286995888, 0.022435687482357025, 0.03644184768199921, 0.0832151472568512, 0.015943309292197227, 0.0281766876578331, 0.0023363169748336077, -0.04219458997249603, -0.008940228261053562, -0.015508918091654778, 0.02965596318244934, 0.0208037868142128, 0.028716741129755974, -0.007748588919639587, 0.015849387273192406, 0.0195123553276062, 0.006850457284599543, -0.018537912517786026, 0.05189206823706627, -0.03303716704249382, 0.014757540076971054, -0.0020501476246863604, -0.0158259067684412, 0.030360380187630653, -0.028200168162584305, 0.028599338605999947, 0.0611434131860733, -0.011047609150409698, 0.007948174141347408, 0.005036582704633474, 0.03287280350923538, 0.04977881535887718, -0.001568795763887465, 0.0005921507254242897, -0.019794123247265816, -0.030900433659553528, 0.04557579383254051, 0.006245832424610853, -0.03451644256711006, 0.050013620406389236, -0.040245700627565384, 0.003001110628247261, 0.0420537069439888, 0.04287552461028099, 0.011476130224764347, 0.009198514744639397, -0.019864564761519432, 0.0025505772791802883, -0.03644184768199921, 0.018044820055365562, -0.010589738376438618, 0.007460952270776033, 0.02072160504758358, -0.023163584992289543, -0.038695983588695526, -0.011229583993554115, -0.012855613604187965, -0.04144321009516716, 0.02838801220059395, 0.02353927493095398, -0.0758892148733139, 0.03345981612801552, -0.02389148250222206, -0.006932639051228762, -0.005955260246992111, 0.051563337445259094, 0.000940690457355231, 0.04574015736579895, 0.010489946231245995, -0.0042617241851985455, -0.022435687482357025, -0.0032285787165164948, -0.07358811795711517, -0.016189854592084885, -0.048745669424533844, 0.03606615960597992, 0.04026918113231659, -0.011881169863045216, -0.00776032917201519, -0.024419795721769333, -0.021789971739053726, -0.018068300560116768, -0.03341285511851311, 0.0307830311357975, 0.007267237175256014, -0.04149017110466957, -0.007138094399124384, -0.057809170335531235, 0.010090776719152927, 0.056212492287158966, -0.012738211080431938, 0.002299628686159849, 0.013794836588203907, 0.024936368688941002, 0.03681753948330879, 0.019359732046723366, 0.02730790711939335, -0.02418499067425728, 0.04017525911331177, 0.04698462784290314, 0.007754459045827389, -0.013595251366496086, 0.024912888184189796, 0.026509566232562065, -0.05348874628543854, -0.02085074968636036, -0.0001256577525055036, -0.010008594021201134, -0.00665674265474081, 0.00020141928689554334, 0.03259103372693062, -0.0008445668499916792, 0.0433451384305954, -0.032520592212677, 0.0007146899588406086, 0.013877018354833126, 0.012016183696687222, 0.06133125722408295, 0.020627683028578758, 0.0033430466428399086, -0.05198599025607109, -0.05569591745734215, 0.04841694235801697, -0.02254134975373745, 0.023738859221339226, 0.01198683213442564, -0.011264804750680923, 0.017187779769301414, -0.019735421985387802, -0.01816222257912159, -0.035267822444438934, 0.027894921600818634, -0.017892196774482727, -0.04968489333987236, -0.04968489333987236, -0.01773957349359989, 0.0006398456171154976, -0.0118107283487916, -0.0424763560295105, -0.011435039341449738, 0.0027193438727408648, 0.07246104627847672, 0.013466108590364456, -0.016377700492739677, -0.003648294135928154, -0.0033988128416240215, -0.008094927296042442, -0.009333527646958828, -0.0007976057240739465, 0.004957336001098156, 0.048792630434036255, -0.022048257291316986, -0.011652234010398388, -0.025218134745955467, -0.0030172537080943584, 0.0073376791551709175, -0.017680872231721878, 0.011082830838859081, -0.008071446791291237, 0.015461957082152367, -0.016095932573080063, 0.011411558836698532, -0.021050333976745605, 0.025382500141859055, -0.005306609440594912, -0.006008091848343611, 0.0580909363925457, -0.028599338605999947, 0.004238243214786053, -0.004320425447076559, -0.012186417356133461, -0.013477848842740059, 0.02249438874423504, -0.010789323598146439, 0.0197236817330122, -0.000892261799890548, -0.02514769323170185, 0.025476422160863876, 0.012069014832377434, 0.04836998134851456, -0.0071204835548996925, 0.016283776611089706, 0.02592255175113678, 0.010349062271416187, -0.0013068406842648983, -0.04365038499236107, -0.027331387624144554, -0.020017188042402267, 0.0033547868952155113, -0.03463384509086609, -0.021343840286135674, 0.020216774195432663, 0.029115909710526466, 0.0268852561712265, -0.022705713286995888, 0.011687454767525196, -0.005658817943185568, -0.037780240178108215, 0.07034779340028763, 0.01498060580343008, -0.017176039516925812, -0.03970564901828766, 0.04245287552475929, -0.014898424036800861, -0.00414138613268733, -0.010108387097716331, -0.038179412484169006, 0.006650872528553009, -0.014663618057966232, 0.01157592236995697, -0.034187715500593185, -0.010366672649979591, -0.013477848842740059, -0.031158721074461937, -0.06875111907720566, 0.019019264727830887, 0.005978740751743317, -0.03540870547294617, 0.045153141021728516, 0.0008621772867627442, 0.010848024860024452, -0.012256858870387077, 0.010583868250250816, 0.011176752857863903, -0.0008739175973460078, 0.04404955357313156, -0.011558311991393566, -0.015368035063147545, 0.011053480207920074, -0.015250632539391518, 0.014487513341009617, -0.04062139242887497, 0.007138094399124384, -0.014123564586043358, 0.0016363024478778243, -0.01144677959382534, 0.00884630624204874, -0.0018916536355391145, -0.0076194461435079575, 0.026086917147040367, 0.0030788900330662727, 0.0066743530333042145, 0.016917752102017403, 0.011628753505647182, -0.025265095755457878, -0.020709864795207977, -0.039306480437517166, -0.011546571739017963, 0.040691833943128586, -0.027777517214417458, 0.03935344144701958, 0.02254134975373745, -0.03416423499584198, -0.008893267251551151, 0.03580787405371666, 0.0052244276739656925, 0.004223567899316549, 0.004164866637438536, -0.01677686907351017, -0.02400888502597809, 0.03576091304421425, -0.017927417531609535, -0.002383278217166662, -0.025899071246385574, 0.00562359718605876, 0.029280275106430054, -0.0033019555266946554, -0.011828338727355003, -0.029233314096927643, 0.010331451892852783, -0.015285853296518326, 0.002657707314938307, 0.018397029489278793, 0.01209249533712864, -0.0007741251611150801, -0.018138742074370384, -0.023609716445207596, 0.04503573849797249, 0.015626320615410805, -0.005726324860006571, 0.027754036709666252, 0.004584582056850195, -0.03313108906149864, -0.030970875173807144, -0.046444572508335114, 0.018103521317243576, -0.004763621371239424, -0.007243756670504808, -0.019758902490139008, -0.03759239614009857, -0.04296945035457611, -0.01296127587556839, -0.018972303718328476, -0.0019356796983629465, 0.008687811903655529, -0.015567620284855366, 0.008077316917479038, -0.0031874878332018852, 0.03172225505113602, -0.015626320615410805, 0.04050398990511894, 0.05588376522064209, 0.03740455210208893, -0.036747097969055176, 0.01577894575893879, 0.027260946109890938, 0.00244491477496922, -0.039517804980278015, -0.007819030433893204, -0.006398456171154976, -0.02996121160686016, 0.001564393169246614, 0.03979957103729248, -0.004616867750883102, 0.010378412902355194, -0.015426736325025558, 0.05344178527593613, 0.02939767763018608, -0.03099435567855835, -0.011646363884210587, 0.006198871415108442, -0.0016377699794247746, 0.008905007503926754, -0.010577998124063015, -0.009362878277897835, -0.014593176543712616, -0.008312122896313667, -0.01400616206228733, 0.04327469691634178, 0.003853749018162489, 0.03052474558353424, 0.027425309643149376, -0.046021923422813416, -0.0026738501619547606, -0.0061577800661325455, -0.03174573555588722, -0.003774502081796527, -0.00851757824420929, -0.0023128364700824022, -0.02904546819627285, 0.037780240178108215, 0.004520010203123093, -0.028716741129755974, -0.0048575433902442455, 0.012280339375138283, -0.03914211690425873, 0.013430887833237648, -0.038437698036432266, -0.019089706242084503, -0.003657099325209856, -0.016401180997490883, 0.01998196728527546, -0.014029642567038536, 0.005098219495266676, 0.011006518267095089, 0.0030524744652211666, -0.04841694235801697, -0.003974087070673704, -0.01400616206228733, 0.019406693056225777, 0.017246481031179428, 0.0004798842128366232, 0.01880793832242489, -0.004801777191460133, 0.011047609150409698, 0.014276188798248768, -0.009245475754141808, -0.0528782494366169, -0.009374618530273438, -0.03611312061548233, -0.0005965533200651407, -0.018631834536790848, 0.04672633856534958, -0.050530191510915756, -0.011476130224764347, -0.017493026331067085, -0.013818317092955112, -0.011470260098576546, -0.045928001403808594, -0.010073165409266949, 0.04456612840294838, -0.034657325595617294, 0.002218914218246937, -0.04411999508738518, 0.006721314042806625, -0.03524434193968773, -0.0017038091318681836, 0.04604540392756462, -0.008541058748960495, 0.027425309643149376, -0.00288370787166059, -0.03559654951095581, 0.01941843330860138, -0.05710475519299507, 0.01993500627577305, -0.042640719562768936, 0.021496465429663658, -0.0070383017882704735, -0.01795089803636074, -0.004285204689949751, 0.01656554453074932, 0.0011329376138746738, 0.010302101261913776, -0.047360315918922424, 0.0074198609218001366, 0.013912239111959934, 0.0368645004928112, 0.021402541548013687, -0.0034222935792058706, 0.05475669726729393, -0.010748232714831829, 0.026509566232562065, -0.02986728958785534, -0.0004934589378535748, 0.012233378365635872, 0.03712278604507446, 0.014534474350512028, -0.0001028192273224704, -0.003962346818298101, -0.01634247973561287, -0.02150820568203926, 0.001239334000274539, 0.0010602945694699883, -0.04275812208652496, -0.024607639759778976, 0.01638944074511528, 0.003542631398886442, -0.010507556609809399, -0.014194006100296974, 0.018443990498781204, -0.08114886283874512, 0.014393591322004795, 0.026979178190231323, -0.01846747100353241, 0.010695400647819042, -0.020862489938735962, 0.002057485282421112, 0.012409483082592487, 0.014334890060126781, -0.028458453714847565, 0.004470114130526781, -0.021472984924912453, -0.050436269491910934, -0.03446948155760765, 0.03456340357661247, -0.0203693974763155, 0.008394304662942886, 0.005535545293241739, 0.0195006150752306, -0.04102056100964546, -0.013090419583022594, -0.030712589621543884, -0.029468119144439697, 0.009556593373417854, -0.0015673282323405147, 0.0066743530333042145, 0.012233378365635872, -0.005491518881171942, 0.006950249429792166, 0.011147402226924896, 0.008640850894153118, -0.003366527147591114, 0.0024199665058404207, 0.01194574125111103, -0.02899850718677044, 0.0019532900769263506, 0.0184322502464056, 0.03458688408136368, 0.02085074968636036, 0.0066919634118676186, -0.0184322502464056, -0.009703346528112888, 0.009844230487942696, 0.005462168250232935, 0.036958422511816025, 0.008341473527252674, -0.007325938902795315, 0.0028543572407215834, -0.05283128842711449, -0.018314847722649574, -0.031205682083964348, -0.0236331969499588, -0.009398099035024643, -0.010407763533294201, 0.044636569917201996, 0.04764208197593689, -0.03519737720489502, -0.01993500627577305, -0.0015100943855941296, -0.02432587370276451, -0.012022053822875023, 0.032497111707925797, 0.007325938902795315, 0.004126710817217827, 0.019829344004392624, -0.01298475731164217, 0.0007429399993270636, 0.013830057345330715, 0.014851462095975876, -0.013712654821574688, 0.03618356212973595, 0.005573701113462448, 0.006521729286760092, -0.0022776154801249504, -0.0015981465112417936, -0.004050398711115122, -0.004443698562681675, -0.0027721752412617207, 0.03677057847380638, -0.02387974224984646, -0.0034164234530180693, 0.0007829303503967822, 0.04907439649105072, -0.011346986517310143, 0.00086584611563012, -0.01296127587556839, -0.015368035063147545, 0.008400174789130688, 0.008623240515589714, -0.02700265869498253, -0.0018667055992409587, -0.0017302246997132897, 0.011546571739017963, -0.027237465605139732, -0.007431601174175739, 0.00024709635181352496, 0.03538522496819496, -0.026039956137537956, 0.04548187181353569, -0.002927734050899744, 0.03068910911679268, -0.014604916796088219, 0.018361808732151985, 0.0026048761792480946, -0.015144969336688519, 0.04444872587919235, 0.0013728797202929854, -0.029585521668195724, -0.025546863675117493, -0.0027105386834591627, 0.018279626965522766, 0.0008137486292980611, -0.02249438874423504, 0.003287280211225152, -0.03841421753168106, -0.016917752102017403, 0.02331620827317238, 0.011681584641337395, 0.0022042389027774334, 0.016236815601587296, -0.04132580757141113, 0.03263799473643303, -0.008998929522931576, 0.02323402650654316, -0.03172225505113602, 0.003225643653422594, 0.008981319144368172, -0.016976455226540565, -0.021519945934414864, 0.006228222046047449, 0.01124719437211752, 0.03461036458611488, -0.05189206823706627, 0.04764208197593689, 0.0024933433160185814, 0.003727541072294116, 0.04496529698371887, -0.005641207564622164, -0.010120127350091934, -0.020181553438305855, 0.012315560132265091, -0.040691833943128586, 0.008987189270555973, -0.0007473425939679146, 0.0002032537158811465, -0.0012327301083132625, 0.02387974224984646, -0.045153141021728516, -0.0351034551858902, 0.01298475731164217, -0.005696974229067564, 0.025805149227380753, -0.0034076182637363672, 0.010994778014719486, -0.058372706174850464, 0.04482441395521164, -0.01603723131120205, -0.018056560307741165, -0.0236214566975832, -0.024560678750276566, -0.01144677959382534, 0.04226503148674965, 0.009738567285239697, -0.013583511114120483, 0.018537912517786026, -0.015379775315523148, -0.009803139604628086, 0.004161931574344635, 0.011141532100737095, -0.054427966475486755, -0.0333893746137619, 0.01510974857956171, 0.011071090586483479, 0.017622170969843864, 0.06795278191566467, 0.04041006788611412, 0.037263669073581696, 0.0014961527194827795, -0.030923914164304733, 0.021226437762379646, -0.006821106653660536, 0.04139624908566475, 0.01811526156961918, 0.015602841041982174, 0.057903092354536057, 0.0007311997469514608, -0.009961633011698723, 0.03841421753168106, 0.006539339665323496, 0.02601647563278675, 0.024725044146180153, 0.03529130294919014, -0.0037891773972660303, 0.04717247188091278, 0.008658461272716522, 0.013266523368656635, 0.023961924016475677, 0.012245118618011475, -0.002215979155153036, 0.0022849533706903458, 0.02220088243484497, 0.024138029664754868, -0.0038919050712138414, -0.03801504895091057, 0.00501603726297617, 0.03564351052045822, -0.010848024860024452, 0.007566614542156458, -0.057245638221502304, 0.005741000175476074, 0.019711941480636597, 0.018009599298238754, 0.0046080625616014, 0.018220923840999603, -0.03345981612801552, -0.011264804750680923, -0.029233314096927643, -0.008869786746799946, -0.024466756731271744, -0.012315560132265091, -0.03702886402606964, -0.006239962298423052, -0.004819387570023537, 0.020475059747695923, -0.013665693812072277, 0.007807290647178888, -0.03620704263448715, 0.0416075736284256, 0.007877732627093792, -0.0005378518835641444, -0.008793474175035954, 0.02643912471830845, -0.006633261684328318, -0.015884608030319214, 0.027167022228240967, -0.03827333450317383, 0.037686318159103394, -0.03590179607272148, 0.018878379836678505, 0.010548647493124008, -0.018408769741654396, -0.0073376791551709175, -0.03043082356452942, -0.00016087861149571836, 0.03655925393104553, 0.015814166516065598, -0.013970941305160522, 0.043767787516117096, 0.02263527177274227, 0.027941882610321045, -0.008599760010838509, -0.007220276165753603, 0.004320425447076559, 0.007114613428711891, -0.005732194986194372, -0.035526107996702194, -0.003862554207444191, 0.0063749756664037704, -0.03341285511851311, 0.019265810027718544, -0.009310047142207623, 0.04188934341073036, 0.004003437701612711, 0.004437828436493874, -0.003897775197401643, 0.016483362764120102, -0.012632547877728939, 0.026979178190231323, 0.010489946231245995, 0.014440552331507206, -0.030407341197133064, 0.0028426169883459806, 0.01751650683581829, 0.03733411058783531, 0.01079519372433424, 0.00446424400433898, -0.010624959133565426, 0.00572338979691267, -0.011851819232106209, -0.028669780120253563, -0.010748232714831829, 0.014346630312502384, -0.0184322502464056, 0.030196016654372215, 0.02704961970448494, -0.030853472650051117, 0.0061695207841694355, -0.03789764642715454, -0.039987415075302124, 0.02319880574941635, 0.025030290707945824, 0.0008951968629844487, 0.0029101234395056963, -0.007190925534814596, -0.014957125298678875, 0.0034134883899241686, 0.014452292583882809, -0.010548647493124008, 0.006480637937784195, 0.0030730199068784714, 0.0118165984749794, -0.00739051029086113, -0.003692320082336664, 0.015309333801269531, 0.021038593724370003, -0.0071967956610023975, -0.03855510056018829, -0.06274008750915527, 0.010008594021201134, 0.011053480207920074, -0.0013420615578070283, 0.00474601099267602, 0.00938635878264904, -0.003216838464140892, -0.004534685518592596, 0.03324849158525467, -0.02128513902425766, 0.012996497564017773, -0.05771524831652641, 0.016788609325885773, -0.0175517275929451, -0.012714730575680733, 0.004675569012761116, -0.018314847722649574, -0.011605273000895977, 0.0014345162780955434, -0.0017331597628071904, 0.0027971232775598764, 0.008740643039345741, 0.004408477805554867, 0.029726404696702957, 0.023950183764100075, 0.023868001997470856, -0.012926055118441582, -0.029843809083104134, 0.014863202348351479, -0.04916831851005554, -0.004173671826720238, -0.020909450948238373, -0.004452503751963377, -0.0012099832529202104, 0.0010426841909065843, -0.028951546177268028, 0.02292877994477749, 0.03148745000362396, -0.0015746658900752664, -0.029726404696702957, 0.005837857257574797, -0.006603911053389311, 0.018279626965522766, 0.07297761738300323, 0.002174888039007783, 0.003712865523993969, 0.02223610319197178, 0.010049684904515743, -0.03705234453082085, 0.008640850894153118, -0.0021426023449748755, 0.01669468730688095, -0.052220795303583145, -0.0035044755786657333, 0.003340111579746008, -0.021696049720048904, 0.016847310587763786, 0.007989265024662018, -0.02648608572781086, 0.021484725177288055, 0.009310047142207623, -0.006709573790431023, 0.01201031357049942, 0.04959097132086754, 0.046186286956071854, 0.030642148107290268, 0.002588733099400997, 0.029538560658693314, -0.0059435199946165085, -0.023527534678578377, -0.0015056917909532785, 0.01869053579866886, 0.060063306242227554, 0.005479778628796339, -0.0502953864634037, -0.021355580538511276, -0.03653577342629433, -0.045763637870550156, 0.018526172265410423, 0.025593824684619904, -0.01577894575893879, 0.014240967109799385, 0.03216838464140892, 0.021085554733872414, 0.01023165974766016, -0.021872153505682945, 0.012526885606348515, -0.0010962492087855935, -0.0018138742307201028, 0.031158721074461937, -0.00562653224915266, 0.010613218881189823, 0.006498248782008886, 0.013278263621032238, 0.005987545941025019, 0.041161444038152695, -0.015403255820274353, -0.008723032660782337, -0.025006810203194618, 0.010290361009538174, 0.03761587664484978, 0.005881883669644594, 0.02930375561118126, -0.04362690448760986, -0.01603723131120205, 0.013877018354833126, 0.03949432447552681, 0.007783810142427683, -0.022705713286995888, -0.0031405265908688307, -0.007014821283519268, -0.04888655245304108, 0.035526107996702194, -0.0015262372326105833, 0.002873435150831938, 0.00665674265474081, 0.01759868860244751, 0.026767853647470474, 0.03202750161290169, -0.0351034551858902, -0.01129415538161993, 0.015309333801269531, 0.046585455536842346, 0.0017126143211498857, 0.02878718264400959, -0.027589673176407814, 0.033882465213537216, -0.03226230666041374, 0.022952260449528694, 0.053864434361457825, 0.006621521431952715, 0.005817311815917492, -0.0032549945171922445, 0.03569047152996063, 0.035173896700143814, 0.035526107996702194, -0.0030436692759394646, 0.01298475731164217, 0.012526885606348515, -0.013266523368656635, 0.013642213307321072, -0.04332165792584419, -3.3317650377284735e-05, 0.0009164761286228895, -0.008288642391562462, 0.0053623756393790245, 0.0065980409272015095, 0.014593176543712616, 0.0031522668432444334, 0.002653304720297456, -0.0029292015824466944, -0.03233274817466736, -0.004188347142189741, -0.040292661637067795, -0.012761691585183144, -0.011200233362615108, -0.01829136721789837, -0.016025491058826447, -0.0351034551858902, -0.02704961970448494, -0.02328098751604557, -0.022881818935275078, -0.0036394887138158083, 0.02449023723602295, -0.023292727768421173, 0.0062340921722352505, 0.009368748404085636, -0.022740935906767845, 0.016542064025998116, 0.017669131979346275, -0.0377097986638546, -0.016624245792627335, -0.021883893758058548, 0.005027777515351772, 0.019019264727830887, -0.004249983932822943, -0.018913602456450462, -0.00562653224915266, 0.02986728958785534, -0.005192141514271498, 0.012491664849221706, 0.002505083568394184, -0.03761587664484978, -0.01400616206228733, 0.03021949715912342, -1.453204390600149e-06, 0.0053741163574159145, 0.005773285869508982, -0.004584582056850195, 0.005605986807495356, 0.013231302611529827, 0.015849387273192406, 0.0342581570148468, 0.008869786746799946, -0.004795907065272331, 0.000371286558220163, 0.005497389007359743, 0.004094425123184919, -0.060110267251729965, 0.008335603401064873, -0.017281701788306236, 0.00572338979691267, -0.012503405101597309, -0.004845803137868643, -0.00804209616035223, -0.014886682853102684, -0.019218849018216133, -0.006609781179577112, 0.02215392142534256, 0.0017830560682341456, -4.9391750508220866e-05, 0.02838801220059395, 0.007361159659922123, 0.02514769323170185, 0.00786599237471819, 0.028082765638828278, -0.002154342597350478, 0.033577218651771545, -0.00949789211153984, 0.008300382643938065, -0.020040668547153473, -0.01994674652814865, -0.022189142182469368, -0.021602127701044083, -0.02224784344434738, -0.004578711930662394, 0.013982681557536125, 0.021296879276633263, 0.020862489938735962, 0.022447427734732628, -0.015602841041982174, -0.02653304673731327, -0.004963206127285957, 0.014100084081292152, -0.014851462095975876, -0.015297593548893929, -0.006592170801013708, 0.007895343005657196, 0.05081196129322052, 0.017575208097696304, -0.026392163708806038, -0.009726827032864094, 0.02986728958785534, -0.004414347931742668, -0.027472270652651787, -0.030923914164304733, 0.013278263621032238, -0.0023040312808007, 0.02432587370276451, -0.02137906104326248, 0.012820392847061157, 0.03954128548502922, 0.011229583993554115, -0.005931779742240906, 0.009556593373417854, 0.01608419232070446, -0.01867879554629326, 0.058466628193855286, 0.022787896916270256, -0.02744879014790058, 0.024114549160003662, 0.02566426619887352, 0.010020334273576736, 0.012198157608509064, -0.009028280153870583, 0.04557579383254051, -0.013712654821574688, -0.006627391558140516, 0.0063280146569013596, 0.015156709589064121, 0.02349231392145157, 0.0011322038481011987, -0.006104948930442333, 0.01912492699921131, -0.039165597409009933, -0.01613115333020687, 0.00039183205808512866, 0.018502691760659218, -0.0011043207487091422, 0.0071322242729365826, -0.005831987131386995, 0.011429169215261936, -0.016612505540251732, -0.0184322502464056, 0.026133878156542778, -0.008752383291721344, 0.006509989034384489, -0.010666050016880035, -0.01742258481681347, 0.050999805331230164, -0.014158785343170166, -0.012597327120602131, 0.020052408799529076, 0.008593889884650707, -0.0065980409272015095, -0.0011945741716772318, -0.03979957103729248, -0.013841797597706318, 0.014205746352672577, 0.02181345224380493, -0.02249438874423504, 0.022048257291316986, 0.03667665645480156, 0.005444557871669531, -0.01621333509683609, -0.034399040043354034, -0.010894985869526863, 0.026415644213557243, -0.023832781240344048, -0.009838360361754894, 0.009850100614130497, -0.024631120264530182, -0.002974695060402155, 0.000979580101557076, 0.004247048869729042, 0.006844587158411741, 0.006721314042806625, -0.010783453471958637, 6.126961670815945e-05, -0.00450826995074749, 0.006193001288920641, 0.024349354207515717, -0.018843159079551697, -0.006204741541296244, -0.020310696214437485, -0.023046182468533516, 0.015767205506563187, -0.011734416708350182, 0.0014550617197528481, 0.02648608572781086, 0.02332794852554798, -0.0028411492239683867, 0.0006831379141658545, 0.026392163708806038, 0.016107672825455666, 0.003536761272698641, -0.0063925860449671745, 0.022423947229981422, -0.005749805364757776, 0.0229757409542799, -0.03456340357661247, -0.017751313745975494, -0.017410844564437866, -0.022306544706225395, -0.023774079978466034, 0.03881338611245155, -0.011499610729515553, 0.020932931452989578, 0.005051258485764265, 0.031158721074461937, 0.010202309116721153, -0.012080755084753036, -0.0010338790016248822, -0.024983329698443413, -0.0005022641271352768, -0.003862554207444191, -0.02848193421959877, 0.02704961970448494, -0.005171596072614193, -0.030665628612041473, -0.010014464147388935, 0.014910164289176464, 0.024725044146180153, 0.014910164289176464, -0.00651585916057229, -0.019406693056225777, 0.008799344301223755, 0.015591100789606571, -0.00038779634633101523, -0.03709930554032326, 0.005109959747642279, 0.01298475731164217, -0.02474852465093136, 0.0005965533200651407, 0.018091781064867973, 0.04665589705109596, 0.02458415925502777, 0.00037899112794548273, -0.02276441641151905, -0.005306609440594912, -0.0045581660233438015, 0.03848465904593468, 0.011505480855703354, -0.01534455455839634, 0.0018740432569757104, 0.03712278604507446, 0.03021949715912342, 0.011288285255432129, 0.03472776710987091, -0.023046182468533516, -0.024091068655252457, -0.014874942600727081, 0.006146039813756943, 0.005650012753903866, 0.016847310587763786, 0.01176963746547699, 0.005388791672885418, 0.004387931898236275, 0.010214049369096756, 0.007695757783949375, 0.01798611879348755, 0.008699552156031132, 0.029773365706205368, -0.041983265429735184, 0.012292079627513885, 0.024983329698443413, -0.02700265869498253, -0.023175325244665146, 0.014534474350512028, 0.021966075524687767, -0.003542631398886442, 0.01699993573129177, 0.009979243390262127, 0.0164716225117445, -0.0079129533842206, -0.0009487618808634579, 0.00958007387816906, -0.014464032836258411, -0.0355495885014534, -0.0011057882802560925, -0.017046896740794182, -0.03043082356452942, 0.017410844564437866, 0.02159038744866848, -0.033060647547245026, -0.012162936851382256, -0.015591100789606571, 0.012303819879889488, -0.0021983685437589884, -0.009914672002196312, 0.013970941305160522, -0.03125264123082161]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:14:06.340177", "url_path": "/graph/", "chunk_size": 4819}
updated_dt: 2025-03-14T10:14:06.340177
---
```
importasyncio
fromdataclassesimport dataclass, field
fromtypingimport Literal
fromtyping_extensionsimport TypedDict
frompydanticimport TypeAdapter
frompydantic_graphimport (
  BaseNode,
  End,
  Graph,
  GraphRunContext,
  HistoryStep,
  GraphRunResult,
)

@dataclass
classOrderState:
"""Order workflow state."""
  order_id: str
  amount: float
  human_approved: bool = False # set to True after human review

classStoredRun(TypedDict):
"""An object representing a mock-serialized run state."""
  state: OrderState
  history: bytes
  node: bytes

# We'll use a global dictionary to simulate persist/load:
STORED_RUNS: dict[str, StoredRun] = {}

@dataclass
classCheckOrder(BaseNode[OrderState]):
"""Check if this order needs human review."""
  kind: Literal['check-order'] = field(default='check-order', init=False)
  async defrun(
    self, ctx: GraphRunContext[OrderState]
  ) -> 'HumanReview | ProcessOrder':
    if ctx.state.amount < 1000:
      return ProcessOrder() # no human review required
    else:
      return HumanReview() # human review required

@dataclass
classHumanReview(BaseNode[OrderState]):
"""Pause graph execution until a human sets `approved=True` in the order state."""
  kind: Literal['human-review'] = field(default='human-review', init=False)
  async defrun(
    self, ctx: GraphRunContext[OrderState]
  ) -> 'ProcessOrder | HumanReview':
    if not ctx.state.human_approved:
      # Still not approved: we'll stay on this node, effectively keeping the workflow paused
      return self
    return ProcessOrder()

@dataclass
classProcessOrder(BaseNode[OrderState, None, str]):
"""Final node: process the order."""
  kind: Literal['process-order'] = field(default='process-order', init=False)
  async defrun(self, ctx: GraphRunContext[OrderState]) -> End[str]:
    # In a real system, you'd charge payment, update inventory, etc.
    return End(f'Order {ctx.state.order_id} processed successfully!')

# Build the graph
order_graph = Graph[OrderState, None, str](
  nodes=[CheckOrder, HumanReview, ProcessOrder]
)
GraphNodeType = CheckOrder | HumanReview | ProcessOrder
node_adapter = TypeAdapter[GraphNodeType](GraphNodeType)

defpersist_run_state(
  run_id: str,
  state: OrderState,
  history: list[HistoryStep[OrderState, str]],
  node: GraphNodeType,
) -> None:
"""Simulate storing run state in a global dictionary."""
  STORED_RUNS[run_id] = StoredRun(
    state=state,
    history=order_graph.dump_history(history),
    node=node_adapter.dump_json(node),
  )

defapprove_order(run_id: str) -> None:
"""Simulate a human approving an order."""
  stored_run = STORED_RUNS[run_id]
  stored_run['state'].human_approved = True

defload_run_state(
  run_id: str,
) -> tuple[OrderState, list[HistoryStep[OrderState, str]], GraphNodeType]:
"""Simulate loading run state from a global dictionary."""
  stored_run = STORED_RUNS[run_id]
  state = stored_run['state']
  history = order_graph.load_history(stored_run['history'])
  node = node_adapter.validate_json(stored_run['node'])
  return state, history, node

async defrun_until_interrupted(
  run_id: str,
  state: OrderState,
  history: list[HistoryStep[OrderState, str]],
  start_node: GraphNodeType,
) -> GraphRunResult[OrderState, str] | tuple[HumanReview, OrderState]:
"""Continue the workflow from any point."""
  async with order_graph.iter(start_node, state=state, history=history) as graph_run:
    await graph_run.next() # The first node will be yielded before it has been run, so we ensure it runs first
    async for node in graph_run:
      if isinstance(node, HumanReview):
        persist_run_state(run_id, state, history, node)
        return node, state # Run is interrupted
  assert graph_run.result is not None # the graph run is complete at this point
  return graph_run.result

async defbegin_run(
  run_id: str, amount: int
) -> GraphRunResult[OrderState, str] | tuple[HumanReview, OrderState]:
"""Start the workflow. Possibly pause if human review is needed."""
  state = OrderState(order_id=run_id, amount=amount)
  history: list[HistoryStep[OrderState, str]] = []
  node = CheckOrder()
  return await run_until_interrupted(run_id, state, history, node)

async defresume_run(
  run_id: str,
) -> GraphRunResult[OrderState, str] | tuple[HumanReview, OrderState]:
"""Resume the workflow after human review."""
  state, history, node = load_run_state(run_id)
  return await run_until_interrupted(run_id, state, history, node)

async defmain():
  results = []
  # Begin a run that will not require human review:
  results.append(await begin_run('order-1', 100))
  # Begin a run that _will_ require human review:
  results.append(await begin_run('order-2', 1500))
  # ... human review happens ...
  approve_order('order-2')
  # Resume run after human review:
  results.append(await resume_run('order-2'))
  return results