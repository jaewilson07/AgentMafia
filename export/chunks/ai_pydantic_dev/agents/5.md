---
url: https://ai.pydantic.dev/agents/
session_id: pydantic_ai_docs
chunk_number: 5
title: Weather Service Agent Implementation
summary: This chunk details the implementation of a WeatherService class using Pydantic's Agent. It includes asynchronous methods to get forecasts and historical weather data, simulating external API calls. The agent is configured to use the OpenAI GPT-4 model for obtaining weather information.
embedding: [-0.007666470482945442, 0.004087723791599274, 0.025207100436091423, -0.057056352496147156, -0.010752145200967789, -0.0028057373128831387, 0.015752846375107765, -0.005617836955934763, 0.019544728100299835, 0.012266352772712708, 0.003578746458515525, 0.01529476698487997, -0.0358320027589798, -0.07084963470697403, -0.04524808004498482, 0.014734892174601555, -0.005274277180433273, 0.031632937490940094, -0.045324426144361496, 0.03382154181599617, 0.037104442715644836, -0.02071537636220455, 0.015307491645216942, -0.022560417652130127, -0.015422011725604534, 0.033668845891952515, -0.04201607406139374, 0.07644838839769363, 0.012877125293016434, 0.003912762738764286, 0.042906783521175385, -0.010141372680664062, 0.015307491645216942, -0.008188172243535519, 0.029902415350079536, -0.011808273382484913, 0.01015409640967846, 0.018043244257569313, 0.0333634614944458, 0.025105305016040802, 0.014162292703986168, -0.06972988694906235, 0.013424276374280453, 0.0284518301486969, -0.04066728428006172, -0.005862782243639231, -0.025754250586032867, 0.04326307028532028, 0.03725713863968849, 0.001092710648663342, -0.03287993371486664, 0.036824505776166916, -0.01588009111583233, -0.005137489642947912, -0.024278216063976288, -0.014047772623598576, -0.029876966029405594, 0.029698824509978294, 0.01520569622516632, -0.032676342874765396, 0.041150812059640884, -0.004275409039109945, -0.0066803270019590855, 0.028299137949943542, -0.014887585304677486, -0.00844902265816927, 0.013284306973218918, 0.013895079493522644, 0.0020279563032090664, 0.01941748335957527, 0.0098359864205122, 0.033592499792575836, 0.005636923480778933, -0.06021201238036156, -0.03822419419884682, -0.02268766239285469, 0.03076767735183239, -0.022280480712652206, 0.012527203187346458, -0.045146286487579346, -0.0017416566843166947, 0.030971268191933632, -0.03870772197842598, 0.0286299716681242, 0.013157063163816929, -0.08016392588615417, -0.06901732087135315, -0.0092188511043787, -0.0438992902636528, -0.03013145551085472, -0.011967328377068043, 0.0198501143604517, 0.0006795641966164112, 0.04557891562581062, 0.05242466181516647, 0.04830194264650345, -0.011687390506267548, -0.035704758018255234, -0.010739420540630817, -0.0010410175891593099, 0.03776611387729645, -0.048836369067430496, -0.06733769178390503, 0.024774469435214996, 0.028579074889421463, 0.0078064389526844025, 0.015523807145655155, -0.028579074889421463, -0.05868507921695709, -0.015892814844846725, -0.10057391226291656, -0.004701677709817886, -0.0284518301486969, 0.007596485782414675, -0.024176420643925667, 0.0300296600908041, 0.0004366070788819343, -0.018819434568285942, 0.0265177171677351, 0.006890280172228813, -0.02472357079386711, 0.029266193509101868, -0.029037153348326683, 0.04962528496980667, 0.012132746167480946, 0.029876966029405594, -0.022255031391978264, -0.03130210191011429, -0.019264791160821915, -0.021835125982761383, 0.015511082485318184, -0.008531731553375721, -0.013322480022907257, -0.008748047053813934, -0.019888287410140038, -0.011394728906452656, -0.04562981426715851, -0.0011436083586886525, -0.023336607962846756, 0.057616230100393295, 0.012514479458332062, -0.0017257510917261243, -0.0030824937857687473, -0.008722598664462566, -0.04221966490149498, 0.02174605429172516, -0.06662512570619583, 0.013297031633555889, -0.03550116717815399, 0.007011162117123604, 0.0424996018409729, 0.003919125068932772, -0.03382154181599617, 0.034610453993082047, 0.04204152524471283, -0.009594221599400043, 0.011999139562249184, -0.013564244844019413, -0.00037278610398061574, -0.04842918738722801, -0.028680870309472084, -0.019570177420973778, -0.02163153514266014, -0.03886041417717934, -0.019824665039777756, -0.04201607406139374, -0.006381302606314421, -0.0023015316110104322, -0.0565473772585392, -0.03529757633805275, -0.020626304671168327, -0.03168383613228798, 0.027026694267988205, 0.03176018223166466, 0.03094581887125969, 0.0007893124129623175, -0.02936798892915249, -0.029444336891174316, -0.02061358094215393, -0.041710689663887024, -0.00911705568432808, 0.0168598722666502, 0.004552165511995554, -0.05527493357658386, -0.04825104773044586, 0.015651050955057144, 0.046520523726940155, 0.003970022778958082, -0.005089772865176201, 0.03244730085134506, 0.014709443785250187, 0.032676342874765396, 0.057972513139247894, 0.00991869531571865, -0.03104761429131031, -0.02424004301428795, 0.0597030371427536, -0.0009614899172447622, 0.02890991047024727, 0.05074503645300865, 0.011541060172021389, 0.03697719797492027, 0.030055109411478043, -0.005080229602754116, 0.03397423401474953, -0.052882738411426544, -0.00900889839977026, 0.011483799666166306, -0.04308492690324783, 0.006788484752178192, 0.03636642545461655, -0.044866349548101425, 0.009015260264277458, -0.02082989551126957, -0.026670409366488457, 0.00245899660512805, -0.11217859387397766, 0.028986256569623947, -0.012183643877506256, 0.015816468745470047, -0.00999504141509533, 0.04970163106918335, 0.033032625913619995, -0.013576969504356384, -0.003699628636240959, 0.00541742704808712, 0.02633957378566265, -0.010612176731228828, 0.011445626616477966, 0.022102339193224907, 0.02743387594819069, 0.002354020019993186, -0.017725134268403053, -0.007819163613021374, 0.015574704855680466, -0.05176299065351486, 0.044484615325927734, 0.0018848065519705415, -0.01155378483235836, -0.0009320646640844643, -0.032294608652591705, 0.006282688584178686, 0.026008740067481995, 0.00720839062705636, 0.02855362556874752, 0.013500622473657131, 0.007959132082760334, -0.032370954751968384, 0.05771802365779877, 0.01519297156482935, 0.07181669771671295, -0.04071818292140961, -0.02202599123120308, -0.017674235627055168, -0.013882355764508247, -0.007182941772043705, -0.017725134268403053, 0.0010282931616529822, -0.02191147208213806, -0.014569474384188652, 0.020880792289972305, 0.004094086121767759, -0.049752529710531235, 0.025105305016040802, 0.029215296730399132, -0.02725573442876339, 0.02504168264567852, -0.01829773373901844, -0.032650891691446304, -0.03799515590071678, 0.04407743364572525, -0.005579663440585136, 0.036544568836688995, 0.00023261852038558573, -0.01773785799741745, 0.021618809551000595, 0.020995313301682472, 0.04998156800866127, -0.02107165940105915, 0.019302964210510254, -0.03776611387729645, 0.0025528392288833857, 0.009206126444041729, 0.0170380137860775, 0.010230443440377712, -0.000534823804628104, -0.0010672617936506867, -0.0201936736702919, 0.006833020132035017, 0.011458351276814938, 0.03280358761548996, 0.005140670575201511, 0.014747616834938526, -0.02745932526886463, 0.017050739377737045, -0.014900309965014458, 0.0300296600908041, 0.02107165940105915, 0.01497665699571371, -0.03438141569495201, -0.01094301138073206, -0.03916580229997635, 0.005621017888188362, 0.009206126444041729, 0.010198632255196571, 0.008805306628346443, 0.02605963684618473, -0.010624900460243225, 0.02567790448665619, -0.011312020011246204, -0.004243598319590092, 0.06016111373901367, -0.01734340190887451, -0.010911200195550919, -0.004482181277126074, -0.012107296846807003, 0.034788597375154495, -0.01348789781332016, 0.024698123335838318, -0.03649367019534111, -0.035602960735559464, -0.03259999677538872, 0.049014512449502945, 0.009104331023991108, 0.001970696495845914, -0.015930989757180214, 0.026924898847937584, 0.013017093762755394, -0.025054406374692917, 0.027001244947314262, -0.03455955907702446, -0.05257735401391983, 0.027128489688038826, 0.0635712593793869, 0.0186158437281847, -0.014556750655174255, -0.02835003472864628, -0.04766572266817093, 0.005236103665083647, 0.04000561311841011, -0.0498797744512558, -0.010688522830605507, -0.0695262998342514, -0.022064166143536568, 0.024354564025998116, 0.002473311498761177, 0.05061779171228409, 0.009244299493730068, -0.03425417095422745, 0.022496795281767845, 0.011719201691448689, 0.0396747812628746, 0.0012159785255789757, 0.020244572311639786, -0.03455955907702446, -0.029775170609354973, 0.025067131966352463, 0.05675096809864044, -0.020257296040654182, 0.0029377532191574574, -0.03135300055146217, 0.01797962188720703, 0.033948786556720734, -0.04204152524471283, -0.03992926701903343, 0.005722813308238983, -0.050490546971559525, 0.0286299716681242, -0.022038716822862625, 0.02761201746761799, 0.06301138550043106, -0.020600855350494385, -0.0323200561106205, 0.015574704855680466, -0.016516312956809998, -0.016274549067020416, -0.012164557352662086, -0.009301559999585152, 0.018704915419220924, 0.046978604048490524, -0.002967973705381155, -0.015829194337129593, -0.0016573573229834437, -0.02029546909034252, 0.0048925443552434444, 0.03537392243742943, -0.01893395557999611, 0.02490171417593956, 0.01678352616727352, -0.007742817047983408, 0.0730382427573204, -0.07461606711149216, -0.04649507626891136, 0.020944414660334587, -0.0235274750739336, 0.021695157513022423, 0.00047915440518409014, 0.03705354779958725, 0.04104901850223541, 0.008060927502810955, -0.008283604867756367, -0.007984581403434277, -0.02936798892915249, 0.018768537789583206, 0.023591097444295883, 0.02378196455538273, 0.01871763914823532, -0.024049175903201103, -0.007698281668126583, -0.03290538117289543, 0.031022164970636368, -0.04018375650048256, 0.03048773854970932, 0.006852106656879187, -0.01865401677787304, -0.0023906026035547256, 0.0034833133686333895, 0.005267914850264788, -0.003400604473426938, 0.06133176386356354, -0.03402513265609741, -0.06728679686784744, 0.02901170589029789, 0.029597029089927673, -0.01987556368112564, 0.020778996869921684, 0.03244730085134506, -0.04786931350827217, 0.00911705568432808, -0.023056671023368835, -0.03234550729393959, -0.015269318595528603, 0.045858852565288544, 0.03611193969845772, 0.022051440551877022, 0.0004334259720053524, -0.011706477962434292, 0.027128489688038826, -0.0029775172006338835, 0.029444336891174316, 0.05440967157483101, -0.014149568974971771, -0.0017543811118230224, 0.022318653762340546, -0.027332080528140068, -0.035806551575660706, -0.034228723496198654, -0.008366313762962818, -0.0011444035917520523, -0.025168927386403084, 0.009479701519012451, -0.0017575621604919434, -0.03751162439584732, -0.007819163613021374, -0.025932392105460167, -0.019010301679372787, 0.06178984418511391, 0.022611316293478012, 0.04186338186264038, 0.03565385937690735, 0.021644258871674538, 0.020397264510393143, -0.037664320319890976, 0.0018052788218483329, -0.03048773854970932, 0.004924355074763298, 0.03545026853680611, 0.0025623824913054705, 0.006533995736390352, -0.004507630132138729, 0.022916702553629875, 0.002869359450414777, 0.004545803181827068, 0.010281341150403023, -0.04036189988255501, -0.026034187525510788, 0.024634500965476036, 0.023056671023368835, -0.018272284418344498, 0.008162722922861576, 0.0407436303794384, -0.024036452174186707, -0.0022569962311536074, -0.0002503134310245514, -0.05369710549712181, 0.05532583221793175, -0.008996173739433289, -0.04738578572869301, -0.021402494981884956, 0.009085244499146938, 0.00010676593956304714, 0.015078452415764332, 0.027484772726893425, -0.014035048894584179, 0.030080556869506836, 0.004036826081573963, -0.02366744354367256, 0.03188742697238922, 0.02817189320921898, 0.010504018515348434, -0.00550649780780077, -0.04443371668457985, -0.020804446190595627, 0.0015937350690364838, 0.04545167088508606, 0.019646523520350456, -0.024927163496613503, -0.00855081807821989, 0.021542463451623917, 0.017127085477113724, -0.014289537444710732, -0.011286571621894836, -0.008245431818068027, 0.030004210770130157, -0.012915298342704773, 0.0013058448676019907, -0.0064799170941114426, 0.012419045902788639, -0.018730364739894867, 0.01773785799741745, -0.00028908319654874504, -0.0026291857939213514, -0.006476736161857843, 0.00837903842329979, 0.012476305477321148, -0.0015563571359962225, 0.0018339087255299091, -0.05675096809864044, -0.006301775109022856, -0.01417501736432314, 0.039776574820280075, -0.007240201812237501, 0.01811959221959114, 0.032472752034664154, -0.028222789987921715, 0.023934656754136086, -0.01155378483235836, -0.012781691737473011, 0.013678764924407005, -0.00841084960848093, 0.009594221599400043, 0.029138948768377304, -0.0265177171677351, -0.01727977953851223, -0.0070684221573174, 0.011324744671583176, 0.007825525477528572, 0.017941448837518692, -0.01731795258820057, -0.026085086166858673, 0.03249819949269295, -0.04527353122830391, 0.009314284659922123, -0.0108030429109931, 0.007761903572827578, -0.0013098212657496333, 0.00636539701372385, -0.025945117697119713, -0.016910770907998085, -0.003333801170811057, 0.01734340190887451, 0.008875291794538498, 0.04758937656879425, 0.009676930494606495, -0.0025655636563897133, 0.039420291781425476, 0.04657142236828804, 0.0025098943151533604, -0.022713111713528633, 0.022853080183267593, 0.0233620572835207, -0.024876264855265617, -0.0254615880548954, -0.027484772726893425, 0.010860302485525608, -0.022115062922239304, 0.01871763914823532, -0.03657001629471779, -0.05349351093173027, 0.004205424804240465, 0.018106866627931595, -0.022331377491354942, 0.004698496777564287, 0.006928453221917152, 0.0022999411448836327, 0.0013885536463931203, -0.0059391288086771965, 0.0109748225659132, 0.0020820351783186197, -0.043186724185943604, 0.024532705545425415, -0.02753567136824131, 0.004793929867446423, -0.013678764924407005, -0.02030819281935692, -0.0006990485126152635, 0.0010306789772585034, 0.00407499959692359, -0.04094722121953964, -0.002621232997626066, 0.037740666419267654, -0.019481105729937553, -0.030742228031158447, 0.03649367019534111, 0.011483799666166306, 0.0046571423299610615, 0.01657993532717228, -0.004122715909034014, -0.06901732087135315, -0.0400310643017292, -0.014747616834938526, -0.029775170609354973, -0.010866665281355381, -0.021835125982761383, -0.02100803703069687, 0.031556591391563416, -0.04252505302429199, 0.03410147875547409, 0.06270600110292435, 0.0006938792066648602, -0.0012127974769100547, 0.033210769295692444, 0.02364199422299862, 0.0035882899537682533, 0.012565377168357372, -0.02009187825024128, -0.02865542098879814, 0.01436588354408741, 0.001441837172023952, 0.011032083071768284, -0.017165258526802063, 0.04066728428006172, 0.030614983290433884, -0.016338171437382698, -0.034330517053604126, 0.0027452963404357433, 0.012240903452038765, -0.00584687665104866, -0.03936939314007759, -0.034966740757226944, 0.025652455165982246, 0.03504308685660362, 0.011630130931735039, -0.011273846961557865, 0.012838952243328094, -0.0036678174510598183, -0.02093169093132019, 0.01612185500562191, 0.049396246671676636, -0.004510811064392328, -0.02047361060976982, -0.039496637880802155, -0.00040698301745578647, 0.03270179033279419, 0.009969593025743961, -0.025092579424381256, 0.029418887570500374, 0.011451988480985165, -0.03748617693781853, 0.018030520528554916, -0.042830437421798706, -0.0039159441366791725, -0.017546992748975754, -0.0002011056785704568, -0.008767133578658104, 0.015269318595528603, 0.027866506949067116, 0.02412552386522293, 0.0438992902636528, 0.017941448837518692, -0.03364339843392372, 0.012514479458332062, 0.015422011725604534, 0.03748617693781853, 0.02995331399142742, 0.005646466743201017, 0.018730364739894867, -0.046698667109012604, -0.03399968147277832, 0.04608789458870888, -0.01015409640967846, 0.00942880380898714, -0.06224792078137398, 0.01935386098921299, 0.04026010259985924, 0.0179160013794899, 0.006467192433774471, -0.008372676558792591, -0.01913754642009735, 0.04252505302429199, -0.028299137949943542, -0.013106165453791618, -0.005834151990711689, 0.046520523726940155, 0.0007745997863821685, 0.026950348168611526, -0.0133479293435812, 0.014620372094213963, -0.0020645391196012497, -0.0484800860285759, 0.0005670324899256229, -0.01622365042567253, -0.0009710332378745079, 0.0036900853738188744, -0.0074628796428442, -0.002420823322609067, -0.005897774361073971, -0.010688522830605507, 0.026644960045814514, -0.04308492690324783, -0.0037791563663631678, 0.0027039418928325176, -0.048098351806402206, -0.016490863636136055, -0.05670006945729256, -0.005306088365614414, 0.001813231618143618, 0.014480403624475002, -0.002395374234765768, -0.035704758018255234, -0.0017130266642197967, 0.013093440793454647, -0.0252834465354681, 0.03351615369319916, -0.025843322277069092, -0.05675096809864044, -0.025347068905830383, 0.005528765730559826, 0.002325389999896288, -0.007990943267941475, -0.009333371184766293, -0.01101299561560154, 0.03573020547628403, -0.026365023106336594, -0.017623338848352432, -0.029317092150449753, -0.0635712593793869, 0.02490171417593956, 0.00837903842329979, -0.0012135927099734545, 0.017368849366903305, -0.038656823337078094, -0.030538637191057205, -0.007583761587738991, 0.008118188008666039, -0.02015550062060356, -0.002350838854908943, 0.0389876589179039, -0.07354721426963806, -0.00019424641504883766, -0.03730803355574608, 0.00928883533924818, -0.0028327766340225935, -0.009301559999585152, 0.02191147208213806, 0.007055697496980429, 0.021338872611522675, 0.0029600211419165134, -0.0438992902636528, -0.0007777808932587504, 0.009473339654505253, -0.006247696001082659, 0.019659247249364853, 0.010414947755634785, -0.014556750655174255, -4.980422090739012e-05, 0.035144880414009094, 0.002051814692094922, -0.028528176248073578, -0.01257173903286457, -0.03204011917114258, -0.02100803703069687, 0.009040708653628826, 0.01931568793952465, 0.025614282116293907, -0.030182352289557457, 0.020944414660334587, -0.0065594445914030075, 0.014213190414011478, -0.00032626237953081727, 0.02071537636220455, 0.0005030127358622849, -0.005255190655589104, 0.04351755976676941, 0.02324753813445568, -0.009950505569577217, 0.007933683693408966, 0.010548554360866547, -0.0298515185713768, -0.05476595461368561, -0.03906400501728058, -0.018501324579119682, 0.012221816927194595, 0.015994612127542496, 0.037740666419267654, -0.03308352455496788, 0.009047071449458599, -0.07390350103378296, -0.026823103427886963, 0.014989380724728107, -0.03181108087301254, -0.010586727410554886, -0.008849842473864555, -0.03211646527051926, -0.0072338394820690155, -0.0039159441366791725, -0.012247266247868538, 0.02107165940105915, 0.008786220103502274, -0.05680186673998833, -0.034890394657850266, 0.024532705545425415, 0.0036837230436503887, 0.02595784142613411, 0.024838091805577278, 0.00923793762922287, -0.0337197445333004, -0.03356705233454704, 0.011878257617354393, -0.053442616015672684, 0.04059093818068504, -0.014671269804239273, -0.005474687088280916, -0.004924355074763298, 0.018730364739894867, 0.039954718202352524, -0.004822559654712677, -0.036926303058862686, -0.012781691737473011, 0.00550649780780077, -0.0019659248646348715, -0.05005791783332825, 0.03041139245033264, 0.0005809498834423721, 0.05191568285226822, 0.007189304102212191, -0.03623918443918228, 0.025932392105460167, -0.006737587042152882, 0.020880792289972305, 0.004682591184973717, 0.037638869136571884, 0.028324585407972336, -0.015434736385941505, -0.025270722806453705, -0.02763746678829193, 0.0048734573647379875, 0.004857551772147417, -0.002754839602857828, -0.005531946662813425, 0.01020499411970377, 0.03822419419884682, 0.04341576248407364, -0.06596345454454422, -0.0231839157640934, -0.0022888071835041046, 0.01987556368112564, -0.0010537420166656375, 0.006833020132035017, -0.007252926472574472, -0.050210610032081604, -0.017305226996541023, 0.0018418615218251944, -0.010580365546047688, 0.018450425937771797, -0.0013646953739225864, -0.009454253129661083, -0.01692349463701248, 0.021898748353123665, 0.0323200561106205, -0.02865542098879814, 0.0008477653027512133, 0.0235274750739336, 0.008563542738556862, 0.012928023003041744, -0.006623066961765289, 0.0034133289009332657, 0.02504168264567852, -0.010516743175685406, 0.01805596984922886, 0.053646206855773926, -0.017165258526802063, 0.019939186051487923, 0.00713840639218688, -0.024392737075686455, -0.017305226996541023, 0.014989380724728107, 0.019150270149111748, -0.0025592013262212276, 0.009676930494606495, -0.005722813308238983, -0.03659546747803688, 0.020778996869921684, -0.015523807145655155, 0.007545588072389364, 0.011261122301220894, 0.0008803716627880931, 0.011878257617354393, 0.023972829803824425, -0.016414517536759377, 0.02992786467075348, -0.012030950747430325, 0.0286299716681242, -0.049676183611154556, -0.03522122651338577, -0.015472909435629845, -0.005541490390896797, 0.01797962188720703, -0.013322480022907257, -0.015638327226042747, -0.00855081807821989, -0.012838952243328094, -0.033312562853097916, 0.06886462867259979, -0.006320861633867025, -0.01949382945895195, -0.0034833133686333895, 0.0230057742446661, 0.038376886397600174, 0.006731224711984396, -0.014951207675039768, -9.429002966498956e-05, 0.02462177537381649, -0.04076908156275749, 0.003740983083844185, -0.020677201449871063, 0.006164987571537495, -0.026466818526387215, 0.012100934982299805, -0.02539796568453312, 0.006060010753571987, -0.02156791277229786, -0.012291801162064075, 0.021758779883384705, -0.028706319630146027, -0.002996603725478053, 0.004832102917134762, -0.0021726968698203564, -0.014582199044525623, -0.017686961218714714, -0.014989380724728107, -0.02504168264567852, 0.01004593912512064, 0.012336337007582188, 0.03779156506061554, -0.020206397399306297, 0.02440546080470085, -0.021097108721733093, 0.006228609476238489, -0.008353590033948421, 0.014594923704862595, -0.029775170609354973, 0.04603699594736099, -0.03824964165687561, -0.017114361748099327, -0.02633957378566265, -0.027306631207466125, -0.0004636464873328805, 0.05588570609688759, -0.02068992704153061, -0.015511082485318184, 0.03679905831813812, -0.03860592842102051, -0.0005308474064804614, -0.019468382000923157, 0.01496393233537674, -0.0036519120912998915, -0.016172753646969795, 0.026263227686285973, 0.024392737075686455, -0.006584893446415663, 0.0407436303794384, 0.031734734773635864, 0.04758937656879425, -0.0066930511966347694, -0.029164398089051247, 0.009530599229037762, -0.001868900959379971, 0.028986256569623947, 0.024112798273563385, 0.013678764924407005, 0.03455955907702446, 0.013996874913573265, 0.005764167755842209, 0.03824964165687561, -0.02051178552210331, 0.0035851087886840105, 0.025512486696243286, 0.013806008733808994, 0.00020736847363878042, 0.051050420850515366, -0.026186881586909294, 0.04267774522304535, 0.03104761429131031, -0.0037886996287852526, 0.005353804677724838, -0.017585165798664093, 0.02791740372776985, 0.044408269226551056, 0.012883487157523632, -0.03280358761548996, 0.024825366213917732, 0.06998437643051147, -0.02262404002249241, -0.0491672046482563, -0.005261552520096302, -0.002360382117331028, -0.0017337038880214095, -0.0077937147580087185, -0.004809835460036993, 0.0023492483887821436, -0.01590554043650627, 0.008964362554252148, -0.02114800550043583, 0.01991373673081398, -0.029902415350079536, -0.026644960045814514, -0.026594063267111778, 0.02462177537381649, 0.028757216408848763, -0.0045012678019702435, 0.00023082915868144482, 0.030284147709608078, 0.006441743578761816, 0.010414947755634785, 0.036620914936065674, 0.003403785638511181, -0.02791740372776985, -0.006737587042152882, 0.006642153486609459, 0.02138977125287056, 0.036620914936065674, -0.03886041417717934, 0.008054565638303757, -0.004513992462307215, 0.02883356250822544, 0.018781261518597603, -0.01889578253030777, 0.010376774705946445, -0.005213836207985878, -0.021504290401935577, 0.013704213313758373, 0.03132755309343338, 0.015307491645216942, 0.04501904174685478, -0.011706477962434292, 0.022471347823739052, -0.022496795281767845, 0.034508660435676575, 0.03751162439584732, 0.002490807557478547, -0.001671672216616571, -0.003868227358907461, -0.026644960045814514, 0.030462291091680527, -0.029088051989674568, 0.019124820828437805, 0.019888287410140038, 0.012444494292140007, -0.002592602977529168, 0.0031906513031572104, 0.009562410414218903, -0.03354160487651825, -0.03399968147277832, 0.018870333209633827, 0.05140670761466026, 0.03282903507351875, -0.047716621309518814, 0.00014096284576226026, 0.015078452415764332, 0.029164398089051247, 0.005955034401267767, -0.0012509707594290376, -0.05700545758008957, -0.01408594660460949, -0.012858038768172264, -0.013984151184558868, -0.016350895166397095, 0.01871763914823532, 0.014340435154736042, 0.01562560349702835, 0.015218420885503292, 0.0029870604630559683, -0.03964933007955551, -0.039140354841947556, -0.017114361748099327, 0.01959562487900257, -0.012221816927194595, 0.016376344487071037, -0.017203431576490402, -0.0049275364726781845, 0.004895725287497044, -0.00837903842329979, 0.004428102169185877, 0.007055697496980429, -0.004660323262214661, -0.0008509464096277952, 0.0037982428912073374, -0.022942151874303818, -0.0003383903531357646, 0.006979350931942463, -0.010663074441254139, 0.025894219055771828, -0.008964362554252148, -0.05542762577533722, 0.011292933486402035, -0.0018879876006394625, -0.03924214839935303, -0.02030819281935692, 0.022064166143536568, -0.013271582312881947, -0.0028232333716005087, -0.0043867481872439384, -0.008207258768379688, 0.0109748225659132, -0.02406190149486065, -0.0038491408340632915, 0.007386533077806234, -0.010548554360866547, 0.008366313762962818, 0.010586727410554886, 0.02121162787079811, -0.01913754642009735, 0.004876638762652874, -0.002707122825086117, 0.020066428929567337, -0.017928725108504295, 0.05061779171228409, 0.014060497283935547, -0.005334718152880669, -0.008818031288683414, -0.026543164625763893, -0.008608078584074974, -0.036188285797834396, 0.01004593912512064, -0.015523807145655155, 0.00593594741076231, -0.05471505969762802, 0.00410999171435833, -0.025410691276192665, 0.003270179033279419, 0.019939186051487923, -0.020944414660334587, 0.0016843967605382204, 0.02753567136824131, 0.00030916393734514713, 0.006285869516432285, 0.07242746651172638, 0.009861434809863567, -0.0025544296950101852, -0.01020499411970377, 0.018704915419220924, -0.017852379009127617, 0.01023680530488491, 0.01071397215127945, -0.00460942555218935, -0.02791740372776985, -0.033312562853097916, 0.016350895166397095, -0.011910068802535534, -0.02416369691491127, 0.04692770540714264, -0.0003546935331542045, 0.008862567134201527, -0.0014760341728106141, 0.0008596944389864802, -0.014149568974971771, 0.0300296600908041, 0.044026535004377365, -0.007920959033071995, -0.008614440448582172, 0.019939186051487923, 0.01696166768670082, 0.003810967318713665, -0.06072099134325981, 0.014620372094213963, 0.05158484727144241, -0.008792582899332047, -0.02135159634053707, -0.0316074900329113, 0.004202243871986866, -0.0221277866512537, 0.010866665281355381, 0.005856419913470745, -0.027841057628393173, -0.013042543083429337, 0.025906944647431374, -0.017407022416591644, 0.008977087214589119, -0.034152377396821976, -0.01777603104710579, -0.0015833965735509992, 0.020626304671168327, 0.002845501061528921, -0.01851404830813408, -6.063987166271545e-05, -0.023692892864346504, 0.013424276374280453, 0.005369710270315409, 0.023082120344042778, -0.015129350125789642, -0.025843322277069092, -0.061026375740766525, 0.010688522830605507, 0.06016111373901367, 0.02240772545337677, 0.0323200561106205, -0.011242035776376724, -0.02761201746761799, 0.008105463348329067, 0.018628569319844246, 0.0023906026035547256, -0.03799515590071678, 0.016605384647846222, -0.005697364453226328, -0.05552942305803299, 0.023476576432585716, -0.003092037048190832, -0.0026848551351577044, 0.010090474970638752, -0.012030950747430325, -0.0018482237355783582, 0.037384383380413055, 0.006238152738660574, -0.026212330907583237, 0.015549256466329098, 0.02451997995376587, -0.0074628796428442, -0.013195236213505268, 0.004962528590112925, 0.0013209551107138395, -0.0182595606893301, -0.0005213040858507156, 0.014887585304677486, 0.012476305477321148, -0.02420186996459961, -0.0010831672698259354, 0.03822419419884682, 0.006533995736390352, 0.004653960932046175, 0.001959562534466386, -0.006238152738660574, 0.04234690964221954, 0.0078064389526844025, 0.010847578756511211, -0.04766572266817093, -7.092877058312297e-05, 0.009874159470200539, -0.006085459608584642, -0.025868769735097885, 0.012069123797118664, -0.008811669424176216, 0.0050961351953446865, -0.008805306628346443, 0.01166194211691618, -0.009524237364530563, 0.011464713141322136, 0.000300813524518162, -0.016236376017332077, 0.022458622232079506, -0.01616002805531025, -0.01529476698487997, -0.024596327915787697, 0.004682591184973717, -0.014200466684997082, 0.00457443343475461, -0.01973559334874153, 0.010968460701406002, 0.016007335856556892, 0.008894378319382668, -0.03326166421175003, -0.019570177420973778, 0.03402513265609741, 0.024736296385526657, -0.020499059930443764, -0.013602417893707752, -0.009689655154943466, 0.011184776201844215, 0.005630561150610447, 0.02936798892915249, -0.020842619240283966, 0.00543651357293129, -0.011560146696865559, -0.007316548377275467, -0.03860592842102051, 0.007997306063771248, -0.016210926696658134, -0.02086806856095791, 0.03891131281852722, 0.00823906995356083, -0.023120293393731117, -0.001171443029306829, -0.01995190978050232, -0.003842778503894806, -0.011840084567666054, 0.020257296040654182, 0.010949374176561832, 0.003836416406556964, -0.017928725108504295, 0.004943442065268755, 0.0021297517232596874, 0.015460184775292873, -0.02110983245074749, 0.006947539746761322, -0.0512794628739357, -0.031276654452085495, -0.004914811812341213, 0.0033783367834985256, -0.005140670575201511, -0.02549976110458374, -0.0062095229513943195, 0.023871034383773804, 0.04491724446415901, 0.01921389251947403, 0.049930673092603683, 0.026085086166858673, -0.00453944131731987, 0.016109131276607513, -0.031098512932658195, -0.00932700838893652, 0.016669007018208504, 0.034076027572155, -0.008092738687992096, 0.0035851087886840105, -0.013602417893707752, 0.0028502726927399635, -0.00999504141509533, -0.006168168503791094, -0.013589693233370781, 0.015511082485318184, 0.036442775279283524, -0.0049179932102561, -0.006495822686702013, -0.01574012264609337, -0.016885321587324142, -0.00992505718022585, -0.012043675407767296, 0.020957140251994133, -0.0014664907939732075, -0.013984151184558868, -0.006451287306845188, -0.009626032784581184, 0.017025290057063103, 0.009136142209172249, -0.04534987732768059, 0.008728960528969765, 0.0034260533284395933, 0.008805306628346443, 0.013742386363446712, -0.030258700251579285, -0.006499003618955612, 0.006960264407098293, 0.01497665699571371, -0.013844181783497334, -0.0021615629084408283, 0.014124119654297829, 0.015816468745470047, 0.0020152318757027388, -0.0001400681649101898, 0.02799374982714653, -0.02745932526886463, 0.01995190978050232, 0.015396563336253166, 0.0032335962168872356, 0.021160731092095375, 0.017088912427425385, -0.03855502977967262, 0.014149568974971771, 0.003476951038464904, 0.015231145545840263, -0.017546992748975754, -0.035170331597328186, 0.0035342110786587, 0.03613738715648651, -0.009587859734892845, 0.02725573442876339, -0.00231425603851676, 0.02835003472864628, -0.03453410789370537, -0.004682591184973717, -0.022496795281767845, 0.0035151243209838867, 0.004415377974510193, -0.011884619481861591, -0.02149156667292118, 0.03606104105710983, -0.005283820442855358, 0.015002105385065079, 0.018564946949481964, -0.016312722116708755, 0.025296170264482498, -0.018743088468909264, 0.006629429291933775, 0.014633096754550934, 0.026046913117170334, 0.0033210767433047295, 0.021300699561834335, 0.04148164764046669, -0.02047361060976982, 0.011541060172021389, -0.040132857859134674, -0.006250877398997545, 0.01427681278437376, -0.024888988584280014, -0.02745932526886463, -0.0011618997668847442, 0.02420186996459961, 0.017623338848352432, 0.00545241916552186, -0.008092738687992096, -0.0014179788995534182, 0.011630130931735039, -0.015816468745470047, 0.002272901590913534, -0.030920369550585747, -0.030920369550585747, 0.034152377396821976, 0.02753567136824131, 0.013424276374280453, 0.0017066644504666328, 0.0041258973069489, -0.0009161591297015548, 0.015930989757180214, -0.0017273416742682457, 0.008805306628346443, 0.024876264855265617, -0.01584191806614399, -0.022102339193224907, 0.018921229988336563, -0.011579233221709728, -0.0084299361333251, -0.014683994464576244, 0.023158466443419456, 0.010383136570453644, 0.012190005742013454, 0.021122558042407036, -0.014200466684997082, 0.0133479293435812, -0.003295627888292074, 0.02697579562664032, -0.03814784809947014, 0.03891131281852722, -0.006623066961765289, 0.01643996685743332, 0.0037632507737725973, -0.005503316875547171, -0.03929304704070091, -0.016910770907998085, -0.014900309965014458, 0.024354564025998116, 0.003880951786413789, 0.014989380724728107, 8.946866728365421e-06, 0.012393596582114697, 0.001092710648663342, -0.049752529710531235, 0.023272985592484474, 0.006915729027241468, 0.007838250137865543, 0.018005071207880974, -0.019341137260198593, 0.013933253474533558, 0.03771521523594856, -0.01741974800825119, -0.0006525247590616345, -0.030004210770130157, 0.005420607980340719, -0.015027554705739021, -0.005287001375108957, 0.010014127939939499, -0.021593362092971802, 0.0012907346244901419, -0.020957140251994133, -0.005207473877817392, 0.006012293975800276, 0.011292933486402035, -0.0029345720540732145, 0.00631449930369854, 0.015791019424796104, 0.01654176227748394, -0.005729175638407469, 0.012673534452915192, -0.03224371001124382, -0.013653315603733063, 0.013080716133117676, 0.019570177420973778, 0.003922306001186371, -0.03030959703028202, -0.01408594660460949, 0.003670998616144061, -0.01851404830813408, -0.027332080528140068, 0.0410999171435833, -0.007653745822608471, -0.06789757311344147, -0.003814148483797908, 0.009466977789998055, -0.0027309812139719725, 0.007704643532633781, 0.01570194959640503, -0.03990381956100464, -0.01889578253030777, -0.012527203187346458, -0.03323621675372124, 0.046596869826316833, -0.01921389251947403, 0.005923223216086626, 0.007494690362364054, 0.018908506259322166, 0.007774628233164549, 0.02789195440709591, -0.0505668930709362, 0.03657001629471779, -0.012756243348121643, -0.02957157976925373, 0.0203718151897192, 0.008671700954437256, 0.01927751488983631, 0.011095704510807991, 0.04570616036653519, -0.001700302236713469, 0.007341997232288122, 0.0024955791886895895, -0.01675807684659958, -0.008016392588615417, -0.02563973143696785, -0.04471365362405777, 0.04453551396727562, -0.027128489688038826, 0.018959403038024902, 0.01913754642009735, 0.017470644786953926, -0.024354564025998116, -0.014213190414011478, -0.01441678125411272, -0.01092392485588789]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:34:51.782602", "url_path": "/agents/", "chunk_size": 4038}
updated_dt: 2025-03-16T00:34:51.784113
---
```
importasyncio
fromdataclassesimport dataclass
fromdatetimeimport date
frompydantic_aiimport Agent
frompydantic_ai.messagesimport (
  FinalResultEvent,
  FunctionToolCallEvent,
  FunctionToolResultEvent,
  PartDeltaEvent,
  PartStartEvent,
  TextPartDelta,
  ToolCallPartDelta,
)
frompydantic_ai.toolsimport RunContext

@dataclass
classWeatherService:
  async defget_forecast(self, location: str, forecast_date: date) -> str:
    # In real code: call weather API, DB queries, etc.
    return f'The forecast in {location} on {forecast_date} is 24Â°C and sunny.'
  async defget_historic_weather(self, location: str, forecast_date: date) -> str:
    # In real code: call a historical weather API or DB
    return (
      f'The weather in {location} on {forecast_date} was 18Â°C and partly cloudy.'
    )

weather_agent = Agent[WeatherService, str](
  'openai:gpt-4o',
  deps_type=WeatherService,
  result_type=str, # We'll produce a final answer as plain text
  system_prompt='Providing a weather forecast at the locations the user provides.',
)

@weather_agent.tool
async defweather_forecast(
  ctx: RunContext[WeatherService],
  location: str,
  forecast_date: date,
) -> str:
  if forecast_date >= date.today():
    return await ctx.deps.get_forecast(location, forecast_date)
  else:
    return await ctx.deps.get_historic_weather(location, forecast_date)

output_messages: list[str] = []

async defmain():
  user_prompt = 'What will the weather be like in Paris on Tuesday?'
  # Begin a node-by-node, streaming iteration
  async with weather_agent.iter(user_prompt, deps=WeatherService()) as run:
    async for node in run:
      if Agent.is_user_prompt_node(node):
        # A user prompt node => The user has provided input
        output_messages.append(f'=== UserPromptNode: {node.user_prompt} ===')
      elif Agent.is_model_request_node(node):
        # A model request node => We can stream tokens from the model's request
        output_messages.append(
          '=== ModelRequestNode: streaming partial request tokens ==='
        )
        async with node.stream(run.ctx) as request_stream:
          async for event in request_stream:
            if isinstance(event, PartStartEvent):
              output_messages.append(
                f'[Request] Starting part {event.index}: {event.part!r}'
              )
            elif isinstance(event, PartDeltaEvent):
              if isinstance(event.delta, TextPartDelta):
                output_messages.append(
                  f'[Request] Part {event.index} text delta: {event.delta.content_delta!r}'
                )
              elif isinstance(event.delta, ToolCallPartDelta):
                output_messages.append(
                  f'[Request] Part {event.index} args_delta={event.delta.args_delta}'
                )
            elif isinstance(event, FinalResultEvent):
              output_messages.append(
                f'[Result] The model produced a final result (tool_name={event.tool_name})'
              )
      elif Agent.is_call_tools_node(node):
        # A handle-response node => The model returned some data, potentially calls a tool
        output_messages.append(
          '=== CallToolsNode: streaming partial response & tool usage ==='
        )
        async with node.stream(run.ctx) as handle_stream:
          async for event in handle_stream:
            if isinstance(event, FunctionToolCallEvent):
              output_messages.append(
                f'[Tools] The LLM calls tool={event.part.tool_name!r} with args={event.part.args} (tool_call_id={event.part.tool_call_id!r})'
              )
            elif isinstance(event, FunctionToolResultEvent):
              output_messages.append(
                f'[Tools] Tool call {event.tool_call_id!r} returned => {event.result.content}'
              )
      elif Agent.is_end_node(node):
        assert run.result.data == node.data.data
        # Once an End node is reached, the agent run is complete
        output_messages.append(f'=== Final Agent Output: {run.result.data} ===')