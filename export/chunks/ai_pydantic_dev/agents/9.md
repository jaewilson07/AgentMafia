---
url: https://ai.pydantic.dev/agents/
session_id: pydantic_ai_docs
chunk_number: 9
title: Using Pydantic AI Agent to Calculate Volume
summary: This section demonstrates how to define a tool with the Pydantic AI Agent to calculate the volume of a box. If the input size is 42, the volume is computed as size cubed; otherwise, it raises a ModelRetry exception. It also captures and displays messages during the execution, handling unexpected model behavior.
embedding: [-0.008035490289330482, 0.0431424155831337, 0.04429648071527481, -0.011307389475405216, -0.026887277141213417, 0.006807760335505009, 0.00018694100435823202, 0.013173538260161877, -0.026838168501853943, -0.03425365313887596, -0.002639618469402194, -0.026273412629961967, -0.024996573105454445, -0.009508765302598476, -0.011626598425209522, 0.007188356481492519, -0.015543055720627308, 0.016083257272839546, -0.01184145174920559, 0.02268844097852707, 0.028213225305080414, -0.019926050677895546, 0.01080401986837387, -0.005346762016415596, 0.009815697558224201, -0.027255596593022346, 0.013689184561371803, 0.03187185898423195, 0.011172338388860226, -0.031429875642061234, 0.014425822533667088, -0.02061357907950878, -0.053037915378808975, -0.047562241554260254, -0.019189411774277687, -0.007740834727883339, 0.00595141900703311, 0.0020395657047629356, -0.013480470515787601, 0.011540657840669155, 0.024247657507658005, -0.04331429675221443, 0.054265644401311874, 0.050926219671964645, -0.0024462509900331497, 0.038771700114011765, 0.001246145460754633, 0.024517759680747986, 0.022135963663458824, 0.022430619224905968, -0.028458770364522934, 0.034671083092689514, 0.02271299622952938, -0.006905978545546532, 0.011798480525612831, -0.01712682656943798, -0.019385850057005882, 0.012209770269691944, 0.013689184561371803, -0.038894470781087875, 0.021006451919674873, -0.03398355469107628, -0.02046625129878521, 0.001104956609196961, -0.021497543901205063, 0.015346619300544262, -0.008759850636124611, 0.030668683350086212, -0.035923365503549576, -0.0035819008480757475, -0.036782778799533844, 0.016967222094535828, -0.04886363446712494, -0.01612008921802044, -0.02207457646727562, -0.04304419830441475, 0.005368247628211975, 0.04353528842329979, 0.0066358782351017, -0.03744575008749962, -0.005561614874750376, -0.030349474400281906, 0.012307988479733467, 0.027574805542826653, -0.014401267282664776, -0.003348632249981165, -0.04007309302687645, -0.012792942114174366, -0.009128169156610966, -0.04505767300724983, -0.040637847036123276, -0.004484282340854406, 0.012056304141879082, 0.044591136276721954, 0.07273069769144058, -0.004109824541956186, 0.02108011581003666, -0.010902238078415394, 0.04252855107188225, 0.003775268327444792, 0.025585884228348732, -0.021313384175300598, -0.04491034522652626, 0.03484296426177025, -0.0038121002726256847, -0.014978300780057907, 0.011976501904428005, -0.029612837359309196, -0.013345420360565186, -0.0003867348132189363, -0.04328974336385727, 0.00260585593059659, 0.0003552742418833077, -0.031577203422784805, -0.07675764709711075, -0.008336283266544342, -0.017053162679076195, 1.65455730893882e-05, 0.016046425327658653, -0.011448577977716923, -0.041006166487932205, 0.010533919557929039, -0.01936129480600357, -0.034032661467790604, 0.0010075055761262774, 0.021129224449396133, 0.016783062368631363, -0.0238302294164896, -0.015187014825642109, 0.030668683350086212, 0.03192096948623657, 0.0041865576058626175, 0.03658634051680565, -0.0026580344419926405, -0.002183823846280575, -0.05146642401814461, -0.02580687403678894, 0.010490949265658855, -0.046236295253038406, 0.05829259753227234, 5.227442306932062e-05, 0.0017080786637961864, -0.04687471315264702, 0.020073378458619118, -0.01835455745458603, 0.014352158643305302, -0.0649714469909668, 0.014278494752943516, -0.011338082142174244, -0.0065744915045797825, 0.0282868891954422, 0.04056418314576149, -0.015678105875849724, -0.01700405403971672, -0.030177591368556023, -0.01365235261619091, 0.005963696166872978, 0.03808417171239853, 0.022148240357637405, -0.04491034522652626, -0.03501484543085098, -0.0005847061984241009, -0.026617176830768585, -0.028360553085803986, -0.019385850057005882, -0.000508740427903831, -0.008017074316740036, -0.03611980378627777, -0.04083428531885147, -0.07828003168106079, 0.00015039686695672572, -0.012707000598311424, -0.009036089293658733, -0.028335997834801674, 0.016193753108382225, -0.03398355469107628, -0.0811774805188179, -0.03918912634253502, -0.048323433846235275, -0.013664629310369492, -0.02108011581003666, -0.010767187923192978, -0.04935472831130028, -0.05583713948726654, 0.015972761437296867, -0.003683188697323203, 0.0396556630730629, 0.016046425327658653, 0.007759250700473785, 0.04466480016708374, 0.007820636965334415, 1.4243581063055899e-05, 0.06693581491708755, 0.00812143087387085, -0.03774040564894676, -0.010828574188053608, 0.05122087523341179, 0.00906064361333847, 0.008643215522170067, -0.0034130881540477276, -0.015027409419417381, 0.04326518997550011, 0.06276153028011322, -0.02902352623641491, 0.0069796424359083176, -0.0766594335436821, 0.00707172229886055, 0.02246745117008686, -0.05195751413702965, -0.01685672625899315, 0.016905834898352623, -0.04513133689761162, 0.03076690249145031, -0.04574520140886307, -0.03695465996861458, 0.021043283864855766, -0.05829259753227234, 0.0312579944729805, -0.0377158522605896, 0.03265760466456413, 0.0005889264866709709, 0.03707743063569069, 0.045229557901620865, -0.031110666692256927, -0.04166914150118828, 0.007188356481492519, 0.0330013707280159, -0.05966765433549881, -0.0006111791008152068, 0.05235038697719574, 0.016807617619633675, 0.0029097190126776695, -0.010822435840964317, -0.03793684393167496, 0.036414459347724915, -0.049919482320547104, 0.03820694237947464, 0.04090794920921326, 0.018796538934111595, 0.009177278727293015, 0.011958085931837559, -0.0017679305747151375, 0.03278037905693054, -0.004039230290800333, 0.01303848810493946, 0.03948378190398216, -0.005340623669326305, -0.03302592411637306, 0.05338168144226074, 0.06177935004234314, 0.04552420973777771, -0.0417182482779026, -0.008409947156906128, -0.0065744915045797825, -0.011215309612452984, 0.0014141909778118134, -0.039999429136514664, -0.015972761437296867, -0.05691754072904587, -0.011258279904723167, 0.03128254786133766, 0.008354699239134789, -0.07120831310749054, 0.00893787108361721, 0.005644486751407385, -0.01813356578350067, 0.038747143000364304, -0.026273412629961967, -0.0014080522814765573, -0.024849245324730873, 0.02136249467730522, -0.0042540826834738255, 0.039508335292339325, 0.007304990664124489, -0.06207400560379028, 0.022762104868888855, 0.001331319217570126, -0.0009307724540121853, 0.0337134525179863, -0.010730355978012085, -0.029490062966942787, 0.021743090823292732, 0.0035573462955653667, 0.021509820595383644, 0.026568066328763962, -0.0058992402628064156, 0.03400810807943344, -0.0049446807242929935, -0.02206229977309704, -0.016942666843533516, 0.01961911842226982, -0.01921396702528, 0.02804134227335453, -0.03130710497498512, 0.009300051257014275, -0.005276167765259743, 0.04763590544462204, 0.009686785750091076, 0.009300051257014275, -0.020674966275691986, -0.024996573105454445, -0.005316068883985281, 0.0007918855408206582, -0.024726472795009613, -0.033443354070186615, 0.05200662463903427, -0.018784262239933014, -0.011239863932132721, 0.05406920984387398, 0.01216679997742176, 0.03513761982321739, 0.07145386189222336, -0.0454014390707016, -0.02220962755382061, 0.008360838517546654, -0.03798595070838928, 0.049060072749853134, -0.035063955932855606, 0.05598446726799011, 0.001625207019969821, -0.01284205075353384, -0.018268615007400513, 0.027108268812298775, -0.03088967502117157, -0.0352603904902935, 0.03025125525891781, 0.005435772705823183, -0.009815697558224201, -0.0020625856705009937, 0.01464681327342987, -0.021166056394577026, -0.020773183554410934, -0.009846391156315804, 0.032952260226011276, 0.02966194599866867, 0.004889432806521654, -0.05333257094025612, -0.016954945400357246, -0.004603985697031021, 0.06217222288250923, -0.016218306496739388, 0.004453588742762804, -0.045475102961063385, -0.0035235837567597628, -0.004490420687943697, 0.003996259532868862, 0.04078517481684685, 0.039262790232896805, -0.0012990912655368447, 0.005994389299303293, 0.027329258620738983, 0.022798936814069748, 0.03805961459875107, 0.017225045710802078, 0.02148526720702648, 0.006562214344739914, -0.014683645218610764, 0.01098204031586647, -0.014462653547525406, 0.01970505900681019, -0.06055162101984024, 0.02791856974363327, 0.044738464057445526, -0.01970505900681019, -0.011540657840669155, 0.01650068536400795, -0.015358896926045418, -0.043731726706027985, -0.01948406733572483, 0.03805961459875107, 0.052792370319366455, -0.014966023154556751, -0.047095704823732376, -0.055640701204538345, -0.02306903712451458, -0.028606098145246506, -0.0005402009701356292, 0.007188356481492519, -0.0005670575774274766, 0.025143900886178017, 0.0543147549033165, 0.0036218021996319294, -0.008815097622573376, 0.015972761437296867, 0.015800878405570984, 0.026469849050045013, -0.007974103093147278, 0.021509820595383644, -0.015088795684278011, 0.01587454229593277, 0.0590292364358902, -0.0490846261382103, -0.016046425327658653, 0.005153394769877195, 0.007126969750970602, 0.025733212009072304, 0.023363692685961723, 0.00030616504955105484, 0.028385106474161148, 0.017028609290719032, -0.007249742746353149, 0.015849988907575607, -0.02939184568822384, 0.0253157839179039, -0.00038539196248166263, 0.030816011130809784, 0.03904179856181145, 0.025855984538793564, 0.012528980150818825, -0.010521641932427883, 0.05298880860209465, -0.04122715815901756, -0.0003940244496334344, -0.02395300380885601, 0.006562214344739914, -0.05721219629049301, 0.01010421384125948, 0.0324857234954834, 0.01589909754693508, 0.022983096539974213, -0.04989492893218994, -0.08206143975257874, 0.011823035776615143, 0.030840566381812096, -0.032927706837654114, 0.02926907129585743, 0.030987894162535667, -0.04987037554383278, 0.0056199319660663605, -0.01921396702528, -0.008409947156906128, 0.0037599217612296343, 0.012473732233047485, -0.03712654113769531, 0.014548595063388348, -0.031577203422784805, -0.001783277140930295, 0.02468964084982872, -0.00713310856372118, 0.01925079897046089, 0.029956601560115814, -0.03334513306617737, -0.002469270955771208, 0.025512220337986946, -0.0518592968583107, -0.006832314655184746, -0.027255596593022346, -0.0016006523510441184, 0.05991320312023163, -0.01388562098145485, 0.01141788437962532, -0.03511306643486023, -0.07685586810112, -0.02321636490523815, -0.02742747776210308, -0.06384193897247314, 0.06781978160142899, 0.02122744359076023, 0.07503882795572281, -0.013848789036273956, 0.031454429030418396, 0.016954945400357246, -0.007010335568338633, -0.0014656020794063807, -0.029367290437221527, 0.010343621484935284, -0.004533391445875168, -0.01085926778614521, -0.024530036374926567, 0.03314869850873947, 0.0017310986295342445, -0.011780064553022385, 0.0022114478051662445, 0.012068581767380238, 0.011430162005126476, -0.021890416741371155, -0.025978757068514824, 0.025008849799633026, -0.03376256301999092, -0.011878283694386482, 0.010828574188053608, -0.0406869575381279, -0.0029833826702088118, 0.01912802644073963, -0.03486751765012741, 0.044959455728530884, -0.019766446202993393, -0.06285975128412247, -0.0028299165423959494, 0.01573949307203293, -0.03273126855492592, -0.0026488264556974173, 0.03538316488265991, -0.012528980150818825, 0.04225844889879227, 0.04950205609202385, 0.010761049576103687, 0.018919311463832855, -0.0056199319660663605, -0.024652808904647827, 0.010675108060240746, -0.02592964842915535, -0.002151596127077937, -0.023032207041978836, 0.020147042348980904, -0.01786346547305584, 0.014892359264194965, 0.001823178376071155, 0.014450376853346825, 0.05058245733380318, -0.018514161929488182, -0.024370431900024414, 0.010644415393471718, 0.008305590599775314, 0.008342422544956207, 0.003351701656356454, 0.018452774733304977, 0.022123686969280243, 0.014720477163791656, 0.003950219601392746, 0.042626768350601196, -0.011503825895488262, -0.004079131409525871, 0.001675850828178227, -0.0017756038578227162, -0.041374485939741135, -0.001766395871527493, -0.004926264751702547, 0.0028053619898855686, -0.0006905978661961854, 0.020527638494968414, 0.028753425925970078, 0.014192553237080574, -0.011055704206228256, -0.0065437983721494675, 0.019668227061629295, -0.013910175301134586, 0.013689184561371803, -0.01625513844192028, -0.008084598928689957, 0.00838539283722639, 0.026617176830768585, -0.023670624941587448, -0.003532791743054986, -0.014990577474236488, 0.029440954327583313, 0.04601530358195305, -0.002797688590362668, -0.0007957221823744476, 0.007679448463022709, 0.031233439221978188, 0.0017771385610103607, 0.05028780177235603, -0.019201690331101418, 0.041104383766651154, -0.007034890353679657, -0.0031614035833626986, -0.011387191712856293, 0.02022070623934269, -0.00801093503832817, 0.02715737745165825, 0.01598503813147545, 0.035800594836473465, 0.0024738749489188194, -0.01872287504374981, 0.02069951966404915, 0.04876541718840599, -0.029416399076581, -0.008250342682003975, -0.0025245188735425472, 0.0045978473499417305, 0.015714937821030617, -0.0050428989343345165, 8.04258743301034e-05, -0.005322207696735859, -0.027623914182186127, 0.00348675181157887, -0.0029803134966641665, -0.047071151435375214, 0.010257679969072342, 0.00729271350428462, -0.01278066448867321, 0.030496802181005478, 0.02789401449263096, -0.014082057401537895, 0.0124000683426857, -0.024419540539383888, 0.009122030809521675, 0.014045225456357002, 0.0029189269989728928, 0.010251541621983051, -0.039876654744148254, 0.0008762919460423291, -0.020503083243966103, -0.0602569654583931, 0.026027865707874298, -0.002925065578892827, 0.011227586306631565, -0.057997941970825195, 0.006500828079879284, 0.05819438025355339, -0.02319181151688099, -0.022627055644989014, 0.04441925510764122, 0.0028068965766578913, 0.003146057017147541, 0.014462653547525406, -0.006077261175960302, -0.04451747238636017, 0.005791814066469669, -0.013799680396914482, -0.010564612224698067, -0.04456658288836479, -0.040490519255399704, -0.01284205075353384, -0.02718193270266056, -0.044468365609645844, 0.017691582441329956, 0.0981692522764206, -0.019287630915641785, -0.013517302460968494, 0.0012776060029864311, 0.024247657507658005, -0.002596647944301367, 0.0015500085428357124, 0.006617462262511253, -0.037912286818027496, -0.015788601711392403, -0.0077899438329041, 0.009570151567459106, -0.031847305595874786, 0.022663887590169907, 0.043731726706027985, -0.001071194070391357, -0.01984011009335518, 0.023412803187966347, 0.01271927822381258, 0.0004910918069072068, -0.007851330563426018, -0.014438099227845669, 0.026224302127957344, 0.02755025029182434, 0.003416157327592373, -0.010085797868669033, 0.01625513844192028, 0.007734695915132761, -0.018894758075475693, 0.02084684744477272, 0.0006802388816140592, -0.009306189604103565, -0.003456058679148555, -0.04601530358195305, -0.015420283190906048, 0.00539894076064229, 0.003502098610624671, -0.0009860203135758638, 0.013492747209966183, -0.022651610895991325, -0.01947179064154625, -0.010957485996186733, -0.05917656421661377, 0.025364892557263374, 0.012964824214577675, 0.019422682002186775, 0.01079788152128458, 0.016218306496739388, 0.02678905799984932, -0.02133793942630291, 0.04078517481684685, 0.00992619339376688, -0.006276767235249281, 0.0209573432803154, 0.02752569690346718, -0.0018584756180644035, -0.007268158718943596, 0.00867390912026167, -0.0038581399712711573, -0.01774069108068943, -0.0199874360114336, 0.04491034522652626, -0.01887020282447338, -0.014278494752943516, -0.06556075811386108, 0.06276153028011322, 0.07651210576295853, -0.013296310789883137, 0.002366448752582073, -0.002387933898717165, 0.0227007195353508, 0.008851929567754269, -0.00899925734847784, -0.02619974873960018, -0.026764504611492157, 0.03661089390516281, 0.02493518777191639, -0.0050490377470850945, -0.003996259532868862, -0.0022989236749708652, -0.0103006511926651, -0.0104786716401577, -0.04505767300724983, -0.009913915768265724, -0.022897155955433846, 0.0024293698370456696, -0.028876198455691338, -0.008489749394357204, -0.010098075494170189, 0.0044720047153532505, 0.04773412272334099, -0.029612837359309196, -0.006666571367532015, 0.027231041342020035, -0.002527588279917836, 0.013603243045508862, -0.015027409419417381, -0.010134907439351082, -0.014978300780057907, 0.0413990393280983, 0.03101244755089283, -0.007433902472257614, -0.0055831000208854675, 0.016451576724648476, -0.02457914501428604, -0.006335084326565266, 0.019312186166644096, -0.029858382418751717, -0.0024032804649323225, 0.025708656758069992, -0.0019520899513736367, 0.016439298167824745, 0.013996116816997528, 0.006292114034295082, 0.004886363632977009, -0.032804932445287704, 0.014904636889696121, -0.042233895510435104, -0.05578802898526192, 0.031208883970975876, -0.014438099227845669, 0.01564127393066883, -0.010503225959837437, -0.030938783660531044, 0.006740235257893801, 0.0003220871731173247, -0.007882023230195045, -0.0037292283959686756, -0.01322264689952135, 0.016218306496739388, -0.022676164284348488, 0.002777738030999899, -0.000310193543555215, 0.008336283266544342, -0.012203631922602654, 0.01359096635133028, 0.033811669796705246, 0.010939070023596287, -0.014094335027039051, 0.0038397242315113544, -0.02742747776210308, 0.007102415431290865, -0.0007872815476730466, -0.012989378534257412, 0.0018262476660311222, 0.0612882599234581, -0.018698321655392647, 0.008373115211725235, 0.022492004558444023, -0.005997458938509226, -0.012621060013771057, -0.016476130113005638, -0.03224017843604088, -0.00035546606522984803, 0.034548308700323105, 0.010988179594278336, 0.04753768816590309, -0.05397098883986473, 0.0352603904902935, -0.02395300380885601, 0.010233125649392605, 0.00160525634419173, -0.0011226051719859242, 0.024603700265288353, -0.031699977815151215, 0.002719420939683914, -0.006660432554781437, -0.015039687044918537, 0.01278066448867321, -0.0035481383092701435, -0.025512220337986946, -0.0031076904851943254, -0.019926050677895546, -0.002088674809783697, 0.013185814954340458, -0.0040883393958210945, 0.00707172229886055, -0.013554134406149387, 0.007857468910515308, -0.08324006199836731, 0.011724816635251045, 0.03808417171239853, -0.04029408469796181, -0.0059360722079873085, -0.018391389399766922, -0.017691582441329956, 0.023768844082951546, -0.06403837352991104, 0.00020372637663967907, 0.017654750496149063, -0.009263219311833382, -0.0027378369122743607, -0.028360553085803986, 0.04635906592011452, 0.011773926205933094, -0.012265018187463284, -0.009257080964744091, 0.027476586401462555, -0.0032718991860747337, 0.01650068536400795, 0.01545711513608694, -0.05485495552420616, 0.01202561054378748, -0.02642074041068554, 0.011700262315571308, -0.02804134227335453, 0.04343707114458084, 0.05028780177235603, -0.019889218732714653, -0.004143587313592434, -0.005383593961596489, 0.034179989248514175, 0.00029235309921205044, -0.03904179856181145, 0.02917085401713848, -0.009361437521874905, 0.03155265003442764, -0.004849531687796116, -0.013492747209966183, 0.02976016327738762, -0.04019586369395256, 0.03388533368706703, 0.003146057017147541, 0.015714937821030617, 0.020638134330511093, -0.011810758151113987, -0.010079659521579742, 0.003716951236128807, 0.0035604157019406557, 0.006500828079879284, 0.027992233633995056, -0.03174908459186554, -0.0037691297475248575, 0.051171768456697464, 0.06452946364879608, -0.03607069328427315, -0.0035972476471215487, 0.026248857378959656, 0.0028022925835102797, -0.004613193683326244, 0.00949648767709732, -0.011012733913958073, -0.0074891503900289536, -0.0022175863850861788, -0.009564013220369816, -0.0083792544901371, 0.018182674422860146, -0.008281035348773003, -0.01519929151982069, -0.05122087523341179, 0.023609239608049393, -0.013750570826232433, -0.00461626285687089, -0.017888018861413002, 0.00308620510622859, 0.017531977966427803, 0.0015323599800467491, -0.002447785809636116, 0.028704317286610603, 0.028974417597055435, -0.012584228068590164, 0.029711054638028145, 0.027599360793828964, -0.05009136348962784, 0.02136249467730522, 0.017458314076066017, -0.01458542700856924, 0.0025107068940997124, -0.0024170924443751574, 0.02046625129878521, 0.0007911182474344969, -0.006801621522754431, -0.001856940914876759, -0.029097190126776695, -0.009963025338947773, -0.02493518777191639, 0.022283291444182396, 0.011387191712856293, -0.003535861149430275, 0.025487665086984634, 0.028213225305080414, -0.014745031483471394, -0.0083792544901371, 0.0005847061984241009, 0.011651153676211834, -0.035186730325222015, -0.024038944393396378, 0.023118147626519203, 0.010509365238249302, -0.005380524788051844, 0.0027163515333086252, 0.00832400657236576, 0.03936100751161575, -0.011387191712856293, 0.01030678953975439, 0.07449863106012344, -0.013455916196107864, -0.029121745377779007, -0.013075319118797779, -0.014180276542901993, 0.026248857378959656, 0.0034376427065581083, 0.017544254660606384, -0.012792942114174366, 0.040269527584314346, -0.06408748030662537, -0.009189555421471596, -0.0019183274125680327, 0.016783062368631363, 0.004579431377351284, 0.0459170863032341, -0.03189641237258911, 0.04984581843018532, -0.033787116408348083, 0.008667770773172379, 0.04179191216826439, -0.035039402544498444, 0.011804619804024696, -0.04618718475103378, -0.010644415393471718, -0.024628253653645515, 0.02058902382850647, -0.013934730552136898, -0.04095705598592758, -0.018943866714835167, 0.017937129363417625, -0.012007194571197033, 0.019999714568257332, -0.004984581843018532, 0.01760564185678959, -0.01526067778468132, -0.0021899626590311527, 0.027844905853271484, -0.015690382570028305, 0.023498743772506714, -0.028876198455691338, -0.005312999710440636, -0.02914629876613617, 0.005085869692265987, 0.0029465509578585625, 0.07651210576295853, -0.004183488432317972, -0.0132717564702034, -0.0038335854187607765, -0.029318181797862053, -0.015223845839500427, -0.04353528842329979, -0.024849245324730873, 0.058390818536281586, -0.011319666169583797, 0.02209913171827793, 0.0065437983721494675, -0.019312186166644096, -0.005021413788199425, 0.0053037917241454124, 0.009803419932723045, -0.03327146917581558, -0.007851330563426018, 0.01785118691623211, -0.01316126063466072, 0.012111552059650421, 0.02196408063173294, -0.010030549950897694, -0.007262020371854305, -0.0033118005376309156, 0.006991919595748186, 0.03189641237258911, -0.020306646823883057, 0.00740934768691659, 0.009754311293363571, -0.0031951661221683025, 0.0007374050328508019, 0.056622885167598724, 0.02222190424799919, 0.04203746095299721, 0.02144843526184559, 0.024714196100831032, -0.02715737745165825, -0.005309930071234703, -0.016304248943924904, 0.01004896592348814, -0.011319666169583797, -0.026518957689404488, 0.010466394014656544, 0.05672110617160797, -0.012915714643895626, -0.04034319147467613, -0.03076690249145031, 0.02034347876906395, -0.011823035776615143, -0.008268758654594421, -0.0049508195370435715, 0.0023418942000716925, 0.0070839994587004185, -0.005254682619124651, -0.0590292364358902, 0.014315326698124409, -0.008508165366947651, -0.010220848023891449, 0.0038796253502368927, -0.0016190683236345649, -0.027476586401462555, 0.01109253615140915, 0.008145985193550587, 0.026739949360489845, -0.018649211153388023, 0.017212769016623497, 0.024284489452838898, 0.010816297493875027, 0.02259022369980812, 0.018403666093945503, -0.031675420701503754, -0.010226987302303314, 0.041521813720464706, -0.028311442583799362, -0.004852600861340761, -0.006353500299155712, 0.023879339918494225, -0.001675850828178227, 0.01452404074370861, 0.02867976203560829, -0.019287630915641785, -0.019078917801380157, 0.04080972820520401, 0.003244275227189064, 0.027476586401462555, 0.03855070844292641, -0.0005731962155550718, 0.007986380718648434, 0.02791856974363327, 0.033566124737262726, 0.005696665029972792, 0.010061243548989296, 0.03386078029870987, -0.03437642753124237, 0.021522099152207375, 0.026617176830768585, -0.009533319622278214, 0.01650068536400795, -0.005641417112201452, -0.00021638732869178057, 0.01936129480600357, 0.004398341290652752, -0.004023883491754532, -0.03960655629634857, 0.010619860142469406, -0.006031221244484186, 0.04712025821208954, 0.018514161929488182, -0.005629139952361584, 0.009134307503700256, -0.020662687718868256, -0.0034468506928533316, -0.0132717564702034, -0.021730812266469002, -0.0076855868101119995, -0.029244517907500267, -0.030324919149279594, -0.0008348560659214854, -0.06359639018774033, 0.00512270163744688, -0.015358896926045418, -0.045720648020505905, 0.03238750621676445, -0.0027025395538657904, -0.0006177014438435435, -0.03761763125658035, 0.03609524667263031, 0.03511306643486023, 0.011135506443679333, 0.044959455728530884, 0.01651296205818653, -0.001608325750567019, 0.013848789036273956, -0.010055105201900005, -0.006568353157490492, 0.010503225959837437, -0.004407548811286688, -0.007403209339827299, -0.011577489785850048, -0.006549937184900045, 4.126801650272682e-05, -0.004039230290800333, -0.028262333944439888, -0.014560872688889503, 0.00043430933146737516, -0.010840851813554764, 0.02840966172516346, 0.003052442567422986, -0.0528905875980854, -0.015702661126852036, 0.03909090906381607, 0.0035143757704645395, 0.02681361325085163, 0.00824420340359211, -0.0441737100481987, -0.016083257272839546, -0.034548308700323105, 0.013148983009159565, -0.0047144815325737, 0.016660289838910103, 0.0017986238235607743, -0.02073635160923004, 0.009827975183725357, -0.029858382418751717, 0.0002023835404543206, 0.005945280194282532, 0.027378369122743607, -0.0008149055065587163, 0.0518592968583107, 0.024886077269911766, 0.003363979049026966, 0.01185372844338417, -0.046236295253038406, 0.011080259457230568, -0.03697921335697174, -0.019938327372074127, -0.004401410464197397, -0.04184102267026901, -9.097667498281226e-05, -0.008188956417143345, 0.012964824214577675, 0.03039858303964138, 0.016463853418827057, -0.0024201618507504463, 0.015408005565404892, 0.005098146852105856, 0.00557696120813489, 0.03862437233328819, 0.05686843395233154, 0.0167585089802742, -0.019287630915641785, -0.0046899267472326756, -0.00911589153110981, 0.006881424225866795, 0.015346619300544262, -0.014180276542901993, -0.0014970627380535007, -0.036021582782268524, -0.016439298167824745, 0.045450545847415924, 0.00905450526624918, -0.007120831403881311, 0.02405122108757496, -0.02715737745165825, -0.002387933898717165, 0.006022013258188963, 0.030447691679000854, -0.03260849788784981, 0.023351415991783142, 0.047095704823732376, -0.01488008163869381, -0.02926907129585743, -0.012707000598311424, -0.007808359805494547, 0.031454429030418396, -0.05858725309371948, 0.035284947603940964, 0.06448035687208176, 0.008145985193550587, -0.04753768816590309, 0.0031491261906921864, -0.00713310856372118, -0.020883679389953613, -0.005362108815461397, 0.001390403718687594, -0.0065069664269685745, -0.022123686969280243, -0.01271927822381258, 0.014806418679654598, 0.00794341042637825, -0.019054362550377846, 0.013541856780648232, 0.008637077175080776, 0.015960484743118286, 0.019312186166644096, -0.024149440228939056, 0.01235095877200365, 0.0264452937990427, 0.03165086731314659, -0.01589909754693508, 0.006967365276068449, -0.032829489558935165, -0.03302592411637306, -0.009631537832319736, 0.018956143409013748, 0.05210484191775322, 0.009625399485230446, 0.02605242095887661, -0.011546796187758446, 0.0009798816172406077, 0.0007389397360384464, 0.02384250797331333, -0.020503083243966103, -0.07042256742715836, 0.02541400119662285, -0.014082057401537895, -0.013627798296511173, 0.054020099341869354, -0.010761049576103687, 0.002908184425905347, 0.0040208143182098866, -0.006353500299155712, -0.003351701656356454, -0.003716951236128807, -0.004232597537338734, -0.011810758151113987, 0.028974417597055435, 0.021153779700398445, 0.016341080889105797, -0.00838539283722639, -0.013026210479438305, -0.008452917449176311, -0.029342735186219215, -0.01388562098145485, 0.013284033164381981, 0.004214181564748287, -0.03302592411637306, 0.009778865613043308, 0.023363692685961723, -0.004051507450640202, -0.011080259457230568, -0.00076042499858886, -0.010441839694976807, 0.030472246930003166, 0.010466394014656544, -0.011264418251812458, 0.005282306112349033, -0.0005114260711707175, -0.017298709601163864, -0.009692925028502941, -0.017888018861413002, 0.01836683414876461, -0.0002697168383747339, 0.015923652797937393, -0.024296768009662628, -0.023375971242785454, 0.00713310856372118, 0.008158262819051743, -0.012621060013771057, 0.012074720114469528, -0.0003629475540947169, 0.008152124471962452, 8.440640158369206e-06, -0.008158262819051743, -0.016942666843533516, 0.03857526183128357, -0.02580687403678894, -0.036144357174634933, 0.030938783660531044, 0.015788601711392403, 0.002592043951153755, -0.003284176578745246, -0.014352158643305302, 0.020245259627699852, 0.036660004407167435, -0.011086397804319859, -0.009146585129201412, 0.009723617695271969, 0.021988635882735252, 0.02096961997449398, 0.046850159764289856, -0.04405093565583229, 0.006009736098349094, 0.008686186745762825, -0.006068053189665079, -0.02681361325085163, 0.023044483736157417, -0.0021577347069978714, -0.0034806132316589355, 0.03643901273608208, 0.008581829257309437, -0.03413088247179985, -0.028213225305080414, -0.0025843707844614983, 0.0132717564702034, -0.031208883970975876, 0.014339881017804146, -0.0029235309921205044, -0.0009292378090322018, -0.005641417112201452, 0.006930533330887556, 0.00027834929642267525, -0.009588567540049553, -0.020785460248589516, 0.0011694123968482018, -0.0197296142578125, -0.03064412996172905, -0.002034961711615324, 0.025659548118710518, 0.0061539942398667336, -0.006623601075261831, 0.013996116816997528, 0.01091451570391655, 0.0295146182179451, 0.015002855099737644, 0.019631395116448402, 0.010319067165255547, 0.004607054870575666, 0.002311200834810734, 0.0099937180057168, 0.01772841438651085, -0.006341223139315844, 0.05362722650170326, 0.007863607257604599, 0.039778437465429306, -0.0026841238141059875, -0.002552142832428217, -0.023646071553230286, 0.012209770269691944, -0.0020748628303408623, -0.0025137763004750013, 0.01394700724631548, -0.022798936814069748, 0.004392202477902174, 0.010454117320477962, -0.010988179594278336, -0.028630653396248817, -0.016942666843533516, -0.013468192890286446, 0.00474824383854866, -0.0352603904902935, -0.01042342372238636, -0.004656164441257715, 0.014462653547525406, -0.002790015423670411, 0.006672710180282593, 0.004300122614949942, 0.024026667699217796, -0.029932046309113503, -0.001772534567862749, -0.03265760466456413, -0.02309359237551689, -0.0010550800943747163, 0.022258736193180084, -0.014082057401537895, -0.00862479954957962, 0.016427021473646164, -0.003142987610772252, 0.0018185743829235435, 0.003529722336679697, 0.008053905330598354, -0.014990577474236488, 0.026568066328763962, -0.0208591241389513, 0.03140532225370407, -0.02011021040380001, 0.0312579944729805, -0.02914629876613617, -0.0032657606061547995, 0.04351073503494263, 0.017274154350161552, -0.03845248743891716, -0.012479870580136776, 0.0041497256606817245, 0.0009384457371197641, 0.01636563427746296, -0.005098146852105856, 0.016844449564814568, 0.03410632535815239, -0.017188213765621185, 0.026150638237595558, 0.00778380548581481, -0.0174705907702446, -0.031429875642061234, -0.023781120777130127, 0.009158862754702568, 0.03314869850873947, -0.01388562098145485, -0.020024267956614494, 0.029932046309113503, -0.016304248943924904, 0.0029219964053481817, 0.014573149383068085, -0.021804476156830788, 0.0049446807242929935, -0.0062215193174779415, -0.007323406636714935, 0.015236123465001583, 0.022025467827916145, 0.014953745529055595, -0.016476130113005638, -0.03538316488265991, -0.004864878486841917, 0.004812699742615223, -0.008293312974274158, -0.024358153343200684, -0.010687385685741901, 0.00899311900138855, -0.022516559809446335, 0.004045368637889624, 0.010165601037442684, -0.011313527822494507, 0.027623914182186127, 0.0221850723028183, -0.037789516150951385, -0.03440098091959953, -0.01612008921802044, -0.0031583341769874096, -0.005002997815608978, -0.017040885984897614, -0.008471333421766758, 0.018158119171857834, -0.010343621484935284, 0.03452375531196594, 0.008747573010623455, -0.02294626459479332, 0.010085797868669033, -0.05009136348962784, -0.003324077697470784, 0.015665829181671143, -0.018317725509405136, 0.011749371886253357, -0.03459741920232773, 0.025340337306261063, 0.02219735085964203, -0.003962497226893902, 0.012154522351920605, -0.003109225071966648, 0.03253483399748802, -0.030619574710726738, 0.010675108060240746, -0.04321607947349548, 0.02144843526184559, 0.045475102961063385, 0.013701461255550385, -0.015469391830265522, -0.014008394442498684, 0.004505767486989498, -0.0065376595593988895, -0.006789344362914562, 0.05470762774348259, -0.022234182804822922, -0.008575690910220146, 0.024886077269911766, -0.001173249096609652, 0.029956601560115814, -0.04768501594662666, 0.03575148433446884, -0.0020625856705009937, -0.006691126152873039, 0.011933530680835247, 0.010392730124294758, -0.008158262819051743, -4.611179610947147e-05, 0.010656692087650299, -0.045106783509254456, -0.03398355469107628, 0.006249143276363611, 0.012013333849608898, 0.001438745530322194, 0.005386663135141134, -0.022123686969280243, 0.03756852447986603, -0.019263075664639473, -0.042749542742967606, -0.005801022052764893, 0.037175651639699936, -0.02057674713432789, 0.02297081984579563, -0.0064087482169270515, 0.010693524032831192, -0.009969163686037064, -0.005478742998093367, -0.0010980506194755435, 0.0036617033183574677, 0.009165001101791859, 0.0049753738567233086, -0.0021654078736901283, -0.04788145050406456, -0.024038944393396378, -0.009214109741151333, -0.0565737783908844, 0.013357697054743767, 0.028213225305080414, 0.0038121002726256847, -0.03278037905693054, -0.02516845613718033, 0.0027010049670934677, -0.025733212009072304, 0.03236294910311699, 0.02568410150706768, 0.011798480525612831, 0.010908377356827259, 0.006660432554781437, -0.013259478844702244, 0.01787574216723442, -0.006433303002268076, 0.02914629876613617, -0.022172795608639717, 0.009122030809521675, 0.020515359938144684, 0.014229385182261467, -0.033173251897096634, 0.004238736350089312, 0.003284176578745246, -0.004042299464344978, 0.013689184561371803, -0.026592621579766273, 0.0008095341618172824, -0.0021209027618169785, 0.010497087612748146, -0.032952260226011276, 0.005021413788199425, 0.011675707995891571, -0.020932788029313087, -0.0179862380027771, 0.00782677624374628, -0.03560415655374527, 0.04157092049717903, -0.0399748720228672, 0.037151094526052475, 0.0029127884190529585, 0.03521128371357918, -0.012424622662365437, -0.013247202150523663, -0.008330144919455051, 0.000690981512889266]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:34:52.576345", "url_path": "/agents/", "chunk_size": 2557}
updated_dt: 2025-03-16T00:34:52.577874
---
```
frompydantic_aiimport Agent, ModelRetry, UnexpectedModelBehavior, capture_run_messages
agent = Agent('openai:gpt-4o')

@agent.tool_plain
defcalc_volume(size: int) -> int: [](https://ai.pydantic.dev/agents/#__code_14_annotation_1)
  if size == 42:
    return size**3
  else:
    raise ModelRetry('Please try again.')

with capture_run_messages() as messages: [](https://ai.pydantic.dev/agents/#__code_14_annotation_2)
  try:
    result = agent.run_sync('Please get me the volume of a box with size 6.')
  except UnexpectedModelBehavior as e:
    print('An error occurred:', e)
    #> An error occurred: Tool exceeded max retries count of 1
    print('cause:', repr(e.__cause__))
    #> cause: ModelRetry('Please try again.')
    print('messages:', messages)
"""
    messages:
    [
      ModelRequest(
        parts=[
          UserPromptPart(
            content='Please get me the volume of a box with size 6.',
            timestamp=datetime.datetime(...),
            part_kind='user-prompt',
          )
        ],
        kind='request',
      ),
      ModelResponse(
        parts=[
          ToolCallPart(
            tool_name='calc_volume',
            args={'size': 6},
            tool_call_id=None,
            part_kind='tool-call',
          )
        ],
        model_name='gpt-4o',
        timestamp=datetime.datetime(...),
        kind='response',
      ),
      ModelRequest(
        parts=[
          RetryPromptPart(
            content='Please try again.',
            tool_name='calc_volume',
            tool_call_id=None,
            timestamp=datetime.datetime(...),
            part_kind='retry-prompt',
          )
        ],
        kind='request',
      ),
      ModelResponse(
        parts=[
          ToolCallPart(
            tool_name='calc_volume',
            args={'size': 6},
            tool_call_id=None,
            part_kind='tool-call',
          )
        ],
        model_name='gpt-4o',
        timestamp=datetime.datetime(...),
        kind='response',
      ),
    ]
    """
  else:
    print(result.data)

```

_(This example is complete, it can be run "as is")_
Note
If you call [`run`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run), [`run_sync`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run_sync), or [`run_stream`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.run_stream) more than once within a single `capture_run_messages` context, `messages` will represent the messages exchanged during the first call only.
© Pydantic Services Inc. 2024 to present