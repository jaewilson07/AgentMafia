---
url: https://ai.pydantic.dev/agents/
session_id: pydantic_ai_docs
chunk_number: 6
title: ModelRequestNode and CallToolsNode Streaming Process
summary: This code sample demonstrates the asynchronous execution of a main function that handles streaming requests and responses within a model, including tool calls for weather forecasts. The output consists of incremental updates on request parts and the final response from a tool call, showcasing the interaction between request and response nodes.
embedding: [-0.008612018078565598, 0.01881745085120201, 0.050888050347566605, -0.05260792374610901, -0.019841786473989487, 0.010268662124872208, -0.002699950011447072, 0.003313287626951933, 0.01360724214464426, 0.003736932994797826, -0.03148887678980827, -0.03836837410926819, -0.033309921622276306, -0.030957739800214767, 0.0011191830271854997, -0.020802892744541168, -0.014909793622791767, 0.057919301092624664, 0.0223583672195673, 0.05903216078877449, 0.04509612172842026, 0.006063822191208601, -0.028453804552555084, 0.016338806599378586, -0.014138380065560341, 0.01478333305567503, 0.02272510528564453, 0.047170087695121765, 0.02976900339126587, -0.035181548446416855, 0.004441955126821995, -0.005561138037592173, -0.05336669459939003, -0.04947168380022049, -0.017780466005206108, -0.015099486336112022, 0.025684300810098648, -0.00809985026717186, -0.01176090631633997, 0.035965610295534134, 0.004128963220864534, -0.05544066056609154, -0.007979711517691612, 0.04603193327784538, -0.04241513833403587, 0.007973388768732548, 0.019538279622793198, 0.0023015968035906553, -0.012633489444851875, 0.006164991296827793, -0.01981649547815323, 0.02751799114048481, -0.034498658031225204, -0.04294627532362938, 0.013354319147765636, -0.01454305648803711, 0.006016399245709181, 0.02984488010406494, 0.01669289916753769, -0.04049292579293251, 0.005633853375911713, -0.008770095184445381, 0.014125733636319637, 0.050888050347566605, -0.024419687688350677, 0.012329982593655586, -0.04125169292092323, 0.023572396486997604, -0.0655575692653656, 0.01865305006504059, -0.0006840769201517105, -0.002552938647568226, -0.05045808106660843, -0.003322772216051817, -0.032247647643089294, -0.024723194539546967, 0.03743256255984306, 0.0693008229136467, 0.006866851821541786, 0.009882954880595207, -0.005845676176249981, -0.021890461444854736, 0.015655916184186935, 0.021814584732055664, -0.010097939521074295, -0.03588973358273506, -0.054631307721138, -0.017704589292407036, -0.016806714236736298, -0.05336669459939003, -0.012589228339493275, -0.003240572288632393, -0.004555770196020603, 0.043173909187316895, 0.08144111186265945, 0.03513096645474434, 0.015870900824666023, -0.0034460718743503094, 0.030123095959424973, 0.05923449993133545, 0.040948186069726944, -0.03892480581998825, -0.07016076147556305, 0.04342683032155037, 0.026000455021858215, 0.022383660078048706, 0.01176090631633997, 0.025001410394906998, 0.005128007847815752, 0.012058090418577194, -0.08042941987514496, 0.020233817398548126, -0.018868034705519676, -0.00123299821279943, -0.07906363904476166, -0.014846563339233398, -0.05152035877108574, 0.038115452975034714, 0.011387845501303673, -0.039177726954221725, -0.013480780646204948, -0.00395191740244627, 0.031665924936532974, 0.02321830578148365, 0.017982805147767067, -0.015225947834551334, 0.00663289800286293, -0.02214338444173336, -0.053720783442258835, -0.022092798724770546, 0.040442343801259995, 0.009206387214362621, 0.037609606981277466, -0.0223583672195673, -0.0253555029630661, -0.05091334134340286, -0.011703998781740665, -0.00031220147502608597, -0.04021470993757248, 0.01881745085120201, 0.024217350408434868, -0.012557612732052803, -0.011703998781740665, 0.01444188691675663, -0.02224455215036869, 0.036243826150894165, -0.03553564101457596, 0.007031251676380634, -0.013518719002604485, 0.04818177595734596, 0.030173679813742638, 0.028453804552555084, -0.022472182288765907, -0.014897148124873638, -0.012633489444851875, -0.008612018078565598, 0.01053423061966896, 0.05630059540271759, 0.022763043642044067, -0.04803002253174782, -0.04213692247867584, 0.06105554476380348, -0.011552245356142521, -0.03920302167534828, -0.015188009478151798, 0.001868466497398913, -0.011533276177942753, 0.005959491245448589, -0.05144447833299637, -0.06429295241832733, 0.016326161101460457, -0.03814074397087097, -0.0018352704355493188, -0.01707228273153305, 0.03766019269824028, -0.03308229148387909, -0.08998990058898926, -0.019399171695113182, 4.663262370740995e-05, 0.004116317257285118, -0.0003088423400186002, -0.021232862025499344, -0.08103644102811813, -0.020334986969828606, -0.03052777238190174, -0.01931064948439598, -0.04109993949532509, 0.010312923230230808, -0.001306503894738853, 0.0192094799131155, 0.02987017296254635, 0.01786899007856846, 0.030274849385023117, -0.0024106695782393217, -0.026885684579610825, -0.009611062705516815, 0.043654460459947586, -0.009503571316599846, -0.019260065630078316, 0.033790472894907, 0.025899285450577736, 0.039177726954221725, 0.039278898388147354, -0.0073537277057766914, 0.015238593332469463, -0.06702452152967453, -0.0075181275606155396, 0.037533730268478394, -0.04117581620812416, -0.006860528606921434, -0.014277487061917782, -0.0246726106852293, 0.021814584732055664, -0.023875903338193893, -0.02928845025599003, 0.004783400800079107, -0.05483364313840866, -0.008087203837931156, -0.0003489543159957975, 0.046790700405836105, -0.002579811727628112, 0.006139698904007673, 0.03710376098752022, -0.030780693516135216, -0.0008038199739530683, 0.007530773989856243, -0.00016430096002295613, -0.01697111502289772, 0.009143155999481678, 0.04476732015609741, 0.023243596777319908, 0.017679298296570778, -0.017818404361605644, -0.019373880699276924, 0.021409908309578896, -0.04304744675755501, 0.025886639952659607, 0.013493427075445652, 0.0034998180344700813, -0.04165637120604515, -0.011052723042666912, -0.010761861689388752, -0.01621234603226185, 0.020461447536945343, 0.004650616552680731, 0.008460264652967453, -0.00524498475715518, -0.031185369938611984, 0.02128344587981701, 0.0312359556555748, 0.05250675603747368, -0.03685083985328674, -0.02721448428928852, -0.03540917858481407, -0.011432106606662273, -0.02526697888970375, 0.0011002138489857316, 0.02186516858637333, -0.04137815535068512, -0.006892143748700619, 0.027947960421442986, 0.01826101914048195, -0.04066997393965721, -0.0030145226046442986, 0.0063325525261461735, -0.001342071103863418, -0.02272510528564453, 0.007075512781739235, 0.007815311662852764, -0.06287658959627151, 0.03373989090323448, 0.02010735496878624, 0.016528500244021416, -0.035383887588977814, -0.03743256255984306, 0.022168675437569618, 0.04428676888346672, 0.03394223004579544, -0.023458581417798996, -0.017717236652970314, -0.009383432567119598, -0.0014709036331623793, 0.03667379543185234, 0.013999272137880325, 0.012285720556974411, -0.00407205568626523, 0.003828617511317134, 0.021890461444854736, 0.01903243362903595, 0.0017230359371751547, 0.022876858711242676, 0.025431379675865173, 0.030881863087415695, -0.02340799756348133, 0.0327787846326828, 0.004928831476718187, 0.025431379675865173, 0.028605559840798378, -0.010812446475028992, -0.028706727549433708, 0.02223190665245056, 0.009471955709159374, -0.004552608821541071, -0.013771641999483109, 0.010698630474507809, 0.04287039861083031, 0.012892735190689564, -0.005643337965011597, 0.0312359556555748, -0.016427330672740936, 0.016528500244021416, 0.04274393990635872, -0.028023837134242058, -0.007739434950053692, -0.016224991530179977, -0.0037306100130081177, 0.040948186069726944, -0.017970159649848938, 0.0679350420832634, 0.023155074566602707, -0.0250899326056242, -0.03384105861186981, 0.020448802039027214, 0.011084337718784809, -0.017211390659213066, -0.0054631307721138, 0.03745785355567932, -0.004644293338060379, -0.024052949622273445, -0.004742301069200039, -0.015858253464102745, -0.032627031207084656, -0.013822226785123348, 0.05726170167326927, 0.015731792896986008, -0.010433061979711056, -0.046310149133205414, -0.0016060592606663704, -0.003351225983351469, 0.08169403672218323, -0.011299322359263897, 0.01794486679136753, -0.0727405697107315, -0.029389619827270508, -0.01181149110198021, 0.02479907125234604, 0.010458353906869888, 0.041808124631643295, 0.0076445890590548515, 0.01497302483767271, 0.043856799602508545, -0.007252559065818787, -0.010135877877473831, 0.0394306518137455, -0.019854433834552765, 0.006051175761967897, 0.01891861855983734, 0.007840604521334171, -0.037710778415203094, -0.009231679141521454, -0.05958859249949455, 0.02204221487045288, 0.038393668830394745, -0.0035282718017697334, -0.02516580931842327, 0.016351453959941864, -0.036547333002090454, -0.03659791499376297, -0.054783061146736145, 0.021005231887102127, 0.050685711205005646, 0.015769731253385544, -0.018273666501045227, -0.024267934262752533, -0.026303961873054504, 0.004081540275365114, -0.02156166173517704, 0.01195059809833765, -0.001361830742098391, 0.004100509453564882, 0.060246191918849945, 0.017224036157131195, 0.006822590250521898, 0.011204476468265057, 0.019639449194073677, 0.026683347299695015, -0.015390346758067608, 0.0176666509360075, -0.02792266756296158, -0.00281534600071609, 0.0327787846326828, -0.03179238364100456, -0.035763271152973175, 0.0036863486748188734, -0.011065368540585041, 0.018033389002084732, 0.0037559024058282375, 0.050609834492206573, 0.04438793659210205, 0.00867524929344654, -0.02536814846098423, 0.00921903271228075, -0.0464366115629673, 0.022206613793969154, -0.007258881814777851, 0.011286675930023193, 0.016022654250264168, 0.007397989276796579, 0.014467178843915462, 0.004543124232441187, 0.07521921396255493, -0.03637028485536575, 0.01891861855983734, -0.010243370197713375, -0.019980894401669502, -0.03217177093029022, 0.00493199285119772, 0.01181149110198021, 0.016945822164416313, 0.035763271152973175, -0.03014838695526123, -0.07623090595006943, 0.015542101114988327, -0.02369885891675949, -0.04598135128617287, 0.0556429959833622, 0.027947960421442986, -0.050002820789813995, -0.007214620243757963, -0.024242641404271126, 0.009301233105361462, -0.006651867181062698, 0.04135286435484886, -0.023142429068684578, -0.009275940246880054, 0.010211754590272903, 0.018754219636321068, 0.03454924374818802, 0.012165582738816738, -0.010957876220345497, 0.03219706192612648, -0.02711331471800804, -0.013834872283041477, 0.06697393208742142, -0.033309921622276306, -0.032449983060359955, -0.044059138745069504, 0.000660760619211942, 0.039961788803339005, -0.012987581081688404, -0.00775840412825346, -0.007549743168056011, -0.04613310471177101, 0.026000455021858215, 0.004385047592222691, -0.0314130000770092, 0.1027877926826477, -0.008491880260407925, 0.04266806319355965, 0.0036863486748188734, 0.023256244137883186, -0.020663786679506302, -0.01190633699297905, -0.0004422195488587022, -0.027442114427685738, 0.03619324043393135, 0.043553292751312256, 0.011653413996100426, -0.0433509536087513, -0.0029955534264445305, 0.0007793180993758142, -0.0036009871400892735, 0.037811946123838425, -0.019968248903751373, 0.021334031596779823, -0.011836783029139042, 0.034498658031225204, 0.0004066523106303066, 0.014340718276798725, -0.030325433239340782, 0.03932948037981987, -0.0022399467416107655, 0.02215602993965149, 0.03014838695526123, -0.02099258452653885, 0.0464366115629673, 0.029718419536948204, -0.04408442974090576, -0.042491015046834946, 0.012519674375653267, -0.02049938589334488, 0.014833916909992695, 0.05984151363372803, -0.013973980210721493, 0.048561159521341324, 0.006784651894122362, -0.012665105052292347, 0.027442114427685738, -0.0007986825075931847, -0.019664740189909935, -0.003281672252342105, -0.03844425082206726, -0.017628712579607964, 0.046689532697200775, -0.004615839570760727, 0.0030255878809839487, 0.03766019269824028, -0.01224145945161581, -0.018071327358484268, 0.04289569333195686, -0.06545639783143997, -0.005918391514569521, 0.01067966129630804, 0.00907992571592331, 0.0005437838262878358, 0.027062730863690376, 0.0030129419174045324, 0.007897512055933475, -0.01083141565322876, -0.005684438161551952, 0.02994604967534542, -0.03657262399792671, -0.01078083086758852, 0.009990447200834751, 0.019399171695113182, -0.016553791239857674, 0.00543783837929368, -0.0055864304304122925, -0.026683347299695015, -0.011476367712020874, 0.015251239761710167, 0.0028643496334552765, 0.005570622626692057, -0.0008670506649650633, -0.028833189979195595, 0.009244325570762157, -0.002883319044485688, -0.0008227892103604972, -0.038393668830394745, -0.00799868069589138, -0.005153300240635872, 0.01463157869875431, -0.040265295654535294, 0.007347404956817627, -0.004619000945240259, -0.005833030212670565, 0.03745785355567932, -0.005090069491416216, 0.002715757582336664, -0.02009470947086811, 0.02224455215036869, -0.000650485628284514, 0.011052723042666912, -0.038115452975034714, 0.025684300810098648, 0.007328435778617859, -0.004704362712800503, -0.003389164339751005, 0.0011966405436396599, -0.007037574425339699, -0.0023679889272898436, 0.0010693888179957867, 0.021877814084291458, 0.013683118857443333, -0.014037210494279861, 0.04896583780646324, 0.03250056877732277, -0.0038570715114474297, -0.047574762254953384, -0.013695765286684036, -0.003218441503122449, 0.023370059207081795, 0.00026734720449894667, -0.024659965187311172, 0.005406223237514496, -0.012133967131376266, 0.021334031596779823, -0.004815016407519579, -0.030123095959424973, 0.045526087284088135, 0.011457398533821106, -0.02380002662539482, 0.02868143655359745, 0.014239548705518246, -0.021106401458382607, -0.011526952497661114, -0.026405131444334984, 0.028833189979195595, -0.006424237042665482, -0.00397404795512557, 0.017122868448495865, -0.0245840884745121, 0.005839352961629629, 0.0014598382404074073, -0.06019560620188713, 0.03895009681582451, 0.008896556682884693, 0.0004995223716832697, -0.04056880250573158, -0.0010662273271009326, 0.03609207272529602, -0.03571268916130066, -0.02311713621020317, 0.05377136915922165, -0.01871628127992153, 0.005545330699533224, 0.0246726106852293, 0.00790383480489254, -0.025317564606666565, -0.01942446455359459, -0.001975958701223135, -0.03318345919251442, -0.02106846123933792, -0.02906082011759281, -0.018981849774718285, 0.010938907042145729, -0.03710376098752022, -0.0017309398390352726, 0.06849147379398346, -0.009478278458118439, 0.0041131554171442986, 0.010167493484914303, -0.0042396169155836105, -0.0019174703629687428, 0.003338579786941409, -0.017337851226329803, -0.03973415866494179, -0.02281362935900688, -0.012285720556974411, 0.02077760174870491, -0.008042942732572556, 0.026025747880339622, 0.0411505252122879, 0.01140681467950344, -0.027770914137363434, 0.0027299844659864902, 0.00668348278850317, -0.006974343676120043, 0.011887367814779282, -0.03755902126431465, 0.032753489911556244, 0.01686994545161724, 0.019879724830389023, -0.03217177093029022, -0.019677387550473213, 0.004508347250521183, -0.01747695915400982, 0.004053086508065462, 0.03452394902706146, -0.016515852883458138, -0.023079197853803635, -0.04104935750365257, -0.005772960837930441, 0.005959491245448589, 0.003338579786941409, -0.0003339370305184275, -0.00424277875572443, -0.011881044134497643, -0.020461447536945343, 0.012348951771855354, -0.0518997423350811, 0.028327343985438347, -0.010230723768472672, -0.004394532181322575, 0.0035093026235699654, 0.05270909518003464, 0.03237410634756088, 0.002663592342287302, 0.025406086817383766, 0.00692375935614109, -0.013746349141001701, 0.020727016031742096, 0.013569303788244724, 0.03852013126015663, 0.0019427626393735409, 0.0009658486233092844, 0.03831779211759567, -0.05159623548388481, -0.049522265791893005, 0.03872246667742729, -0.028757313266396523, 0.005444161593914032, -0.04562725871801376, 0.00013525437680073082, 0.03194413706660271, -0.04448910430073738, 0.019335942342877388, 0.021485785022377968, 0.00838438794016838, 0.03128654137253761, 0.003980371169745922, -0.010736568830907345, 0.0011381522053852677, -0.005507392343133688, -0.0008054007776081562, 0.040543511509895325, -0.007164035923779011, 0.006841559428721666, -0.012329982593655586, -0.06287658959627151, -0.004824500996619463, 0.025696948170661926, -0.006218737456947565, -0.0018747895956039429, -0.00893449503928423, -0.004154255613684654, -0.0017435859190300107, -0.009155802428722382, 0.010135877877473831, -0.0077520813792943954, -0.015352408401668072, 0.030376018956303596, -0.016617022454738617, 0.03318345919251442, -0.023875903338193893, -0.022206613793969154, 0.007916481234133244, 0.03738197684288025, 0.0013697345275431871, -0.021586954593658447, -0.021789291873574257, 0.0068794977851212025, -0.0266327615827322, 0.031008325517177582, 0.0038349407259374857, -0.015200654976069927, 0.003414456732571125, 0.04954756051301956, -0.010401446372270584, -0.0021103238686919212, -0.007973388768732548, 0.007322112563997507, -0.015529454685747623, -0.020537324249744415, -0.0055231996811926365, -0.011748259887099266, -0.04173224791884422, 0.016250284388661385, -0.014505118131637573, 0.011444753035902977, 0.019070371985435486, -0.0011073272908106446, -0.043098028749227524, 0.02683510072529316, 0.012519674375653267, -0.008428649045526981, -0.0031125301029533148, 0.019449757412075996, -0.026860391721129417, 0.0004548656870611012, -0.05306318402290344, 0.008991402573883533, 0.0005109829362481833, 0.00946563296020031, 0.03783723711967468, 0.014264841563999653, -0.020663786679506302, 0.009769139811396599, -0.0741063579916954, -0.004792885389178991, -0.03857071325182915, -0.0014400787185877562, -0.008555110543966293, 0.023926489055156708, -0.0021245507523417473, -0.0029323226772248745, -3.472747266641818e-05, -0.003095141611993313, -0.013202565722167492, 0.004811854567378759, -0.02417941205203533, -0.014871855266392231, -0.010641722939908504, 0.02253541350364685, 0.05210207775235176, -0.02847909741103649, 0.010945230722427368, -5.10785321239382e-05, 0.026658054441213608, 0.0009634774760343134, 0.04519728943705559, -0.013050812296569347, -0.01283582765609026, -0.0015143747441470623, 0.008827002719044685, -0.03674967214465141, 0.005191238597035408, -0.032930538058280945, -0.01961415633559227, -0.011621798388659954, -0.047675929963588715, 0.007575035095214844, 0.01224145945161581, 0.0049067004583776, 0.018766865134239197, 0.004852954763919115, 0.02369885891675949, -0.08837119489908218, 0.004748623818159103, 0.027012145146727562, -0.005061615724116564, 0.008586726151406765, -0.030679525807499886, -0.006557021290063858, 0.02605103887617588, -0.03601619601249695, -0.017527544870972633, 0.009762817062437534, 0.01705963723361492, -0.007619296666234732, -0.04694245755672455, 0.017540190368890762, -0.02908611297607422, 0.0056591457687318325, -0.015251239761710167, 0.03490333631634712, -0.006389460060745478, -0.005137492436915636, -0.004710685461759567, -0.05286084860563278, 0.0101991081610322, -0.01823572814464569, -0.009756493382155895, -0.007050220854580402, 0.04704362526535988, 0.029136696830391884, -0.024533502757549286, -0.03945594280958176, -0.017590774223208427, -0.00917477160692215, 0.006035368423908949, -0.043376244604587555, 0.05503598228096962, 0.003189987735822797, 0.028023837134242058, 0.003863394493237138, -0.010483646765351295, 0.011583860032260418, -0.017906928434967995, 0.043553292751312256, 0.05033161863684654, 0.012962289154529572, -0.009143155999481678, -0.015934130176901817, -0.014113087207078934, -0.021498430520296097, 0.008795387111604214, 0.005188077222555876, 0.03346167504787445, -0.011198152787983418, -0.0017878474900498986, 0.035459764301776886, 0.05397370830178261, -0.033815767616033554, 0.0035820179618895054, -0.022990675643086433, 0.04613310471177101, 0.0011808329727500677, 0.017135513946413994, -0.025494609028100967, -0.02008206397294998, -0.007360050920397043, -0.0022146545816212893, -0.013114042580127716, -0.011078014969825745, -0.025393441319465637, -0.025810763239860535, -0.01970267854630947, 0.019399171695113182, -0.010369831696152687, 0.010660692118108273, -0.0010701792780309916, -0.005406223237514496, 0.005169108044356108, 0.03910185024142265, -0.022383660078048706, 0.008744803257286549, 0.05822280794382095, -0.018488651141524315, 0.011552245356142521, 0.030907155945897102, -0.025734886527061462, 0.018324250355362892, -0.021308738738298416, -0.01972797140479088, -0.013885457068681717, 0.020347632467746735, 0.026910977438092232, -0.0024912888184189796, 0.0048403083346784115, -0.029414910823106766, -0.06495055556297302, 0.005083746742457151, -0.035485055297613144, 0.03513096645474434, 0.0061523448675870895, -0.003367033554241061, 0.022585999220609665, 0.011305645108222961, -0.006601282861083746, 0.03649674728512764, 0.01176090631633997, 0.05111568048596382, -0.007208297494798899, -0.010844061151146889, 0.002674657618626952, 0.029136696830391884, 0.0037527407985180616, -0.028023837134242058, -0.01391074899584055, 0.0293643269687891, -0.016945822164416313, 0.017198745161294937, 0.0826045572757721, -0.026708638295531273, -0.061106126755476, 0.018223080784082413, -0.005374607630074024, 0.016376744955778122, -0.004460924305021763, 0.0324246920645237, -0.017110221087932587, 0.01107169222086668, -0.022712459787726402, -0.00030745918047614396, -0.005251307971775532, 0.006383136846125126, 0.011451075784862041, 0.027391530573368073, -0.0036167947109788656, 0.027189191430807114, -0.03864658996462822, -0.014277487061917782, 0.043755628168582916, -0.041504617780447006, -0.0007516546756960452, -0.0168952364474535, -0.006607606075704098, 0.012766273692250252, 0.02125815488398075, -0.005118523258715868, -0.04436264559626579, -0.001987023977562785, 0.02186516858637333, -0.04618368670344353, 0.019475048407912254, 0.02068907767534256, 0.00852981861680746, -0.012797889299690723, 0.008997725322842598, 0.029541373252868652, -0.03202001750469208, 0.01492244005203247, -0.01676877588033676, -0.0450708270072937, -0.012974935583770275, -0.020701725035905838, -0.008118819445371628, 0.06156138703227043, -0.007397989276796579, -0.0009207967668771744, 0.031463585793972015, -0.02252276800572872, -0.021713415160775185, -0.01657908409833908, 0.0018747895956039429, 0.002190943108871579, 0.016553791239857674, -0.008080881088972092, -0.002012316370382905, 0.011198152787983418, 0.042288679629564285, 0.06070145219564438, 0.00389184826053679, 0.018463358283042908, -0.0055864304304122925, 0.028833189979195595, 0.011944275349378586, 0.030072510242462158, -0.010837738402187824, -0.02224455215036869, 0.030021926388144493, 0.007322112563997507, -0.0285043902695179, 0.04018941894173622, -0.01608588546514511, 0.011305645108222961, 0.0382419154047966, 0.005687599536031485, -0.00027801739634014666, 0.03588973358273506, -0.006664513610303402, 0.008118819445371628, 0.03558622673153877, 0.008871263824403286, -0.004018309526145458, 0.009566801600158215, 0.01102110743522644, 0.04964872822165489, -0.005371446255594492, -0.005314538720995188, 0.006262998562306166, 0.04451439902186394, -0.03191884607076645, -0.021890461444854736, 0.006104921922087669, 0.02906082011759281, -0.03014838695526123, 0.007524450775235891, -0.005697084125131369, 0.00404992513358593, 0.001904824166558683, 4.384158273751382e-06, -0.03386635333299637, 0.001271727029234171, -0.04491907358169556, 0.008871263824403286, -0.033512260764837265, -0.003126756986603141, 0.0164779145270586, 0.004252263344824314, 0.026910977438092232, 0.0009373947978019714, 0.03257644549012184, 0.03161533921957016, 0.030679525807499886, -0.009756493382155895, -0.0042206477373838425, 0.01697111502289772, -0.026126915588974953, -0.021498430520296097, 0.029642542824149132, -0.021346677094697952, 0.02020852454006672, -0.0027663421351462603, 0.024811718612909317, 0.012273075059056282, 0.010312923230230808, 0.021890461444854736, -0.02429322712123394, -0.013670472428202629, 0.0036768638528883457, 0.021220216527581215, 0.017148159444332123, 0.023268889635801315, 0.0012914866674691439, -0.022674521431326866, 0.0016266092425212264, 0.021549014374613762, 0.014758040197193623, -0.005507392343133688, 0.042693354189395905, 0.014302779920399189, 0.030376018956303596, 0.03895009681582451, -0.010907292366027832, 0.014075148850679398, -0.007214620243757963, 0.03609207272529602, 0.011489014141261578, 0.015175363048911095, -0.000334332202328369, -0.02077760174870491, -0.008523495867848396, 0.01628822274506092, 0.051849156618118286, 0.002072385512292385, -0.018210435286164284, 0.010723923332989216, -0.0018668858101591468, 0.030553063377738, -0.028529683127999306, 0.00794809591025114, -0.018311604857444763, -0.02555784024298191, -0.0037748715840280056, -0.024128826335072517, -0.03900068253278732, 0.0045020245015621185, -0.0051849158480763435, -0.05544066056609154, 0.024659965187311172, -0.020044125616550446, 0.00668348278850317, -0.06677159667015076, 0.000688424042891711, 0.01970267854630947, 0.027467407286167145, 0.040543511509895325, -0.0017862666863948107, -0.005728699266910553, 0.011507983319461346, 0.010900968685746193, 0.019841786473989487, 0.014163671992719173, -0.03358813747763634, -0.030907155945897102, 0.013796933926641941, -0.024811718612909317, -0.028125006705522537, 0.006455852184444666, -0.01341755036264658, 0.015124778263270855, 0.002723661484196782, -0.020739663392305374, 0.01862775720655918, 0.005706568714231253, -0.04684128612279892, -0.00037997684557922184, 0.022472182288765907, -0.008536141365766525, 0.004245940130203962, 0.01122976839542389, -0.031261246651411057, -0.010894645936787128, -0.019550925120711327, 0.005055292975157499, -0.016338806599378586, 0.013202565722167492, 0.011545921675860882, 0.004343947395682335, 0.01785634458065033, -0.03462512046098709, -0.02029704861342907, 0.000657599070109427, 0.003936109598726034, 0.00399934034794569, 0.044337350875139236, 0.004615839570760727, 0.0038033253513276577, 0.009111540392041206, -0.05083746463060379, -0.0012306270655244589, -0.06257308274507523, -0.005766638088971376, -0.008359096013009548, -0.0409734807908535, -0.01391074899584055, -0.00263513857498765, -0.0030967225320637226, 0.01580766960978508, 0.014884501695632935, 0.005965814460068941, -0.00804926548153162, 0.008137788623571396, 0.017122868448495865, 0.00034480480826459825, 0.06732802838087082, -0.01238689012825489, -0.03715434670448303, 0.015415639616549015, 0.01688259094953537, 0.018387481570243835, 0.018185142427682877, -0.006999636068940163, -0.01396133378148079, -0.018905973061919212, -0.006019560620188713, 0.0366990864276886, -6.851636862847954e-05, -0.009554155170917511, 0.020410863682627678, 0.009427694603800774, -0.004489378072321415, -0.0037148024421185255, 0.028529683127999306, 0.003433425910770893, 0.03798899054527283, 0.03588973358273506, -0.03328463062644005, -0.028276760131120682, 0.03447336703538895, 0.0015546843642368913, 0.014833916909992695, -0.050205159932374954, 0.032146476209163666, 0.056553520262241364, -0.007138743530958891, -0.03798899054527283, 0.0024407042656093836, -0.0009579447796568274, -0.0437050461769104, 0.009541509672999382, 0.020562617108225822, -0.011716645210981369, -0.0012661943910643458, 0.041024062782526016, 0.013164627365767956, -0.005899422336369753, 0.0043565938249230385, -0.007967065088450909, -0.015972068533301353, 0.015188009478151798, 0.02635454759001732, -0.011545921675860882, 0.022029569372534752, 0.024723194539546967, 0.014062503352761269, -0.011507983319461346, -0.004916185047477484, -0.012342628091573715, -0.013784287497401237, -0.03657262399792671, -0.004619000945240259, 0.048459991812705994, -0.0048308237455785275, 0.020120002329349518, -0.01502360962331295, 0.008555110543966293, -0.015946777537465096, 0.04261747747659683, 0.0075813583098351955, -0.04127698764204979, -0.005213369615375996, -0.0005686809308826923, -0.027593867853283882, 0.0556429959833622, -0.006715097930282354, -0.008839649148285389, 0.024128826335072517, -0.0037495791912078857, 0.010230723768472672, -0.0002325703389942646, 0.003338579786941409, -0.030300140380859375, 0.035864442586898804, -0.012899058870971203, 0.02352181263267994, -0.023736797273159027, -0.025772824883461, 0.011059045791625977, -0.03836837410926819, -0.003131499281153083, 0.020840831100940704, 0.0125449663028121, -0.02029704861342907, 0.036243826150894165, 0.00907992571592331, -0.005820383783429861, 0.01862775720655918, 0.01190001331269741, -0.006146022118628025, 0.007802665699273348, 0.010603784583508968, 0.016832007095217705, -0.02253541350364685, 0.0196268018335104, 0.0028501227498054504, -0.02906082011759281, -0.02632925473153591, 0.016326161101460457, -0.008605695329606533, 0.01668025366961956, -0.014188963919878006, -0.012026474811136723, -0.013101397082209587, 0.031185369938611984, 0.001304132747463882, -0.005602238234132528, 0.015668561682105064, 0.0030524609610438347, 0.001889016479253769, 0.01078083086758852, -0.05407487601041794, 0.03768548369407654, -0.011185507290065289, -0.04345212131738663, 0.02605103887617588, 0.009984124451875687, -0.0014424498658627272, -0.00012626376701518893, -0.0018020743736997247, 0.03315816819667816, 0.02926315739750862, -0.023673566058278084, -0.004053086508065462, -0.007511804811656475, -0.004805531352758408, 0.017881635576486588, 0.01865305006504059, -0.024065596982836723, -0.007846927270293236, -0.011609152890741825, 0.0005062406416982412, -0.01979120261967182, 0.005940522067248821, -0.02292744442820549, -0.002043931744992733, 0.036648500710725784, 0.005393576808273792, -0.038393668830394745, -0.0035440796054899693, -0.006379975471645594, -0.0018510781228542328, -0.01784369722008705, 0.0014748555840924382, 0.022573351860046387, -0.0027853113133460283, 0.0023189850617200136, 0.015099486336112022, 0.014366010203957558, 0.013544010929763317, -0.03573798015713692, -0.01137519907206297, -0.021713415160775185, -0.018286311998963356, -0.01200118288397789, 0.01823572814464569, -0.011685029603540897, -0.018476003780961037, 0.011881044134497643, 0.025292271748185158, -0.011078014969825745, 0.02137196995317936, 0.02994604967534542, 0.009611062705516815, 0.021549014374613762, 0.0109262615442276, 0.012949642725288868, 0.0010662273271009326, -0.0018226243555545807, 0.03872246667742729, -0.00848555751144886, 0.021726060658693314, -0.005422030575573444, -0.005036323331296444, -0.011153891682624817, -0.022282490506768227, 0.00044182437704876065, 0.003787517547607422, 0.0070691900327801704, -0.004571577999740839, 0.00834012683480978, -0.016654960811138153, -0.02292744442820549, -0.006313583347946405, -0.02350916713476181, -0.022371014580130577, -0.011691352352499962, -0.002024962566792965, -0.014884501695632935, 0.020069416612386703, 0.005750830285251141, -0.008972433395683765, 0.005361961666494608, 0.031665924936532974, 0.01087567675858736, -0.0211696308106184, 0.030072510242462158, -0.02906082011759281, -0.018273666501045227, -0.020701725035905838, 0.04185871034860611, 0.008808033540844917, 0.016958467662334442, 0.00012636255996767431, -0.016907883808016777, -0.011836783029139042, -0.006180798634886742, 0.009332847781479359, -0.008087203837931156, 0.030401309952139854, -0.015428286045789719, 0.01737578958272934, -0.0076445890590548515, -0.0007923594675958157, -0.04428676888346672, -0.019980894401669502, -0.0011903175618499517, 0.03189355507493019, -0.011887367814779282, 0.015402993187308311, -0.018286311998963356, 0.012469089590013027, 0.009876632131636143, 0.009294909425079823, 0.02382531948387623, 0.029516080394387245, 0.023382704704999924, 0.02018323354423046, -0.02498876489698887, -0.0021530045196413994, -0.05134331062436104, -0.022497475147247314, -0.0022525929380208254, 0.03588973358273506, -0.010768184438347816, -0.019538279622793198, 0.03356284275650978, -0.011242414824664593, 0.015491516329348087, 0.018779510632157326, -0.00281534600071609, 0.021637538447976112, 0.013923395425081253, -0.00931387860327959, 0.01420161034911871, 0.02224455215036869, 0.00433762464672327, -0.01718609780073166, -0.04451439902186394, 0.01942446455359459, -0.024659965187311172, -0.026582177728414536, -0.012582904659211636, 0.0009437178960070014, 0.03467570245265961, -0.02225719951093197, -0.010957876220345497, 0.006721421144902706, 0.00945930927991867, 0.017337851226329803, 0.04049292579293251, -0.0016123823588714004, -0.04676540940999985, -0.02546931803226471, -0.007322112563997507, 0.025229040533304214, -0.006082791369408369, -0.00404676329344511, 0.015276531688869, 0.027973251417279243, 0.01190633699297905, 0.04036646708846092, -0.04312332347035408, 0.03373989090323448, -0.020828185603022575, -0.017135513946413994, 0.018589818850159645, -0.018665695562958717, -0.01341755036264658, -0.03922831267118454, 0.029642542824149132, 0.008466588333249092, 0.03434690460562706, 0.015643270686268806, -0.010919937863945961, 0.022004276514053345, -0.004619000945240259, 0.03728080913424492, -0.041529908776283264, 0.0407964326441288, 0.003363872179761529, 0.01243747491389513, -0.008618341758847237, -0.01420161034911871, -0.011274030432105064, -0.0025561002548784018, -0.02029704861342907, 0.04749888554215431, -0.002714176895096898, -0.0218525230884552, 0.030477186664938927, 0.006146022118628025, 0.03103361651301384, -0.04036646708846092, 0.016553791239857674, 0.027947960421442986, -0.01043938472867012, -0.010572169907391071, -0.014694809913635254, -0.0031204340048134327, 0.02342064306139946, 0.009048310108482838, 0.0060796295292675495, -0.044438522309064865, 0.013758995570242405, 0.008763772435486317, 0.00033334424369968474, -0.0002517371322028339, -0.02096729353070259, 0.04011354222893715, 0.004520993679761887, -0.021245507523417473, 0.022383660078048706, 0.024533502757549286, -0.009876632131636143, 0.037811946123838425, 0.017122868448495865, 0.0491681769490242, 0.0077078198082745075, -0.006000591441988945, 0.005422030575573444, 0.005769799463450909, 0.0068162670359015465, 0.015238593332469463, -0.012899058870971203, -0.02799854427576065, -0.032930538058280945, -0.010907292366027832, 0.0002298039908055216, -0.008523495867848396, 0.02147313766181469, 0.0016076399479061365, -0.020954646170139313, -0.022206613793969154, 0.007846927270293236, 0.01688259094953537, 0.041327573359012604, 0.030376018956303596, -0.005504230502992868, -0.03219706192612648, 0.02448291890323162, -0.0017435859190300107, 0.03525742515921593, -0.00519756181165576, -0.006677159573882818, 0.008182049728929996, 0.010218077339231968, 0.03558622673153877, 0.01010426227003336, -0.0034271026961505413, 0.005153300240635872, -0.0043755630031228065, -0.001999670173972845, -0.0031141110230237246, 0.00522285420447588, -0.012974935583770275, 0.029111403971910477, 0.04013883322477341, -0.030755402520298958, 0.011147568933665752, 0.015124778263270855, -0.0005603819154202938, -0.003306964412331581, -0.003226345404982567, -0.025583133101463318, 0.023496519774198532, -0.04770122468471527, 0.01024969294667244, 0.00048529545892961323, 0.029718419536948204, -0.012469089590013027, -0.024837011471390724, 0.0049225082620978355, 0.023483874276280403]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:34:51.959854", "url_path": "/agents/", "chunk_size": 4833}
updated_dt: 2025-03-16T00:34:51.961404
---
if __name__ == '__main__':
  asyncio.run(main())
  print(output_messages)
"""
  [
    '=== ModelRequestNode: streaming partial request tokens ===',
    '[Request] Starting part 0: ToolCallPart(tool_name=\'weather_forecast\', args=\'{"location":"Pa\', tool_call_id=\'0001\', part_kind=\'tool-call\')',
    '[Request] Part 0 args_delta=ris","forecast_',
    '[Request] Part 0 args_delta=date":"2030-01-',
    '[Request] Part 0 args_delta=01"}',
    '=== CallToolsNode: streaming partial response & tool usage ===',
    '[Tools] The LLM calls tool=\'weather_forecast\' with args={"location":"Paris","forecast_date":"2030-01-01"} (tool_call_id=\'0001\')',
    "[Tools] Tool call '0001' returned => The forecast in Paris on 2030-01-01 is 24Â°C and sunny.",
    '=== ModelRequestNode: streaming partial request tokens ===',
    "[Request] Starting part 0: TextPart(content='It will be ', part_kind='text')",
    '[Result] The model produced a final result (tool_name=None)',
    "[Request] Part 0 text delta: 'warm and sunny '",
    "[Request] Part 0 text delta: 'in Paris on '",
    "[Request] Part 0 text delta: 'Tuesday.'",
    '=== CallToolsNode: streaming partial response & tool usage ===',
    '=== Final Agent Output: It will be warm and sunny in Paris on Tuesday. ===',
  ]
  """

```

### Additional Configuration
#### Usage Limits
PydanticAI offers a [`UsageLimits`](https://ai.pydantic.dev/api/usage/#pydantic_ai.usage.UsageLimits) structure to help you limit your usage (tokens and/or requests) on model runs.
You can apply these settings by passing the `usage_limits` argument to the `run{_sync,_stream}` functions.
Consider the following example, where we limit the number of response tokens:
```
frompydantic_aiimport Agent
frompydantic_ai.exceptionsimport UsageLimitExceeded
frompydantic_ai.usageimport UsageLimits
agent = Agent('anthropic:claude-3-5-sonnet-latest')
result_sync = agent.run_sync(
  'What is the capital of Italy? Answer with just the city.',
  usage_limits=UsageLimits(response_tokens_limit=10),
)
print(result_sync.data)
#> Rome
print(result_sync.usage())
"""
Usage(requests=1, request_tokens=62, response_tokens=1, total_tokens=63, details=None)
"""
try:
  result_sync = agent.run_sync(
    'What is the capital of Italy? Answer with a paragraph.',
    usage_limits=UsageLimits(response_tokens_limit=10),
  )
except UsageLimitExceeded as e:
  print(e)
  #> Exceeded the response_tokens_limit of 10 (response_tokens=32)

```

Restricting the number of requests can be useful in preventing infinite loops or excessive tool calling:
```
fromtyping_extensionsimport TypedDict
frompydantic_aiimport Agent, ModelRetry
frompydantic_ai.exceptionsimport UsageLimitExceeded
frompydantic_ai.usageimport UsageLimits

classNeverResultType(TypedDict):
"""
  Never ever coerce data to this type.
  """
  never_use_this: str

agent = Agent(
  'anthropic:claude-3-5-sonnet-latest',
  retries=3,
  result_type=NeverResultType,
  system_prompt='Any time you get a response, call the `infinite_retry_tool` to produce another response.',
)

@agent.tool_plain(retries=5) [](https://ai.pydantic.dev/agents/#__code_6_annotation_1)
definfinite_retry_tool() -> int:
  raise ModelRetry('Please try again.')

try:
  result_sync = agent.run_sync(
    'Begin infinite retry loop!', usage_limits=UsageLimits(request_limit=3) [](https://ai.pydantic.dev/agents/#__code_6_annotation_2)
  )
except UsageLimitExceeded as e:
  print(e)
  #> The next request would exceed the request_limit of 3

```

Note
This is especially relevant if you've registered many tools. The `request_limit` can be used to prevent the model from calling them in a loop too many times.
#### Model (Run) Settings
PydanticAI offers a [`settings.ModelSettings`](https://ai.pydantic.dev/api/settings/#pydantic_ai.settings.ModelSettings) structure to help you fine tune your requests. This structure allows you to configure common parameters that influence the model's behavior, such as `temperature`, `max_tokens`, `timeout`, and more.
There are two ways to apply these settings: 1. Passing to `run{_sync,_stream}` functions via the `model_settings` argument. This allows for fine-tuning on a per-request basis. 2. Setting during [`Agent`](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent) initialization via the `model_settings` argument. These settings will be applied by default to all subsequent run calls using said agent. However, `model_settings` provided during a specific run call will override the agent's default settings.
For example, if you'd like to set the `temperature` setting to `0.0` to ensure less random behavior, you can do the following:
```
frompydantic_aiimport Agent
agent = Agent('openai:gpt-4o')
result_sync = agent.run_sync(
  'What is the capital of Italy?', model_settings={'temperature': 0.0}
)
print(result_sync.data)
#> Rome