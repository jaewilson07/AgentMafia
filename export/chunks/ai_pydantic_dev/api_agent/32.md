---
url: https://ai.pydantic.dev/api/agent/
session_id: pydantic_ai_docs
chunk_number: 32
title: Agent API Arguments and Returns
summary: This section outlines the arguments required for the agent API, including user input, custom result types, message history, model options, and usage limits. It also notes that the method will return the result of the run and mentions a future deprecation regarding the current implementation.
embedding: [0.054410867393016815, 0.04273609444499016, -0.026562785729765892, -0.04811291769146919, -0.020671844482421875, 0.03521711379289627, 0.029604652896523476, 0.03918010741472244, 0.0011012041941285133, 0.013195706531405449, 0.0047368514351546764, 0.021335914731025696, -0.026926953345537186, -0.050640664994716644, 0.006870978511869907, 0.005767765920609236, -0.03905157744884491, 0.024634841829538345, 0.011835434474050999, -0.003896053647622466, 0.03588118031620979, 0.008333003148436546, 0.020629001781344414, 0.051968805491924286, -0.045242421329021454, 0.013077887706458569, -0.05055497959256172, 0.06683539599180222, -0.06769225746393204, -0.004616355057805777, 0.013699114322662354, -0.0012437916593626142, -0.021250227466225624, -0.023692291229963303, 0.0071762362495064735, 0.0007772024837322533, 0.014791615307331085, 0.031811077147722244, -0.019054513424634933, 0.029604652896523476, 0.011214207857847214, -0.012692298740148544, -0.012006807141005993, 0.04142937809228897, 0.03928721696138382, 0.011739036999642849, 0.026841266080737114, 0.044899675995111465, 0.03155401721596718, 0.027419649064540863, -0.04243618994951248, 0.011407002806663513, -0.002115383045747876, 0.011781880632042885, -0.025941558182239532, -0.021389469504356384, 0.012563768774271011, -0.01787632517516613, 0.01252092607319355, -0.09014209359884262, 0.004300386179238558, -0.011921120807528496, 0.015037964098155499, -0.008686459623277187, -0.04965526983141899, 0.027612444013357162, -0.005031398497521877, 0.03898731246590614, 0.023049643263220787, 0.004383394960314035, -0.004785050172358751, 0.03684515506029129, -0.08440110832452774, 0.008472243323922157, -0.05672439932823181, -0.005703501403331757, 0.06525019556283951, 0.022921113297343254, 0.022021405398845673, -0.008102720603346825, 0.023885084316134453, -0.03277504816651344, 0.025705920532345772, 0.02442062459886074, 0.019183043390512466, -0.059337835758924484, -0.0574527345597744, -0.011385580524802208, -0.025555970147252083, -0.045285265892744064, -0.0333748534321785, 0.027976611629128456, 0.04459977522492409, 0.05723851919174194, 0.02939043752849102, 0.022257043048739433, -0.009757539257407188, -0.0035372418351471424, 0.039308637380599976, 0.016451789066195488, 0.005138506647199392, -0.014684507623314857, -0.03320348262786865, -0.039887022227048874, 0.009114891290664673, 0.004584222566336393, -0.03296784311532974, 0.032325197011232376, -0.035195689648389816, -0.057367049157619476, -0.008349069394171238, 0.022042827680706978, -0.032903578132390976, 0.022728318348526955, -0.07780325412750244, -0.024784792214632034, 0.018079832196235657, -0.03307495266199112, 0.015841273590922356, -0.0029186932370066643, -0.0068227797746658325, 0.029026269912719727, -0.0850437581539154, -0.000672437425237149, 0.006388992536813021, 0.009725406765937805, 0.017405051738023758, -0.03258225694298744, 0.015455685555934906, 0.0014553300570696592, 0.01022345945239067, 0.01010564062744379, -0.025555970147252083, -0.028319356963038445, -0.014984410256147385, -0.017619267106056213, -0.07891717553138733, -0.02671273611485958, -0.06315088272094727, -0.007818884216248989, -0.025106117129325867, -0.02174292504787445, -0.012895803898572922, -0.027205433696508408, 0.01797272264957428, 0.05205449089407921, -0.037637751549482346, 0.04742742329835892, -0.04909830912947655, -0.02939043752849102, 0.02724827639758587, 0.010641179978847504, -0.028019454330205917, 0.022642632946372032, 0.01068402361124754, -0.0032721494790166616, 0.0011888988083228469, -0.0014740739716216922, 0.012724431231617928, -0.04258614405989647, -0.022728318348526955, 0.011546242982149124, -0.013442054390907288, 0.0016414301935583353, -0.00943621527403593, -0.05955205112695694, 0.006185487378388643, 0.010523361153900623, -0.03680231049656868, -0.028790632262825966, 0.03489578887820244, 0.014952277764678001, -0.01139629166573286, 0.016034068539738655, 0.01058227103203535, -0.023049643263220787, -0.06490745395421982, -0.023670868948101997, 0.009805737994611263, -0.04320736974477768, -0.03851603716611862, -0.032946422696113586, -0.053082726895809174, -0.04597075656056404, -0.028812052682042122, -0.025555970147252083, 0.02442062459886074, -0.027226854115724564, 0.02236415073275566, 0.0009211288415826857, -0.011931831948459148, 0.05179743096232414, -0.004086170345544815, 0.004645809531211853, -0.01744789443910122, 0.022685475647449493, 0.0378519706428051, -0.013752668164670467, 0.022385573014616966, 0.007781396619975567, -0.006367570720613003, 0.005607103928923607, 0.037402115762233734, -0.003684515366330743, 0.04519957676529884, -0.014416737481951714, -0.004361973609775305, 0.030311565846204758, -0.009446926414966583, 0.002167598344385624, 0.0260058231651783, -0.02694837376475334, 0.006828135345131159, -0.0054839299991726875, -0.0004160476673860103, -0.012874382548034191, -0.03723074123263359, 0.009479058906435966, -0.015327155590057373, 0.027548179030418396, 0.03748780116438866, 0.023906506597995758, 0.022449837997555733, 0.011846145614981651, 0.011664061807096004, 0.030804261565208435, -0.010116350837051868, -0.007524337153881788, 0.0009331784676760435, 0.04665624722838402, -0.014202521182596684, -0.02651994116604328, -0.016805246472358704, -0.0586095005273819, 0.022192778065800667, -0.0803738459944725, 0.020275546237826347, 0.02040407434105873, 0.030504360795021057, -0.06263676285743713, -0.05329694226384163, -0.0016668683383613825, 0.04909830912947655, 0.002846395131200552, -0.007861727848649025, 0.025555970147252083, -0.0014740739716216922, -0.036395300179719925, 0.01343134418129921, 0.01104283519089222, 0.030183035880327225, -0.007604668382555246, 0.008418689481914043, -0.03555985912680626, -0.019183043390512466, -0.032946422696113586, -0.005955205298960209, -0.027740973979234695, -0.0223213080316782, -0.04243618994951248, 0.04627065733075142, -0.008166985586285591, -0.06525019556283951, 0.0156270582228899, -0.006297950632870197, 0.00886318739503622, 0.04554232209920883, -0.052354391664266586, 0.047384582459926605, 0.014095413498580456, 0.011899699456989765, -0.05710998922586441, 0.04134368896484375, -0.011096389032900333, -0.03778770565986633, 0.021614395081996918, 0.03633103519678116, 0.044128499925136566, 0.018604660406708717, -0.07488992065191269, 0.014684507623314857, 0.07600384205579758, 0.02752675674855709, 0.05492498353123665, -0.01263874489814043, -0.016034068539738655, -0.01357058435678482, -0.010598337277770042, 0.012338842265307903, 0.016944486647844315, 0.03082568384706974, 0.0035479527432471514, 0.02943328022956848, 0.004407494328916073, 0.009072047658264637, -0.010866107419133186, 0.026605628430843353, 0.012895803898572922, -0.008691814728081226, -0.02962607331573963, 0.003381935181096196, -0.017854904755949974, 0.008654327131807804, -0.0010362699395045638, 0.015112939290702343, 0.05488214269280434, -0.03581691533327103, -0.023435231298208237, 0.028683524578809738, 0.0031570084393024445, 0.004728818312287331, 0.06970588862895966, -0.054796457290649414, -0.013870486989617348, 0.04798438772559166, -0.017287231981754303, 0.05458223819732666, -0.0020055973436683416, 0.009130957536399364, -0.0001760587765602395, 0.012381684966385365, -0.01527360174804926, 0.014234653674066067, 0.050597820430994034, 0.011342737823724747, 0.029026269912719727, 0.007701065391302109, -0.004894835874438286, -0.02705548144876957, 0.05505351349711418, -0.028126562014222145, -0.025577392429113388, -0.005352722480893135, 0.009141668677330017, 0.03044009581208229, 0.006474678870290518, -0.03570980951189995, -0.009023849852383137, 0.06614990532398224, 0.06614990532398224, -0.0036015065852552652, -0.03478867933154106, -0.031703971326351166, -0.0013843709602952003, 0.02962607331573963, 0.028447886928915977, 0.06216548755764961, -0.0007397146546281874, -0.01897953823208809, -0.007984901778399944, 0.019515078514814377, -0.010967859998345375, 0.02671273611485958, -0.011481977999210358, -0.013324235565960407, 0.004726140759885311, -0.004723463207483292, 0.023499496281147003, 0.005751699674874544, 0.017951302230358124, -0.045285265892744064, 0.006014114711433649, -0.002328260336071253, -0.01078042108565569, -0.039694227278232574, -0.0065710763446986675, -0.058181069791316986, -0.007615379057824612, 0.009655786678195, 0.014727350324392319, 0.0461849719285965, 0.012606612406671047, 0.006196198053658009, 0.04177212342619896, -0.05998048186302185, -0.0009773605270311236, -0.02041478641331196, 0.009923556819558144, 0.02647709846496582, 0.06272244453430176, 0.001504867454059422, 0.034531619399785995, -0.02379939891397953, -0.009607587940990925, 0.02939043752849102, 0.052782826125621796, -0.05719567462801933, 0.005173316691070795, -0.0225141029804945, 0.04134368896484375, 0.03082568384706974, -0.06782078742980957, 0.008804278448224068, 0.0023818141780793667, 0.00975218415260315, 0.0058695184998214245, 0.01331352535635233, 0.006640696432441473, 0.04067961871623993, 0.027419649064540863, 0.011942542158067226, 0.02915479987859726, -0.0007276650285348296, 0.05072635039687157, 0.034531619399785995, 0.018272625282406807, 0.06550725549459457, -0.040979523211717606, 0.020082751289010048, 0.05303988233208656, 0.05089772492647171, 0.001411147997714579, 0.03354622796177864, -0.028940582647919655, -0.03189676254987717, -0.019375838339328766, 0.011428424157202244, -0.005591037683188915, 0.04918399453163147, 0.08157345652580261, -0.012167469598352909, -0.03236803784966469, 0.008092009462416172, 0.03129695728421211, -0.025148959830403328, 0.07488992065191269, 0.011117811314761639, -0.05016938969492912, 0.020104171708226204, 0.012692298740148544, -0.007824239321053028, 0.014909434132277966, 0.015209336765110493, 0.010319855995476246, 0.0026388734113425016, 0.005832030903548002, -0.0023028221912682056, -0.01197467464953661, -0.04849850386381149, 0.005633880849927664, 0.014555977657437325, 0.009907490573823452, 0.03858030214905739, 0.0045976112596690655, -0.05779547989368439, 0.006763870362192392, -0.029369015246629715, -0.0164946336299181, 0.002913337666541338, 0.006988797336816788, -0.023628026247024536, -0.021346624940633774, 0.006635340861976147, -0.0034649439621716738, -0.07309050112962723, -0.02581303007900715, 0.07441864162683487, 0.02752675674855709, 0.0434858500957489, 0.020950326696038246, 0.009682564064860344, -0.02911195531487465, 0.001427214127033949, 0.01753357984125614, -0.059380676597356796, -0.0015985870268195868, 0.04922683909535408, -0.005810609087347984, -0.029454700648784637, 0.027269698679447174, 0.031811077147722244, -0.029947398230433464, -0.02036123163998127, -0.026177195832133293, -0.0029776026494801044, -0.006490745116025209, 0.029497545212507248, 0.03301068767905235, -0.0036738046910613775, -0.0003835805400740355, 0.03249656781554222, -0.035966869443655014, 0.028812052682042122, 0.011021413840353489, -0.02814798429608345, -0.026584206148982048, -0.022149935364723206, -0.051154784858226776, -0.06452186405658722, 0.04100094363093376, 0.03738069534301758, 0.00932375155389309, -0.025748765096068382, -0.008241960778832436, -0.0017003396060317755, -0.016023358330130577, -0.004538701847195625, 0.03862314671278, -0.016023358330130577, -0.005360755603760481, -0.04063677787780762, 0.01826191507279873, 0.007974190637469292, -0.0028142628725618124, -0.035731229931116104, -0.010882173664867878, -0.01974000595510006, 0.037594910711050034, 0.020768241956830025, 0.027162590995430946, -0.05072635039687157, 0.032089557498693466, 0.02671273611485958, -0.0011407003039494157, -0.007684999145567417, 0.009050626307725906, -0.0009566083899699152, -0.01325997058302164, -0.0022332018706947565, 0.027548179030418396, 0.0111606540158391, -0.01428820751607418, 0.015798430889844894, -0.01791916973888874, -0.017222966998815536, 0.029069112613797188, 0.007968835532665253, 0.021635817363858223, 0.0033176704309880733, 0.018390445038676262, 0.010764354839920998, 0.023777976632118225, -0.01044303085654974, 0.024977587163448334, 0.004897513426840305, 0.0064639681950211525, 0.005253647454082966, 0.021014589816331863, -0.04254329949617386, -0.031703971326351166, -0.0004558784421533346, 0.02179647982120514, -0.015037964098155499, -0.005858807824552059, -0.008772145956754684, -0.0063568600453436375, 0.023006798699498177, -0.03521711379289627, -0.007004863582551479, -0.03817329183220863, -0.01992208883166313, 0.016751691699028015, 0.020200569182634354, -0.021335914731025696, -0.006105156149715185, -0.013249260373413563, -0.042136289179325104, 0.0029936686623841524, 0.010394832119345665, -0.010094929486513138, -0.027998032048344612, -0.00558032700791955, 0.007738553453236818, -0.008697169832885265, -0.004474436864256859, 0.02117525227367878, 0.021293072029948235, 0.009586166590452194, -0.011921120807528496, 0.02519180253148079, 0.015337866730988026, -0.010625113733112812, 0.016216151416301727, 0.0059766266494989395, 0.0017083727288991213, -0.030697153881192207, 0.03952285274863243, 0.05042644962668419, -0.03063288889825344, 0.01916162297129631, -0.024442046880722046, -0.031468331813812256, 0.002183664357289672, -0.006721027195453644, 0.0038906983099877834, 0.028083719313144684, -0.04824144393205643, 0.0070905499160289764, -0.027548179030418396, 0.008215184323489666, -0.003992450889199972, -0.025748765096068382, -0.007615379057824612, 0.014159678481519222, -0.04239334911108017, -0.0027499981224536896, 0.01686951145529747, 0.016655294224619865, -0.03609539940953255, 0.0045761894434690475, 0.043657224625349045, 0.011149943806231022, -0.009173800237476826, 0.036395300179719925, 0.0333748534321785, 0.005058175418525934, 0.046998992562294006, 0.004399461206048727, -0.04639918729662895, -0.0036416721995919943, 0.011074967682361603, -0.03485294431447983, -0.006935243494808674, -0.014759482815861702, -0.002886560745537281, 0.013442054390907288, -0.047341737896203995, 0.009141668677330017, 0.054753612726926804, 0.013902619481086731, 0.0005757055478170514, 0.03982275724411011, -0.02857641503214836, 0.026027245447039604, 0.03101847879588604, -0.01312073040753603, -0.042457614094018936, 0.012060360983014107, 0.007904570549726486, 0.03508858382701874, -0.007352964486926794, 0.024699106812477112, 0.004099559038877487, -0.00759931281208992, -0.04515673592686653, -0.02819082699716091, -0.01354916300624609, -0.008981006219983101, -0.026926953345537186, -0.018529685214161873, 0.04044398292899132, 0.021100277081131935, -0.03941574692726135, 0.010416253469884396, -0.018990248441696167, -0.00027262335061095655, 0.00886854249984026, 0.0030150902457535267, 0.006972731091082096, -0.023435231298208237, -0.03412460908293724, -0.031661126762628555, -0.001553066074848175, 0.0026884109247475863, 0.021207384765148163, -0.03301068767905235, 0.00850437581539154, 0.032860737293958664, -0.019772138446569443, -0.0028651391621679068, 0.004324485547840595, 0.021089566871523857, -0.023885084316134453, 0.021528709679841995, -0.05573900416493416, 0.020254123955965042, 0.03780912607908249, 0.011449845507740974, 0.04511389136314392, -0.012810117565095425, -0.04209344461560249, -0.023906506597995758, 0.014116834849119186, -0.004262898582965136, 0.025363175198435783, -0.007781396619975567, -0.03078284114599228, -0.04314310476183891, -0.016451789066195488, 0.043421585112810135, -0.001601264695636928, -0.025705920532345772, -0.042757514864206314, 0.019804270938038826, 0.027783816680312157, -0.017801349982619286, -0.007336898241192102, -0.010314500890672207, 0.01744789443910122, 0.01997564360499382, -0.011246340349316597, -0.01022881455719471, -0.01877603307366371, 0.027698129415512085, 0.00666747335344553, 0.0020176470279693604, -0.015477106906473637, -0.005607103928923607, -0.02442062459886074, -0.047813013195991516, 0.006533588282763958, -0.012799406424164772, -0.027933767065405846, 0.009827159345149994, -0.01946152374148369, -0.022814005613327026, -0.0048439595848321915, -0.003170396899804473, -0.024634841829538345, -0.007851016707718372, 0.016237573698163033, 0.01816551759839058, -0.032432302832603455, -0.0020752176642417908, -0.050255075097084045, 0.015466395765542984, -0.0073101213201880455, 0.004142402205616236, 0.005333978682756424, -0.014984410256147385, 0.01830475777387619, -0.008659682236611843, -0.0312541164457798, 0.03024730086326599, 0.016933776438236237, -0.028040876612067223, 0.007572535891085863, 0.02188216522336006, 0.023028220981359482, 0.023820821195840836, -0.001519594807177782, -0.012103204615414143, 0.01845471002161503, -0.03418887406587601, -0.004929645918309689, 0.001657496322877705, -0.03412460908293724, -0.00690846610814333, 0.015798430889844894, -0.000919790007174015, -0.009254131466150284, -0.023970771580934525, 0.01988995634019375, -0.02322101593017578, 0.01252092607319355, -0.009495124220848083, 0.02499900758266449, 0.03189676254987717, -0.029904555529356003, -0.006458612624555826, -0.015648478642106056, 0.003973707091063261, 0.002602724591270089, 0.04549948126077652, 0.030761418864130974, 0.026112930849194527, 0.052268706262111664, 0.006367570720613003, -0.015284311957657337, 0.00775461969897151, -4.397285738377832e-05, -0.013774089515209198, 0.0191187784075737, 0.021485865116119385, 0.017662109807133675, 0.020007776096463203, 0.02566307783126831, 0.014256075955927372, -0.018283337354660034, -0.024913322180509567, -0.04121515899896622, 0.0016561575466766953, -0.02939043752849102, 0.04515673592686653, 0.023649446666240692, -0.017844194546341896, 0.034810103476047516, -0.006206908728927374, -0.01749073714017868, -0.0005847427528351545, 0.01323854923248291, 0.0018596627051010728, -0.005682079587131739, -0.0003561341145541519, 0.011407002806663513, -0.022492680698633194, -0.0016869510291144252, -0.009693274274468422, -0.012135337106883526, -0.0004234113439451903, -0.05321125686168671, -0.002093961462378502, 0.01825120486319065, 0.00032031987211667, 0.00022760451247449964, -0.015894828364253044, 0.00033856171648949385, -0.08183051645755768, 0.025448862463235855, -0.02624146081507206, -0.033246323466300964, 0.020961036905646324, -0.0009345173602923751, -0.021582262590527534, -0.029454700648784637, 0.006635340861976147, -0.0028356844559311867, 0.01906522549688816, 0.013709824532270432, -0.009730761870741844, -0.06773510575294495, 0.01118207536637783, 0.016890931874513626, 0.011696194298565388, -0.024741949513554573, 0.01825120486319065, -0.03358906880021095, -0.030525781214237213, -0.02771955169737339, -0.06820637732744217, 0.010362699627876282, 0.0006895078113302588, -0.01974000595510006, 0.003277505049481988, -0.016655294224619865, 0.00819376204162836, -0.027805238962173462, -0.037873391062021255, 0.011599796824157238, 0.010100284591317177, -0.020703976973891258, -0.02589871548116207, 0.011664061807096004, 0.007920636795461178, 0.033760443329811096, 0.0004826554504688829, 0.002347004134207964, -0.007524337153881788, -0.04166501387953758, 0.019632898271083832, -0.015798430889844894, 0.018626082688570023, -0.011289183981716633, -0.008702525869011879, 0.0092219989746809, 0.014545267447829247, -0.003266794141381979, -0.007610023953020573, -0.021957140415906906, -0.03660951554775238, -0.010405542328953743, 0.007256567478179932, 0.03915868699550629, -0.011246340349316597, 0.005087630357593298, 0.010657246224582195, 0.01791916973888874, 0.01539142057299614, 0.002535782055929303, 0.01347418688237667, -0.04455693066120148, -0.0012953374534845352, -0.026177195832133293, 9.556042641634122e-05, -0.00563923642039299, -0.01185685582458973, -0.04721320793032646, 0.0026723446790128946, 0.0333748534321785, -0.0017056949436664581, -0.010641179978847504, 0.010496584698557854, -0.004104914143681526, 0.00025136908516287804, 0.020489761605858803, 0.018958117812871933, -0.0028115850873291492, -0.027462491765618324, -0.0010228814790025353, 0.020232701674103737, -0.0002778113994281739, -0.014845169149339199, -0.0064639681950211525, 0.007128037977963686, -0.0037005816120654345, -0.003057933645322919, 0.019236598163843155, 0.03283931314945221, -0.016944486647844315, 0.02065042406320572, -0.013613427057862282, -0.030611468479037285, -0.0032534056808799505, -0.022771161049604416, -0.006335438694804907, 0.011449845507740974, -0.004560123197734356, 0.01692306436598301, 0.00910418014973402, -0.029476122930645943, 0.031104164198040962, -0.03326774761080742, 0.008954228833317757, -0.03001166321337223, -0.0027392872143536806, 0.009543322958052158, 0.03369617834687233, -0.007995612919330597, 0.005526773165911436, -0.004608321934938431, -0.014127545990049839, -0.01000924315303564, -0.013377789407968521, 0.04764164239168167, -0.0562959685921669, -0.049012623727321625, 0.01652676612138748, -0.02542744018137455, 0.03800192102789879, 0.026841266080737114, 0.031275536864995956, 0.014855880290269852, 0.03219666704535484, -0.012906515039503574, -0.043464429676532745, 0.0026174518279731274, 0.011546242982149124, -0.017769217491149902, 0.006737093441188335, -0.003989773336797953, 0.008616838604211807, -0.039737068116664886, -0.007277988828718662, 0.017758507281541824, -0.04142937809228897, -0.011921120807528496, -0.019761426374316216, 0.007010219153016806, -0.006945954170078039, 0.009982465766370296, -0.01805840991437435, -0.059809111058712006, -0.020950326696038246, 0.0011005348060280085, -0.01345276553183794, -0.010662602260708809, 0.022428415715694427, -0.021003879606723785, -0.01874390058219433, 0.0285335723310709, 0.005379499401897192, -0.03673804551362991, 0.00010576915519777685, -0.010833974927663803, -0.023392388597130775, -0.0143631836399436, 0.017190834507346153, 0.0024152854457497597, 0.08315865695476532, -0.009007783606648445, 0.01508080679923296, -5.5060208978829905e-05, 0.01147126778960228, -0.016998039558529854, 0.01519862562417984, -0.04639918729662895, 0.01969716139137745, -0.05136900022625923, 0.0005254986463114619, -0.00494571216404438, -0.013388500548899174, 0.022921113297343254, 0.006388992536813021, 0.034146033227443695, -0.02045762911438942, -0.0042227329686284065, 0.04168643429875374, 0.01859395019710064, 0.05415380746126175, -0.018679635599255562, -0.008884608745574951, 0.0033551582600921392, -0.0074225845746695995, 0.01639823615550995, 0.04391428083181381, -0.02044691890478134, -0.006565720774233341, 0.001396420644596219, 0.03555985912680626, -0.030761418864130974, 0.0015597603050991893, -0.03236803784966469, -0.020082751289010048, 0.03427456319332123, -0.010769709944725037, -0.03153259679675102, -0.005612459499388933, -0.014620242640376091, 0.027655286714434624, -0.0036657715681940317, -0.025448862463235855, 0.03528137877583504, 0.04682761803269386, 0.004091525916010141, -0.0010389476083219051, -0.03847319632768631, -0.022385573014616966, 0.016623161733150482, -0.03879452124238014, -0.009098825044929981, -0.009371950291097164, -0.0008742691134102643, -0.01448100246489048, -0.01587340608239174, 0.02647709846496582, -0.013495608232915401, -0.0063515049405395985, 0.026991216465830803, -0.016837378963828087, -0.005317912437021732, 0.03815187141299248, 0.016708848997950554, -0.0006145321531221271, -0.0018610015977174044, 0.01974000595510006, 0.020800374448299408, 0.0012993540149182081, 0.01619473099708557, -0.026027245447039604, -0.0008448144071735442, -0.009853936731815338, 0.05248292163014412, -0.03915868699550629, 0.011514110490679741, -0.005275069270282984, 0.024720527231693268, 0.01343134418129921, 0.012456661090254784, 0.019375838339328766, -0.01816551759839058, -0.024013614282011986, 0.035581279546022415, 0.034146033227443695, -0.004046004731208086, 0.0390087366104126, 0.00419327849522233, -0.008097365498542786, 0.005457153078168631, -0.00038157225935719907, -0.005240259226411581, 0.0064371912740170956, -0.013110020197927952, -0.008718591183423996, 0.011953253298997879, 0.01393475104123354, -0.003057933645322919, 0.009205932728946209, 0.017908457666635513, -0.002577286446467042, -0.015444974415004253, -0.014352472499012947, -0.022342730313539505, -0.011717615649104118, -0.014727350324392319, 0.028790632262825966, 0.027034061029553413, 0.038644567131996155, 0.00579454330727458, -0.0015303055988624692, 0.04145079851150513, 0.023906506597995758, -0.02786950208246708, -0.023263858631253242, -0.00031446240609511733, -0.010121706873178482, 0.014748772606253624, 0.008557929657399654, 0.011824723333120346, 0.01777992956340313, -0.02690553106367588, 0.006865622941404581, 0.03828040137887001, -0.0283407773822546, -0.024977587163448334, -0.03148975223302841, 0.008697169832885265, -0.01801556721329689, 0.020757531747221947, 0.005928427912294865, -0.03660951554775238, 0.036245349794626236, 0.05021223425865173, -0.004742207005620003, 0.06392205506563187, 0.01762997731566429, 0.005499996244907379, -0.011996096931397915, -0.009939623065292835, -0.009013138711452484, -0.005655302666127682, -0.0392015315592289, 0.0004849984252359718, 0.01725509949028492, 0.028447886928915977, -0.03742353618144989, -0.009698630310595036, 0.006485389545559883, -0.028040876612067223, 0.009088113903999329, -0.012531636282801628, 0.0004783041949849576, 0.0003624936507549137, 0.011846145614981651, -0.02050047181546688, -0.0056231701746582985, -0.022471260279417038, -0.012649455107748508, -0.01381693221628666, 0.01758713461458683, 0.008927452377974987, -0.0523972362279892, -0.03427456319332123, -0.012156758457422256, 0.0012926597846671939, 0.010903595015406609, 0.014523845165967941, 0.005649947095662355, 0.027034061029553413, -0.020896771922707558, 0.004206666722893715, 0.023906506597995758, -0.011460556648671627, -0.0022961278446018696, -0.032046716660261154, -0.02643425576388836, -0.01820836029946804, -0.020811084657907486, -0.013227839022874832, 0.00036550607183016837, -0.01663387380540371, 0.013956173323094845, 0.02030767686665058, 0.010876817628741264, -0.0013288087211549282, 0.006940598599612713, 0.030268723145127296, 0.009805737994611263, 0.04601359739899635, -0.0006654085009358823, 0.013720535673201084, 0.004517280030995607, -0.0019828369840979576, -0.02279258333146572, -0.00014794293383602053, 0.012595901265740395, 0.01720154471695423, -0.018840298056602478, -0.019129490479826927, 0.02981886826455593, 0.005181349813938141, 0.014427448622882366, 0.01744789443910122, 0.02317817322909832, 0.02452773228287697, 0.03044009581208229, 0.019086645916104317, 0.0025170380249619484, 0.018851008266210556, 0.04824144393205643, 0.022385573014616966, -0.010732222348451614, 0.011192786507308483, 0.008279448375105858, -0.0038505326956510544, 0.0007336898124776781, 0.03493862971663475, 0.05338263139128685, 0.03665236011147499, -0.007004863582551479, -0.03245372697710991, 0.004327163565903902, -0.03380328789353371, 0.02289969101548195, 0.022685475647449493, 0.005703501403331757, -0.005928427912294865, -0.0019614154007285833, 0.024356359615921974, 0.009495124220848083, -0.01939726062119007, -0.004394106101244688, 0.012124625965952873, 0.012081783264875412, 0.035774074494838715, -0.013602716848254204, -0.0009766911389306188, -0.018626082688570023, -0.0023322768975049257, -0.04226481914520264, 0.033953238278627396, -0.02356376126408577, -0.0017967367311939597, -0.04545663669705391, -0.0006975408759899437, 0.013195706531405449, 0.01987924613058567, 0.01811196282505989, -0.016419656574726105, -0.02001848630607128, 0.030418673530220985, 0.04142937809228897, 0.004343229811638594, -0.03213240206241608, 0.030033085495233536, -0.000718962459359318, -0.023285280913114548, 0.05094056576490402, -0.021335914731025696, -0.01682666689157486, 0.011310605332255363, -0.017308654263615608, -0.020950326696038246, 0.01335636805742979, 0.024484889581799507, 0.00304722273722291, 0.02371371164917946, 0.04747026786208153, 0.019332995638251305, -0.015926960855722427, -0.013956173323094845, 0.013045755214989185, -0.0013535773614421487, 0.02127164974808693, 0.04871271923184395, 0.015894828364253044, -0.013442054390907288, -0.01820836029946804, 0.04395712539553642, 0.042457614094018936, 0.013827643357217312, -0.012617322616279125, 0.0025572036392986774, 0.024206409230828285, 0.00784030556678772, -0.0019346383633092046, -0.02686268836259842, 0.002610757714137435, 0.011235630139708519, -0.010753643698990345, 0.003703259164467454, 0.009007783606648445, -0.03253941237926483, -0.008814988657832146, -0.045028205960989, 0.0020055973436683416, -0.013131441548466682, 0.017672820016741753, -0.0005335317691788077, 0.00377020169980824, -0.013142152689397335, -0.022728318348526955, -0.012917225249111652, -0.03044009581208229, -0.0004779694718308747, 0.009966399520635605, -0.024827634915709496, -0.01426678616553545, -0.004605644382536411, -0.01845471002161503, 0.011921120807528496, -0.0050180102698504925, -0.006308661308139563, -0.0045092469081282616, 0.01686951145529747, -0.02084321714937687, 0.0158198531717062, -0.0028731722850352526, 0.021625107154250145, -0.012745852582156658, 0.025063272565603256, -0.017994144931435585, -0.017415761947631836, 0.009543322958052158, -0.024870479479432106, -0.011117811314761639, 0.0013174284249544144, -0.0018797455122694373, -0.02379939891397953, 0.0393943227827549, -0.008836410008370876, -0.004983199760317802, -0.0016133143799379468, 0.007792107295244932, 0.015091517940163612, -0.01496298797428608, 0.01791916973888874, 0.03168254718184471, -0.014609531499445438, -0.0167838241904974, 0.008279448375105858, 0.025106117129325867, 0.017137281596660614, -0.026155775412917137, -0.018197650089859962, -0.010732222348451614, -0.00748149398714304, 0.0005211473908275366, 0.025148959830403328, -0.01445958111435175, 0.010143128223717213, -0.008895319886505604, 0.0041557904332876205, -0.01777992956340313, -0.008102720603346825, 0.01129989419132471, 0.011792591772973537, 0.022235622629523277, -0.0058641633950173855, 0.003810367314144969, 0.0011407003039494157, 0.013527740724384785, 0.034253139048814774, -8.618847641628236e-05, -0.01022881455719471, 0.012574479915201664, -0.010860751383006573, 0.0009452281519770622, -0.023263858631253242, -0.018958117812871933, -0.014738061465322971, -0.010742932558059692, -0.017694242298603058, 0.003896053647622466, -0.0223213080316782, -0.0013201062101870775, -0.028897739946842194, -0.036352455615997314, 0.011524821631610394, 0.0007169542368501425, -0.0061105117201805115, 0.0181548073887825, -0.01629112847149372, 0.027376806363463402, -0.01333494670689106, 0.008847121149301529, 0.0024929388891905546, 0.028169404715299606, 0.012617322616279125, 0.005933783482760191, -0.04202917963266373, -0.01835831254720688, -0.0076903547160327435, 0.01125705149024725, 0.002056473633274436, 0.020768241956830025, -0.010260947048664093, -0.01735149696469307, -0.011717615649104118, 0.034338828176259995, 0.0005703501519747078, -0.010576915927231312, 0.04682761803269386, 0.005992692895233631, -0.0006001395522616804, 0.006774581503123045, 0.006699605844914913, -0.006769225932657719, -0.00016534798487555236, 0.002450095722451806, -0.02069326676428318, -0.03116842918097973, 0.01022881455719471, -0.02538459748029709, 0.014438158832490444, -0.012810117565095425, -0.01566990092396736, -0.029690338298678398, 0.051925960928201675, -0.005633880849927664, 0.03828040137887001, 0.01252092607319355, 0.026605628430843353, -0.033289168030023575, -0.003743424778804183, -0.04584222659468651, 0.0335676483809948, -0.029411857947707176, -0.005358078051358461, 0.03489578887820244, -0.02814798429608345, -0.0008722608326934278, 0.003944252151995897, 0.004442304372787476, 0.013388500548899174, 0.003746102564036846, -0.02418498694896698, 0.0029749248642474413, 0.030118770897388458, 0.017362207174301147, -0.0063300831243395805, -0.048155758529901505, -0.0011447167489677668, 0.0011266423389315605, 0.00307667744345963, -0.050297919660806656, -0.006040891632437706, 0.010475163348019123, -0.013924040831625462, 0.011021413840353489, -0.030418673530220985, 0.002644228981807828, 0.019332995638251305, -0.029047690331935883, -0.012863671407103539, -0.00886318739503622, 0.0016133143799379468, 0.019086645916104317, 0.018583238124847412, 0.033332012593746185, -0.0016882899217307568, 0.007315476890653372, -0.021785767748951912, 0.05586753413081169, -0.0002947143802884966, -0.057324204593896866, 0.030504360795021057, -0.03995128720998764, 0.013656270690262318, -0.006538943853229284, -0.006737093441188335, -0.0029106601141393185, -0.0227068979293108, -0.0008220539311878383, 0.006115867290645838, 0.002213119063526392, 0.034146033227443695, -0.018626082688570023, -0.024399204179644585, -0.013045755214989185, 0.023499496281147003, -0.0287263672798872, 0.017480026930570602, -0.040743883699178696, -0.006447901949286461, -0.0335676483809948, -0.02495616488158703, -0.03521711379289627, -0.03915868699550629, -0.011321316473186016, 0.004723463207483292, 0.003084710566326976, 0.00886854249984026, 0.005141184199601412, -0.01902238093316555, -0.0009204593952745199, -0.019954221323132515, 0.011246340349316597, -0.024163566529750824, -0.03498147428035736, -0.004860025830566883, -0.04168643429875374, 0.006319372449070215, 0.018294047564268112, 0.0062122642993927, -0.03898731246590614, -0.049869488924741745, -0.000864227709826082, -0.0011166009353473783, -0.009163090027868748, -0.005987337324768305, -0.018808165565133095, 0.016644584015011787, 0.03116842918097973, -0.04639918729662895, 0.012617322616279125, 0.0324108824133873, -0.029861710965633392, -0.013024333864450455, 0.010394832119345665, 0.010046730749309063, 0.009586166590452194, 0.008616838604211807, 0.011481977999210358, 0.012488793581724167, -0.012703009881079197, 0.02714116871356964, 0.011739036999642849, -0.03427456319332123, -0.011599796824157238, 0.013227839022874832, 0.01711585931479931, -0.021046722307801247, 0.007460072636604309, -0.04057251289486885, -0.010084218345582485, -0.0248490571975708, -0.016237573698163033, -0.0327964723110199, 0.03136122226715088, -0.004054037854075432, 0.03714505583047867, 0.021046722307801247, -0.0009746828582137823, -0.019707873463630676, 0.010143128223717213, -0.03506715968251228, 0.03633103519678116, -0.03478867933154106, 0.012413817457854748, 0.02146444469690323, 0.01207107212394476, -0.05800969526171684, 0.030118770897388458, 0.005574971903115511, 0.024249251931905746, 0.0250418521463871, 0.005226870533078909, -0.018529685214161873, -0.013013622723519802, 0.03217524290084839, -5.451630204333924e-05, -0.00836513563990593, -0.026691315695643425, 0.009580811485648155, -0.007460072636604309, 0.00874536857008934, -0.013645559549331665, 0.015284311957657337, -0.04061535373330116, -0.01000924315303564, -0.014855880290269852, -0.002317549427971244, 0.0033123150933533907, -0.005660658236593008, 0.00850437581539154, 0.01729794219136238]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:08.146325", "url_path": "/api/agent/", "chunk_size": 5000}
updated_dt: 2025-03-15T11:17:08.147938
---
```
  Args:
    user_prompt: User input to start/continue the conversation.
    result_type: Custom result type to use for this run, `result_type` may only be used if the agent has no
      result validators since result validators would expect an argument that matches the agent's result type.
    message_history: History of the conversation so far.
    model: Optional model to use for this run, required if `model` was not set when creating the agent.
    deps: Optional dependencies to use for this run.
    model_settings: Optional settings to use for this model's request.
    usage_limits: Optional limits on model request count or token usage.
    usage: Optional usage to start with, useful for resuming a conversation or agents used in tools.
    infer_name: Whether to try to infer the agent name from the call frame if it's not set.
  Returns:
    The result of the run.
  """
  # TODO: We need to deprecate this now that we have the `iter` method.
  #  Before that, though, we should add an event for when we reach the final result of the stream.
  if infer_name and self.name is None:
    # f_back because `asynccontextmanager` adds one frame
    if frame := inspect.currentframe(): # pragma: no branch
      self._infer_name(frame.f_back)
  yielded = False
  async with self.iter(
    user_prompt,
    result_type=result_type,
    message_history=message_history,
    model=model,
    deps=deps,
    model_settings=model_settings,
    usage_limits=usage_limits,
    usage=usage,
    infer_name=False,
  ) as agent_run:
    first_node = agent_run.next_node # start with the first node
    assert isinstance(first_node, _agent_graph.UserPromptNode) # the first node should be a user prompt node
    node = first_node
    while True:
      if self.is_model_request_node(node):
        graph_ctx = agent_run.ctx
        async with node._stream(graph_ctx) as streamed_response: # pyright: ignore[reportPrivateUsage]
          async defstream_to_final(
            s: models.StreamedResponse,
          ) -> FinalResult[models.StreamedResponse] | None:
            result_schema = graph_ctx.deps.result_schema
            async for maybe_part_event in streamed_response:
              if isinstance(maybe_part_event, _messages.PartStartEvent):
                new_part = maybe_part_event.part
                if isinstance(new_part, _messages.TextPart):
                  if _agent_graph.allow_text_result(result_schema):
                    return FinalResult(s, None, None)
                elif isinstance(new_part, _messages.ToolCallPart) and result_schema:
                  for call, _ in result_schema.find_tool([new_part]):
                    return FinalResult(s, call.tool_name, call.tool_call_id)
            return None
          final_result_details = await stream_to_final(streamed_response)
          if final_result_details is not None:
            if yielded:
              raise exceptions.AgentRunError('Agent run produced final results')
            yielded = True
            messages = graph_ctx.state.message_history.copy()
            async defon_complete() -> None:
"""Called when the stream has completed.
              The model response will have been added to messages by now
              by `StreamedRunResult._marked_completed`.
              """
              last_message = messages[-1]
              assert isinstance(last_message, _messages.ModelResponse)
              tool_calls = [
                part for part in last_message.parts if isinstance(part, _messages.ToolCallPart)
              ]
              parts: list[_messages.ModelRequestPart] = []
              async for _event in _agent_graph.process_function_tools(
                tool_calls,
                final_result_details.tool_name,
                final_result_details.tool_call_id,
                graph_ctx,
                parts,
              ):
                pass
              # TODO: Should we do something here related to the retry count?
              #  Maybe we should move the incrementing of the retry count to where we actually make a request?
              # if any(isinstance(part, _messages.RetryPromptPart) for part in parts):
              #   ctx.state.increment_retries(ctx.deps.max_result_retries)
              if parts:
                messages.append(_messages.ModelRequest(parts))
            yield StreamedRunResult(
              messages,
              graph_ctx.deps.new_message_index,
              graph_ctx.deps.usage_limits,
              streamed_response,
              graph_ctx.deps.result_schema,
              _agent_graph.build_run_context(graph_ctx),
              graph_ctx.deps.result_validators,
              final_result_details.tool_name,
              on_complete,
            )
            break
      next_node = await agent_run.next(node)
      if not isinstance(next_node, _agent_graph.AgentNode):
        raise exceptions.AgentRunError('Should have produced a StreamedRunResult before getting here')
      node = cast(_agent_gr