---
url: https://ai.pydantic.dev/api/agent/
session_id: pydantic_ai_docs
chunk_number: 32
title: Agent API Documentation: Arguments and Returns
summary: This section outlines the arguments for initiating a conversation with the agent API, including user input, custom result types, message history, model specifications, optional dependencies, and usage limits. It also mentions future deprecation of certain methods.
embedding: [0.05437030643224716, 0.04275931045413017, -0.026585323736071587, -0.04811493679881096, -0.020726269111037254, 0.03517574816942215, 0.029627319425344467, 0.03918175399303436, 0.0011588233755901456, 0.01317483838647604, 0.0047316947020590305, 0.021347522735595703, -0.026949506253004074, -0.050642792135477066, 0.0068605560809373856, 0.005778719671070576, -0.03903179615736008, 0.024614453315734863, 0.011857354082167149, -0.003933706786483526, 0.03588268905878067, 0.00829586386680603, 0.0206084456294775, 0.051970988512039185, -0.04528716579079628, 0.013067725114524364, -0.050514258444309235, 0.06675251573324203, -0.06769510358572006, -0.0046031600795686245, 0.013721112161874771, -0.0012425050372257829, -0.021197564899921417, -0.023714708164334297, 0.007181893568485975, 0.000797988148406148, 0.014781525358557701, 0.03181241452693939, -0.019087448716163635, 0.029605897143483162, 0.01121467910706997, -0.012724965810775757, -0.011996600776910782, 0.04145253822207451, 0.039310287684202194, 0.011739530600607395, 0.02688523940742016, 0.04490156099200249, 0.03155534341931343, 0.027399377897381783, -0.0424593985080719, 0.01142890378832817, -0.0021288609132170677, 0.0117609528824687, -0.025942647829651833, -0.021347522735595703, 0.012553585693240166, -0.01791992224752903, 0.012489317916333675, -0.09014588594436646, 0.0042657554149627686, -0.011975177563726902, 0.015060017816722393, -0.008643979206681252, -0.04965735599398613, 0.027613604441285133, -0.0050690993666648865, 0.0389246828854084, 0.023029187694191933, 0.0044050016440451145, -0.004817384760826826, 0.036825280636548996, -0.08436180651187897, 0.008483310230076313, -0.05672678351402283, -0.005735874641686678, 0.06525293737649918, 0.022922076284885406, 0.022043753415346146, -0.00812448374927044, 0.023864666000008583, -0.03275500237941742, 0.02572842314839363, 0.024443073198199272, 0.01923740655183792, -0.059340327978134155, -0.0574551485478878, -0.011375348083674908, -0.02555704303085804, -0.04533001035451889, -0.03331198915839195, 0.027956362813711166, 0.044601645320653915, 0.05732661113142967, 0.029370248317718506, 0.022236555814743042, -0.009747237898409367, -0.0035079345107078552, 0.039267443120479584, 0.016452480107545853, 0.005128011107444763, -0.014652990736067295, -0.03324772045016289, -0.03986727446317673, 0.00907242950052023, 0.004536214750260115, -0.03296922892332077, 0.03230513259768486, -0.03521859273314476, -0.05736945569515228, -0.008402976207435131, 0.022043753415346146, -0.03284069523215294, 0.02272927388548851, -0.07776367664337158, -0.024828677996993065, 0.018027033656835556, -0.0330977626144886, 0.01585265062749386, -0.0029027487616986036, -0.0068123554810881615, 0.02904891036450863, -0.08504732698202133, -0.0007390762912109494, 0.0064267502166330814, 0.00975794903934002, 0.01738435961306095, -0.03258362412452698, 0.015467045828700066, 0.0014460188103839755, 0.010293511673808098, 0.010095353238284588, -0.025578465312719345, -0.028277700766921043, -0.014963616617023945, -0.01756644994020462, -0.07887765020132065, -0.026692437008023262, -0.06311068683862686, -0.007819212973117828, -0.02510717138648033, -0.021775972098112106, -0.012928479351103306, -0.027206575497984886, 0.017941344529390335, 0.052056677639484406, -0.03763933479785919, 0.047429416328668594, -0.049186062067747116, -0.029370248317718506, 0.027292266488075256, 0.010657694190740585, -0.028042053803801537, 0.022665005177259445, 0.010700538754463196, -0.003248186782002449, 0.0011822542874142528, -0.0014902027323842049, 0.012724965810775757, -0.04260935261845589, -0.022750696167349815, 0.011536017060279846, -0.0134211964905262, 0.0016455159056931734, -0.009458034299314022, -0.05946886166930199, 0.006110768299549818, 0.0105077363550663, -0.03678243234753609, -0.028748996555805206, 0.03491867706179619, 0.01494219433516264, -0.011418192647397518, 0.01602403074502945, 0.01056664902716875, -0.023050611838698387, -0.06486733257770538, -0.023736130446195602, 0.009784727357327938, -0.043187763541936874, -0.038496233522892, -0.032947804778814316, -0.05304211378097534, -0.045972686260938644, -0.028813263401389122, -0.0255998894572258, 0.024378806352615356, -0.027206575497984886, 0.022365091368556023, 0.0009231758886016905, -0.01196446642279625, 0.051799606531858444, -0.004099731333553791, 0.004656716249883175, -0.01743791624903679, 0.02264358289539814, 0.037853557616472244, -0.013699688948690891, 0.022300822660326958, 0.007803145796060562, -0.0063517712987959385, 0.005591272842139006, 0.037360843271017075, -0.003687347983941436, 0.04515863209962845, -0.014417342841625214, -0.00435680104419589, 0.030291415750980377, -0.009415188804268837, 0.002185095101594925, 0.026028338819742203, -0.026949506253004074, 0.006817711051553488, -0.005564494524151087, -0.0004227596800774336, -0.012874922715127468, -0.037232305854558945, 0.009452678263187408, -0.01531708799302578, 0.02754933573305607, 0.037489376962184906, 0.02388608828186989, 0.022386513650417328, 0.011900199577212334, 0.011632418259978294, 0.030826978385448456, -0.010122131556272507, -0.007535364478826523, 0.0009265231783501804, 0.04657251760363579, -0.01425667479634285, -0.02652105689048767, -0.01677381806075573, -0.05861196294426918, 0.02219371125102043, -0.08054860681295395, 0.020276397466659546, 0.020404933020472527, 0.030484218150377274, -0.06259654462337494, -0.053299181163311005, -0.0017312058480456471, 0.049057528376579285, 0.0027929586358368397, -0.007862057536840439, 0.02555704303085804, -0.0014741357881575823, -0.03631113842129707, 0.013410485349595547, 0.011086144484579563, 0.030120035633444786, -0.007599632255733013, 0.008344064466655254, -0.03556135296821594, -0.01915171556174755, -0.032947804778814316, -0.005917965900152922, -0.02767787128686905, -0.022343669086694717, -0.042352285236120224, 0.04635829105973244, -0.008194106630980968, -0.06525293737649918, 0.015606291592121124, -0.006298215128481388, 0.008852848783135414, 0.04554423689842224, -0.05235659331083298, 0.047386571764945984, 0.014106716960668564, 0.011857354082167149, -0.05715523287653923, 0.04134542495012283, -0.011118277907371521, -0.03778929263353348, 0.021690282970666885, 0.036353982985019684, 0.0441303513944149, 0.018658997491002083, -0.07485021650791168, 0.01473868079483509, 0.07596419006586075, 0.027527913451194763, 0.054884448647499084, -0.012671409174799919, -0.01602403074502945, -0.01354973204433918, -0.010625560767948627, 0.01240362785756588, 0.016966620460152626, 0.030826978385448456, 0.003593624569475651, 0.029413092881441116, 0.004402324091643095, 0.009093851782381535, -0.010866563767194748, 0.026585323736071587, 0.012896345928311348, -0.008692179806530476, -0.029627319425344467, 0.003339232411235571, -0.017802098765969276, 0.008708246983587742, -0.001036313478834927, 0.015167131088674068, 0.054798755794763565, -0.03583984449505806, -0.02347906120121479, 0.0287275742739439, 0.0031142961233854294, 0.004758473020046949, 0.06970881670713425, -0.054841604083776474, -0.013849646784365177, 0.04798640310764313, -0.01730938069522381, 0.05458453297615051, -0.0020471876487135887, 0.009142052382230759, -0.00012937182327732444, 0.012285804376006126, -0.015284954570233822, 0.014267385937273502, 0.050557103008031845, 0.011332502588629723, 0.02900606580078602, 0.007663899566978216, -0.0049057528376579285, -0.027120886370539665, 0.05509867146611214, -0.028170589357614517, -0.025578465312719345, -0.0053315251134335995, 0.009147407487034798, 0.03046279586851597, 0.006480306386947632, -0.035689886659383774, -0.009024228900671005, 0.06615268439054489, 0.0661955252289772, -0.0036578921135514975, -0.03479013964533806, -0.03168387711048126, -0.0013697011163458228, 0.029627319425344467, 0.028491925448179245, 0.062210943549871445, -0.0006724657141603529, -0.01898033544421196, -0.007985237054526806, 0.019569454714655876, -0.010952253825962543, 0.026692437008023262, -0.011482460424304008, -0.01328195072710514, 0.004686172120273113, -0.004758473020046949, 0.023500483483076096, 0.005714451894164085, 0.017952056601643562, -0.0453728586435318, 0.00601436709985137, -0.0023618307895958424, -0.010775517672300339, -0.03976016119122505, -0.006592774763703346, -0.05818351358175278, -0.007567498367279768, 0.009666903875768185, 0.014727969653904438, 0.046272601932287216, 0.012671409174799919, 0.006142902188003063, 0.0418381430208683, -0.05998300388455391, -0.0009760626708157361, -0.02043706551194191, 0.009891839697957039, 0.026456788182258606, 0.06263939291238785, 0.0015102863544598222, 0.03446880355477333, -0.023821821436285973, -0.009607991203665733, 0.02939167059957981, 0.05278504267334938, -0.05719807744026184, 0.005149433854967356, -0.02255789376795292, 0.04138827323913574, 0.03080555610358715, -0.06778079271316528, 0.00878322497010231, 0.002368525369092822, 0.009779371321201324, 0.005875120870769024, 0.013324795290827751, 0.006630264222621918, 0.04068132862448692, 0.027420802041888237, 0.011910910718142986, 0.02922029048204422, -0.0007276955875568092, 0.05072848126292229, 0.03446880355477333, 0.01827339269220829, 0.06555285304784775, -0.04095982015132904, 0.020072882995009422, 0.05291357636451721, 0.05089986324310303, 0.0013516258914023638, 0.03354763612151146, -0.028984643518924713, -0.03191952779889107, -0.019408786669373512, 0.011418192647397518, -0.005591272842139006, 0.049100372940301895, 0.0816197320818901, -0.012167980894446373, -0.03241224214434624, 0.00814054999500513, 0.03134112060070038, -0.025171438232064247, 0.07489306479692459, 0.011139700189232826, -0.05017149820923805, 0.020105017349123955, 0.012714254669845104, -0.007813856936991215, 0.01487792655825615, 0.015220686793327332, 0.010298867709934711, 0.002638984238728881, 0.0058269202709198, -0.002324341330677271, -0.012050156481564045, -0.04850054159760475, 0.0056234062649309635, 0.01461014524102211, 0.009913261979818344, 0.03862477093935013, 0.004571026191115379, -0.057755064219236374, 0.00672130985185504, -0.02943451702594757, -0.016527459025382996, 0.0029000709764659405, 0.007005157880485058, -0.023671863600611687, -0.021336810663342476, 0.0066141970455646515, -0.0034999011550098658, -0.07313641905784607, -0.025878380984067917, 0.0745074599981308, 0.027613604441285133, 0.04342341050505638, 0.020983340218663216, 0.009645480662584305, -0.029156023636460304, 0.0014152239309623837, 0.017502183094620705, -0.059340327978134155, -0.001625432283617556, 0.04922890663146973, -0.005853698588907719, -0.029413092881441116, 0.02731368876993656, 0.03181241452693939, -0.029991501942276955, -0.020404933020472527, -0.026156874373555183, -0.003007183549925685, -0.006496373564004898, 0.029520206153392792, 0.03305491805076599, -0.003623080439865589, -0.0003702075919136405, 0.0324765108525753, -0.03596837818622589, 0.02877041883766651, 0.01101116556674242, -0.028149167075753212, -0.026413943618535995, -0.022129442542791367, -0.05115693062543869, -0.0645245760679245, 0.04095982015132904, 0.03742510825395584, 0.009334854781627655, -0.025707000866532326, -0.008242307230830193, -0.0016816663555800915, -0.016056165099143982, -0.004560315050184727, 0.03856050223112106, -0.016013318672776222, -0.0053797257132828236, -0.04061705991625786, 0.018284104764461517, 0.007931681349873543, -0.0027822472620755434, -0.035775575786828995, -0.010898697189986706, -0.019762257114052773, 0.03757506608963013, 0.020769115537405014, 0.02727084420621395, -0.050685636699199677, 0.032112330198287964, 0.026692437008023262, -0.0011139700654894114, -0.007679966744035482, 0.009061717428267002, -0.0009968157391995192, -0.013271239586174488, -0.002293546451255679, 0.02754933573305607, 0.011161123402416706, -0.014267385937273502, 0.015820516273379326, -0.017909210175275803, -0.017234401777386665, 0.029070334509015083, 0.00799059309065342, 0.021679570898413658, 0.0033017429523169994, 0.018391216173768044, 0.010759451426565647, 0.023757552728056908, -0.010416691191494465, 0.02497863583266735, 0.004887008108198643, 0.006464239675551653, 0.005277968477457762, 0.020994050428271294, -0.042523663491010666, -0.03170530125498772, -0.0004388265369925648, 0.021775972098112106, -0.015081441029906273, -0.005853698588907719, -0.00878322497010231, -0.006330349016934633, 0.023029187694191933, -0.03521859273314476, -0.007005157880485058, -0.03813205286860466, -0.01994434744119644, 0.01673097349703312, 0.02021212875843048, -0.02131538838148117, -0.006078634411096573, -0.013249816372990608, -0.04213805869221687, 0.0030393172055482864, 0.01037384569644928, -0.010052508674561977, -0.02802063152194023, -0.005548427812755108, 0.0077281673438847065, -0.008729669265449047, -0.004474624991416931, 0.021197564899921417, 0.021283254027366638, 0.009581213817000389, -0.011943044140934944, 0.025171438232064247, 0.015306376852095127, -0.010582715272903442, 0.016270389780402184, 0.005971522070467472, 0.0017191556980833411, -0.03067702054977417, 0.03946024551987648, 0.050385721027851105, -0.030655598267912865, 0.01915171556174755, -0.02435738407075405, -0.031491074711084366, 0.0021958062425255775, -0.006715953815728426, 0.003877472598105669, 0.028063476085662842, -0.04824347048997879, 0.007090847939252853, -0.027506491169333458, 0.008204817771911621, -0.004008685704320669, -0.025749845430254936, -0.007599632255733013, 0.014160272665321827, -0.042395129799842834, -0.002740741241723299, 0.016880931332707405, 0.016655994579195976, -0.036075491458177567, 0.0045683481730520725, 0.04365905746817589, 0.011118277907371521, -0.00918489694595337, 0.036396827548742294, 0.03339767828583717, 0.005085166078060865, 0.04695812240242958, 0.004418390803039074, -0.04635829105973244, -0.003644502954557538, 0.01107543334364891, -0.03479013964533806, -0.0068766227923333645, -0.014727969653904438, -0.0029000709764659405, 0.01344261970371008, -0.047386571764945984, 0.00917954184114933, 0.054755911231040955, 0.013881780207157135, 0.0005978216649964452, 0.03984585031867027, -0.02855619415640831, 0.026071183383464813, 0.030998358502984047, -0.01311057060956955, -0.042437974363565445, 0.012071579694747925, 0.00789954699575901, 0.035111479461193085, -0.007369340397417545, 0.02467872016131878, 0.004080986604094505, -0.0075889211148023605, -0.04520147666335106, -0.028192011639475822, -0.01354973204433918, -0.008992094546556473, -0.02692808397114277, -0.01854117400944233, 0.04042425751686096, 0.021079741418361664, -0.039438825100660324, 0.010357779450714588, -0.019044604152441025, -0.0003260236990172416, 0.00887427106499672, 0.003017894923686981, 0.006983735132962465, -0.02343621663749218, -0.03410462290048599, -0.03164103254675865, -0.0015758926747366786, 0.002701913006603718, 0.02118685282766819, -0.03301207348704338, 0.008515443652868271, 0.032819271087646484, -0.019762257114052773, -0.0028813264798372984, 0.004351445473730564, 0.021122585982084274, -0.02397177927196026, 0.021561747416853905, -0.05574134737253189, 0.020233552902936935, 0.03778929263353348, 0.011482460424304008, 0.04507294297218323, -0.0127999447286129, -0.04207378998398781, -0.023907510563731194, 0.014074583537876606, -0.0042416551150381565, 0.025364240631461143, -0.007787079084664583, -0.030784133821725845, -0.0430806502699852, -0.016452480107545853, 0.04346625506877899, -0.001589281833730638, -0.02564273402094841, -0.04280215501785278, 0.01981581375002861, 0.02780640684068203, -0.01778067648410797, -0.0073907626792788506, -0.010325645096600056, 0.01742720417678356, 0.01999790407717228, -0.011236101388931274, -0.010250667110085487, -0.018744688481092453, 0.027699293568730354, 0.0066731092520058155, 0.0020177317783236504, -0.01548846811056137, -0.005607339553534985, -0.024443073198199272, -0.047857865691185, 0.006501729134470224, -0.012767810374498367, -0.027913518249988556, 0.009859706275165081, -0.01950518786907196, -0.022793540731072426, -0.004854874219745398, -0.003127685049548745, -0.024614453315734863, -0.007872768677771091, 0.016216833144426346, 0.01813414692878723, -0.03239082172513008, -0.002021748572587967, -0.05025718733668327, 0.015467045828700066, -0.007315784227102995, 0.004163998644798994, 0.005304746795445681, -0.014985039830207825, 0.018284104764461517, -0.008643979206681252, -0.031169738620519638, 0.030269993469119072, 0.016923775896430016, -0.028084898367524147, 0.007556787226349115, 0.021872373297810555, 0.023007765412330627, 0.023800399154424667, -0.001492880517616868, -0.01209300197660923, 0.01844477280974388, -0.03416888788342476, -0.004935208708047867, 0.0016401602188125253, -0.03410462290048599, -0.006914112251251936, 0.01579909399151802, -0.0008963977452367544, -0.009302721358835697, -0.0239289328455925, 0.019869370386004448, -0.023200567811727524, 0.012500029057264328, -0.009479456581175327, 0.02497863583266735, 0.03191952779889107, -0.02992723323404789, -0.0064749508164823055, -0.015638425946235657, 0.003973873797804117, 0.0026309508830308914, 0.04550139233469963, 0.03071986697614193, 0.026114027947187424, 0.05222805589437485, 0.006357127334922552, -0.015295665711164474, 0.007738878484815359, -5.522988431039266e-05, -0.013742534443736076, 0.019130293279886246, 0.021508190780878067, 0.01765214093029499, 0.020019326359033585, 0.02568557858467102, 0.014224540442228317, -0.018294814974069595, -0.02493579126894474, -0.041216891258955, 0.001658904948271811, -0.02943451702594757, 0.04515863209962845, 0.023671863600611687, -0.017855655401945114, 0.03483298793435097, -0.006196458358317614, -0.017502183094620705, -0.0006132191047072411, 0.013260528445243835, 0.0018758077640086412, -0.005676962900906801, -0.00036183942575007677, 0.011418192647397518, -0.022493625059723854, -0.0016910387203097343, -0.009682970121502876, -0.012125135399401188, -0.00044652525684796274, -0.053213492035865784, -0.0021007440518587828, 0.018251970410346985, 0.00030543800676241517, 0.00024451775243505836, -0.015863362699747086, 0.00031631661113351583, -0.08183395117521286, 0.025449931621551514, -0.026199718937277794, -0.03326914459466934, 0.02096191793680191, -0.000970037595834583, -0.021604591980576515, -0.029455939307808876, 0.006603485904633999, -0.002825092291459441, 0.019076736643910408, 0.013721112161874771, -0.00975794903934002, -0.06773794442415237, 0.011161123402416706, 0.016880931332707405, 0.01169668510556221, -0.024742988869547844, 0.018284104764461517, -0.033611904829740524, -0.030527064576745033, -0.027699293568730354, -0.06820924580097198, 0.010379201732575893, 0.0006383236031979322, -0.019719412550330162, 0.003285676008090377, -0.01663457229733467, 0.008199462667107582, -0.02776356041431427, -0.03783213719725609, 0.011643129400908947, 0.01012748759239912, -0.02069413661956787, -0.025899803265929222, 0.011675262823700905, 0.007894191890954971, 0.033783283084630966, 0.0005014204070903361, 0.002380575519055128, -0.007513942196965218, -0.04162392020225525, 0.01959087699651718, -0.015788383781909943, 0.01866970956325531, -0.011300369165837765, -0.00867075752466917, 0.00918489694595337, 0.0145673006772995, -0.003266931278631091, -0.007642477285116911, -0.021883085370063782, -0.036611054092645645, -0.010379201732575893, 0.007256872020661831, 0.03920317813754082, -0.011268235743045807, 0.0050690993666648865, 0.010614849627017975, 0.017898499965667725, 0.015402778051793575, 0.002577394712716341, 0.013464041985571384, -0.044558800756931305, -0.0013348895590752363, -0.02617829665541649, 8.142223668983206e-05, -0.005607339553534985, -0.011889488436281681, -0.04725803807377815, 0.0026764736976474524, 0.03335483372211456, -0.001728528062812984, -0.010641627013683319, 0.010523803532123566, -0.0041425758972764015, 0.0002589109935797751, 0.020469199866056442, 0.018916068598628044, -0.0028545481618493795, -0.027463646605610847, -0.0010664388537406921, 0.02026568539440632, -0.0002953961957246065, -0.014813659712672234, -0.0064749508164823055, 0.007133692968636751, -0.0036980591248720884, -0.0030660955235362053, 0.019258828833699226, 0.03288353979587555, -0.01694519817829132, 0.020597735419869423, -0.013646133244037628, -0.030612753704190254, -0.0032588979229331017, -0.02281496301293373, -0.006362482905387878, 0.01145032700151205, -0.0045683481730520725, 0.016923775896430016, 0.009104562923312187, -0.02947736158967018, 0.031126894056797028, -0.03324772045016289, 0.008922471664845943, -0.03001292422413826, -0.002731368876993656, 0.00955979060381651, 0.033697593957185745, -0.007974525913596153, 0.005532360635697842, -0.004584415350109339, -0.014106716960668564, -0.010025730356574059, -0.013389063067734241, 0.047686487436294556, -0.056384023278951645, -0.049057528376579285, 0.0165488813072443, -0.02542850933969021, 0.037982095032930374, 0.026799548417329788, 0.031276851892471313, 0.014867215417325497, 0.032198019325733185, -0.012907057069242, -0.04348767548799515, 0.002617561724036932, 0.011568150483071804, -0.01779138669371605, 0.006742732133716345, -0.004011363256722689, 0.008622556924819946, -0.03971731662750244, -0.007272939197719097, 0.017759252339601517, -0.04147396236658096, -0.011921621859073639, -0.019719412550330162, 0.007010513450950384, -0.006930178962647915, 0.010036441497504711, -0.018027033656835556, -0.05981162190437317, -0.020886939018964767, 0.0010979031212627888, -0.0134211964905262, -0.010673761367797852, 0.02242935821413994, -0.0210154727101326, -0.018744688481092453, 0.028577616438269615, 0.005358302965760231, -0.03671816736459732, 8.644313493277878e-05, -0.010823718272149563, -0.02339337021112442, -0.014353075996041298, 0.01721297949552536, 0.002427437109872699, 0.08316215127706528, -0.009056362323462963, 0.015081441029906273, -8.928831084631383e-05, 0.011461038142442703, -0.017009465023875237, 0.015209975652396679, -0.04640113562345505, 0.01967656798660755, -0.05137115716934204, 0.0005074454820714891, -0.004975375719368458, -0.013399774208664894, 0.022922076284885406, 0.006378549616783857, 0.0341474674642086, -0.020501334220170975, -0.004276466555893421, 0.041688185185194016, 0.018573308363556862, 0.0541132390499115, -0.018680421635508537, -0.008890338242053986, 0.003315132111310959, -0.007385407108813524, 0.016345368698239326, 0.04391612857580185, -0.020458487793803215, -0.006560640875250101, 0.0013938014162704349, 0.03556135296821594, -0.030741289258003235, 0.0015758926747366786, -0.03234797716140747, -0.020072882995009422, 0.034276001155376434, -0.010759451426565647, -0.031533923000097275, -0.0056341178715229034, -0.014620857313275337, 0.02763502672314644, -0.0036364695988595486, -0.025449931621551514, 0.03526143729686737, 0.04678674042224884, 0.004091697745025158, -0.001027610618621111, -0.038496233522892, -0.022386513650417328, 0.01660243794322014, -0.03879614919424057, -0.009125985205173492, -0.009399122558534145, -0.0008595778490416706, -0.01450303290039301, -0.015863362699747086, 0.026542479172348976, -0.013453330844640732, -0.006341060157865286, 0.02701377309858799, -0.0168595090508461, -0.005294035654515028, 0.038110628724098206, 0.016698839142918587, -0.0006306248833425343, -0.0018450128845870495, 0.019740834832191467, 0.020811960101127625, 0.0012860194547101855, 0.01619541086256504, -0.026028338819742203, -0.0008468582527711987, -0.009811505675315857, 0.0524422824382782, -0.03916032984852791, 0.011514593847095966, -0.005269935354590416, 0.02476441115140915, 0.013410485349595547, 0.012414338998496532, 0.019387362524867058, -0.01813414692878723, -0.02405746839940548, 0.03560419753193855, 0.03412604331970215, -0.004035463556647301, 0.038988951593637466, 0.004212199244648218, -0.008076283149421215, 0.005427926313132048, -0.0003916301066055894, -0.0052163791842758656, 0.006458884105086327, -0.013164127245545387, -0.008724313229322433, 0.01196446642279625, 0.013935336843132973, -0.0030366394203156233, 0.009233097545802593, 0.017887787893414497, -0.002580072497949004, -0.015456334687769413, -0.01436378713697195, -0.022322246804833412, -0.011739530600607395, -0.014727969653904438, 0.02877041883766651, 0.026992350816726685, 0.038646191358566284, 0.005778719671070576, -0.0015035917749628425, 0.04143111780285835, 0.023950355127453804, -0.027870673686265945, -0.023286258801817894, -0.0002958982950076461, -0.010100709274411201, 0.014749391935765743, 0.008579711429774761, 0.01182522065937519, 0.01779138669371605, -0.026949506253004074, 0.006844488903880119, 0.03826058655977249, -0.02834196947515011, -0.02493579126894474, -0.03146965429186821, 0.00871360208839178, -0.017973478883504868, 0.02079053781926632, 0.005934032611548901, -0.036611054092645645, 0.03624686971306801, 0.05012865364551544, -0.004737050738185644, 0.06396758556365967, 0.01760929636657238, 0.005548427812755108, -0.011975177563726902, -0.009982885792851448, -0.009024228900671005, -0.005660895723849535, -0.03920317813754082, 0.0004729686479549855, 0.017266536131501198, 0.028449080884456635, -0.03746795281767845, -0.0097311707213521, 0.006464239675551653, -0.028084898367524147, 0.009104562923312187, -0.012585719116032124, 0.00048100209096446633, 0.00031899442547000945, 0.011835931800305843, -0.020490622147917747, -0.00563947344198823, -0.02251504920423031, -0.012660698033869267, -0.013806802220642567, 0.01756644994020462, 0.00891176052391529, -0.0524422824382782, -0.03425458073616028, -0.012157268822193146, 0.0012927140342071652, 0.010887986049056053, 0.014470899477601051, 0.00563947344198823, 0.02705661952495575, -0.020886939018964767, 0.004233621526509523, 0.02388608828186989, -0.01145032700151205, -0.0022748017217963934, -0.0320480614900589, -0.026413943618535995, -0.018209125846624374, -0.02083338238298893, -0.013249816372990608, 0.00034342947765253484, -0.01664528250694275, 0.013956759124994278, 0.020383508875966072, 0.010898697189986706, -0.0013469397090375423, 0.006973023992031813, 0.030291415750980377, 0.009832927957177162, 0.046015530824661255, -0.0006821727729402483, 0.013731823302805424, 0.004482658114284277, -0.001956142019480467, -0.02277211844921112, -0.00013539689825847745, 0.012596430256962776, 0.017223691567778587, -0.01880895532667637, -0.01910887099802494, 0.02979869954288006, 0.005162822548300028, 0.014406631700694561, 0.017502183094620705, 0.023136300966143608, 0.024528764188289642, 0.030441373586654663, 0.019098158925771713, 0.002529194112867117, 0.018873224034905434, 0.0482863187789917, 0.022365091368556023, -0.010743384249508381, 0.011182545684278011, 0.008322641253471375, -0.003831949783489108, 0.0007330512162297964, 0.03500436618924141, 0.053427718579769135, 0.036653898656368256, -0.0070158690214157104, -0.032455090433359146, 0.004308600444346666, -0.03376186266541481, 0.022922076284885406, 0.022707851603627205, 0.005730519071221352, -0.005907254759222269, -0.0019588200375437737, 0.024335961788892746, 0.00949016772210598, -0.019398074597120285, -0.004372868221253157, 0.012103713117539883, 0.012114424258470535, 0.03575415536761284, -0.013646133244037628, -0.0009660209179855883, -0.018594730645418167, -0.002359153004363179, -0.04220232740044594, 0.03389039635658264, -0.02356475032866001, -0.0018021678552031517, -0.04541570320725441, -0.0006989091052673757, 0.013239105232059956, 0.01991221494972706, 0.018112724646925926, -0.01642034761607647, -0.020072882995009422, 0.030419951304793358, 0.04143111780285835, 0.00437019020318985, -0.03217659518122673, 0.030077191069722176, -0.0006969007081352174, -0.023286258801817894, 0.05094270780682564, -0.021326100453734398, -0.016848796978592873, 0.011311080306768417, -0.01730938069522381, -0.020929783582687378, 0.013346218504011631, 0.024507341906428337, 0.0030366394203156233, 0.023736130446195602, 0.047472260892391205, 0.019301673397421837, -0.015991896390914917, -0.013946047984063625, 0.01304630283266306, -0.0013583204708993435, 0.02127254381775856, 0.04867192357778549, 0.01589549519121647, -0.013474753126502037, -0.018198413774371147, 0.04400181770324707, 0.0424593985080719, 0.013828224502503872, -0.012639275752007961, 0.002538566244766116, 0.02422884851694107, 0.007883480750024319, -0.0019507864490151405, -0.026820970699191093, 0.0026282730977982283, 0.011236101388931274, -0.010748740285634995, 0.0037034149281680584, 0.008997450582683086, -0.03256219998002052, -0.008826070465147495, -0.04503009840846062, 0.00203112093731761, -0.013099859468638897, 0.017716407775878906, -0.0004659394035115838, 0.003746259957551956, -0.013142704032361507, -0.0226864293217659, -0.012949901632964611, -0.030419951304793358, -0.00045020724064670503, 0.009977529756724834, -0.02480725571513176, -0.01425667479634285, -0.004605837631970644, -0.01849832944571972, 0.011932333000004292, -0.005012865178287029, -0.006319637876003981, -0.004509436432272196, 0.01690235361456871, -0.020822670310735703, 0.015809806063771248, -0.0028384814504534006, 0.021658148616552353, -0.012746388092637062, 0.02506432682275772, -0.01800561137497425, -0.01742720417678356, 0.00955443549901247, -0.024871524423360825, -0.011118277907371521, 0.0013020863989368081, -0.0018771466566249728, -0.023778976872563362, 0.03941740095615387, -0.008836781606078148, -0.0049700201489031315, -0.0016495325835421681, 0.007754945196211338, 0.015102863311767578, -0.014995750971138477, 0.01791992224752903, 0.03170530125498772, -0.014578011818230152, -0.016784530133008957, 0.00830121897161007, 0.02506432682275772, 0.017138000577688217, -0.026156874373555183, -0.0182198379188776, -0.010700538754463196, -0.007508586626499891, 0.0005265249055810273, 0.025150015950202942, -0.014492321759462357, 0.010164977051317692, -0.00891176052391529, 0.004163998644798994, -0.017769964411854744, -0.008070927113294601, 0.01132179144769907, 0.011814509518444538, 0.022215133532881737, -0.005891187582165003, 0.0038346275687217712, 0.0011253507109358907, 0.013581865467131138, 0.034233156591653824, -5.602485907729715e-05, -0.010202466510236263, 0.012607141397893429, -0.010909408330917358, 0.000936564989387989, -0.02326483651995659, -0.019012469798326492, -0.014770814217627048, -0.010764806531369686, -0.017705697566270828, 0.0038935395423322916, -0.022257978096604347, -0.0013442619238048792, -0.028898954391479492, -0.036353982985019684, 0.011514593847095966, 0.000674139300826937, -0.006116123870015144, 0.018155569210648537, -0.016302522271871567, 0.027335111051797867, -0.013324795290827751, 0.008815359324216843, 0.00252651609480381, 0.028170589357614517, 0.012596430256962776, 0.0059447442181408405, -0.04200952500104904, -0.018348371610045433, -0.007685322314500809, 0.011257524602115154, 0.0020297819282859564, 0.020769115537405014, -0.01023995503783226, -0.01734151504933834, -0.01169668510556221, 0.03429742529988289, 0.0005379056092351675, -0.010588071309030056, 0.04687243327498436, 0.005971522070467472, -0.000602842541411519, 0.006785577163100243, 0.006699887104332447, -0.006780221592634916, -0.0001497901394031942, 0.002459570998325944, -0.02070484682917595, -0.031169738620519638, 0.010234599933028221, -0.025364240631461143, 0.014438766054809093, -0.0127999447286129, -0.015702692791819572, -0.029670163989067078, 0.051885295659303665, -0.005655540153384209, 0.03826058655977249, 0.012489317916333675, 0.026606746017932892, -0.0332905650138855, -0.0037489377427846193, -0.04584415256977081, 0.0335262157022953, -0.029455939307808876, -0.005323491524904966, 0.03491867706179619, -0.028170589357614517, -0.0008381553343497217, 0.0039551290683448315, 0.004421068821102381, 0.013431907631456852, 0.0037435819394886494, -0.02422884851694107, 0.0030045057646930218, 0.030120035633444786, 0.017362937331199646, -0.006341060157865286, -0.04815778136253357, -0.0011079449905082583, 0.0011327146785333753, 0.0030821622349321842, -0.050300031900405884, -0.006041145417839289, 0.010491670109331608, -0.013871069066226482, 0.011000454425811768, -0.030441373586654663, 0.002580072497949004, 0.019398074597120285, -0.029027488082647324, -0.01288563385605812, -0.008868915028870106, 0.001595976296812296, 0.019044604152441025, 0.018594730645418167, 0.0332905650138855, -0.001683005248196423, 0.00728365033864975, -0.02176526002585888, 0.05582703649997711, -0.00033790647285059094, -0.05732661113142967, 0.030484218150377274, -0.03991011902689934, 0.013624710962176323, -0.006544574163854122, -0.006769510451704264, -0.002894715406000614, -0.022707851603627205, -0.0007953103631734848, 0.006100057158619165, 0.00221856776624918, 0.03410462290048599, -0.018637575209140778, -0.02440022863447666, -0.013078437186777592, 0.02347906120121479, -0.028748996555805206, 0.017502183094620705, -0.0407884418964386, -0.006448172964155674, -0.03354763612151146, -0.02493579126894474, -0.03521859273314476, -0.03916032984852791, -0.011300369165837765, 0.004785251338034868, 0.003108940552920103, 0.008879626169800758, 0.005098555237054825, -0.01902318000793457, -0.0009111257386393845, -0.019933637231588364, 0.011246812529861927, -0.02410031296312809, -0.03498294577002525, -0.004881652537733316, -0.04170960932970047, 0.006314282305538654, 0.018348371610045433, 0.006217881105840206, -0.038946107029914856, -0.04987158253788948, -0.0008542222203686833, -0.001127359108068049, -0.00918489694595337, -0.005982233211398125, -0.01880895532667637, 0.01664528250694275, 0.031191160902380943, -0.04640113562345505, 0.012628564611077309, 0.03243366628885269, -0.029820121824741364, -0.013035591691732407, 0.010422046296298504, 0.010057863779366016, 0.009607991203665733, 0.00860648974776268, 0.011482460424304008, 0.012457184493541718, -0.012692831456661224, 0.027163730934262276, 0.011707397177815437, -0.03425458073616028, -0.011621707119047642, 0.013228394091129303, 0.017148712649941444, -0.021069029346108437, 0.007449674885720015, -0.04055279493331909, -0.010089998133480549, -0.024828677996993065, -0.016270389780402184, -0.03279785066843033, 0.03138396516442299, -0.004043497145175934, 0.037189461290836334, 0.021026184782385826, -0.0009325482533313334, -0.019665855914354324, 0.010138198733329773, -0.035068634897470474, 0.03633256256580353, -0.03483298793435097, 0.012414338998496532, 0.021465346217155457, 0.01202873419970274, -0.05805497616529465, 0.030077191069722176, 0.005575205665081739, 0.024250270798802376, 0.025042902678251266, 0.005205667577683926, -0.01854117400944233, -0.013035591691732407, 0.032198019325733185, -6.037630737409927e-05, -0.008381553925573826, -0.026713859289884567, 0.00955979060381651, -0.007449674885720015, 0.008745736442506313, -0.013678266666829586, 0.01531708799302578, -0.0405956394970417, -0.010031086392700672, -0.01487792655825615, -0.0023497806396335363, 0.0033258432522416115, -0.00569302961230278, 0.008515443652868271, 0.017277246341109276]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-14T10:07:19.367708", "url_path": "/api/agent/", "chunk_size": 5000}
updated_dt: 2025-03-14T10:07:22.298503
---
```
  Args:
    user_prompt: User input to start/continue the conversation.
    result_type: Custom result type to use for this run, `result_type` may only be used if the agent has no
      result validators since result validators would expect an argument that matches the agent's result type.
    message_history: History of the conversation so far.
    model: Optional model to use for this run, required if `model` was not set when creating the agent.
    deps: Optional dependencies to use for this run.
    model_settings: Optional settings to use for this model's request.
    usage_limits: Optional limits on model request count or token usage.
    usage: Optional usage to start with, useful for resuming a conversation or agents used in tools.
    infer_name: Whether to try to infer the agent name from the call frame if it's not set.
  Returns:
    The result of the run.
  """
  # TODO: We need to deprecate this now that we have the `iter` method.
  #  Before that, though, we should add an event for when we reach the final result of the stream.
  if infer_name and self.name is None:
    # f_back because `asynccontextmanager` adds one frame
    if frame := inspect.currentframe(): # pragma: no branch
      self._infer_name(frame.f_back)
  yielded = False
  async with self.iter(
    user_prompt,
    result_type=result_type,
    message_history=message_history,
    model=model,
    deps=deps,
    model_settings=model_settings,
    usage_limits=usage_limits,
    usage=usage,
    infer_name=False,
  ) as agent_run:
    first_node = agent_run.next_node # start with the first node
    assert isinstance(first_node, _agent_graph.UserPromptNode) # the first node should be a user prompt node
    node = first_node
    while True:
      if self.is_model_request_node(node):
        graph_ctx = agent_run.ctx
        async with node._stream(graph_ctx) as streamed_response: # pyright: ignore[reportPrivateUsage]
          async defstream_to_final(
            s: models.StreamedResponse,
          ) -> FinalResult[models.StreamedResponse] | None:
            result_schema = graph_ctx.deps.result_schema
            async for maybe_part_event in streamed_response:
              if isinstance(maybe_part_event, _messages.PartStartEvent):
                new_part = maybe_part_event.part
                if isinstance(new_part, _messages.TextPart):
                  if _agent_graph.allow_text_result(result_schema):
                    return FinalResult(s, None, None)
                elif isinstance(new_part, _messages.ToolCallPart) and result_schema:
                  for call, _ in result_schema.find_tool([new_part]):
                    return FinalResult(s, call.tool_name, call.tool_call_id)
            return None
          final_result_details = await stream_to_final(streamed_response)
          if final_result_details is not None:
            if yielded:
              raise exceptions.AgentRunError('Agent run produced final results')
            yielded = True
            messages = graph_ctx.state.message_history.copy()
            async defon_complete() -> None:
"""Called when the stream has completed.
              The model response will have been added to messages by now
              by `StreamedRunResult._marked_completed`.
              """
              last_message = messages[-1]
              assert isinstance(last_message, _messages.ModelResponse)
              tool_calls = [
                part for part in last_message.parts if isinstance(part, _messages.ToolCallPart)
              ]
              parts: list[_messages.ModelRequestPart] = []
              async for _event in _agent_graph.process_function_tools(
                tool_calls,
                final_result_details.tool_name,
                final_result_details.tool_call_id,
                graph_ctx,
                parts,
              ):
                pass
              # TODO: Should we do something here related to the retry count?
              #  Maybe we should move the incrementing of the retry count to where we actually make a request?
              # if any(isinstance(part, _messages.RetryPromptPart) for part in parts):
              #   ctx.state.increment_retries(ctx.deps.max_result_retries)
              if parts:
                messages.append(_messages.ModelRequest(parts))
            yield StreamedRunResult(
              messages,
              graph_ctx.deps.new_message_index,
              graph_ctx.deps.usage_limits,
              streamed_response,
              graph_ctx.deps.result_schema,
              _agent_graph.build_run_context(graph_ctx),
              graph_ctx.deps.result_validators,
              final_result_details.tool_name,
              on_complete,
            )
            break
      next_node = await agent_run.next(node)
      if not isinstance(next_node, _agent_graph.AgentNode):
        raise exceptions.AgentRunError('Should have produced a StreamedRunResult before getting here')
      node = cast(_agent_gr