---
url: https://ai.pydantic.dev/api/agent/
session_id: pydantic_ai_docs
chunk_number: 24
title: Agent Graph Context Manager Overview
summary: This chunk describes a context manager for iterating over the nodes of an agent graph during execution, utilizing an `AgentRun` object. It highlights the ability to access LLM model responses, message history, new messages, usage statistics, and the final result. An example of usage is provided, demonstrating how to use the context manager with an agent.
embedding: [-0.02043072320520878, 0.055845413357019424, -0.0039316765032708645, -0.05743853375315666, 0.007066791411489248, 0.00017761166964191943, 0.025016333907842636, -0.0007561951060779393, 0.024499645456671715, -0.002719342242926359, -0.02820257842540741, -0.03453201428055763, -0.013638422824442387, -0.06221790239214897, -0.01105498056858778, -0.01997862011194229, -0.02117346227169037, -0.01742747239768505, 0.004335339181125164, 0.02525314874947071, 0.04172259569168091, -0.03666335344314575, 0.01412281859666109, 0.014714857563376427, -0.03347710892558098, 0.015985049307346344, -0.039419025182724, 0.05248693749308586, -0.016135750338435173, 0.022045375779271126, -0.0013744720490649343, -0.005801980849355459, -0.026523342356085777, 0.003285815706476569, 0.02473646029829979, -0.03248678892850876, 0.0040231733582913876, -2.2916276520845713e-06, -0.009090487845242023, 0.037395328283309937, 0.03711545467376709, -0.03584526106715202, 0.03420908376574516, 0.030656849965453148, -0.02195926010608673, -0.0027529806829988956, 0.005958063993602991, 0.02691085822880268, 0.028913026675581932, -0.006001121364533901, -0.030936721712350845, 0.031927041709423065, -0.00456139026209712, 0.030979780480265617, -0.03347710892558098, 0.008304690942168236, 0.01527460291981697, 0.010866604745388031, -0.008789085783064365, -0.044478267431259155, 0.025489965453743935, 0.002960194367915392, 0.003226611763238907, 0.041980937123298645, -0.03776131570339203, 0.01567288301885128, -0.009354214183986187, 0.041830237954854965, -0.040495458990335464, 0.0009876284748315811, 0.03978501260280609, 0.02624346874654293, -0.06006503477692604, -0.028913026675581932, -0.04047393053770065, -0.013746066018939018, 0.033735450357198715, 0.04320807382464409, -0.017373649403452873, -0.01834244094789028, 0.004486040212213993, 0.017039954662322998, 0.03873010724782944, 0.021776266396045685, 0.03483341634273529, -0.0576968789100647, -0.04770756885409355, -0.026372641324996948, 0.0028256401419639587, -0.06092618405818939, -0.014994730241596699, 0.031453412026166916, 0.004335339181125164, 0.07074326276779175, 0.05184107646346092, 0.04426297917962074, -0.019548047333955765, -0.008024818263947964, 0.023487797006964684, 0.04327265918254852, 0.05110910162329674, -0.024714931845664978, -0.017911866307258606, 0.017944160848855972, -0.013853710144758224, -0.011011922731995583, -0.004453747067600489, -0.002337208017706871, -0.029451243579387665, -0.039526667445898056, -0.06566249579191208, -0.005807362962514162, -0.009241188876330853, 0.03547927364706993, -0.061141468584537506, -0.038514818996191025, -0.006119529251009226, -0.008234722539782524, 0.040839917957782745, -0.015543711371719837, -0.02740601822733879, 0.006345580331981182, -0.025683723390102386, 0.00668465718626976, 0.018008746206760406, 0.014359633438289165, -0.02785811945796013, -0.02757824771106243, 0.002633227501064539, -0.02785811945796013, 0.00855227094143629, 0.008988226763904095, -0.02708308771252632, -0.012863390147686005, -0.008223958313465118, -0.013100205920636654, -0.03875163570046425, 0.00381326861679554, -0.03502717241644859, 0.02557607926428318, 0.009138927794992924, -0.018041038885712624, -0.031087422743439674, -0.00011184825416421518, 0.020097028464078903, 0.05976363271474838, -0.041012149304151535, 0.041356608271598816, -0.013724537566304207, 0.02193773165345192, 0.03162563964724541, 0.022971108555793762, -0.03498411551117897, 0.004184638615697622, -0.029946403577923775, -0.0072928424924612045, 0.014402691274881363, -0.010226125828921795, 0.0022537843324244022, -0.05558706820011139, -0.014251990243792534, 0.045425526797771454, -0.04047393053770065, -0.02226066216826439, -0.02043072320520878, -0.04736310988664627, -0.020613716915249825, -0.016135750338435173, -0.017222948372364044, -0.034919530153274536, 0.005212633404880762, -0.008993608877062798, -0.036361951380968094, 0.027965763583779335, 0.024542702361941338, -0.01944040320813656, -0.09455399215221405, -0.0012002242729067802, -0.025511493906378746, -0.044951897114515305, -0.014585684984922409, -0.0041684918105602264, -0.04533941298723221, -0.026372641324996948, -0.05214247852563858, -0.012077593244612217, 0.005357951857149601, -0.0038536349311470985, -0.005425229202955961, -0.004257297609001398, 0.048267316073179245, 0.04706170782446861, 0.01896677352488041, -0.0009317884687334299, -0.013154027052223682, 0.012325173243880272, 0.041033677756786346, 0.008875200524926186, 0.04023711383342743, 0.03246526047587395, 0.010274565778672695, 0.008611474186182022, 0.025167034938931465, 0.020904354751110077, 0.013724537566304207, -0.04753534123301506, 0.00550327030941844, -0.016921548172831535, -0.013132498599588871, 0.009246570989489555, 0.02490868978202343, -0.03517787531018257, 0.011388675309717655, -0.02691085822880268, -0.01565135456621647, -0.03184092789888382, -0.045511644333601, 0.016953840851783752, -0.0008059801766648889, 0.020559895783662796, 0.03597443550825119, 0.03330487757921219, -0.004634049721062183, 0.0008598018903285265, 0.003199700964614749, 0.014338104985654354, -0.020538367331027985, -0.02938665635883808, 0.015080844983458519, 0.056319043040275574, -0.026157354936003685, -0.0015863950829952955, -0.028826911002397537, -0.0485687181353569, 0.026781685650348663, -0.06381102651357651, 0.016458680853247643, 0.013853710144758224, 0.0422823391854763, -0.049214575439691544, -0.019924798980355263, 0.014327340759336948, 0.02753519080579281, 0.01386447437107563, 0.020215436816215515, 0.011937656439840794, 0.03035544790327549, -0.03321876376867294, 0.03664182499051094, 0.04040934517979622, 0.03526398912072182, -0.004491422325372696, -0.014682563953101635, -0.030161689966917038, -0.005694337654858828, 0.012895682826638222, -0.02919289842247963, -0.014553392305970192, -0.019892506301403046, -0.005532872397452593, 0.04439214989542961, 0.00961794052273035, -0.006878415122628212, 0.011743898503482342, -0.012486638501286507, -0.0023089516907930374, 0.01569441333413124, -0.03364933654665947, -0.01412281859666109, -0.05606069788336754, 0.01501625869423151, -0.009402654133737087, 0.017018426209688187, -0.0458991602063179, -0.028956083580851555, 0.038859277963638306, 0.016996897757053375, 0.03328334912657738, -0.004733619745820761, -0.05050629749894142, 0.004943524487316608, 0.055199552327394485, 0.02740601822733879, 0.05214247852563858, -0.008315455168485641, -0.012572753243148327, 0.011819249019026756, -0.025016333907842636, 0.04977432265877724, 0.010764343664050102, 0.034230612218379974, 0.010931190103292465, 0.039677370339632034, -0.0016684732399880886, 0.031152009963989258, -0.061141468584537506, 0.05614681541919708, 0.018923714756965637, 0.0016523266676813364, -0.013067912310361862, -0.0056028407998383045, -0.014305812306702137, 0.03328334912657738, -0.03248678892850876, 0.011151859536767006, 0.03431672602891922, -0.010952719487249851, -0.014079760760068893, 0.014144347049295902, -7.00102755217813e-05, -0.015758998692035675, 0.09954864531755447, -0.02852550894021988, -0.005565165542066097, -0.010667463764548302, 0.01516695972532034, 0.04213164001703262, -0.03562997654080391, 0.048267316073179245, 0.0006694076000712812, -0.011926892213523388, -0.017858045175671577, 0.03944055363535881, 0.026114296168088913, -0.030786020681262016, 0.012518931180238724, 0.016480209305882454, -0.009284245781600475, -0.03147494047880173, 0.03453201428055763, 0.012486638501286507, -0.029300542548298836, -0.003272360423579812, 0.013972117565572262, 0.03166869655251503, -0.02156098000705242, -0.013552308082580566, 0.01287415437400341, 0.029429715126752853, 0.05976363271474838, -0.05330502614378929, -0.017858045175671577, -0.047104764729738235, -0.014155111275613308, 0.014628742821514606, 0.059117771685123444, 0.029623473063111305, 0.02493021823465824, -0.035586919635534286, 0.02456423081457615, 0.024951746687293053, 0.02542537823319435, 0.023832255974411964, 0.017858045175671577, -0.009192748926579952, -0.017266007140278816, 0.0030328535940498114, 0.008939786814153194, -0.034725770354270935, 0.015758998692035675, -0.08753564208745956, -0.029085256159305573, -0.0032885067630559206, -0.00509960763156414, -0.053391143679618835, -0.020656773820519447, -0.03164716809988022, 0.02378919906914234, 0.0070129698142409325, 0.04998961091041565, 0.07285307347774506, 0.03298194706439972, -0.0006445150356739759, -0.035242460668087006, 0.00218516169115901, -0.01576976291835308, -0.0373307429254055, -0.0055113439448177814, 0.027599776163697243, 0.026006653904914856, 0.03681405261158943, 0.042325396090745926, 0.006297140847891569, -0.004397234413772821, 0.04783673956990242, 0.012185236439108849, -0.022863464429974556, -0.0007023733924143016, 0.0009082414326258004, 0.04899929091334343, 0.04697559401392937, -0.04376782104372978, -0.007911792024970055, 0.0011511119082570076, -0.0396127812564373, -0.0009149691904895008, 0.028611624613404274, 0.003199700964614749, 0.03767520189285278, 0.00651242770254612, -0.010581349022686481, -0.026523342356085777, -0.024628818035125732, 0.03664182499051094, 0.02327251061797142, -0.0044106896966695786, 0.054725922644138336, -0.013121734373271465, 0.033089589327573776, 0.030463092029094696, 0.0558023564517498, 0.01021536160260439, 0.0018097552238032222, -0.01849314197897911, -0.007911792024970055, -0.026114296168088913, -0.0030705288518220186, -0.02344474010169506, 0.01891295053064823, 0.0603664368391037, -0.030764492228627205, -0.0784505307674408, 0.0005940572009421885, 0.018428554758429527, -0.020958175882697105, 0.06927931308746338, 0.0491284616291523, -0.04486578330397606, -0.03926832228899002, 0.01820250414311886, 0.02936512790620327, 0.038342591375112534, 0.03246526047587395, -0.005236852914094925, -0.014908615499734879, -0.01944040320813656, 0.01904212310910225, 0.015403775498270988, -0.031431883573532104, 0.009327303618192673, 0.05873025581240654, -0.04211011156439781, 0.045425526797771454, 0.046114444732666016, -0.045468587428331375, -0.005715866107493639, -0.03360627964138985, -0.008396187797188759, 0.021410278975963593, -0.03395073860883713, -0.0035629975609481335, -0.002621117513626814, -0.04400463402271271, -0.008945168927311897, -0.0567496158182621, -0.03595290705561638, 0.06983906030654907, 0.018256325274705887, 0.052228592336177826, 0.0036356570199131966, -0.002081554848700762, 0.012820332311093807, -0.012594281695783138, 0.017319828271865845, -0.028008820489048958, 0.037524498999118805, 0.0045075686648488045, -0.025834424421191216, -0.008450009860098362, 0.036512650549411774, 0.027169201523065567, -0.024026013910770416, 0.02243289165198803, 0.005904242396354675, -0.01693231239914894, -0.023552382364869118, 0.012518931180238724, 0.020258493721485138, 0.00865453202277422, -0.008153989911079407, 0.0040420107543468475, -0.005043094977736473, 0.01096886582672596, 0.024026013910770416, -0.022325247526168823, 0.014854793436825275, -0.004714782349765301, -0.03367086499929428, -0.026760157197713852, 0.006996823009103537, 0.022884992882609367, 0.009693291038274765, 0.00949415098875761, -0.007804148830473423, 0.07319753617048264, 0.011173387989401817, -0.03444589674472809, -0.0085684172809124, -0.030979780480265617, -0.023487797006964684, -0.02708308771252632, -0.004486040212213993, 0.0015177724417299032, 0.07491982728242874, 0.014241226017475128, -0.029645001515746117, 0.009989310055971146, 0.01955881156027317, 0.019580340012907982, 0.06781536340713501, -0.03601749241352081, 0.011593197472393513, 0.040646158158779144, 0.02344474010169506, 0.009316539391875267, 0.015113137662410736, -0.013218613341450691, 0.001258082571439445, -0.013433900661766529, -0.02342321164906025, 0.020000150427222252, -0.0045990655198693275, 0.0046475050039589405, -0.023961428552865982, 0.032271500676870346, 0.01770734414458275, 0.045769985765218735, -0.03005404584109783, -0.0102368900552392, 0.009015137329697609, 0.009817080572247505, 0.0422823391854763, -0.004717473406344652, 0.03528551757335663, 0.005963446106761694, 0.020882826298475266, 0.03453201428055763, 0.02064600959420204, -0.042476098984479904, -0.024327415972948074, -0.003102821996435523, 0.024026013910770416, -0.02968805842101574, 0.00860609207302332, -0.01244358066469431, 0.016534030437469482, 0.025296205654740334, -0.032723601907491684, 0.019720276817679405, -0.010737432166934013, 0.032443732023239136, 0.010861222632229328, 0.049903493374586105, -0.027750477194786072, 0.036232780665159225, -0.0077287983149290085, -0.038514818996191025, -0.010005457326769829, 0.020183144137263298, -0.013832180760800838, -0.013423136435449123, -0.003622201504185796, 0.020936647430062294, -0.0111410953104496, 0.0030786022543907166, 0.02902066893875599, 0.009639468975365162, -0.030118633061647415, -0.020344609394669533, -0.013563072308897972, 0.027965763583779335, 0.014359633438289165, -0.014068996533751488, -0.03367086499929428, 0.010188451036810875, -0.029946403577923775, 0.021227285265922546, 0.00713137723505497, -0.05020489543676376, 0.04144272208213806, -0.010565202683210373, -0.03857940435409546, 0.010651317425072193, 0.008902112022042274, 0.020118556916713715, 0.006216408219188452, -0.03907456621527672, 0.00730360671877861, 0.005053859204053879, -0.0030893664807081223, 0.010355298407375813, -0.009741730988025665, 0.0030140161979943514, -0.013304728083312511, -0.03862246498465538, 0.002898299368098378, 0.035543862730264664, -0.0034284433349967003, -0.03954819589853287, 0.016157278791069984, 0.04357406124472618, 0.013746066018939018, -0.02488716132938862, 0.04508106783032417, 0.023509325459599495, -0.006264847703278065, 0.027815062552690506, 0.01592046394944191, -0.05003266781568527, -0.009488768875598907, 0.0006287049036473036, -0.029903344810009003, -0.01510237343609333, -0.021055055782198906, -0.0037971220444887877, 0.024456588551402092, -0.042476098984479904, 0.035716090351343155, 0.06962376832962036, -0.03515634313225746, 0.016544794663786888, 0.030635321512818336, 0.01814868301153183, 0.008358512073755264, 0.0019954401068389416, -0.006162586621940136, -0.042648326605558395, 0.004714782349765301, -0.019343525171279907, 0.043143488466739655, -0.06863345205783844, 0.014661035500466824, 0.023035693913698196, 0.015640590339899063, -0.04040934517979622, -0.011474790051579475, -0.04340183362364769, -0.03328334912657738, -0.007621155120432377, 0.0024556159041821957, 0.02292805165052414, 0.033326406031847, -0.023229451850056648, 0.0009452438680455089, -0.0047551486641168594, -0.007233638782054186, 0.0014774061273783445, -0.0033934591338038445, 0.024994805455207825, -0.02473646029829979, -0.035737618803977966, -0.024628818035125732, -0.011937656439840794, -0.014736386016011238, -0.006119529251009226, 0.0002707905077841133, 0.004739002324640751, 0.022669706493616104, -0.010048514232039452, -0.0002807138953357935, -0.006028032395988703, 0.009962399490177631, 0.009042047895491123, -0.009117398411035538, -0.05317585542798042, 0.01603887230157852, 0.025942066684365273, 0.017266007140278816, 0.027319902554154396, 0.0021421043202281, -0.01742747239768505, -0.005748159252107143, 0.017029190436005592, -0.0007165016140788794, 0.0205706600099802, 0.005072696600109339, -0.00794946774840355, 0.0031135862227529287, -0.018116390332579613, 0.028956083580851555, 0.0009432255756109953, -0.017621230334043503, -0.036878641694784164, 0.07306836545467377, 0.06505969166755676, -0.0057427771389484406, -0.005538254510611296, 0.003417678875848651, 0.029924873262643814, 0.03972042724490166, -0.011388675309717655, -0.01261581014841795, -0.030441561713814735, 0.01412281859666109, 0.016383331269025803, 0.005586693994700909, 0.004617903381586075, 0.015629826113581657, 0.0049973465502262115, -0.0247579887509346, -0.023961428552865982, 2.421977296762634e-05, 4.03400053983205e-06, 0.03194857016205788, -0.020764417946338654, 0.007793384604156017, -0.0055436366237699986, 0.005758923478424549, 0.014424219727516174, -0.03194857016205788, -0.011690076440572739, 0.01047370582818985, -0.03797660395503044, 0.009305775165557861, -0.012648102827370167, -0.006878415122628212, -0.0059311529621481895, 0.02639416977763176, -0.01475791446864605, -0.004292281810194254, -0.03156105428934097, 0.0123789943754673, -0.004943524487316608, 0.0031916277948766947, -0.015199252404272556, -0.0260927677154541, 0.006975294556468725, 0.0348549447953701, -0.013089441694319248, 0.005775070283561945, 0.004311119671911001, -0.026114296168088913, -0.00989243108779192, -0.020409194752573967, -0.030247803777456284, -0.029580414295196533, -0.026824742555618286, 0.027190731838345528, -0.02772894874215126, -0.006889179814606905, -0.01898830197751522, -0.004190020728856325, -0.04301431402564049, -0.022389834746718407, -0.009499533101916313, -0.030097102746367455, 0.0098063163459301, 0.035070229321718216, -0.010565202683210373, 0.0018299383809790015, -0.033713921904563904, 0.004292281810194254, 0.0009210241260007024, 0.00033319005160592496, 0.04637278988957405, 0.008358512073755264, 0.04325113072991371, -0.017621230334043503, -0.03806271776556969, 0.014004410244524479, -0.010371444746851921, 0.01700766198337078, -0.004195402842015028, 0.025123976171016693, 0.007529658265411854, -0.0008651840616948903, 0.02169015072286129, 0.03166869655251503, -0.016856960952281952, 0.002292805118486285, -0.02559760771691799, 0.005239543970674276, -0.00812169723212719, 0.014305812306702137, 0.013337021693587303, -0.03453201428055763, 0.040495458990335464, -0.018191739916801453, 0.013498486019670963, -0.026264997199177742, 0.008110933005809784, 0.005285292398184538, 0.0002514483348932117, 0.007427396718412638, 0.029128313064575195, -0.022368304431438446, -0.00398549810051918, -0.019677219912409782, -0.04671724885702133, -0.006463988218456507, -0.05033406987786293, -0.03054920583963394, 0.04620056226849556, 0.009843992069363594, 0.01565135456621647, 0.010688993148505688, 0.019504990428686142, -0.024047542363405228, -0.008197047747671604, 0.007276696152985096, -0.026932386681437492, 0.02889149636030197, -0.0247579887509346, -0.008084021508693695, 0.014338104985654354, -0.010699757374823093, 0.007820295169949532, 0.011474790051579475, 0.011420967988669872, -0.015446832403540611, -0.035070229321718216, 0.007960231974720955, -0.0013872546842321754, 0.0028094935696572065, 0.002680321456864476, 0.049257636070251465, -0.015888171270489693, -0.02884843945503235, 0.0071044666692614555, -0.06088312342762947, 0.008622239343822002, 0.018180975690484047, -0.005909624509513378, -0.014574920758605003, 0.04667419195175171, 0.03285277634859085, 0.009424182586371899, -0.03502717241644859, -0.03888080641627312, -0.018385497853159904, -0.01088275108486414, -0.03386462479829788, 0.04521024227142334, 0.008191665634512901, 0.04968820884823799, 0.010904279537498951, -0.02213148958981037, -0.005758923478424549, -0.03330487757921219, 0.0029198280535638332, 0.020559895783662796, 0.03530704602599144, -0.004940833430737257, -0.019591104239225388, 0.020441487431526184, 0.028159521520137787, 0.008040964603424072, 0.011399439536035061, 0.014779442921280861, 0.004044701810926199, -0.00903666578233242, 0.0544675774872303, 0.018880657851696014, -0.0342736691236496, -0.0020869369618594646, 0.021184228360652924, 0.022303719073534012, 0.001867613522335887, 0.019257409498095512, -0.018288619816303253, -0.029494300484657288, 0.0015029713977128267, 0.01293874066323042, -0.02195926010608673, 0.018331676721572876, 0.0009950289968401194, -0.017438236624002457, -0.03890233486890793, 0.004160418640822172, -0.01782575249671936, 0.00040769949555397034, 0.03515634313225746, 0.0035064849071204662, -0.0017882265383377671, 0.005915006622672081, 0.022820407524704933, -0.008304690942168236, 0.04477966949343681, -0.032099273055791855, 0.04327265918254852, 0.027427546679973602, -0.02312180958688259, -0.0020398430060595274, -0.00048675015568733215, -0.017459765076637268, -0.00672771455720067, 0.005608222912997007, 0.007169052492827177, -0.016178807243704796, 0.020538367331027985, -0.00646937033161521, -0.0689348503947258, 0.0038374883588403463, 0.011485554277896881, 0.04370323196053505, -0.0017249860102310777, 0.00329927122220397, 0.037201568484306335, 0.014822500757873058, -0.010107718408107758, 0.03270207345485687, -0.032422203570604324, 0.03879469260573387, -0.029085256159305573, -0.020463015884160995, -0.01412281859666109, 0.054725922644138336, 0.02129187062382698, 0.021948495879769325, -0.03364933654665947, -0.009537207894027233, -0.019946327432990074, -0.00042418239172548056, 0.06239013373851776, -0.040021829307079315, -0.06540414690971375, 0.006829975638538599, -0.031238123774528503, 0.017696579918265343, 0.020613716915249825, 0.012744982726871967, 0.025619136169552803, 0.023832255974411964, -0.013638422824442387, -0.021916203200817108, -0.016426388174295425, 0.027470603585243225, 0.008234722539782524, 0.0295158289372921, -0.03265901654958725, 0.026501813903450966, -0.045425526797771454, 0.01624339446425438, 0.02344474010169506, -0.0472339391708374, -0.016630910336971283, -0.011474790051579475, -0.011442496441304684, -0.008918258361518383, 0.03416602686047554, -0.0028014203999191523, -0.054855093359947205, 0.012841861695051193, -0.003762137843295932, 0.002672248287126422, 0.002276658546179533, 0.027664361521601677, -0.008084021508693695, 0.013659951277077198, 0.034230612218379974, 0.04307890310883522, -0.018234796822071075, 0.026932386681437492, -0.013842944987118244, -0.004225004930049181, -0.023509325459599495, 0.012002242729067802, -0.014198169112205505, 0.058127451688051224, 0.011625491082668304, 0.016770847141742706, 0.012357465922832489, -0.02807340770959854, -0.013057148084044456, -0.003764829132705927, -0.017761167138814926, -0.011668547987937927, 0.0029090638272464275, 0.005425229202955961, 0.003807886503636837, 0.0023735377471894026, 0.04172259569168091, 0.05132438987493515, 0.048439543694257736, -0.0017868810100480914, -0.0005775743047706783, 0.05524260923266411, -0.011410203762352467, 0.03767520189285278, 0.005549018736928701, -0.002392375376075506, -0.007831059396266937, 0.04394004866480827, -0.01748129352927208, 0.010382208973169327, -0.03050614893436432, -0.0012439544079825282, 0.017319828271865845, 0.025705251842737198, 0.007766473572701216, 0.012077593244612217, -0.010242272168397903, 0.02089359052479267, 0.017664287239313126, -0.00812169723212719, -0.02374614030122757, -0.014112054370343685, 0.011969950050115585, 0.03821341693401337, -0.009526443667709827, -0.03481188416481018, 0.04370323196053505, 0.03250831738114357, 0.012271351180970669, -0.004897776059806347, -0.025037862360477448, 0.0006287049036473036, 0.005304130259901285, 0.011786955408751965, -0.016867725178599358, -0.008363895118236542, 0.01759970188140869, 0.002545767230913043, -0.02169015072286129, -0.001379181514494121, -0.028654681518673897, -0.0019658382516354322, -0.012088357470929623, -0.020140085369348526, 0.0074919830076396465, 0.01881607249379158, 0.006544720847159624, 0.0004369650559965521, 0.00646937033161521, 0.0020183143205940723, 0.017814988270401955, 0.011937656439840794, -0.014305812306702137, 0.010339152067899704, -0.017642758786678314, -0.005164193455129862, 0.04490884020924568, -0.02540384978055954, 0.030635321512818336, -0.021087348461151123, 0.023143338039517403, 0.01296026911586523, -0.010952719487249851, 0.009300392121076584, -0.05291751027107239, -0.023186394944787025, 0.025662194937467575, 0.041162848472595215, 0.012099121697247028, 0.050893813371658325, 0.0011107457103207707, -0.022519005462527275, -0.013627658598124981, 0.016964605078101158, 0.009068959392607212, 0.0025323117151856422, -0.00865453202277422, -0.0290421973913908, 0.02919289842247963, 0.013713773339986801, -0.007696505170315504, 0.016620146110653877, 0.004203476011753082, 0.045813046395778656, -0.013014091178774834, 0.0007555223419331014, -0.01611422188580036, -0.009951635263860226, -0.013487721793353558, 0.022045375779271126, 0.026609456166625023, 0.03601749241352081, -0.0183747336268425, -0.010861222632229328, 0.0281810499727726, 0.017621230334043503, -0.017588937655091286, -0.0132831996306777, -0.016964605078101158, -0.020333845168352127, -0.006894561927765608, -0.011485554277896881, -0.017018426209688187, 0.01856849156320095, -0.02723378874361515, -0.019752569496631622, 0.014854793436825275, 0.0022080359049141407, -0.01052214577794075, -0.04869788885116577, -0.0017640067962929606, 0.022906523197889328, 0.014768678694963455, 0.02003244310617447, -0.0019402728648856282, 0.008406952023506165, 0.04499495401978493, 0.007664212491363287, 0.04486578330397606, 0.012249822728335857, -0.01278803963214159, -0.02658792771399021, -0.005277219228446484, -0.004076994955539703, -0.028008820489048958, -0.017352120950818062, 0.0076803588308393955, 0.007325135637074709, -0.0006202952936291695, -0.04667419195175171, -0.01829938404262066, 0.012013006955385208, -0.04658807814121246, -0.02096894010901451, -0.004502186551690102, -0.004911231808364391, 0.0209474116563797, 0.008546888828277588, -0.03959125280380249, -0.0063186693005263805, -0.038665521889925, 0.002638609614223242, -0.0013125770492479205, 0.03050614893436432, -0.014241226017475128, -0.01767505146563053, -0.0040716128423810005, -0.016049636527895927, -0.014768678694963455, 0.005314894486218691, 0.0036571857053786516, -0.027319902554154396, 0.03280971944332123, 0.005823509767651558, -0.021582508459687233, 0.03050614893436432, -0.0346611849963665, 0.004235769156366587, -0.017373649403452873, -0.008972080424427986, -0.03255137428641319, -0.027470603585243225, -0.004300354979932308, -0.004216931294649839, -0.020613716915249825, 0.005694337654858828, 0.017965689301490784, -0.013886002823710442, -0.0026951225008815527, 0.004354177042841911, 0.025210091844201088, 0.030075574293732643, 0.05528566613793373, 0.025662194937467575, -0.006894561927765608, 0.011991478502750397, -0.011442496441304684, -0.0016819286393001676, 0.014112054370343685, 7.917678885860369e-05, 0.0015998504823073745, -0.012572753243148327, -0.016867725178599358, 0.016221866011619568, 0.015037787146866322, 0.00877832155674696, 0.009440328925848007, -0.0073897214606404305, 0.010877368971705437, 0.010742814280092716, 0.010807400569319725, -0.018590020015835762, 0.03448895737528801, 0.08060339838266373, 0.0010999813675880432, -0.014553392305970192, 0.01668473146855831, 0.01982792094349861, 0.022368304431438446, -0.04273444414138794, 0.021604036912322044, 0.02277735061943531, 0.02340168133378029, -0.010672845877707005, -0.015134666115045547, 0.005855802912265062, -0.0504632405936718, 0.021011998876929283, 0.0222821906208992, -0.018030274659395218, 0.008509213104844093, 0.012540459632873535, 0.030613791197538376, 0.02062448114156723, -0.015220780856907368, -0.03584526106715202, 0.001994094578549266, 0.01973104104399681, 0.03134576603770256, -0.01673855446279049, 0.010995776392519474, -0.022691234946250916, 0.008084021508693695, 0.008875200524926186, 0.025123976171016693, -0.01889142207801342, 0.0026453372556716204, -0.0481811985373497, 0.015048551373183727, 0.050420183688402176, -0.005877331364899874, 0.02604971081018448, -0.008067875169217587, -0.002070790622383356, 0.007502747233957052, 0.02986028790473938, -0.001540646655485034, -0.036534182727336884, 0.0020088956225663424, -0.0005153429228812456, -0.004125434439629316, 0.06536109000444412, -0.010306858457624912, -0.019321996718645096, 0.017513586208224297, -0.014585684984922409, 0.0013206503354012966, 0.017319828271865845, -0.0021421043202281, -0.03479035571217537, 0.03700781241059303, 0.052400823682546616, 0.016178807243704796, -0.03166869655251503, -0.01096886582672596, 0.008961315266788006, -0.024155186489224434, -0.026609456166625023, 0.010619024746119976, 0.01733059249818325, -0.011442496441304684, 0.04490884020924568, 0.042088583111763, 0.022411363199353218, 0.00015112129040062428, 0.014305812306702137, -0.007685740943998098, 0.02856856770813465, 0.01982792094349861, -0.021238049492239952, -0.04434909299015999, 0.01740594208240509, 0.00869220681488514, 0.003038235940039158, -0.027190731838345528, 0.00655548507347703, 0.006157204508781433, 0.03151799738407135, 0.00498927291482687, 0.013842944987118244, -0.014704092405736446, 0.019687984138727188, -0.008374659344553947, -0.007265931461006403, -0.0032454493921250105, 0.0012257895432412624, 0.006044178735464811, -0.040516987442970276, -0.016630910336971283, 0.017126070335507393, -0.0279011782258749, -0.016351036727428436, -0.004833190236240625, -0.004574846010655165, 0.008040964603424072, 0.015005494467914104, 1.5379135220427997e-05, 0.005667426623404026, 0.03894539549946785, -0.05102298781275749, 0.00858994573354721, -0.010931190103292465, 0.01146402582526207, -0.0049973465502262115, 0.01871919259428978, -0.013595365919172764, -0.009052813053131104, 0.008014053106307983, -0.01592046394944191, -0.010699757374823093, 0.007454307749867439, -0.02062448114156723, -0.008450009860098362, 0.03207774460315704, 0.0034015325363725424, -0.032056212425231934, -0.0063671087846159935, -0.012669632211327553, 0.004146963357925415, 0.020172379910945892, 0.026523342356085777, 0.006205643992871046, -0.01814868301153183, -0.016049636527895927, 0.015080844983458519, 0.021001232787966728, 0.005861185025423765, -0.04325113072991371, 0.004747075494378805, -0.005390245001763105, -0.013918295502662659, -0.013972117565572262, 0.005301439203321934, 0.0012163707287982106, 0.019074415788054466, -0.002863315399736166, 0.006582396104931831, 0.01805180311203003, 0.004109288100153208, 0.034575071185827255, 0.00797099620103836, 0.023380152881145477, 0.020086264237761497, -0.003522631246596575, 0.020215436816215515, 0.015156195499002934, 0.033412519842386246, -0.015070080757141113, 0.009354214183986187, -0.023380152881145477, 0.0038590170443058014, -0.016620146110653877, -0.03334793448448181, -0.0033450196497142315, 0.004378396552056074, -0.013627658598124981, -0.003910147584974766, 0.004386469721794128, -0.018826836720108986, -0.01319708488881588, -0.0028794617392122746, -0.02114116959273815, 0.007664212491363287, -0.014704092405736446, -0.010339152067899704, 0.008369277231395245, -0.008014053106307983, 0.04516718536615372, -0.022303719073534012, -0.029472772032022476, 0.03248678892850876, 0.0344674251973629, 0.005769688170403242, 0.008401569910347462, -0.03429519757628441, -0.0030193983111530542, 0.006065707188099623, 0.015199252404272556, 0.0037540646735578775, 0.02010779269039631, 0.00227127643302083, -0.03662029653787613, -0.0003844888706225902, 0.02988181635737419, -0.02153945155441761, -0.03823494538664818, 0.047449223697185516, -0.0004278826527297497, 0.01988174207508564, 0.006544720847159624, 0.02456423081457615, -0.012314409017562866, -0.00329927122220397, 0.013487721793353558, -0.0014343487564474344, -0.030484620481729507, -0.00432726601138711, -0.01469332817941904, -0.004534479696303606, 0.021485628560185432, -0.030226275324821472, -0.012863390147686005, 0.03575914725661278, 0.0074812183156609535, 0.019257409498095512, -0.02310028113424778, 0.018848365172743797, -0.02624346874654293, -0.0308506079018116, -0.0308506079018116, 0.01710454188287258, 0.013315492309629917, -0.008105550892651081, 0.05614681541919708, -0.031130479648709297, 0.017793459817767143, -0.005845038220286369, -0.024348944425582886, 0.02195926010608673, -0.01002698577940464, -0.032400671392679214, -0.010080807842314243, 0.031281180679798126, 0.011044216342270374, -0.029817230999469757, -0.022174546495079994, 0.012099121697247028, 0.004547934979200363, 0.008579181507229805, -0.037352271378040314, -0.010091572068631649, 0.029946403577923775, -0.017029190436005592, -0.010279947891831398, -0.019774097949266434, 0.017685815691947937, -0.0017868810100480914, -0.006098000332713127, -0.01866537146270275, -0.03360627964138985, -0.043165016919374466, 0.01088275108486414, 0.03631889447569847, 0.010554438456892967, -0.012884918600320816, 0.012109885923564434, -0.022820407524704933, 0.031431883573532104, 0.004200784955173731, -0.05657738819718361, 0.0010152121540158987, -0.003762137843295932, -0.038536347448825836, 0.015931228175759315, -0.0045990655198693275, -0.012185236439108849, -0.01916053146123886, 0.02359544113278389, 0.008143225684762001, 0.012583517469465733, 0.017190655693411827, -0.007551186718046665, 0.026695571839809418, -0.018213268369436264, 0.02856856770813465, -0.06118452548980713, 0.007944085635244846, 0.003285815706476569, 0.013627658598124981, -0.006394019816070795, -0.04058157280087471, -0.02312180958688259, -0.027169201523065567, 0.006803065072745085, 0.042002465575933456, 0.002533657243475318, -0.006593160331249237, 0.017610466107726097, -0.03530704602599144, -0.008197047747671604, -0.027319902554154396, 0.019031358882784843, 0.006081853993237019, -0.023035693913698196, 0.016867725178599358, -0.039160680025815964, 0.02307875268161297, 0.02753519080579281, -0.0021259577479213476, -0.009176602587103844, -0.03595290705561638, -0.0054817418567836285, 0.016458680853247643, 0.014004410244524479, -0.0003690151497721672, -0.0012049336219206452, 0.016824668273329735, 0.020161615684628487, -0.029558885842561722, 0.02117346227169037, 0.014865557663142681, -0.011700840666890144, -0.0058988602831959724, 0.014208933338522911, 0.029558885842561722, 0.003463427536189556, 0.008659914135932922, 0.022798879072070122, 0.004418762866407633, -0.003215847536921501, 0.01656632497906685, 0.009569501504302025, -0.03401532396674156, -0.018137918785214424, 0.045511644333601, 0.01255122385919094, 0.00019779481226578355, 0.011840777471661568, -0.002190543804317713, -0.02658792771399021, -0.036900170147418976, -0.00944571103900671, -0.021248813718557358, 0.055027320981025696, 0.03926832228899002, 0.014564156532287598, 0.009897813200950623, -0.004887011833488941, -0.017911866307258606, 0.029171369969844818, -0.02357391081750393, 0.04409075155854225, -0.008713736198842525, 0.002212072489783168, -0.004179256036877632, 0.014079760760068893, -0.022153018042445183, 0.01874072104692459, 0.014079760760068893, 0.02163632959127426, 0.028137993067502975, -0.007082937750965357, -0.009047430008649826, -0.0017989908810704947, 0.015306895598769188, -0.02574830874800682, -0.007841823622584343, -0.014488806016743183, -0.00030005606822669506, -0.0132831996306777, -0.013164792209863663, -0.04878400266170502, 0.03965584188699722, -0.029128313064575195, -0.00019678565149661154, -0.012755746953189373, -0.017147598788142204, 0.0019227807642892003, -0.0013731265207752585, -0.022002317011356354, -0.014596449211239815]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:17:06.521067", "url_path": "/api/agent/", "chunk_size": 4554}
updated_dt: 2025-03-15T11:17:06.521067
---
```

A contextmanager which can be used to iterate over the agent graph's nodes as they are executed.
This method builds an internal agent graph (using system prompts, tools and result schemas) and then returns an `AgentRun` object. The `AgentRun` can be used to async-iterate over the nodes of the graph as they are executed. This is the API to use if you want to consume the outputs coming from each LLM model response, or the stream of events coming from the execution of tools.
The `AgentRun` also provides methods to access the full message history, new messages, and usage statistics, and the final result of the run once it has completed.
For more details, see the documentation of `AgentRun`.
Example: 
```
frompydantic_aiimport Agent
agent = Agent('openai:gpt-4o')
async defmain():
  nodes = []
  async with agent.iter('What is the capital of France?') as agent_run:
    async for node in agent_run:
      nodes.append(node)
  print(nodes)
'''
  [
    ModelRequestNode(
      request=ModelRequest(
        parts=[
          UserPromptPart(
            content='What is the capital of France?',
            timestamp=datetime.datetime(...),
            part_kind='user-prompt',
          )
        ],
        kind='request',
      )
    ),
    CallToolsNode(
      model_response=ModelResponse(
        parts=[TextPart(content='Paris', part_kind='text')],
        model_name='gpt-4o',
        timestamp=datetime.datetime(...),
        kind='response',
      )
    ),
    End(data=FinalResult(data='Paris', tool_name=None, tool_call_id=None)),
  ]
  '''
  print(agent_run.result.data)
  #> Paris

```

Parameters:
Name | Type | Description | Default  
---|---|---|---  
`user_prompt` |  `str[](https://docs.python.org/3/library/stdtypes.html#str) | Sequence[](https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence "collections.abc.Sequence")[UserContent]` |  User input to start/continue the conversation. |  _required_  
`result_type` |  `type[](https://docs.python.org/3/library/functions.html#type)[RunResultDataT[](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.RunResultDataT "pydantic_ai.agent.RunResultDataT")] | None` |  Custom result type to use for this run, `result_type` may only be used if the agent has no result validators since result validators would expect an argument that matches the agent's result type. |  `None`  
`message_history` |  `list[](https://docs.python.org/3/library/stdtypes.html#list)[ModelMessage[](https://ai.pydantic.dev/api/messages/#pydantic_ai.messages.ModelMessage "pydantic_ai.messages.ModelMessage")] | None` |  History of the conversation so far. |  `None`  
`model` |  `Model[](https://ai.pydantic.dev/api/models/base/#pydantic_ai.models.Model "pydantic_ai.models.Model") | KnownModelName[](https://ai.pydantic.dev/api/models/base/#pydantic_ai.models.KnownModelName "pydantic_ai.models.KnownModelName") | None` |  Optional model to use for this run, required if `model` was not set when creating the agent. |  `None`  
`deps` |  `AgentDepsT[](https://ai.pydantic.dev/api/tools/#pydantic_ai.tools.AgentDepsT "pydantic_ai.tools.AgentDepsT")` |  Optional dependencies to use for this run. |  `None`  
`model_settings` |  `ModelSettings[](https://ai.pydantic.dev/api/settings/#pydantic_ai.settings.ModelSettings "pydantic_ai.settings.ModelSettings") | None` |  Optional settings to use for this model's request. |  `None`  
`usage_limits` |  `UsageLimits[](https://ai.pydantic.dev/api/usage/#pydantic_ai.usage.UsageLimits "pydantic_ai.usage.UsageLimits") | None` |  Optional limits on model request count or token usage. |  `None`  
`usage` |  `Usage[](https://ai.pydantic.dev/api/usage/#pydantic_ai.usage.Usage "pydantic_ai.usage.Usage") | None` |  Optional usage to start with, useful for resuming a conversation or agents used in tools. |  `None`  
`infer_name` |  `bool[](https://docs.python.org/3/library/functions.html#bool)` |  Whether to try to infer the agent name from the call frame if it's not set. |  `True`  
Returns:
Type | Description  
---|---  
`AsyncIterator[](https://docs.python.org/3/library/collections.abc.html#collections.abc.AsyncIterator "collections.abc.AsyncIterator")[AgentRun[](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.AgentRun "pydantic_ai.agent.AgentRun")[AgentDepsT[](https://ai.pydantic.dev/api/tools/#pydantic_ai.tools.AgentDepsT "pydantic_ai.tools.AgentDepsT"), Any[](https://docs.python.org/3/library/typing.html#typing.Any "typing.Any")]]` |  The result of the run.  
Source code in `pydantic_ai_slim/pydantic_ai/agent.py`