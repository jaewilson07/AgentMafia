---
url: https://ai.pydantic.dev/testing-evals/
session_id: pydantic_ai_docs
chunk_number: 7
title: Testing Evaluations in Pydantic
summary: This code snippet demonstrates how to conduct testing evaluations using a dataset of examples. It imports necessary libraries, loads examples from a JSON file, and splits them into five folds for cross-validation. It initializes a database connection and iterates over the folds to create a system prompt, overriding it for processing each case while handling potential query errors.
embedding: [0.01042059063911438, 0.0026068820152431726, 0.03307947888970375, -0.03307947888970375, 0.01828806661069393, 0.0011698881862685084, 0.003527876455336809, 0.0025843342300504446, 0.0057722581550478935, 0.03099813498556614, 0.04576179385185242, -0.06377235054969788, 0.006008143536746502, -0.05125654116272926, 0.04953596368432045, 0.03602110967040062, 0.03593785688281059, 0.052283335477113724, -0.027889996767044067, -0.0034134024754166603, 0.02018902637064457, -0.017080888152122498, 0.041876621544361115, 0.012113416567444801, 0.01505504734814167, 0.008644510991871357, -0.012654565274715424, 0.03496656194329262, 0.017205769196152687, -0.02057754434645176, 0.02894454263150692, -0.019842136651277542, 0.015748828649520874, -0.0030214162543416023, -0.03979527950286865, 0.020008644089102745, 0.002903473563492298, 0.003996178507804871, 0.016817251220345497, 0.0009886379120871425, 0.018967973068356514, -0.010649538598954678, -0.00012889150821138173, 0.007645466830581427, -0.010378963313996792, 0.01597083918750286, 0.02611391618847847, 0.006903120782226324, 0.04615031182765961, 0.032857466489076614, -0.05045175552368164, 0.02276989258825779, -0.040960829704999924, -0.006726206745952368, -0.018093807622790337, -0.028916792944073677, -0.023491425439715385, 0.024518219754099846, -0.019106728956103325, -0.031081389635801315, 0.042403895407915115, -0.05522496625781059, 0.024615349248051643, 0.0491751991212368, -0.00803398434072733, 0.011280879378318787, -0.024393340572714806, 0.031109139323234558, -0.011038055643439293, 0.012203607708215714, -0.0071736956015229225, 0.04179336875677109, -0.008880396373569965, -0.033773258328437805, 0.018551703542470932, -0.013369159772992134, 0.04415222257375717, 0.04259815439581871, 0.01164164487272501, -0.03924025222659111, -0.02225649543106556, -0.03346799686551094, -0.0017726104706525803, 0.020300032570958138, 0.0011143857846036553, -0.02006414718925953, -0.06083071976900101, -0.019661754369735718, 0.012980642728507519, -0.07315226644277573, -0.018301943317055702, 0.00038656609831377864, -0.03499431535601616, 0.018718210980296135, 0.07781447470188141, -0.002730028238147497, 0.003229550551623106, -0.013854806311428547, 0.007936854846775532, -0.00952561292797327, 0.010732792317867279, -0.006989843677729368, -0.06099722534418106, 0.0032798496540635824, 0.0167201217263937, 0.018329694867134094, 0.005026443395763636, -0.010018197819590569, -0.006750489119440317, -0.040600065141916275, -0.04787088930606842, -0.0038262021262198687, -0.03463354706764221, -0.03924025222659111, -0.011842841282486916, 0.013445476070046425, -0.01762203685939312, -0.0622737817466259, 0.018870843574404716, -0.06038669869303703, -0.06077521666884422, -0.0071667577140033245, -0.006365440785884857, 0.004901562817394733, -0.010136140510439873, 0.001551467808894813, -0.006240560207515955, -0.019203858450055122, -0.009435421787202358, 0.011537577956914902, -0.012904326431453228, -0.0030647774692624807, 0.04184887185692787, -0.027210090309381485, 0.0015904929023236036, 0.009053842164576054, -0.013473226688802242, -0.01499954517930746, -0.0020189026836305857, 0.03357899934053421, -0.04079432412981987, -0.022062236443161964, -0.03369000554084778, 0.02648855932056904, -0.015485191717743874, -0.0015766173601150513, -0.020938310772180557, 0.04232064262032509, -0.034911058843135834, 0.03915699943900108, 0.03457804396748543, 0.017816295847296715, -0.0321914367377758, 0.025267504155635834, 0.007201446685940027, 0.02944406494498253, 0.01055240910500288, 0.036881398409605026, -0.007305514067411423, -0.016553614288568497, 0.010219394229352474, -0.002674525836482644, -0.017316773533821106, -0.009449297562241554, 0.01094786450266838, 0.00996963307261467, -0.03682589530944824, -0.04590054973959923, -0.06554842740297318, -0.01709476299583912, -0.0006881440058350563, -0.04720485955476761, 0.028209134936332703, -0.01875983737409115, 0.013022269122302532, -0.017025385051965714, -0.009227287024259567, -0.038019198924303055, -0.008006232790648937, -0.010261020623147488, -0.03266321122646332, -0.03629862144589424, -0.022603385150432587, 0.006133024115115404, 0.009768436662852764, -0.029249807819724083, 0.008346185088157654, 0.026211045682430267, -0.006882307585328817, 0.019328739494085312, 0.03208043426275253, 0.01916223205626011, 0.03355124965310097, -0.010240207426249981, -0.013278968632221222, -0.05722305551171303, 0.05572449043393135, -8.141086436808109e-05, -0.04154360666871071, 0.014222510159015656, 0.012751694768667221, 0.06610345095396042, 0.02765411138534546, -0.04603930562734604, 0.009428483434021473, -0.04157135635614395, -0.0017084357095882297, -0.003631943603977561, -0.06987762451171875, -0.009026090614497662, 0.011017242446541786, 0.0009340026881545782, 0.051395297050476074, 0.011121309362351894, -0.023574678227305412, 0.011995473876595497, -0.07342977821826935, 0.008290682919323444, 0.011239252053201199, 0.04126609489321709, 0.0288335382938385, 0.047787636518478394, 0.0110588688403368, -0.039823029190301895, 0.0071667577140033245, 0.05394840985536575, 0.020910559222102165, -0.029000045731663704, 0.04673308879137039, 0.004977878648787737, 0.039434511214494705, -0.022728266194462776, -0.0221177376806736, 0.02791774831712246, 0.010635662823915482, -0.025961285457015038, -0.000653888622764498, -0.00017962424317374825, 0.013265092857182026, 0.00433959998190403, -0.00118983443826437, -0.007562213111668825, 0.003847015555948019, 0.0071598198264837265, 0.03294072300195694, 0.03871297836303711, -0.024851234629750252, -0.044957008212804794, 0.02457372285425663, 0.027362722903490067, 0.05145080015063286, -0.010281834751367569, 0.01248112041503191, -0.07259724289178848, -0.009137095883488655, -0.008138051256537437, -0.024934489279985428, -0.017982803285121918, -0.03188617527484894, 0.007576088421046734, -0.055530231446027756, -0.0011187219060957432, 0.002967648208141327, 0.012689254246652126, -0.0073263272643089294, -0.029249807819724083, 0.0321914367377758, -0.029666075482964516, -0.009248101152479649, -0.05611300840973854, 0.01512442622333765, 0.030803875997662544, -0.008200491778552532, 0.009227287024259567, -0.025323007255792618, 0.026072289794683456, -0.00016466458328068256, 0.042514901608228683, -0.0015922273742035031, -0.008928961120545864, -0.05444793403148651, -0.016525862738490105, -0.010677289217710495, 0.02097993716597557, -0.004783620126545429, 0.011724898591637611, -0.036603886634111404, -0.003092528786510229, -0.015277057886123657, -0.012592124752700329, -0.016178973019123077, 0.02689095214009285, 0.03665938973426819, -0.020522041246294975, -0.006681111175566912, -0.025434011593461037, 0.026224922388792038, 0.03813020512461662, -0.0065562305971980095, 0.019467495381832123, 0.009109344333410263, -0.0291943047195673, -0.017649788409471512, 0.03460579738020897, -0.02392156980931759, 0.016303854063153267, 0.01889859512448311, -0.01029570959508419, 0.04925845190882683, 0.025392385199666023, -0.035826850682497025, 0.04787088930606842, 0.04157135635614395, 0.012196670286357403, -0.014722032472491264, -0.03399527072906494, 0.06382784992456436, -0.013951935805380344, 0.0435139462351799, -0.011863655410706997, -0.06171875819563866, -0.04448523744940758, 0.01981438510119915, 0.043819207698106766, -0.06055320426821709, 0.007381829898804426, 0.02252013050019741, 0.0176081620156765, -0.007381829898804426, 0.009775374084711075, -0.018246440216898918, -0.004277159925550222, -0.0022825393825769424, 0.04789863899350166, 0.0009582850034348667, -0.010822983458638191, 0.012474182061851025, 0.02521200105547905, -0.03937900811433792, 0.0057375687174499035, -0.09540876001119614, 0.013743801973760128, -0.0651044100522995, 0.006913527846336365, -0.015415813773870468, 0.015623948536813259, 0.014222510159015656, 0.05722305551171303, 0.0023189629428088665, 0.007916041649878025, 0.02378281205892563, 0.043680451810359955, 0.016761748120188713, 0.038546472787857056, 0.008505755104124546, -0.036076612770557404, -0.05303261801600456, 0.006910058669745922, 0.003857422387227416, -0.0019408523803576827, -0.015374187380075455, -0.002102156402543187, 0.023630181327462196, -0.03180292248725891, 0.0057722581550478935, 0.027973249554634094, -0.04104408249258995, 0.004644863773137331, 0.02675219625234604, 0.012585187330842018, 0.013043083250522614, -0.001418782165274024, -0.029527319595217705, -0.007839725352823734, -0.02764023467898369, -0.06343933194875717, 0.011489013209939003, 0.03074837476015091, -0.008894272148609161, 0.04440198466181755, 0.012467244639992714, -0.02032778412103653, -0.028611527755856514, -0.003363103372976184, 0.030554115772247314, 0.031608663499355316, 0.027085211127996445, 0.019356489181518555, -0.04409671947360039, 0.01968950405716896, 0.05086802318692207, -0.05572449043393135, 0.011537577956914902, -0.02829238958656788, 0.01010838896036148, 0.05855511501431465, -0.008693075738847256, 0.03241344913840294, 0.053088121116161346, 0.022547882050275803, 0.008311496116220951, -0.031331151723861694, -0.0321914367377758, 0.004003116395324469, 0.030776124447584152, 0.012626814655959606, 0.018066057935357094, 0.021257450804114342, 0.007749533746391535, -0.009081593714654446, 0.04490150511264801, -0.03463354706764221, 0.03393976762890816, -0.029111050069332123, 0.022589510306715965, -0.07265274971723557, -0.011891406029462814, 0.00933829229325056, 0.04195987433195114, 0.04029479995369911, -0.03782493993639946, -0.060164690017700195, 0.03682589530944824, -0.02855602651834488, -0.00727082509547472, 0.02032778412103653, 0.009137095883488655, -0.03538282960653305, 0.04784313961863518, -0.018357444554567337, -0.009310540743172169, 0.010663414373993874, 0.02677994593977928, 0.03113689087331295, 0.006035894621163607, -0.018634958192706108, 0.028861289843916893, 0.01395887415856123, 0.021534962579607964, -0.03538282960653305, 0.022200992330908775, -0.0006044566980563104, 0.007603839971125126, 0.029416315257549286, -0.03513307124376297, -0.04295891895890236, -0.05350439250469208, -0.02793162316083908, 0.028347890824079514, -0.003909456077963114, 0.04323643073439598, -0.02560051903128624, -0.025545015931129456, -0.001156012644059956, -0.014555525034666061, -0.02780674211680889, 0.04620581492781639, -0.021035440266132355, 0.06549292802810669, -0.004863404668867588, 0.047426868230104446, 0.027584733441472054, -0.012717005796730518, -0.0218541007488966, 0.014902415685355663, 0.01914835534989834, -0.0011785604292526841, 0.023866066709160805, -0.002279070671647787, 0.002508018398657441, 0.02650243416428566, -0.013605045154690742, 0.0043291933834552765, 0.0016026340890675783, -0.019509121775627136, -0.027973249554634094, 0.011752650141716003, 0.004093308001756668, 5.864617560291663e-05, 0.005838166922330856, 0.01570720225572586, -0.031997181475162506, 0.05247759446501732, 0.03629862144589424, -0.03882398456335068, 0.02687707543373108, -0.01880146563053131, -0.04903643950819969, -0.03860197588801384, -0.0015540694585070014, -0.001397101441398263, 0.00785360112786293, 0.044457487761974335, -0.016775624826550484, 0.01375767681747675, -0.0243239626288414, 0.0078050363808870316, -0.020910559222102165, -0.0005133979138918221, -0.023963196203112602, 0.027709612622857094, 0.022173240780830383, -0.018856966868042946, 0.08120013028383255, -0.011378008872270584, -0.02147945947945118, 0.010913175530731678, -0.0223813746124506, 0.038407716900110245, 0.04609480872750282, -0.029305309057235718, -0.04309767484664917, -0.014611028134822845, 0.008776329457759857, 0.00913015753030777, 0.03349574655294418, -0.018940221518278122, 0.03246895223855972, -0.027196215465664864, 0.038907237350940704, 0.007576088421046734, -0.040350303053855896, -0.02315841056406498, 0.0177746694535017, 0.013292844407260418, -0.034800056368112564, 0.001008584164083004, -0.05700104683637619, 0.0017882204847410321, -0.047426868230104446, 0.010940926149487495, 0.01351485401391983, -0.015346435829997063, 0.04695509746670723, -0.051783815026283264, 0.022547882050275803, 0.0009851689683273435, -0.020938310772180557, -0.0375196747481823, 0.010212455876171589, -0.02136845514178276, 0.04501251131296158, 0.0009149236720986664, -0.019467495381832123, 0.002365793101489544, -0.008235180750489235, 0.025531141087412834, 0.007992357015609741, -0.027848368510603905, -0.021965106949210167, 0.01293207798153162, -0.01375767681747675, 0.00492237601429224, -0.041488103568553925, -0.007381829898804426, 0.005619626026600599, -0.026557937264442444, -0.030415359884500504, 0.01826031506061554, -0.014944043010473251, 0.021521085873246193, -0.018565580248832703, 0.031053638085722923, -0.005182544235140085, 0.033412493765354156, -0.004204312805086374, 0.0375196747481823, 0.015734953805804253, -0.05550248175859451, 0.002971117151901126, 0.00965049397200346, -0.01261987630277872, -0.024490470066666603, 0.011197625659406185, 0.0169837586581707, -0.035826850682497025, -0.0169837586581707, -0.01512442622333765, -0.019384240731596947, -0.02005027048289776, -0.01164164487272501, -0.030554115772247314, -0.019731132313609123, 0.035299576818943024, -0.015873709693551064, 0.029138801619410515, -0.00213684537447989, 0.024767981842160225, 0.026155544444918633, -0.022173240780830383, -0.011273941025137901, -0.003985771909356117, 0.0025999443605542183, -0.027709612622857094, -0.017150266095995903, 0.01763591356575489, -0.009248101152479649, 0.012099540792405605, -0.03926800563931465, 0.06238478794693947, 0.01827419176697731, -0.03485555574297905, -0.0035833788570016623, 0.012585187330842018, -0.002464656950905919, 0.013854806311428547, 0.008894272148609161, 0.03407852351665497, 0.013473226688802242, 0.005682066548615694, -0.0302488524466753, -0.01827419176697731, -0.039434511214494705, -0.024934489279985428, 0.0014057738007977605, 0.006171181797981262, -0.0007202313863672316, 0.03438378497958183, 0.04409671947360039, -0.05547472834587097, -0.015637824311852455, 0.008082549087703228, 0.006566637195646763, 0.022103862836956978, 0.04748237133026123, -0.0034567639231681824, -0.004006585106253624, 0.008589008823037148, -0.029027797281742096, 0.0034775773528963327, -0.011197625659406185, 0.009601929225027561, 0.036603886634111404, 0.003226081607863307, 0.008998339995741844, 0.019606251269578934, 0.02961057238280773, 0.00495706545189023, -0.013091647066175938, -0.028778035193681717, 0.036603886634111404, 0.002513221697881818, -0.015610072761774063, -0.002889597788453102, 0.021673718467354774, 0.029638323932886124, -0.013618920929729939, 0.003304132027551532, 0.0016711449716240168, -0.018440699204802513, -0.027348846197128296, -0.030332105234265327, 0.02469860389828682, 0.009463172405958176, 0.015207679942250252, -0.039295755326747894, -0.016040217131376266, -0.0491751991212368, -0.03846322000026703, 0.009699058718979359, -0.03640962764620781, 0.0007237003301270306, -0.002131642075255513, 0.010600973851978779, 0.01812155917286873, 0.040072791278362274, -0.02045266330242157, 0.02600291185081005, 0.024268459528684616, 0.022464629262685776, -0.055779993534088135, -0.0010796966962516308, 0.02623879723250866, 0.03949001431465149, -0.011038055643439293, -0.01459715235978365, 0.01826031506061554, -0.029277557507157326, -0.02197898179292679, 0.044846005737781525, 0.002834095386788249, 0.0012878309935331345, -0.0412105917930603, 0.0032087371218949556, 0.02455984801054001, 0.0005823424435220659, 0.03810245171189308, 0.026335926726460457, 0.02134070359170437, 0.02225649543106556, -0.0032156750094145536, -0.003919862676411867, -0.007298576179891825, 0.006237091030925512, -0.027848368510603905, -0.008366999216377735, -0.007749533746391535, 0.06527091562747955, 0.0041696238331496716, -0.038157954812049866, 0.0033197421580553055, 0.019481370225548744, 0.0056612528860569, -0.03985077887773514, -0.04268140718340874, -0.007513648364692926, -0.020258404314517975, -0.012890450656414032, 0.0067678336054086685, -0.01660911738872528, -0.04026705026626587, 0.03063736855983734, -0.021174196153879166, 0.028472771868109703, -0.024740230292081833, 0.0017448592698201537, -0.021715344861149788, -0.0029693827964365482, 0.014777535572648048, -0.047426868230104446, 0.0036701015196740627, 0.009629679843783379, 0.010961740277707577, -0.028014875948429108, -0.001300839358009398, -0.0824211835861206, 0.006854556500911713, 0.04737136512994766, -0.01523543056100607, 0.01801055483520031, 0.003255567280575633, -0.00505419448018074, 0.01647036150097847, -0.003964958246797323, -0.011065807193517685, -0.017552658915519714, -0.023352667689323425, 0.014208635315299034, -0.009664369747042656, 0.004363882355391979, -0.012571311555802822, -0.012286861427128315, 0.0014421972446143627, 0.011280879378318787, -0.0059907990507781506, -0.004780150949954987, -0.017191892489790916, 0.06693599373102188, 0.015249306336045265, 0.004800964612513781, -0.007825849577784538, 0.01216891873627901, 0.023574678227305412, -0.009164847433567047, 0.03011009469628334, 0.013924184255301952, 0.023116782307624817, 0.00867919996380806, -0.02032778412103653, 0.0027213559951633215, -0.03407852351665497, 0.020563669502735138, -0.030082345008850098, 0.03335699066519737, -0.02382444031536579, 0.004884218331426382, 0.047288112342357635, 0.02186797745525837, -0.02805650420486927, -0.024518219754099846, 0.0078050363808870316, -0.010989490896463394, 0.013917246833443642, -0.009865566156804562, 0.02986033447086811, -0.02393544465303421, 0.01828806661069393, 0.014763659797608852, 0.026724444702267647, 0.026807697489857674, 0.004429791588336229, -0.002036247169598937, 0.011891406029462814, -0.022173240780830383, 0.019897639751434326, 0.008963650092482567, 0.007256949320435524, -0.036492880433797836, -0.017441654577851295, -0.017150266095995903, -0.02368568256497383, -0.010642600245773792, -0.023130659013986588, -0.02021677792072296, 0.027820618823170662, 0.0008195288246497512, 0.012106478214263916, -0.11200400441884995, -0.02587803080677986, 0.033801011741161346, -0.022561758756637573, 0.025517264381051064, -0.0053143627010285854, -0.011038055643439293, -0.0014604090247303247, -0.023186160251498222, -0.007194508798420429, -0.01631772890686989, -0.030665120109915733, -0.017427777871489525, 0.004981347359716892, 0.04065556824207306, -0.02999909035861492, 0.020022518932819366, 0.004544265568256378, 0.022589510306715965, -0.02586415596306324, 0.04104408249258995, -0.010274896398186684, -0.007728720549494028, 0.02020290307700634, -0.01570720225572586, 0.007381829898804426, -0.021410081535577774, -0.017844047397375107, 0.028417270630598068, -0.0017318507889285684, -0.01427801325917244, -0.010705040767788887, 0.025184249505400658, 0.0055259657092392445, -0.0159292109310627, 0.008741640485823154, -0.006205871235579252, 0.024129703640937805, 0.01567945070564747, -0.04129384458065033, 0.0006326415459625423, -0.005855511873960495, 0.016817251220345497, -0.006414005532860756, 0.04040580615401268, -0.02161821536719799, -0.03638187423348427, 0.013743801973760128, 0.003739479696378112, -0.0055294344201684, 0.07126518338918686, 0.007492834702134132, -0.018052181228995323, 0.017677539959549904, 0.018426822498440742, 0.04481825232505798, -0.02665506675839424, 0.002324166242033243, -0.01338997296988964, -0.006802522577345371, 0.006483383476734161, -0.019869888201355934, -0.006965561304241419, -0.024088077247142792, 0.0063238139264285564, 0.006049770396202803, -0.013500978238880634, -0.005623095203191042, -0.005449649877846241, 0.014555525034666061, 0.0018888188060373068, -0.0071667577140033245, -0.027848368510603905, -0.001385827548801899, -0.015485191717743874, 0.025253629311919212, 0.014264137484133244, -0.003174048149958253, -0.0019963548984378576, 0.009171784855425358, 0.04567854106426239, -0.040960829704999924, 0.06022018939256668, 0.035188570618629456, -0.021049315109848976, 0.005831229500472546, 0.002978055039420724, -0.001743991975672543, 0.03690914809703827, 0.03954551741480827, 0.039184749126434326, -0.0005029911990277469, 0.02519812621176243, 0.013466289266943932, -0.04642782360315323, 0.027348846197128296, 0.014500022865831852, 0.02535075694322586, 0.01608184352517128, -0.006195464171469212, 0.01343853771686554, 0.03174741938710213, -0.013681361451745033, 0.04720485955476761, -0.026072289794683456, 0.03060961700975895, -0.03846322000026703, -0.024129703640937805, 0.01943974383175373, 0.006871900986880064, 0.03063736855983734, -0.005092352628707886, 0.001814237330108881, 0.011378008872270584, -0.04259815439581871, 0.015734953805804253, 0.059498660266399384, 0.007388767786324024, 0.01324427966028452, -0.002036247169598937, 0.009934944100677967, 0.029416315257549286, -0.023463673889636993, 0.024920614436268806, -0.015277057886123657, 0.02314453385770321, -0.03022110089659691, -0.022867022082209587, -0.00045876268995925784, 0.022173240780830383, 0.030692871659994125, 0.0172473955899477, -0.006105273030698299, 0.0647713914513588, 0.008339247666299343, -0.011953846551477909, 0.03849096968770027, -0.016692370176315308, 0.0167201217263937, 0.007125130854547024, 0.007409580983221531, 0.022062236443161964, -0.00018970573728438467, -0.03693690150976181, -0.017677539959549904, -0.01633160561323166, 0.04079432412981987, -0.015998590737581253, -0.03602110967040062, -0.0025565829128026962, -0.016789499670267105, -0.023990947753190994, -0.0001951259037014097, 0.016692370176315308, -0.010136140510439873, 0.058721624314785004, -0.00617811968550086, -0.038907237350940704, -0.0031064043287187815, -0.020411036908626556, 0.021021563559770584, 0.04129384458065033, 0.015762703493237495, -0.018357444554567337, 0.04195987433195114, -0.01505504734814167, 0.01738615147769451, -0.020494291558861732, -0.0008923758286982775, 0.03224693983793259, -0.03754742816090584, 0.013924184255301952, 0.020300032570958138, 0.006660297513008118, 0.01581820659339428, 0.016040217131376266, 0.005404553841799498, -0.0010762277524918318, -0.03527182713150978, 0.019745007157325745, 0.007395705673843622, 0.017691414803266525, 0.04229288920760155, -0.009268914349377155, 0.02832014113664627, -6.0976846725679934e-05, 0.023213911801576614, 0.025669896975159645, -0.011662459000945091, 0.004846060182899237, 0.030165597796440125, 0.006670704111456871, 0.027848368510603905, 0.07659342139959335, -0.020771803334355354, 0.01623447611927986, 0.0316641665995121, -0.03663163632154465, 0.027681861072778702, -0.014132319018244743, -0.03588235378265381, -0.018565580248832703, 0.0015063720056787133, -0.0071528819389641285, 0.014569400809705257, 0.09468723088502884, -0.01721964403986931, -0.02858377806842327, -0.0006681978120468557, 0.01505504734814167, -0.033134981989860535, -0.026183294132351875, 0.039295755326747894, -0.018218688666820526, -0.04356944561004639, -0.01010838896036148, -0.03779719024896622, 0.021812474355101585, -0.021965106949210167, -0.02149333618581295, -0.037658434361219406, 0.009699058718979359, -0.01674787327647209, 0.005775726865977049, 0.024920614436268806, 0.020091896876692772, 0.024379463866353035, -0.011468200013041496, 0.03446704149246216, 0.0038366089574992657, 0.004533858969807625, 0.022034484893083572, 0.0009617538889870048, -0.015804331749677658, 0.026294300332665443, -0.018690459430217743, -0.0016078375047072768, -0.02161821536719799, 0.035216324031353, 0.012980642728507519, -0.018204813823103905, 0.0073540788143873215, 0.003104669973254204, 0.007936854846775532, 0.008970588445663452, 0.0030613087583333254, 0.026086166501045227, 0.03638187423348427, -0.02240912616252899, -0.003151500131934881, -0.031442154198884964, 0.009900255128741264, 0.006615201942622662, -0.026710567995905876, 0.03640962764620781, -0.010351212695240974, -0.004859935957938433, 0.04770438000559807, -0.02575315162539482, 0.01306389644742012, -0.013452413491904736, -0.006722738035023212, -0.005650846287608147, -0.02536463364958763, 0.013077772222459316, -0.029804831370711327, 0.004676084034144878, 0.006639484316110611, -0.012626814655959606, 0.016151221469044685, -0.04903643950819969, 0.020757926627993584, 0.029416315257549286, 0.01891246996819973, -0.014000500552356243, -0.013931122608482838, -0.028098130598664284, -0.035216324031353, -0.035216324031353, -0.005609219428151846, -0.04146035388112068, 0.02095218561589718, 0.02740434929728508, 0.02135457843542099, 0.005390678532421589, -0.007687093690037727, -0.004048211965709925, -0.030665120109915733, 0.02585027925670147, 0.021201947703957558, 0.01631772890686989, 0.02961057238280773, 0.003229550551623106, 0.003137624589726329, -0.011155998334288597, 0.004239001777023077, -0.010462217964231968, 0.018607206642627716, 0.0024074199609458447, -0.02289477363228798, 0.04126609489321709, 0.012640689499676228, 0.03102588653564453, -0.012557435780763626, -0.03427278250455856, 0.02263113670051098, 0.0073402030393481255, -0.028500523418188095, 0.023893818259239197, -0.011114371940493584, -0.037658434361219406, -0.010843796655535698, 0.028153633698821068, 0.003196595935150981, -0.008609822019934654, -0.0016399248270317912, -0.007617715280503035, 0.01505504734814167, -0.04473499953746796, 0.027348846197128296, -0.012148105539381504, 0.003978834021836519, -0.020036395639181137, 0.02032778412103653, -0.007957668043673038, -0.010614849627017975, 3.6044089938513935e-05, -0.019745007157325745, 0.00440550921484828, -0.019259359687566757, 0.03060961700975895, 0.019522996619343758, 0.00925503857433796, -0.0019616656936705112, -0.06671398133039474, 0.021521085873246193, -0.0672135055065155, -0.015721077099442482, 0.0016902239294722676, -0.015096674673259258, -0.03771393373608589, -0.016289977356791496, 0.012286861427128315, -0.04179336875677109, -0.007610777392983437, -0.008540444076061249, 0.006712330970913172, -0.0034151370637118816, 0.027612483128905296, -0.00030309558496810496, 0.0743178203701973, 0.01369523722678423, 0.011981598101556301, -0.00313415564596653, 0.0176081620156765, -0.00547393225133419, -0.010989490896463394, -0.044984761625528336, 0.0041037146002054214, -0.016040217131376266, -0.01980051025748253, 0.037880443036556244, 0.010129202157258987, 0.004474887624382973, 0.03280196711421013, 0.02986033447086811, -0.00350359408184886, 0.016165098175406456, 0.001647729892283678, -0.029305309057235718, 0.016692370176315308, 0.035327330231666565, 0.025406260043382645, -0.014944043010473251, 0.013278968632221222, 0.026405304670333862, 0.0039302692748606205, -0.03174741938710213, 0.017552658915519714, 0.047787636518478394, 0.02136845514178276, -0.04828715696930885, 0.00252709724009037, 0.0019339144928380847, -0.04301442205905914, 0.007062690798193216, 0.0023779342882335186, 0.048176154494285583, 0.014763659797608852, 0.002275601727887988, -0.008013170212507248, 0.022298121824860573, 0.017275147140026093, 0.002964179264381528, 0.007992357015609741, 0.02121582254767418, -0.016428733244538307, 0.012057913467288017, -0.009442359209060669, -0.0057930713519454, -0.009241162799298763, -0.003151500131934881, -0.008526568301022053, -0.025017742067575455, -0.015512943267822266, -0.033134981989860535, -0.024670852348208427, 0.06366134434938431, -0.014042127877473831, 0.014500022865831852, -0.020008644089102745, -0.026016786694526672, 0.00308905984275043, 0.009726809337735176, 0.0014794879825785756, -0.03782493993639946, -0.01906510256230831, -0.017580410465598106, -0.017205769196152687, 0.0160957183688879, -0.02997133880853653, 0.011780401691794395, -0.0318584218621254, -0.0116347074508667, 0.027237841859459877, 0.004800964612513781, 0.009366043843328953, 0.016137346625328064, 0.009768436662852764, 0.013050020672380924, 0.013507915660738945, -0.0005389811121858656, -0.022700514644384384, 0.011280879378318787, 0.0186627097427845, -0.013556480407714844, 0.0017153734806925058, 0.01737227663397789, -0.012911264784634113, -0.0006820734706707299, -0.005186012946069241, 0.012973704375326633, 0.026016786694526672, 0.02880578674376011, 0.013015331700444221, 0.030193349346518517, 0.0175110325217247, -0.0014291888801380992, -0.019731132313609123, -0.02381056360900402, -0.012272985652089119, -0.020424911752343178, -0.023200036957859993, -0.0014569400809705257, -0.028472771868109703, 0.009761498309671879, -0.013098585419356823, -0.03899049386382103, -0.014375142753124237, 0.01261987630277872, 0.029638323932886124, -0.005456587765365839, -0.005872856359928846, -0.0006573575083166361, -0.0011872327886521816, -0.004402040503919125, -0.04259815439581871, 0.03443928807973862, -0.020619170740246773, -0.06671398133039474, -0.002932959236204624, -0.014007437974214554, -0.030054593458771706, 0.013688298873603344, -0.007992357015609741, 0.018551703542470932, -0.005980392452329397, -0.050646014511585236, 0.012814135290682316, -0.009407670237123966, 0.03074837476015091, 0.03516082093119621, 0.028778035193681717, 0.012390928342938423, 0.0028358297422528267, -0.009456234984099865, -0.006500727962702513, -0.020757926627993584, 0.036354124546051025, 0.003919862676411867, -0.01324427966028452, 0.009962694719433784, -0.033912014216184616, -0.026294300332665443, 0.012765570543706417, 0.016664620488882065, 0.02677994593977928, -0.03757517784833908, 0.0027959374710917473, 0.003314538626000285, 0.03155316039919853, -0.023394295945763588, 0.03849096968770027, -0.0018974910490214825, 0.013903371058404446, -0.006594388280063868, 0.01623447611927986, -0.031830672174692154, -0.011086620390415192, -0.023630181327462196, 0.0020293095149099827, -0.014763659797608852, -0.004388164728879929, -0.01789955049753189, -0.027432100847363472, 0.012474182061851025, -0.014819161966443062, 0.003989240620285273, 0.005567592568695545, -0.010718916542828083, 0.02958282269537449, -0.02365793287754059, -0.01306389644742012, -0.020813429728150368, -0.0005511222989298403, -0.007083503995090723, 0.018704336136579514, 0.001670277793891728, -0.007673217914998531, 0.005557185970246792, 0.014007437974214554, 0.0033093353267759085, -0.024101952090859413, 0.019980892539024353, 0.02136845514178276, -0.00181770627386868, 0.04262590408325195, -0.011912220157682896, 0.007038408424705267, 0.0025895375292748213, 0.02714071236550808, -2.6287796572432853e-05, 0.019203858450055122, -0.036603886634111404, -0.005952640902251005, 0.04126609489321709, -0.009033028967678547, -0.03760293126106262, -0.0023588554468005896, 0.0321914367377758, -0.019745007157325745, 0.0032017992343753576, 0.00022829731460660696, -0.0178717989474535, -0.013410787098109722, 0.019217733293771744, 0.008082549087703228, -0.006906589958816767, -0.004370820242911577, -0.00023154940572567284, 0.02150721102952957, 0.0032174093648791313, 0.011981598101556301, -0.007714844774454832, 0.03782493993639946, 0.008186616003513336, 0.000158919210662134, 0.001171622658148408, 0.018745962530374527, -0.02715458907186985, -0.008817956782877445, -0.00018049146456178278, -0.0055710612796247005, -0.013577294535934925, 0.0034775773528963327, -0.0167201217263937, 0.03127564862370491, 0.011211501434445381, -0.013716050423681736, 0.0055710612796247005, 0.04040580615401268, -0.0027699207421392202, -0.0041765617206692696, 0.013896433636546135, 0.0034376848489046097, 0.011856717057526112, -0.027626359835267067, 0.01606796868145466, 0.06782402843236923, -0.001052812673151493, -0.0110588688403368, 0.010129202157258987, 0.014527774415910244, 0.013743801973760128, 0.012120353989303112, 0.008061734959483147, 0.046122562140226364, 0.0007904767408035696, 2.6003237508120947e-05, -0.011176811531186104, 0.019495246931910515, 0.013771552592515945, 0.000635676842648536, -0.0008008834556676447, -0.005248453468084335, -0.017191892489790916, -0.017441654577851295, 0.002908676862716675, -0.037131160497665405, -0.012710068374872208, 0.005720224231481552, -0.004995223134756088, -0.006677641998976469, -0.012508871033787727, 0.010170829482376575, 0.018301943317055702, -0.03138665109872818, -0.04731586575508118, -0.04190437123179436, 0.028417270630598068, 0.005057663656771183, -0.038657478988170624, -0.016525862738490105, 0.012266048230230808, 0.007832787930965424, -0.009608866646885872, 0.02521200105547905, -0.031719665974378586, -0.007700968999415636, -0.03740867227315903, -0.010732792317867279, -0.03965652361512184, -0.032885219901800156, -0.01762203685939312, 0.036076612770557404, 0.028972294181585312, 0.012383990921080112, 0.04590054973959923, 0.006937810219824314, 0.017788544297218323, 0.046122562140226364, 0.02548951469361782, 0.030415359884500504, -0.003321476513519883, 0.01595696248114109, 0.026807697489857674, 0.004762806463986635, 0.011870592832565308, -0.016900505870580673, 0.004159217234700918, -0.003092528786510229, -0.03102588653564453, 0.016761748120188713, -0.036881398409605026, 0.02135457843542099, 0.009768436662852764, -0.005612688139081001, 0.023449797183275223, -0.027362722903490067, 0.022020608186721802, -0.0053663961589336395, -0.004544265568256378, -0.007846662774682045, -0.0035382830537855625, 0.0010614849161356688, 0.03896274045109749, -0.02006414718925953, 0.041377097368240356, 0.0007622918928973377, 0.01828806661069393, 0.0034602326340973377, -0.007465083617717028, -0.010191642679274082, -0.00181770627386868, 0.012696192599833012, 0.013313657604157925, -0.061829764395952225, 0.011343318969011307, -0.013931122608482838, -0.053060371428728104, 0.01544356532394886, 0.02214548923075199, 0.013709113001823425, 0.015041172504425049, 0.022034484893083572, -0.014513898640871048, -0.03438378497958183, 0.00830455869436264, -0.01447227131575346, 0.0030543708708137274, -0.029527319595217705, -0.01841294765472412, -0.03949001431465149, -0.02651630900800228, -0.0007627254817634821, 0.010080638341605663, -0.004294504411518574, -0.009768436662852764, 0.00745814573019743, -0.000545051705557853, -0.0024837360251694918, -0.010073699988424778, 0.01647036150097847, 0.011412697844207287, 0.01144738681614399, -0.024851234629750252, 0.005331707186996937, 0.025822529569268227, -0.043930213898420334, -0.006858025211840868, -0.006476445589214563, -0.006826804950833321, -0.003753355238586664, 0.006257904693484306, -0.009726809337735176, 0.01762203685939312, -0.01748328097164631, -0.04681634157896042, -0.013764615170657635, -0.02227037027478218, -0.014694281853735447, -0.008582071401178837, 0.030720623210072517, -0.017982803285121918, -0.021548837423324585, -0.02468472719192505, -0.019536873325705528, 0.02356080338358879, 0.005855511873960495, -0.04037805274128914, -0.014888539910316467, -0.027182338759303093, 0.021923480555415154, 0.005664722062647343, 0.012467244639992714, -0.026849323883652687, -0.011239252053201199, -0.010274896398186684, -0.022062236443161964]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:35:04.137699", "url_path": "/testing-evals/", "chunk_size": 1832}
updated_dt: 2025-03-16T00:35:04.139245
---
```
importjson
importstatistics
frompathlibimport Path
fromitertoolsimport chain
fromfake_databaseimport DatabaseConn, QueryError
fromsql_appimport sql_agent, SqlSystemPrompt, user_search

async defmain():
  with Path('examples.json').open('rb') as f:
    examples = json.load(f)
  # split examples into 5 folds
  fold_size = len(examples) // 5
  folds = [examples[i : i + fold_size] for i in range(0, len(examples), fold_size)]
  conn = DatabaseConn()
  scores = []
  for i, fold in enumerate(folds):
    fold_score = 0
    # build all other folds into a list of examples
    other_folds = list(chain(*(f for j, f in enumerate(folds) if j != i)))
    # create a new system prompt with the other fold examples
    system_prompt = SqlSystemPrompt(examples=other_folds)
    # override the system prompt with the new one
    with sql_agent.override(deps=system_prompt):
      for case in fold:
        try:
          agent_results = await user_search(case['request'])
        except QueryError as e:
          print(f'Fold {i}{case}: {e}')
          fold_score -= 100
        else:
          # get the expected results using the SQL from this case
          expected_results = await conn.execute(case['sql'])
        agent_ids = [r['id'] for r in agent_results]
        # each returned value has a score of -1
        fold_score -= len(agent_ids)
        expected_ids = {r['id'] for r in expected_results}
        # each return value that matches the expected value has a score of 3
        fold_score += 5 * len(set(agent_ids) & expected_ids)
    scores.append(fold_score)
  overall_score = statistics.mean(scores)
  print(f'Overall score: {overall_score:0.2f}')
  #> Overall score: 12.00

```

We can then change the prompt, the model, or the examples and see how the score changes over time.
© Pydantic Services Inc. 2024 to present