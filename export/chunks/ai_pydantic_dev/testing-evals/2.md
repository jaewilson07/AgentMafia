---
url: https://ai.pydantic.dev/testing-evals/
session_id: pydantic_ai_docs
chunk_number: 2
title: Weather Forecast Agent Implementation with Pydantic AI
summary: This document outlines the implementation of a weather forecast agent using Pydantic AI. It imports necessary classes, establishes a database connection, and defines a weather agent that can provide forecasts and historical data. The 'weather_forecast' function determines whether to fetch historic or future weather data based on the input date.
embedding: [-0.041457001119852066, -0.008123490959405899, 0.02677086368203163, -0.05193358287215233, 0.009169966913759708, -0.0007331243250519037, 0.04708550125360489, 0.015915893018245697, 0.02289239875972271, 0.00867924652993679, 0.022289345040917397, 0.0031689892057329416, -0.0029310192912817, -0.07785307615995407, -0.03587579354643822, 0.0036804024130105972, -0.004936764948070049, 0.03883194178342819, -0.04105496406555176, -0.00028249676688574255, 0.016980106011033058, -0.005460002925246954, 0.006249293684959412, -0.031997330486774445, 0.008608299307525158, 0.0028172077145427465, -0.030885819345712662, 0.07979230582714081, 0.016495298594236374, -0.021390676498413086, 0.026416126638650894, -0.011239269748330116, -0.020823096856474876, -0.0069173830561339855, 0.03710555285215378, -0.0020545218139886856, 0.0067400140687823296, 0.03405480831861496, -0.006982418242841959, 0.026250582188367844, 0.002265886403620243, -0.07392731308937073, 0.015159119851887226, -0.011747726239264011, -0.022230222821235657, 0.042426615953445435, 0.00539792375639081, 0.0558120459318161, 0.044744234532117844, -0.025612054392695427, -0.022537661716341972, 0.01765410788357258, -0.011836410500109196, -0.021402500569820404, 0.007798314560204744, -0.025399211794137955, -0.022478539496660233, 0.021556220948696136, 0.0003624974633567035, -0.012723254971206188, 0.02684181183576584, -0.012841500341892242, -0.018079793080687523, 0.0341494046151638, -0.013539151288568974, -0.014331398531794548, 0.04353812709450722, 0.04013264551758766, -0.020279165357351303, -0.0063734520226716995, 0.028047919273376465, 0.044957078993320465, 0.039044782519340515, -0.035426460206508636, -0.007940209470689297, -0.018079793080687523, 0.048575401306152344, 0.012959746643900871, 0.01262865774333477, -0.04368002340197563, -0.021745413541793823, 0.025753948837518692, -0.04720374941825867, 0.04058197885751724, 0.008738369680941105, -0.05462959036231041, -0.07572465389966965, 0.010553442873060703, -0.009394633583724499, -0.04311244189739227, 0.028710095211863518, 0.052406568080186844, 0.0020648683421313763, 0.04736929386854172, 0.06579200178384781, 0.03561565279960632, -0.023128891363739967, -0.037744078785181046, 0.005637371446937323, -0.0055930293165147305, 0.03268315643072128, -0.026534371078014374, -0.06522441655397415, 0.012474938295781612, 0.036112286150455475, 0.02006632275879383, 0.023247135803103447, 0.008017069660127163, -0.045028023421764374, 0.020042674615979195, -0.06333248317241669, 0.005551643203943968, 0.001131465076468885, 0.0023057942744344473, -0.03225747123360634, 0.01452059205621481, -0.0014980272389948368, -0.06669066846370697, 0.020645728334784508, -0.03280140087008476, -0.017736880108714104, 0.010246003977954388, 0.016034139320254326, 0.005900468677282333, 0.008927562274038792, 0.003689270932227373, -0.022395767271518707, -0.05609583854675293, -0.010198705829679966, -0.0018180301412940025, 0.03206827864050865, -0.0013472638092935085, 0.03360547497868538, 0.013243536464869976, -0.03559200465679169, 0.008667421527206898, -0.05051463097333908, 0.01206699013710022, -0.009353247471153736, 0.05775127932429314, -0.0010767764179036021, -0.004120868165045977, 0.008413192816078663, 0.004165210761129856, -0.032328419387340546, -0.015265541151165962, -0.04436584934592247, 0.03083852119743824, -0.015714874491095543, 0.018966635689139366, 0.03138245269656181, 0.006379364524036646, -0.021568045020103455, 0.013267185539007187, 0.012132025323808193, 0.005971415899693966, 0.00639710109680891, 0.02159169502556324, -0.004271631594747305, -0.0691501796245575, -0.037862326949834824, -0.011316129006445408, -0.0275749359279871, -0.017784178256988525, -0.01596319116652012, -0.019368672743439674, -0.030885819345712662, -0.014307749457657337, -0.0694812685251236, -0.03358182683587074, -0.017334843054413795, -0.009164053946733475, -0.005474783480167389, 0.01431957446038723, 0.030531082302331924, -0.01130430493503809, 0.012474938295781612, -0.020988641306757927, -0.010044986382126808, -0.06011619791388512, -0.030696626752614975, 0.005489564035087824, -0.010854970663785934, -0.009731634519994259, -0.03942317143082619, -0.004880597814917564, 0.03426765277981758, 0.029845256358385086, -0.027882374823093414, 0.022573135793209076, 0.023944787681102753, 0.019829832017421722, 0.044507741928100586, 0.0033345334231853485, -0.03270680457353592, -0.04706185311079025, 0.0334872268140316, 0.02254948578774929, 0.04576114937663078, 0.03176083788275719, 0.0004264241433702409, 0.033061541616916656, 0.0101218456402421, -0.026676267385482788, 0.05108221247792244, -0.051555197685956955, -0.00868515856564045, -0.0008247648947872221, -0.06342708319425583, 0.019888954237103462, 0.04119686037302017, -0.038879238069057465, 0.02249036356806755, -0.009719809517264366, -0.016258805990219116, -0.011197883635759354, -0.07312323898077011, -0.007957946509122849, -0.03254126012325287, 0.05543366074562073, -0.007142050191760063, 0.026865459978580475, 0.021225132048130035, -0.04382191598415375, -0.0049811070784926414, -0.010529793798923492, 0.014828030951321125, -0.03618323430418968, 0.007325331214815378, 0.01440234575420618, -0.010246003977954388, -0.030294589698314667, -0.017997020855545998, 0.003751350101083517, 0.04391651228070259, -0.032896000891923904, 0.019155830144882202, -0.03485887870192528, -0.019995374605059624, -0.005850214045494795, -0.008549176156520844, 0.0376494824886322, 0.00039686268428340554, -0.006657242309302092, 0.03072027489542961, 0.03828801214694977, 0.003426173934713006, -0.037176501005887985, 0.0691501796245575, 0.04046373441815376, 0.05396741256117821, -0.05306874215602875, -0.0030226598028093576, -0.029443219304084778, -0.02892293781042099, -0.011818674392998219, -0.006261118687689304, 0.022194748744368553, -0.02525731548666954, 0.008531439118087292, -0.03623053431510925, 0.003041874850168824, -0.03254126012325287, 0.05325793847441673, 0.02497352659702301, -0.034764282405376434, 0.04266310855746269, -0.04602129012346268, -0.0033345334231853485, -0.021000465378165245, 0.026179634034633636, 0.04840985685586929, 0.01838723197579384, -0.039375871419906616, -0.029017534106969833, 0.008448666892945766, -0.00503136171028018, 0.0275749359279871, 0.006379364524036646, 0.004035139922052622, -0.016980106011033058, -0.03495347872376442, -0.007082927040755749, 0.0034646037966012955, 0.02513907104730606, 0.021579870954155922, -0.029466869309544563, -0.00870880763977766, -0.015099996700882912, 0.016022315248847008, -0.029183078557252884, -0.0036419725511223078, 0.00556938024237752, -0.014733434654772282, 0.02361369878053665, -0.021296080201864243, 0.004144517704844475, 0.006657242309302092, 0.005019536707550287, -0.012226622551679611, 0.01397666148841381, -0.006184258498251438, -0.008413192816078663, -0.00016942415095400065, -0.0049042473547160625, 0.005510257091373205, 0.025068122893571854, -0.012451289221644402, 0.00941237062215805, -0.012522237375378609, -0.039943452924489975, 0.08532621711492538, 0.007455401588231325, -0.007549998350441456, 0.031216908246278763, -0.011008690111339092, 0.02361369878053665, -0.027196548879146576, 0.025493808090686798, -0.012900623492896557, -0.07052183151245117, -0.0030714361928403378, 0.026085037738084793, 0.010535706765949726, -0.018741969019174576, -0.013633747585117817, 0.008921650238335133, -0.016530770808458328, -0.022005554288625717, 0.013858415186405182, -0.03720014914870262, -0.022916048765182495, -0.011008690111339092, 0.02379106730222702, 0.035662952810525894, 0.015750348567962646, -0.0008949734037742019, -0.03559200465679169, 0.011398901231586933, 0.05812966823577881, -0.04838620871305466, 0.012675956822931767, -0.03866639733314514, -0.03833530843257904, 0.009294125251471996, 0.023270785808563232, 0.052453864365816116, -0.00015353485650848597, 0.030247291550040245, 0.0379805713891983, 0.01434322353452444, 0.025328263640403748, 0.020763972774147987, 0.022963346913456917, -0.023885663598775864, -0.024547841399908066, -0.03466968610882759, 0.05609583854675293, -0.029845256358385086, 0.02136702835559845, -0.010074547491967678, -0.0016480516642332077, -0.0003227742563467473, -0.0014692049007862806, -0.007768752984702587, 0.006308416835963726, -0.012888799421489239, 0.02018456906080246, -0.050372738391160965, 0.0016347490018233657, -0.001918539172038436, -0.005442265886813402, -0.0347406342625618, 0.00043307547457516193, -0.013964836485683918, -0.013586449436843395, -0.0015711919404566288, 0.018682846799492836, 0.04105496406555176, 0.05500797554850578, 0.04228471964597702, -0.0209058690816164, -0.0037956922315061092, -0.01293609756976366, 0.027433039620518684, 0.03821706399321556, -0.026534371078014374, -0.006213820073753595, -0.0033759193029254675, -0.03637242689728737, 0.08802221715450287, -0.10206983238458633, -0.016566244885325432, -0.024949876591563225, -0.005173256620764732, 0.027243847027420998, -0.006621768232434988, 0.042261071503162384, 0.05756208673119545, 0.01167086698114872, -0.02340085618197918, -0.012191148474812508, -0.040558330714702606, 0.04025089368224144, 0.005288546439260244, 0.02733844332396984, 0.017169298604130745, 0.004310061689466238, 0.0013147462159395218, -0.038808293640613556, 0.028260761871933937, -0.037247445434331894, 0.02599044144153595, -0.00016951652651187032, -0.008028893731534481, -0.009820318780839443, -0.007620946038514376, 0.01765410788357258, 0.01573852449655533, 0.05666341632604599, -0.05812966823577881, -0.06877179443836212, 0.027598584070801735, -0.013148940168321133, -0.033747367560863495, 0.02908848226070404, 0.05013624578714371, -0.024878930300474167, 0.029230376705527306, -0.045571956783533096, -0.03935222327709198, -0.03478793427348137, 0.003984885755926371, 0.04734564200043678, -0.0009962214389815927, 0.0014418604550883174, 0.02068120241165161, 0.022573135793209076, 0.011765463277697563, 0.002128425519913435, 0.023412680253386497, -0.040794823318719864, 0.004800782073289156, 0.06792042404413223, -0.005587116815149784, -0.01169451605528593, -0.007934297434985638, -0.014650662429630756, -0.00452290428802371, -0.0010730811627581716, 0.012439465150237083, -0.021556220948696136, -0.03265950828790665, -0.016613543033599854, -0.003831166075542569, -0.019262250512838364, 0.03291964903473854, -0.007136137690395117, 0.06475143134593964, 0.025162719190120697, 0.017287544906139374, 0.02340085618197918, -0.03781502693891525, -0.007425840012729168, -0.00512891449034214, 0.04003804922103882, 0.044673286378383636, 0.043940164148807526, -0.00479486957192421, 0.004978151060640812, 0.03483523055911064, 0.0061369603499770164, 0.04155159741640091, 0.013042518869042397, -0.0389028899371624, -0.02965606190264225, 0.0008454579510726035, 0.04235566779971123, -0.020279165357351303, -0.02745668962597847, 0.04604493826627731, -0.012522237375378609, 0.026652617380023003, 0.0328250527381897, -0.036396075040102005, 0.03393656387925148, 0.011576269753277302, -0.021177833899855614, -0.01731119491159916, 0.02069302648305893, 0.01861189864575863, 0.03682176023721695, 0.002913282485678792, -0.011458024382591248, 0.03552105650305748, 0.006045319605618715, 0.012463114224374294, 0.038879238069057465, 0.038477204740047455, -0.007680068723857403, -0.02006632275879383, 0.00040203594835475087, -0.006669066846370697, 0.0641365572810173, -0.011150584556162357, -0.001968793570995331, -0.013089817017316818, -0.011960568837821484, 0.038193412125110626, 0.021177833899855614, -0.04396381229162216, 0.027551285922527313, -0.02293969690799713, 0.012143850326538086, -0.011097374372184277, -0.0167436134070158, 0.004984063096344471, 0.0401562936604023, -0.0037070077378302813, 0.018741969019174576, -0.04058197885751724, 0.0004345535417087376, -0.04720374941825867, 0.027669532224535942, 0.000736080517526716, -0.0006189431878738105, 0.00014808446576353163, -0.02447689324617386, 0.024287700653076172, -0.006207908038049936, -0.009944477118551731, 0.02368464693427086, 0.0263215284794569, 0.009347335435450077, -0.027362093329429626, 0.02452419139444828, 0.0003107649099547416, -0.0032694980036467314, -0.005983240902423859, -0.0234481543302536, 0.015111821703612804, 0.0016510079149156809, -0.02124878205358982, -0.031547997146844864, -0.011422550305724144, 0.033794667571783066, 0.007218909915536642, 0.02126060612499714, -0.010417460463941097, -0.007845613174140453, 0.053636323660612106, -0.025966791436076164, 0.0019865306094288826, -0.017263896763324738, 0.042095527052879333, 0.0035355512518435717, -0.001834288937970996, -0.03623053431510925, 0.023199837654829025, -0.0325649119913578, -0.005950722843408585, 0.002913282485678792, 0.023211663588881493, 0.0010819496819749475, 0.010364250279963017, 0.05051463097333908, 0.04521721974015236, -0.01491080317646265, -0.02655802108347416, 0.04003804922103882, -0.012321218848228455, 0.00385481514967978, -0.06323789060115814, -0.009323686361312866, 0.023353558033704758, -0.03325073793530464, 0.014993575401604176, -0.049805156886577606, -0.035828497260808945, 0.032210174947977066, 0.011523059569299221, -0.014461468905210495, 0.008235824294388294, 0.03027094155550003, -0.013397255912423134, 0.016838211566209793, 0.000952618254814297, -0.005805871915072203, 0.0010745592880994081, -0.026747213676571846, 0.001834288937970996, -0.014946277253329754, -0.015572980046272278, 0.003668577875941992, -0.009110843762755394, 0.01815073937177658, 0.0055930293165147305, 0.021106885746121407, -0.04044008627533913, 0.029277674853801727, 0.007325331214815378, -0.0015179812908172607, -0.022395767271518707, 0.001985052367672324, 0.016329754143953323, -0.00010974694305332378, 0.023211663588881493, 0.03589944541454315, -0.05992700532078743, -0.0484808050096035, -0.013964836485683918, -0.03951776772737503, -0.016246981918811798, -0.021106885746121407, -0.006048276089131832, 0.017902424558997154, -0.020314639434218407, 0.01203151699155569, 0.05254846066236496, -0.019664287567138672, -0.01876561902463436, 0.008933475241065025, 0.02301064506173134, 0.0017367361579090357, 0.009311861358582973, -0.03400751203298569, -0.02256130985915661, 0.011759551241993904, -0.027314795181155205, 0.037625834345817566, -0.046092238277196884, -0.003627191763371229, 0.013196238316595554, 0.013515502214431763, -0.029632413759827614, -0.010423372499644756, 0.011795025318861008, 0.009323686361312866, -0.02537556178867817, -0.04436584934592247, -0.0026043651159852743, 0.02340085618197918, -0.001834288937970996, 0.017323018983006477, 0.004777132999151945, 0.010577092878520489, -0.026416126638650894, 0.0073312437161803246, 0.03161894530057907, -0.0017677756259217858, -0.024878930300474167, -0.04017994552850723, 0.017713230103254318, 0.0436563715338707, 0.009932652115821838, -0.004386921413242817, -0.004617501050233841, -0.01077219843864441, -0.006403013598173857, 0.03987250477075577, -0.037625834345817566, -0.0167436134070158, -0.005989152938127518, -0.012143850326538086, 0.009087194688618183, 0.022360293194651604, -0.006988330744206905, 0.028899289667606354, 0.039210326969623566, -0.004310061689466238, -0.05756208673119545, -0.00794612243771553, 0.014224977232515812, 0.022088326513767242, 0.0030803047120571136, 0.017110176384449005, 0.0162824559956789, -0.04895378649234772, -0.0443185493350029, 0.031216908246278763, -0.028710095211863518, -0.0011809805873781443, -0.04573750123381615, 0.01990077830851078, 0.04143334925174713, -0.013172589242458344, 0.01152897160500288, 0.012415816076099873, -0.030081747099757195, 0.033960212022066116, -0.010169143788516521, -0.01167086698114872, 0.0018372450722381473, 0.04734564200043678, -0.008164877071976662, 0.037342045456171036, -0.009294125251471996, 0.025777598842978477, 0.016093261539936066, -0.030483784154057503, -0.014201328158378601, 0.00953061692416668, 0.03005809895694256, 0.0002921042323578149, -0.015821296721696854, -0.008265385404229164, 0.003476428333669901, 0.020763972774147987, 0.020894043147563934, -0.04308879375457764, -0.027078302577137947, 0.01521824300289154, -0.0350717231631279, 0.0008757584146223962, -0.04779497906565666, -0.019144006073474884, 0.002753650536760688, 0.00656855758279562, -0.010689426213502884, -0.022785978391766548, -0.04126780480146408, 0.01927407644689083, -0.003644928801804781, 0.005081615876406431, -0.00763868261128664, -0.06229192018508911, -0.0006000977591611445, 0.027149250730872154, 0.007786490023136139, -0.034244000911712646, 0.0010183925041928887, -0.03488253057003021, 0.0395650640130043, -0.011913270689547062, -0.013870240189135075, -0.02587219513952732, -0.02396843582391739, 0.019238602370023727, -0.00989717897027731, -0.00646804878488183, -0.0025999308563768864, -0.0048658172599971294, -0.02260860987007618, 0.006225644610822201, 0.003996710292994976, -0.012025604024529457, 0.019309548661112785, 0.05368362367153168, -0.048622697591781616, -0.0019569690339267254, -0.039210326969623566, 0.007218909915536642, -0.019155830144882202, -0.019368672743439674, 0.004573158919811249, 0.0034084368962794542, -0.0005701667978428304, 0.026936408132314682, -0.07411650568246841, 0.044176653027534485, -0.015773998573422432, -0.016649017110466957, 0.014839855954051018, 0.001562323421239853, -0.04528816416859627, -0.01787877455353737, 0.03928127512335777, -0.00955426599830389, -0.008773842826485634, -0.004570202436298132, -0.022596783936023712, -0.01955786533653736, 0.006077837198972702, 0.01611691154539585, 0.010931829921901226, -0.022762328386306763, -0.00015473579696845263, 0.05377821996808052, 0.02830806002020836, 0.021733589470386505, 0.00018531344539951533, 0.021378852427005768, -0.01910853199660778, -0.019238602370023727, 0.02525731548666954, -0.02368464693427086, -0.009518791921436787, 0.022514011710882187, -0.035402812063694, -0.05089301988482475, -0.032328419387340546, -0.03258856013417244, -0.0033581824973225594, 0.02688910998404026, 0.04900108650326729, -0.0068168737925589085, 0.000977006391622126, -0.08594109117984772, -0.024311348795890808, -0.01702740415930748, -0.017240246757864952, -0.023471804335713387, -0.012297569774091244, -0.03899748623371124, -0.00506092282012105, -0.007910648360848427, 0.010760373435914516, 0.016719965264201164, 0.0065508210100233555, -0.05146060138940811, -0.04278135299682617, 0.029845256358385086, -0.014224977232515812, 0.012687780894339085, 0.025517458096146584, 0.03589944541454315, -0.01062439102679491, -0.02114235982298851, -0.0052175987511873245, -0.054818782955408096, 0.028781043365597725, -0.029183078557252884, -0.016034139320254326, -0.011594006791710854, 0.010931829921901226, 0.015998665243387222, -0.021225132048130035, -0.04008534923195839, -0.041291456669569016, 0.010180968791246414, -0.011777288280427456, -0.0628122016787529, 0.05202817916870117, 0.0020057454239577055, 0.05756208673119545, 0.002806861186400056, -0.024595139548182487, 0.016601718962192535, 0.010872706770896912, 0.01437869668006897, 0.0033611387480050325, 0.024571489542722702, 0.0009984384523704648, -0.0060128020122647285, -0.016932807862758636, -0.0350717231631279, -0.011996042914688587, 0.03405480831861496, 0.008070279844105244, 0.0022422370966523886, 0.006982418242841959, 0.017973370850086212, 0.03767313063144684, -0.04488613083958626, 0.0004245765449013561, -0.030081747099757195, 0.04831526055932045, 0.0052796779200434685, -0.0060128020122647285, 0.005214642733335495, -0.03265950828790665, -0.03327438607811928, 0.0159513670951128, 0.01040563639253378, 0.03138245269656181, -0.0062433816492557526, 0.0030064010061323643, -0.013007044792175293, 0.013917538337409496, 0.011800937354564667, -0.01927407644689083, 0.007626858074218035, 0.0057378807105124, -0.0017707317601889372, -0.013456379063427448, -0.00907536968588829, 0.010033161379396915, 0.060967568308115005, 0.006663154345005751, 0.024204928427934647, 0.03679811209440231, -0.026960056275129318, 0.02282145246863365, -0.008726544678211212, -0.02852090261876583, -0.00375726236961782, -0.011741814203560352, -0.0019421882461756468, 0.006527171470224857, 0.001052388222888112, -0.0020308727398514748, -0.026628969237208366, 0.023696471005678177, -0.01758315972983837, 0.007816051132977009, 0.01316076423972845, 0.006403013598173857, 0.023483628407120705, 0.015454734675586224, -0.023921137675642967, 0.019191304221749306, -0.020669376477599144, -0.0010250437771901488, -0.021331554278731346, -0.03545010834932327, 0.0015268496936187148, -0.003213331336155534, 0.02785872481763363, -0.0010834276909008622, -0.041859034448862076, -0.006958769168704748, -0.0009341423283331096, -0.021189657971262932, 0.042308371514081955, -0.013113466091454029, -0.0035414635203778744, 0.004984063096344471, 0.015159119851887226, 0.026699915528297424, 0.0006340934196487069, 0.00989717897027731, -0.012226622551679611, 0.02830806002020836, -0.02176906354725361, -0.027243847027420998, -0.02513907104730606, 0.00922317709773779, 0.003845946630463004, 0.04219012334942818, -0.007437665015459061, 0.00902215950191021, -0.008756105788052082, -0.02277415245771408, 0.03372371941804886, -0.02075214870274067, 0.020763972774147987, -0.012806027196347713, 0.012640482746064663, -0.0034646037966012955, -0.004126780666410923, -0.014414170756936073, -0.0013502199435606599, 0.0076445951126515865, 0.004330754745751619, 0.025801246985793114, -0.052170075476169586, 0.019888954237103462, -0.02908848226070404, -0.009743459522724152, -0.014165854081511497, 0.03138245269656181, -0.027598584070801735, 0.04966326430439949, -0.033676423132419586, -0.0037454378325492144, -0.03589944541454315, -0.030814871191978455, -0.0015844946028664708, 0.03715284913778305, 0.008797491900622845, -0.0015815384685993195, 0.03254126012325287, -0.030696626752614975, -0.012486763298511505, 0.006071925163269043, 0.006426662672311068, -0.02153257094323635, -0.030199993401765823, 0.025943143293261528, 0.026936408132314682, 0.0025511544663459063, 0.016873683780431747, 0.05732559412717819, 0.014780732803046703, -0.007348980288952589, -0.01397666148841381, 0.0010183925041928887, -0.010553442873060703, 0.04611588642001152, 0.04285230115056038, -0.0012393645010888577, 0.043041493743658066, 0.010311039164662361, -0.007000155281275511, 0.0034734723158180714, -0.022194748744368553, 0.00798159558326006, 0.021497098729014397, -0.005312195513397455, 0.0034350422210991383, 0.030862171202898026, -0.03483523055911064, 0.037460289895534515, 0.03275410458445549, -0.019971726462244987, 0.011517147533595562, -0.008111665956676006, 0.012853325344622135, 0.008868440054357052, 0.014201328158378601, -0.0022747546900063753, -0.029324974864721298, 0.08319778740406036, 0.015762174502015114, -0.04696725681424141, -0.020539306104183197, 0.016093261539936066, -0.01668449118733406, -0.014272275380790234, 0.02074032463133335, -0.0013428295496851206, -0.008862527087330818, 0.0017810782883316278, -0.041291456669569016, 0.007615033537149429, -0.03951776772737503, -0.023377208039164543, -0.022230222821235657, 0.007053365930914879, -0.0007774665718898177, -0.0059595913626253605, 0.0022200660314410925, 0.02998715080320835, 0.011877796612679958, -0.021154185757040977, 0.032115574926137924, 0.03185543417930603, -0.024216752499341965, 0.025280965492129326, -0.008224000222980976, 0.01861189864575863, 0.024713385850191116, -0.018564600497484207, -0.007555910851806402, -0.0231170654296875, 0.024547841399908066, -0.011659041978418827, -0.014579715207219124, 0.015513856895267963, -0.006284767761826515, -0.013361782766878605, 0.012652307748794556, 0.04807876795530319, 0.049474067986011505, 0.03918667882680893, 0.0016125779366120696, 0.00992674008011818, 0.00020766929083038121, 0.015194592997431755, 0.01692098379135132, -0.027835076674818993, 0.014627013355493546, 0.00408539455384016, 0.004978151060640812, 0.032162874937057495, -0.03161894530057907, 0.009512879885733128, -0.0046234130859375, 0.01556115597486496, -0.008844790980219841, 0.003239936660975218, -0.012451289221644402, -0.02795332297682762, -0.008017069660127163, -0.0016717008547857404, 0.027243847027420998, -0.0031069100368767977, -0.021355202421545982, 0.007851525209844112, -0.005356537643820047, -0.001255623297765851, -0.010583004914224148, 0.013988485559821129, -0.05812966823577881, 0.015809472650289536, -0.035213619470596313, -0.019475093111395836, -0.012711429968476295, 0.020030848681926727, 0.0012334521161392331, 0.012782378122210503, 0.025068122893571854, 0.013598274439573288, -0.017393967136740685, -0.02558840438723564, -0.007437665015459061, 0.04105496406555176, 0.01995990239083767, 0.01916765421628952, -0.009104931727051735, -0.033298034220933914, 0.003712920006364584, 0.009873529896140099, 0.010718987323343754, 0.0006045319605618715, -0.01539561152458191, -0.022537661716341972, 0.021946432068943977, 0.005052054300904274, 0.0005871645989827812, 0.013775642961263657, 0.024264050647616386, 0.020728500559926033, -0.0022821452002972364, -0.049142979085445404, 0.03308519348502159, 0.019250426441431046, -0.043277986347675323, -0.03178448975086212, 0.03812246769666672, -0.0012859237613156438, 0.014898979105055332, -0.011339778080582619, -0.014780732803046703, 0.002778777852654457, -0.037294745445251465, 0.007307594176381826, 0.0010597785003483295, -0.0011100330157205462, -0.01026374101638794, 0.019687935709953308, 0.0031689892057329416, 0.0034084368962794542, -0.013917538337409496, 0.013763818889856339, -0.005161432083696127, -0.0263215284794569, 0.025162719190120697, -0.0006152479909360409, -0.0018934118561446667, 0.007863350212574005, -0.043940164148807526, -0.010878619737923145, -0.06262300908565521, 0.018872039392590523, -0.005253072362393141, 0.012640482746064663, -0.04576114937663078, -0.009838055819272995, -0.01011593360453844, 0.008206263184547424, -0.0008188526262529194, 0.005542774684727192, -0.022407591342926025, 0.010033161379396915, -0.005460002925246954, 0.02063390240073204, 0.06773123145103455, -0.0013280488783493638, 0.002497943816706538, -0.015371962450444698, 0.03287234902381897, -0.026061387732625008, 0.00190967065282166, 0.0055841607972979546, -0.03161894530057907, -0.04216647520661354, -0.032446663826704025, 0.014816206879913807, -0.018730144947767258, 0.0004245765449013561, 0.01820986345410347, -0.004209552891552448, 0.027385741472244263, -0.014142205007374287, -0.004035139922052622, -0.015324664302170277, 0.018138915300369263, 0.052122775465250015, 0.003124646842479706, -0.01861189864575863, -0.008673334494233131, 0.008105753920972347, 0.006609943695366383, -0.05056193098425865, 0.02316436544060707, 0.024110332131385803, 0.016306104138493538, -0.018422706052660942, -0.009294125251471996, 0.013941187411546707, -0.03928127512335777, 0.01584494486451149, -0.0060896617360413074, 0.02126060612499714, 0.005208730231970549, 0.03022364340722561, -0.026226932182908058, -0.005572336260229349, -0.027078302577137947, -0.020610254257917404, 0.002614711644127965, 0.011026427149772644, -0.008442754857242107, -0.019250426441431046, 0.01313711516559124, 0.008052543736994267, 0.013893889263272285, 0.016270630061626434, 0.01167086698114872, -0.017855124548077583, -0.01133386604487896, -0.060352686792612076, 0.011469848453998566, 0.038027871400117874, 0.016980106011033058, 0.03429130092263222, 0.0018254205351695418, 0.002583672059699893, -0.012746904045343399, 0.02852090261876583, -0.006615856196731329, -0.02368464693427086, 0.00021561393805313855, -0.004132692702114582, -0.0481497161090374, 0.023814717307686806, -0.027669532224535942, 0.006113311275839806, 0.005799959413707256, -0.0322338230907917, 0.02379106730222702, 0.022395767271518707, 0.015750348567962646, -0.017488563433289528, 0.013633747585117817, 0.024027559906244278, 0.0012341912370175123, 0.001936275977641344, -0.002913282485678792, -0.006609943695366383, -0.021106885746121407, -0.0016037095338106155, 0.00992674008011818, 0.0049190279096364975, -0.021615343168377876, 0.01804431900382042, 0.0263215284794569, 0.017287544906139374, -0.012652307748794556, 0.007254383526742458, 0.02447689324617386, 0.02023186720907688, -0.004576114937663078, 0.012534061446785927, -0.025399211794137955, -0.005486608017235994, -0.0017589072231203318, 0.01967611163854599, -0.02126060612499714, 0.029017534106969833, -0.009128580801188946, 0.025730300694704056, -0.0009666599216870964, 0.004035139922052622, 0.01342090591788292, 0.008070279844105244, -0.006095574237406254, -0.0028305102605372667, 0.009731634519994259, -0.003019703784957528, -0.012971571646630764, -0.01378746796399355, 0.0053624496795237064, -0.0012231057044118643, 0.013953011482954025, -0.016093261539936066, -0.011576269753277302, 0.006527171470224857, -0.01611691154539585, -0.00375726236961782, -0.004117912147194147, 0.019664287567138672, 0.021118711680173874, -0.002424040110781789, -0.021508922800421715, -0.011812761425971985, 0.016779087483882904, 0.020610254257917404, 0.006875996943563223, -0.022916048765182495, 0.016672667115926743, -0.017157474532723427, -0.005554599221795797, -0.05117680877447128, 0.013480028137564659, -0.03083852119743824, -0.007697805762290955, 0.05396741256117821, 0.005489564035087824, -0.0439874604344368, 0.0020101796835660934, -0.023885663598775864, -0.0022067634854465723, -0.006935120094567537, -0.007839701138436794, 0.030199993401765823, 0.029112132266163826, 0.010393811389803886, -0.005856126546859741, -0.022514011710882187, -0.003390700090676546, -0.028733745217323303, 0.021638993173837662, -0.05193358287215233, -0.04032183811068535, -0.03457508981227875, -0.002623580163344741, 0.009294125251471996, -0.0006348324823193252, 0.03164259344339371, 0.023885663598775864, 0.037010956555604935, 0.03173718973994255, 0.012132025323808193, 0.020196393132209778, -0.0003279475204180926, 0.03769678249955177, -0.031311504542827606, -0.0037602183874696493, 0.00848414096981287, 0.0275749359279871, -0.012273920699954033, 0.009335511364042759, -0.007526349276304245, 0.0188247412443161, -0.005270809400826693, 0.020846744999289513, -0.020610254257917404, 0.0022333688102662563, 0.03840625658631325, 0.0026487072464078665, 0.002800948917865753, 0.004747571423649788, -0.009702073410153389, 0.010748549364507198, 0.007207085378468037, 0.01415403001010418, -0.017997020855545998, 0.010275565087795258, 0.011203795671463013, -0.014485117979347706, -0.005782222840934992, -0.004117912147194147, -0.03325073793530464, -0.007011979818344116, 0.012947921641170979, -0.008058455772697926, 0.027362093329429626, -0.012534061446785927, -0.006805049255490303, 0.000380234356271103, 0.002583672059699893, 0.006444399710744619, 0.001695350045338273, 0.029466869309544563, 0.018245337530970573, 0.006976505741477013, 0.00435735983774066, -0.005140739027410746, -0.01787877455353737, 0.033463578671216965, 0.012344867922365665, 0.030318239703774452, 0.0032517611980438232, -0.021733589470386505, -0.04680171236395836, -0.005383142735809088, 0.014650662429630756, 0.023188013583421707, -0.0411495603621006, -0.016152385622262955, -0.03386561572551727, 0.050940316170454025, 0.01764228194952011, 0.011067813262343407, 0.01155853271484375, 0.03455144166946411, -0.01759498380124569, 0.008052543736994267, -0.04779497906565666, -0.022856924682855606, -0.004567246418446302, 0.010837233625352383, 0.012007866986095905, 0.019013935700058937, -0.015762174502015114, 0.0010878619505092502, 0.033676423132419586, -0.012534061446785927, 0.023885663598775864, -0.017003756016492844, -0.030318239703774452, 0.024382296949625015, 0.009288212284445763, -0.009702073410153389, 0.022904222831130028, 0.04159889370203018, 0.006332065910100937, -0.013184413313865662, -0.0331561416387558, -0.032162874937057495, -0.015241892077028751, -0.015005400404334068, -0.0079756835475564, -0.00798159558326006, -0.009169966913759708, 0.012380341999232769, -0.010683514177799225, 0.005134826526045799, 9.986232907976955e-05, 0.016873683780431747, -0.012250271625816822, -0.0029502343386411667, -0.05368362367153168, -0.040108997374773026, 0.017618633806705475, 0.03370007127523422, 0.015371962450444698, 0.0009999165777117014, -0.011759551241993904, -0.007189348340034485, 0.00905172061175108, 0.0013376562856137753, 0.00890391319990158, 0.014816206879913807, -0.025280965492129326, -0.012043341062963009, -0.006793224718421698, -0.04053468257188797, -0.011268830858170986, -0.021958256140351295, 0.03038918599486351, 0.0005420834058895707, 0.0101218456402421, -0.0043603163212537766, 0.0011107720201835036, 0.00944193173199892, -0.014721609652042389, 0.016885509714484215, -0.00795203447341919, 0.034764282405376434, 0.00593298627063632, 0.02226569689810276, 0.007603209000080824, -0.0035503320395946503, -0.026203284040093422, -0.02338903211057186, -0.00549547653645277, 0.012817851267755032, -0.020421059802174568, 0.017441265285015106, -0.010677601210772991, 0.023767419159412384, 0.030247291550040245, -0.06844070553779602, 0.0334872268140316, -0.007857437245547771, -0.004599764011800289, 0.02627423033118248, -0.00907536968588829, 0.025943143293261528, 0.026865459978580475, -0.025280965492129326, 0.027196548879146576, -0.027362093329429626, 0.02717289887368679, -0.004392833914607763, -0.003364094765856862, 0.014260451309382915, 0.005696494597941637, 0.017914248630404472, 8.52663506520912e-05, 4.7044301027199253e-05, 0.012368516996502876, -0.004224333446472883, -0.00781013909727335, 0.01793789677321911, 0.014981751330196857, 0.025612054392695427, -0.013586449436843395, 0.04476788267493248, -0.012581359595060349, -0.015182768926024437, 0.018470004200935364, 0.0028393787797540426, -0.0016510079149156809, -0.04708550125360489, -0.003198550548404455, -0.019546041265130043, 0.005433397367596626, -0.014638837426900864, 0.04044008627533913, -0.015123645775020123, -0.03930492326617241, -0.03715284913778305, -0.018812917172908783, -0.018067967146635056, 0.0028718963731080294, 0.05850805342197418, -0.04760578274726868, -0.02513907104730606, -0.015608454123139381, -0.0036833586636930704, 0.07142049819231033, -0.010606653988361359, 0.017547685652971268, 0.004576114937663078, -0.004966326057910919, -0.009802581742405891, 0.028379006311297417, -0.034598737955093384, 0.026936408132314682, -0.014142205007374287, -0.025635702535510063, 0.0008890610770322382, -0.012321218848228455, 0.009820318780839443, -0.00415634224191308, 0.02000720053911209, 0.010393811389803886, -0.00496337004005909, -0.04053468257188797, -0.02542285993695259, -0.006994242779910564, -0.03410210832953453, -0.05027814209461212, 0.00851370207965374, -0.02345997840166092, 0.023944787681102753, 0.014969926327466965, 0.017902424558997154, -0.029466869309544563, -0.027385741472244263, -0.018647372722625732, -0.005338800605386496]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-15T11:25:02.992112", "url_path": "/testing-evals/", "chunk_size": 2191}
updated_dt: 2025-03-15T11:25:02.994703
---
```
importasyncio
fromdatetimeimport date
frompydantic_aiimport Agent, RunContext
fromfake_databaseimport DatabaseConn 
DatabaseConn is a class that holds a database connection
[](https://ai.pydantic.dev/testing-evals/#__code_0_annotation_1)
fromweather_serviceimport WeatherService 
WeatherService has methods to get weather forecasts and historic data about the weather
[](https://ai.pydantic.dev/testing-evals/#__code_0_annotation_2)
weather_agent = Agent(
  'openai:gpt-4o',
  deps_type=WeatherService,
  system_prompt='Providing a weather forecast at the locations the user provides.',
)

@weather_agent.tool
defweather_forecast(
  ctx: RunContext[WeatherService], location: str, forecast_date: date
) -> str:
  if forecast_date < date.today(): 
We need to call a different endpoint depending on whether the date is in the past or the future, you'll see why this nuance is important below
[](https://ai.pydantic.dev/testing-evals/#__code_0_annotation_3)
    return ctx.deps.get_historic_weather(location, forecast_date)
  else:
    return ctx.deps.get_forecast(location, forecast_date)

async defrun_weather_forecast( 
This function is the code we want to test, together with the agent it uses
[](https://ai.pydantic.dev/testing-evals/#__code_0_annotation_4)
  user_prompts: list[tuple[str, int]], conn: DatabaseConn
):
"""Run weather forecast for a list of user prompts and save."""
  async with WeatherService() as weather_service:
    async defrun_forecast(prompt: str, user_id: int):
      result = await weather_agent.run(prompt, deps=weather_service)
      await conn.store_forecast(user_id, result.data)
    # run all prompts in parallel
    await asyncio.gather(
      *(run_forecast(prompt, user_id) for (prompt, user_id) in user_prompts)
    )

```

Here we have a function that takes a list of `(user_prompt, user_id)` tuples, gets a weather forecast for each prompt, and stores the result in the database.
**We want to test this code without having to mock certain objects or modify our code so we can pass test objects in.**
Here's how we would write tests using [`TestModel`](https://ai.pydantic.dev/api/models/test/#pydantic_ai.models.test.TestModel):
test_weather_app.py