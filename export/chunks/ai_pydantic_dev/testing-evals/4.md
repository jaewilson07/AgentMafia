---
url: https://ai.pydantic.dev/testing-evals/
session_id: pydantic_ai_docs
chunk_number: 4
title: Weather Forecast Function Implementation
summary: This chunk introduces a Python script utilizing the Pydantic AI library to define a function, call_weather_forecast, for handling weather forecasting requests. It outlines the function's access to a list of ModelMessage and AgentInfo, which include the agent's information and available tools. Additionally, the script imports necessary modules and sets a pytest configuration for async testing.
embedding: [-0.006069447845220566, -0.02065977454185486, 0.026182685047388077, -0.05507568642497063, -0.017399724572896957, -0.0058808764442801476, 0.006315549835562706, -0.010425771586596966, -0.012132504023611546, 0.005024313926696777, 0.0031322059221565723, -0.01710567995905876, 0.01155720092356205, -0.026898616924881935, -0.031194213777780533, -0.0017450861632823944, 0.01399904303252697, 0.02758898213505745, -0.042776983231306076, 0.03906947374343872, 0.025083215907216072, 0.004880488384515047, 0.02717987634241581, -0.04433669522404671, -0.017438076436519623, -0.01886994205415249, -0.05039655417203903, 0.04443896934390068, 0.004596032667905092, -0.011461316607892513, 0.06428053975105286, -0.020634206011891365, -0.04068032279610634, -0.027614550665020943, 0.012081366032361984, -0.013359817676246166, 0.04615209624171257, 0.005558067467063665, -0.00596077973023057, 0.040245652198791504, -0.012234780006110668, -0.0630020871758461, 0.009486109018325806, 0.02319110929965973, -0.022526314482092857, 0.052211955189704895, 0.0072360350750386715, 0.059626974165439606, 0.0016587907448410988, 0.013129696249961853, 0.007376664783805609, 0.007753807585686445, -0.011007466353476048, -0.024290576577186584, 0.01855033077299595, -0.027052031829953194, -0.01895943470299244, 0.019163986667990685, -0.002737484173849225, -0.00486131152138114, 0.014344224706292152, -0.00291806529276073, -0.016338609158992767, 0.045794129371643066, -0.017118465155363083, -0.03060612641274929, -0.00972262304276228, 0.008680685423314571, -0.023881472647190094, 0.002953222719952464, -0.008437779732048512, 0.017207955941557884, -0.004698309116065502, -0.04259800165891647, -0.023740842938423157, -0.04093601554632187, 0.03835354372859001, 0.0603940449655056, 0.026169899851083755, -0.01715681701898575, -0.007900829426944256, 0.004541698843240738, -0.011339863762259483, 0.03559208661317825, -0.00862315483391285, -0.02214277908205986, -0.05006415769457817, -0.0014838026836514473, -0.03630802035331726, -0.053592681884765625, 0.019509168341755867, 0.021107232198119164, -0.029276536777615547, -0.0022117209155112505, 0.07246262580156326, 0.012611922807991505, -0.017565922811627388, -0.04970619082450867, 0.014216379262506962, 0.01130790263414383, 0.05333699285984039, 0.0016172410687431693, -0.07210466265678406, -0.0010075794998556376, 0.05558706820011139, 0.015251925215125084, 0.011538024060428143, -0.007613178342580795, -0.05681437999010086, 0.03868594020605087, -0.06392256915569305, -0.03385339304804802, -0.013960689306259155, -0.0067182620987296104, -0.07256489992141724, 0.01038102526217699, -0.015251925215125084, -0.01595507375895977, -0.002758258953690529, -0.04679132252931595, -0.010681461542844772, 0.003969591576606035, 0.04068032279610634, 0.003506152890622616, 0.028714017942547798, -0.01123758777976036, -0.006433806847780943, -0.0294555202126503, -0.048632290214300156, -0.03827683627605438, 0.01715681701898575, -0.0006655937759205699, 0.02400931715965271, -0.007721846457570791, -0.058399658650159836, 0.016990618780255318, -0.033239737153053284, -0.0002173367392970249, -0.001997580286115408, 0.02588864043354988, -0.0059128375723958015, -0.00014881973038427532, -0.038379110395908356, 0.004755839239805937, -0.044387832283973694, 0.02361299842596054, 0.019023356959223747, -0.02971121110022068, -0.014216379262506962, 0.045768558979034424, 0.01001027412712574, 0.015290278941392899, -0.01824350096285343, 0.033751118928194046, -0.01265027653425932, 0.016581514850258827, -0.0030011646449565887, 0.027972517535090446, 0.02214277908205986, -0.026898616924881935, -0.004084652289748192, 0.022973772138357162, -0.014996235258877277, -0.020084472373127937, -0.04714928939938545, -0.0012392988428473473, -0.019419677555561066, -0.007076228503137827, -0.04743054881691933, -0.01180649921298027, -0.01008698157966137, 0.002331575844436884, 0.0129059674218297, -0.013960689306259155, 0.02328060008585453, -0.016965050250291824, -0.04819761961698532, -0.030785109847784042, -0.0021845537703484297, -0.03208912909030914, 0.003076273715123534, 0.0025952563155442476, -0.053592681884765625, -0.010553616099059582, -0.039606425911188126, -0.004215693566948175, 0.0255434587597847, 0.04011780396103859, 0.0022900260519236326, 0.036742694675922394, -0.00016080521163530648, 0.02106887847185135, 0.07650253176689148, 0.0385836623609066, -0.012963497079908848, -0.03239595890045166, 0.05635413900017738, 0.0037554509472101927, 0.007926398888230324, -0.0048421346582472324, -0.007555647753179073, 0.03408351540565491, 0.04500148817896843, -0.021848734468221664, 0.05195626616477966, -0.022692512720823288, -0.010227611288428307, 0.028995277360081673, -0.06719540804624557, -0.005340730771422386, 0.00584252318367362, -0.04129398241639137, 0.029404383152723312, -0.03083624877035618, -0.017527569085359573, -0.0040782601572573185, -0.060598596930503845, -0.014523208141326904, -0.03313745930790901, 0.08079812675714493, -0.008488917723298073, 0.005609205458313227, 0.03582220897078514, -0.033086322247982025, -0.020391300320625305, 0.00439467653632164, 0.00400794530287385, -0.043492916971445084, 0.008597585372626781, -0.001232107519172132, -0.010483301244676113, -0.03559208661317825, -0.017233524471521378, -0.01001027412712574, 0.007376664783805609, -0.04093601554632187, 0.001061114715412259, -0.026029270142316818, -0.01701618917286396, -0.03283063322305679, -0.018090087920427322, 0.036026760935783386, 0.011371824890375137, -0.00389608065597713, 0.003675547894090414, 0.030810678377747536, 0.019483599811792374, -0.028535036370158195, 0.06090542674064636, 0.03339315205812454, 0.07742302119731903, -0.03896719962358475, -0.0038896885234862566, -0.0019624228589236736, -0.03303518518805504, 0.01282286737114191, 0.009792937897145748, 0.0027502686716616154, -0.07808781415224075, -0.00830354169011116, -0.033418718725442886, 0.013602723367512226, -0.03753533214330673, 0.03743305802345276, 0.003924845717847347, -0.023152755573391914, 0.010195650160312653, -0.006603201385587454, 0.009594777598977089, -0.024316145107150078, 0.047328270971775055, 0.04574299231171608, 0.005177728366106749, -0.01610848866403103, -0.019023356959223747, 0.006871676538139582, 0.0030331260059028864, 0.05487113445997238, 0.032114699482917786, -0.004698309116065502, 0.00461840583011508, -0.018358562141656876, 0.0001242494909092784, -0.04599868133664131, -0.016492024064064026, 0.013564369641244411, -0.04142182692885399, 0.004790996666997671, -0.00694199139252305, -0.011365433223545551, -0.034799449145793915, 0.010406594723463058, 0.04060361534357071, -0.03216583654284477, -0.0007031482527963817, 0.010598362423479557, 0.030733972787857056, -0.004209301434457302, 0.013001850806176662, -0.022334545850753784, 0.020289024338126183, -0.0009812114294618368, -0.027461135759949684, 0.013896767050027847, 0.026144331321120262, 5.2436484111240134e-05, 0.015903934836387634, -0.034160222858190536, 0.008150127716362476, -0.003873707726597786, -0.02027623914182186, 0.05574048310518265, -0.04745611548423767, -0.00014132881187833846, 0.0028397601563483477, -0.040245652198791504, 0.008009498007595539, -0.023459583520889282, 0.03042714297771454, 0.005737050902098417, -0.040884874761104584, -0.025428399443626404, -0.04241901636123657, -0.011224803514778614, -0.03904390707612038, -0.005465379916131496, 0.006705477833747864, -0.027537843212485313, 0.001460630795918405, 0.03656370937824249, -0.041626378893852234, -0.0014126887544989586, -0.024073239415884018, 0.011825675144791603, 0.019176771864295006, 0.024137163534760475, -0.03889049217104912, 0.004333950113505125, 0.03868594020605087, 0.0685761347413063, -0.03482501581311226, 0.012074973434209824, -0.0727183148264885, -0.037151798605918884, 0.017617059871554375, -0.012119719758629799, 0.011544416658580303, -0.0032856201287359, -0.008840491063892841, 0.03661485016345978, 0.057018931955099106, 0.01580165885388851, 0.028356052935123444, 0.009313518181443214, -0.002908476861193776, -0.029250968247652054, -0.001304819481447339, 0.05308130383491516, 0.012381802313029766, -0.012100542895495892, -0.025684088468551636, 0.042035482823848724, -0.011653084307909012, 0.005091432947665453, -0.01270141452550888, 0.035617657005786896, -0.032012421637773514, 0.017399724572896957, -0.02866288088262081, 0.005529302172362804, -0.012816475704312325, 0.011122527532279491, -0.029890194535255432, 0.008885237388312817, -0.008341895416378975, -0.015980642288923264, -0.0022101227659732103, -0.0036659594625234604, 0.009287949651479721, 0.034620463848114014, 0.048785705119371414, -0.015315847471356392, 0.023139970377087593, -0.022257838398218155, 0.007089013233780861, 0.05308130383491516, -0.00789443776011467, -0.00767070846632123, -0.029097553342580795, -0.014599914662539959, 0.06203046068549156, -0.07200238108634949, -0.030069177970290184, 0.009741799905896187, -0.005666736047714949, 0.03277949243783951, 0.01168504636734724, 0.05218638479709625, 0.052621059119701385, 0.014101319015026093, -0.01669657602906227, -0.008520878851413727, -0.06566126644611359, 0.024801956489682198, 0.003979180008172989, 0.06617264449596405, 0.007734631188213825, 0.009754584170877934, -0.016325823962688446, -0.007555647753179073, 0.03781659156084061, -0.0262849610298872, 0.024367284029722214, -0.010770953260362148, -0.040884874761104584, -0.019406892359256744, 0.021388491615653038, 0.013104126788675785, 0.03451818972826004, 0.028995277360081673, -0.03825126588344574, -0.09307125955820084, 0.01954752206802368, -0.0020391300786286592, 0.0058648958802223206, 0.0512659028172493, 0.0277679655700922, -0.05195626616477966, 0.035515379160642624, -0.04216332733631134, -0.05446203052997589, -0.03694724664092064, 0.04226560518145561, 0.007574824616312981, -0.011422963812947273, 0.015239140950143337, 0.013500446453690529, 0.022743649780750275, 0.007357487920671701, -0.0014246742939576507, 0.018844373524188995, -0.02743556722998619, -0.008418602868914604, 0.055229101330041885, -0.03346985951066017, -0.003928042016923428, -0.04965505376458168, 0.004314773716032505, 0.016722144559025764, 0.01635139435529709, 0.023178324103355408, -0.0021493963431566954, -0.023715274408459663, -0.01610848866403103, 0.02825377695262432, -0.014919527806341648, 0.05972924828529358, 0.002980389865115285, 0.08719038963317871, -0.000738305679988116, 0.0439787283539772, 0.0032552569173276424, -0.012349840253591537, 0.01485560555011034, -0.014024611562490463, 0.030503850430250168, 0.06417825818061829, 0.012765337713062763, -0.009869645349681377, -0.020941033959388733, 0.03272835537791252, 0.006510513834655285, 0.06642833352088928, 0.017450861632823944, -0.01961144432425499, -0.038379110395908356, 0.017080111429095268, 0.010540831834077835, -0.03474830836057663, -0.04574299231171608, 0.032012421637773514, -0.013052988797426224, 0.03518298268318176, 0.003451818833127618, -0.05972924828529358, 0.044413402676582336, -0.005075451917946339, -0.04886241257190704, -0.03214026987552643, 0.03638472780585289, -0.012765337713062763, 0.017118465155363083, 0.024482345208525658, -0.014651053585112095, 0.03362327069044113, -0.02766568772494793, 0.04743054881691933, 0.03139876574277878, 0.012119719758629799, -0.00891719851642847, -0.011148096062242985, -0.026233822107315063, -0.0012017443077638745, 0.05101021006703377, -0.00720407348126173, 0.022654158994555473, 0.012023835442960262, 0.0053918687626719475, 0.022999340668320656, 0.04234230890870094, -0.04842773824930191, 0.03589891642332077, 0.009498894214630127, 0.01289957482367754, -0.019598660990595818, -0.018780451267957687, 0.01880601979792118, 0.03500400111079216, 0.003675547894090414, 0.010937151499092579, 0.01710567995905876, -0.023983748629689217, -0.04272584617137909, 0.043902020901441574, 0.006769400089979172, -0.012605531141161919, -0.02889300137758255, -0.043671898543834686, -0.018767666071653366, 0.002881309948861599, 0.017028972506523132, 0.010611146688461304, 0.018997788429260254, -0.0397087000310421, -0.028867432847619057, 0.004973175935447216, -0.00461840583011508, -0.00935826450586319, 0.0015157639281824231, 0.0017354978481307626, 0.02106887847185135, 0.0243289303034544, -0.014101319015026093, -0.0023970964830368757, -0.01718238741159439, 0.05216081812977791, -0.00988882128149271, 0.025748010724782944, -0.014318656176328659, -0.0029388400726020336, 0.05691665783524513, -0.03807228431105614, 0.008648723363876343, -0.01953473687171936, -0.006788576953113079, 0.02360021322965622, -0.02247517555952072, -0.01558432262390852, 8.624552719993517e-05, -0.010975505225360394, 0.0072232503443956375, -4.8016838263720274e-05, 0.0037234898190945387, 0.0017802435904741287, -0.020864326506853104, 0.02368970401585102, 0.024149946868419647, -0.01936853863298893, -0.001081889495253563, 0.03068283386528492, -0.00018437666585668921, 0.003258452983573079, -0.0499618798494339, -0.04167751595377922, -0.001348766265437007, 0.003496564691886306, 0.049194809049367905, -0.026924187317490578, -0.01294432021677494, 0.006731046829372644, -0.0047366623766720295, -0.010681461542844772, 0.00879574567079544, 0.023421229794621468, -0.01791110448539257, -0.0073447031900286674, -0.010131727904081345, -0.0121644651517272, -0.014535992406308651, -0.017438076436519623, 0.017808828502893448, -0.016057349741458893, -0.004461795557290316, -0.0037202935200184584, -0.02978791855275631, 0.02751227468252182, 0.0023939001839607954, 0.0060918210074305534, -0.032268114387989044, 0.016645437106490135, 0.019176771864295006, -0.017872750759124756, -0.007261604070663452, 0.0010643107816576958, -0.017604276537895203, 0.02050636149942875, 0.009741799905896187, 0.007900829426944256, -0.06954775750637054, -0.025198277086019516, -0.010521654970943928, -0.038302402943372726, -0.02060863748192787, -0.023791979998350143, -0.033239737153053284, -0.010003882460296154, -0.029353244230151176, -0.010675068944692612, 0.06607037037611008, -0.016734929755330086, -0.023421229794621468, 0.0017514784121885896, 0.022666944190859795, 0.003047508653253317, -0.002119033131748438, -0.020723696798086166, -0.006590417120605707, 0.011493277736008167, 0.002751866588369012, 0.02684747986495495, -0.010272356681525707, -0.006411433685570955, 0.02017396315932274, 0.009332695044577122, -0.013641076162457466, -0.010937151499092579, 0.03231925144791603, 0.015009019523859024, -0.0019224713323637843, -0.0408337377011776, 0.01411410328000784, 0.020889896899461746, 0.017872750759124756, 0.023421229794621468, 0.007996713742613792, 0.014152457006275654, -0.005273612216114998, 0.032600510865449905, 0.03963199257850647, -0.0008701459737494588, -0.011039427481591702, -0.028586173430085182, 0.019266262650489807, 0.052058540284633636, 0.014574346132576466, 0.0013000252656638622, 0.014280302450060844, -0.0072999573312699795, -0.005510125774890184, 0.04551286995410919, -0.04533388838171959, 0.0037650393787771463, -0.010272356681525707, -0.010406594723463058, 0.012362625449895859, 0.007581216748803854, 0.011295118369162083, -0.007242427207529545, 0.03380225598812103, -0.007664316333830357, -0.0499618798494339, -0.008968336507678032, 0.014587130397558212, 0.004359519109129906, 0.0010507272090762854, 0.023702489212155342, 0.016786066815257072, -0.05732576176524162, -0.03648700192570686, 0.061007700860500336, -0.014714975841343403, -0.007351095788180828, -0.05492227151989937, 0.0046727401204407215, 0.03973427042365074, -0.02822820656001568, 0.0029164673760533333, 0.0005089834448881447, -0.02556902915239334, 0.004925234243273735, -0.006865283939987421, -0.04259800165891647, -0.04177979379892349, 0.0038001968059688807, 0.02035294659435749, 0.010540831834077835, -0.01725909486413002, 0.01338538620620966, -0.004068671725690365, -0.03270278871059418, -0.0028221814427524805, -0.009422186762094498, -0.00019845960196107626, 0.009371048770844936, -0.03963199257850647, -0.008834099397063255, -0.0004206904268357903, 0.01748921535909176, 0.009882429614663124, -0.04950163885951042, -0.04451567679643631, 0.009434971027076244, -0.01840970106422901, 0.0012744562700390816, -0.025453967973589897, -0.0017914300551638007, -0.01155720092356205, 0.03548981249332428, 0.03109193779528141, -0.007964752614498138, -0.026387237012386322, 0.024891449138522148, 0.0021462002769112587, 0.014190810732543468, -0.00525123905390501, -0.05203297361731529, -0.017297446727752686, 0.062132738530635834, -0.02822820656001568, -0.021874302998185158, -0.01718238741159439, 0.013231972232460976, 0.013986258767545223, -0.02417551539838314, -0.017757689580321312, -0.02530055306851864, -0.0516238696873188, 0.0040814559906721115, -0.0035221336875110865, 0.009639523923397064, -0.003841746598482132, 0.0066735162399709225, -0.009882429614663124, 0.004906057380139828, 0.018371347337961197, 0.005545283202081919, 0.007881652563810349, 0.05845079943537712, -0.04702144116163254, 0.0073255267925560474, -0.038046713918447495, 0.009204850532114506, -0.0020311397965997458, 0.001920873299241066, -0.027384430170059204, 0.008233226835727692, -0.022014932706952095, -0.009128143079578876, -0.07215579599142075, 0.03045271337032318, 0.006660731974989176, -0.01872931234538555, 0.024686897173523903, 0.003790608374401927, -0.047507256269454956, -0.00033719156635925174, 0.03395567089319229, -0.011876814067363739, -0.005053079221397638, -0.0018569506937637925, -0.014676622115075588, -0.029481088742613792, -0.017617059871554375, 0.008603977970778942, 0.006980344653129578, -0.013008243404328823, 0.01221560314297676, 0.0439787283539772, 0.03042714297771454, 0.0038481387309730053, 0.007025090511888266, 0.013155264779925346, 0.004180536139756441, 0.009805722162127495, -0.002524941461160779, -0.0005745040834881365, -0.03477387875318527, -0.019240694120526314, -0.046024251729249954, -0.042444586753845215, -0.010841268114745617, -0.021925441920757294, 0.00867429282516241, 0.033904530107975006, 0.05932014435529709, 0.010802914388477802, 0.005545283202081919, -0.11004909873008728, -0.022577451542019844, 0.022193916141986847, -0.03469717130064964, -0.027461135759949684, 0.018102871254086494, -0.024533482268452644, 0.0026208253111690283, -0.0047206818126142025, -0.01278451457619667, 0.006967560388147831, -0.02212999388575554, -0.024073239415884018, -0.02060863748192787, 0.055382516235113144, -0.012055796571075916, -0.003141794353723526, -0.011020251549780369, 0.017859965562820435, -0.006142958998680115, -0.006820538081228733, -0.010310710407793522, -0.052876751869916916, -0.012688630260527134, -0.04891354963183403, -0.0038225697353482246, -0.010112551040947437, 0.01131429523229599, 0.02604205533862114, 0.00020874715119134635, -0.046356648206710815, -0.0309385247528553, -0.008891629986464977, 0.006500925403088331, -0.061416804790496826, 0.04916924238204956, 0.025121569633483887, 0.02205328643321991, 0.0005916833179071546, -0.019074495881795883, -0.0064913369715213776, 0.01277812197804451, 0.010150903835892677, 0.019662583246827126, 0.02636166848242283, 0.015072941780090332, 0.001109855598770082, -0.02491701766848564, -0.03157775104045868, -0.022078854963183403, 0.011864028871059418, 0.012829259969294071, -0.0080158906057477, 0.04298153519630432, 0.036103468388319016, 0.03042714297771454, -0.041370686143636703, -0.0035572911147028208, -0.011832067742943764, 0.04934822395443916, 0.0010778943542391062, 0.015430908650159836, 0.01580165885388851, -0.014599914662539959, -0.03753533214330673, 0.014152457006275654, -0.0168627742677927, -0.0041102212853729725, -0.016722144559025764, -0.015814444050192833, -0.011256764642894268, 0.014830036088824272, 0.01033627986907959, -0.012618315406143665, 0.0037266858853399754, -0.0059416028670966625, 0.023740842938423157, -0.00608542887493968, -0.01142935547977686, 0.003758647246286273, 0.07384335249662399, 0.008974729105830193, 0.014753329567611217, 0.03239595890045166, -0.04275141656398773, 0.03221697732806206, -0.020736481994390488, 0.008834099397063255, 0.01485560555011034, 0.004548090975731611, 0.017310231924057007, 0.021375708281993866, 0.003857727162539959, -0.006385864689946175, -0.030171453952789307, 0.01545647718012333, -0.05594503507018089, -0.01148049347102642, 0.015392554923892021, -0.006181312724947929, 0.013321463949978352, 0.042930398136377335, -0.03004360757768154, 0.006513710133731365, -0.034236930310726166, 0.014957881532609463, 0.0012992261908948421, -0.013423739932477474, -0.0007962355157360435, -0.009748191572725773, 0.04387645423412323, -0.003413465339690447, -0.027205446735024452, 0.02223226986825466, -0.03981097787618637, -0.02482752688229084, 0.0764513909816742, -7.7655931818299e-05, -0.02337009273469448, 0.016568729653954506, 0.022257838398218155, 0.027333291247487068, 0.008463348262012005, -0.0053886729292571545, 0.005219277925789356, 0.0449247844517231, -0.01944524608552456, 0.0008997101685963571, -0.01596785895526409, 0.019266262650489807, -0.004925234243273735, 0.042367879301309586, 0.006267608143389225, 0.027563411742448807, -0.010432163253426552, -0.03321416676044464, 0.018690960481762886, 0.007357487920671701, 0.0017946261214092374, -0.0036339981015771627, -0.0071145822294056416, -0.005816953722387552, 0.015047373250126839, 0.01580165885388851, -0.022820357233285904, 0.006948383525013924, 0.029199829325079918, -0.0016412120312452316, -0.012925143353641033, 0.010719815269112587, 0.0067502232268452644, 0.0005573249072767794, -0.008904414251446724, 0.009882429614663124, -0.026924187317490578, 0.050166431814432144, -0.015251925215125084, -0.040910445153713226, -0.012496862560510635, -0.03781659156084061, -0.029890194535255432, 0.04037349671125412, -0.01351323164999485, -0.034134652465581894, 0.022398468106985092, -0.01477889809757471, -0.007734631188213825, -0.0026416003238409758, 0.026182685047388077, 0.012637492269277573, -0.00025608978467062116, 0.01008698157966137, 0.03929959610104561, -0.0034390343353152275, 0.03955528512597084, 0.07184896618127823, 0.009332695044577122, -0.0020391300786286592, -0.012477685697376728, 0.009933567605912685, 0.019675366580486298, 0.04257243126630783, 0.047404978424310684, 0.009025867097079754, 0.03929959610104561, -0.01143574807792902, 0.005679520312696695, 0.03909504413604736, 0.009780153632164001, 0.033751118928194046, 0.0424957238137722, 0.0009644317906349897, -0.012573570013046265, 0.014714975841343403, -0.04671461507678032, 0.012426547706127167, 0.03766318038105965, 0.015251925215125084, -0.0015685000689700246, -0.015993427485227585, -0.006788576953113079, 0.03628244996070862, 0.00696116778999567, -0.017310231924057007, -0.02986462414264679, 0.07471270114183426, -0.00291966344229877, -0.03937630355358124, -0.010777345858514309, 0.034646034240722656, -0.01098828949034214, 0.005644362885504961, 0.035438671708106995, 0.011736184358596802, -0.011582769453525543, -0.021593043580651283, -0.049757327884435654, 0.002098258351907134, -0.027537843212485313, -0.010067804716527462, -0.03459489345550537, 0.018601467832922935, -0.0047814082354307175, 0.020685343071818352, -0.004209301434457302, 0.022257838398218155, 0.011959913186728954, 0.008974729105830193, 0.03508070856332779, 0.01306577306240797, -0.027793534100055695, 0.01645367033779621, -0.03247266635298729, 0.010636716149747372, 0.018703743815422058, -0.01167226117104292, 0.012567177414894104, -0.02287149615585804, -0.016095703467726707, 0.014881174080073833, -0.012803690508008003, 0.027563411742448807, -0.012490469962358475, -0.017962241545319557, 0.01546926237642765, 0.024316145107150078, 0.042776983231306076, 0.03681940212845802, -0.00903225876390934, -0.004135790280997753, 0.02735885977745056, 0.013704999350011349, 0.028356052935123444, -0.010368240997195244, 0.01619797945022583, 0.019815996289253235, 0.014203594997525215, 0.04022008180618286, -0.0031481864862143993, 0.001964021008461714, -0.0029708014335483313, 0.03012031503021717, 0.0029436342883855104, 0.007172112353146076, -0.0024801958352327347, -0.042521294206380844, 0.005800973158329725, 0.014625484123826027, 0.049297086894512177, -0.019956625998020172, -0.018038948997855186, 0.03239595890045166, 0.012330664321780205, 0.004953999072313309, 0.006743831094354391, -0.0046152095310389996, -0.041882067918777466, 0.018281854689121246, -0.028023654595017433, -0.0219893641769886, -0.01098828949034214, 0.00874460767954588, 0.024929802864789963, -0.005727462470531464, 0.029123123735189438, -0.00232038926333189, -0.03147547319531441, 0.0029883801471441984, 0.015673814341425896, 0.03784216195344925, -0.005276808049529791, 0.029276536777615547, 0.0017610668437555432, -0.029250968247652054, 0.002935644006356597, -0.0013751343358308077, -0.012714199721813202, 0.004164555575698614, -0.006484944839030504, -0.030631694942712784, 0.01594228856265545, -0.005621990188956261, -0.01628747023642063, 0.012688630260527134, -0.004193320404738188, 0.0060183098539710045, -0.01862703636288643, -0.04668904468417168, 0.02937881276011467, 0.0046759359538555145, -0.03548981249332428, 0.01594228856265545, 0.02051914483308792, -0.017540354281663895, 0.026182685047388077, 0.009690661914646626, -0.022769220173358917, 0.017386939376592636, -0.022270623594522476, -0.010195650160312653, 0.004701504949480295, 0.010815698653459549, 0.013244756497442722, 0.005919230170547962, 0.021554691717028618, -0.020979387685656548, -0.01872931234538555, -0.008687077090144157, -0.006005525588989258, -0.016057349741458893, 0.05614958703517914, -0.005650755017995834, 0.03155218064785004, -0.009984705597162247, -0.040884874761104584, -0.024955371394753456, -0.06504760682582855, -0.003697920823469758, 0.01838413067162037, -0.008712646551430225, -0.0382256954908371, -0.0035540948156267405, -0.013193618506193161, -0.0017338996985927224, -0.013462093658745289, -0.002122229430824518, -0.02035294659435749, -0.017374154180288315, -0.006497729104012251, 0.003963199444115162, 0.06995686143636703, -0.003934434149414301, -0.00461840583011508, -0.023753628134727478, -0.004960391670465469, 0.009077005088329315, 0.009876037016510963, 0.002825377508997917, -0.016249118372797966, -0.021529121324419975, -0.03160331770777702, -0.009217634797096252, -0.010962720960378647, -0.012835652567446232, 0.034876152873039246, -0.0172463096678257, -0.0012297104112803936, -0.0099719213321805, 0.004362715408205986, 0.0006588019896298647, 0.024968156591057777, 0.024380069226026535, -0.011876814067363739, -0.03761203959584236, 0.015482046641409397, -0.004928430076688528, 0.017386939376592636, -0.034799449145793915, 0.014267518185079098, 0.05507568642497063, -0.018588682636618614, -0.012369017116725445, -0.015558754093945026, 0.005538890603929758, -0.010675068944692612, -0.008098989725112915, 0.02212999388575554, 0.025249416008591652, -0.0002586866612546146, 0.011717007495462894, -0.033418718725442886, -0.014689406380057335, -0.02994133159518242, -0.003247266635298729, -0.016965050250291824, 0.0004378696030471474, -0.011614731512963772, -0.017450861632823944, 0.005340730771422386, 0.025863071903586388, -0.012720591388642788, -0.01962422952055931, 0.014344224706292152, -0.015085726976394653, -0.016415316611528397, -0.041140567511320114, 0.001693948172032833, 0.03773988410830498, 0.009665092453360558, 0.02065977454185486, -0.008482525125145912, 0.020953819155693054, -0.0011897588847205043, 0.008469740860164165, -0.010470516979694366, -0.02758898213505745, 0.014766113832592964, -0.010790130123496056, -0.006910029798746109, 0.04096158221364021, -0.03262608125805855, 0.006807753816246986, 0.015482046641409397, -0.013334248214960098, 0.027077600359916687, 0.0025569028221070766, -0.011461316607892513, -0.03607789799571037, 0.009863252751529217, 0.024559050798416138, 0.0309385247528553, -0.02443120628595352, -0.004317969549447298, 0.007255211938172579, -0.009658700786530972, -0.006478552706539631, -0.015085726976394653, 0.0021941422019153833, -0.04126841202378273, 0.007293565198779106, 0.032012421637773514, 0.012624708004295826, -0.02026345580816269, -0.0008597585838288069, 0.025773581117391586, 0.02490423433482647, 0.0013815265847370028, 0.010349064134061337, -0.024789173156023026, 0.018754882737994194, -0.0012105336645618081, -0.0016108488198369741, -0.0324215292930603, 0.04339063912630081, 0.002895692363381386, 0.057581450790166855, -0.013091342523694038, -0.013666645623743534, -0.009083397686481476, 0.018524760380387306, -0.014050181023776531, -0.021874302998185158, 0.020634206011891365, 0.01594228856265545, 0.006302765570580959, 0.0013583545805886388, -0.024699680507183075, 0.04418328031897545, 0.002202132483944297, -0.018102871254086494, 0.0040175337344408035, 0.014842821285128593, -0.034671600908041, 0.015622676350176334, -0.005056275520473719, 0.024060456082224846, 0.009000297635793686, -0.03311189264059067, -0.01765541359782219, -0.012688630260527134, -0.010898798704147339, 0.04377417638897896, 0.007331918925046921, -0.01783439703285694, -0.011301510035991669, -0.022603020071983337, 0.00498596066609025, -0.04175422340631485, 0.010195650160312653, -0.015545968897640705, 0.002253270708024502, 0.033163029700517654, 0.0036787439603358507, -0.048964690417051315, -0.022833142429590225, 0.000632433919236064, 0.018601467832922935, 0.002181357704102993, -0.002585667883977294, 0.03165445849299431, 0.023702489212155342, 0.0021909461356699467, 0.018857158720493317, -0.04259800165891647, 0.011448532342910767, -0.019304616376757622, -0.003975983709096909, -0.05696779489517212, -0.03768874704837799, -0.013295894488692284, -0.002160582924261689, -0.018371347337961197, 0.001293633016757667, 0.029992470517754555, 0.03249823674559593, 0.033904530107975006, 0.021925441920757294, 0.028279345482587814, -0.005820150021463633, -0.02221948467195034, 0.0012169259134680033, -0.015111295506358147, 0.008035067468881607, -0.010285141877830029, 0.021951010450720787, -0.01872931234538555, 0.01936853863298893, -0.012343448586761951, 0.005417437758296728, -0.012094150297343731, 0.025671305134892464, -0.0017962242709472775, 0.007338311057537794, 0.008156520314514637, -0.010125335305929184, 0.015366986393928528, 0.025581812486052513, 0.0007011506822891533, -0.011589162051677704, 0.01759149134159088, 0.009230419062077999, 0.007868868298828602, 0.015111295506358147, 0.0064913369715213776, -0.01050247810781002, 0.006516905967146158, -0.0009852065704762936, -0.010144512169063091, -0.007971144281327724, -0.007152935490012169, -0.033495426177978516, 0.01945803128182888, 0.0013184030540287495, -0.01945803128182888, -0.018051734194159508, 0.015622676350176334, 0.007581216748803854, 0.00522886635735631, 0.018026165664196014, -0.0023986943997442722, 0.009185673668980598, -0.0018681371584534645, -0.0018090087687596679, -0.011263157241046429, 0.039683133363723755, 0.010815698653459549, 0.04515490308403969, 0.0007199279498308897, -8.719438483240083e-05, -0.046024251729249954, -0.02784467115998268, 0.008348288014531136, 0.04410657286643982, -0.012036619707942009, -0.007076228503137827, -0.0005069858743809164, 0.06121225282549858, -0.01233705598860979, 0.02326781488955021, 0.03254937380552292, 0.0065712402574718, -0.005439810920506716, -0.013743353076279163, -0.011378217488527298, -0.01362829189747572, -0.016300255432724953, -0.0018825196893885732, 0.003502956824377179, 0.007958360016345978, 0.012202818877995014, -0.011013858951628208, 0.041626378893852234, -0.01691391132771969, 0.013347032479941845, -0.026144331321120262, -6.23245068709366e-05, 0.02296098694205284, 0.012023835442960262, -0.000577300728764385, 0.016786066815257072, 0.007824122905731201, 0.01701618917286396, -0.01773212105035782, -0.03367441147565842, -0.008533663116395473, -0.03993882238864899, 0.010790130123496056, 0.018422484397888184, -0.026873048394918442, 0.0038257658015936613, 0.017629845067858696, -0.009287949651479721, 0.01627468690276146, -0.0004366710491012782, 0.040092237293720245, -0.003442230401560664, -0.023561859503388405, -0.02416273206472397, -0.038404680788517, 0.00730634992942214, 0.03661485016345978, 0.0007179303793236613, -0.016901127994060516, -0.0005397461936809123, 0.00903225876390934, 0.010886013507843018, 0.003301600692793727, 0.002453028690069914, 0.023165538907051086, -0.029174260795116425, -0.005091432947665453, -0.022743649780750275, -0.029404383152723312, -0.03012031503021717, -0.02840718999505043, 0.022283408790826797, 0.004586444236338139, 0.016568729653954506, 0.003624409670010209, 0.018115656450390816, 0.009390225633978844, -0.022487960755825043, 0.002237289911136031, -0.005682716611772776, 0.026515081524848938, 0.01265027653425932, -0.0023731254041194916, -0.006337922997772694, -0.02065977454185486, -0.007907222025096416, -0.005040294490754604, -0.008603977970778942, 0.00451932568103075, -0.004915645811706781, 0.007613178342580795, 0.014305870980024338, 0.018933866173028946, 0.034952860325574875, -0.08176974952220917, 0.029276536777615547, 0.006660731974989176, 0.01204301230609417, 0.019637012854218483, 0.008846883662045002, -0.01968815177679062, 0.026336099952459335, -0.030145883560180664, 0.02400931715965271, 0.009952744469046593, 0.0173358004540205, 0.0017690571257844567, 0.014689406380057335, 0.000566114264074713, 0.005666736047714949, 0.0036787439603358507, -0.014037396758794785, -0.012477685697376728, 0.019943842664361, 0.013832843862473965, 0.009869645349681377, 0.004241262562572956, 0.0014973862562328577, 0.013960689306259155, 0.004787800367921591, 0.012253956869244576, 0.00017908307199832052, -0.018511977046728134, 0.010361848399043083, 0.012957105413079262, -0.00033439495018683374, -0.029736779630184174, -0.012445724569261074, -0.032037992030382156, 0.01806451752781868, -0.02475081942975521, 0.03623131290078163, -0.003966395277529955, -0.03653814271092415, 0.0023012126330286264, -0.007856084033846855, -0.01693948172032833, -0.022104425355792046, 0.038609232753515244, -0.05349040776491165, -0.02996690198779106, -0.016786066815257072, -0.007331918925046921, 0.038455817848443985, 0.01855033077299595, -0.006232450716197491, 0.016376962885260582, 0.0022564667742699385, 0.012509646825492382, -0.0006983540952205658, -0.0060918210074305534, 0.007229642942547798, -0.01107138954102993, -0.04709814861416817, -0.009735407307744026, -0.005206493195146322, -0.021759243682026863, 0.03239595890045166, 0.03868594020605087, -0.010317103005945683, -0.006584024988114834, -0.016479238867759705, -0.0001806811342248693, 0.007229642942547798, 0.006200489122420549, -0.025658519938588142, 0.01952195353806019, -0.01580165885388851, 0.02669406495988369, 0.008393033407628536, -0.020084472373127937, -0.00449375668540597, -0.006667124107480049, -0.021350137889385223, 0.01278451457619667]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:35:03.658964", "url_path": "/testing-evals/", "chunk_size": 3122}
updated_dt: 2025-03-16T00:35:03.660503
---
```
importre
importpytest
frompydantic_aiimport models
frompydantic_ai.messagesimport (
  ModelMessage,
  ModelResponse,
  TextPart,
  ToolCallPart,
)
frompydantic_ai.models.functionimport AgentInfo, FunctionModel
fromfake_databaseimport DatabaseConn
fromweather_appimport run_weather_forecast, weather_agent
pytestmark = pytest.mark.anyio
models.ALLOW_MODEL_REQUESTS = False

defcall_weather_forecast( 
We define a function call_weather_forecast that will be called by FunctionModel in place of the LLM, this function has access to the list of ModelMessage[](https://ai.pydantic.dev/api/messages/#pydantic_ai.messages.ModelMessage)s that make up the run, and AgentInfo[](https://ai.pydantic.dev/api/models/function/#pydantic_ai.models.function.AgentInfo) which contains information about the agent and the function tools and return tools.
[](https://ai.pydantic.dev/testing-evals/#__code_2_annotation_1)
  messages: list[ModelMessage], info: AgentInfo
) -> ModelResponse:
  if len(messages) == 1:
    # first call, call the weather forecast tool
    user_prompt = messages[0].parts[-1]
    m = re.search(r'\d{4}-\d{2}-\d{2}', user_prompt.content)
    assert m is not None
    args = {'location': 'London', 'forecast_date': m.group()} 
Our function is slightly intelligent in that it tries to extract a date from the prompt, but just hard codes the location.
[](https://ai.pydantic.dev/testing-evals/#__code_2_annotation_2)
    return ModelResponse(parts=[ToolCallPart('weather_forecast', args)])
  else:
    # second call, return the forecast
    msg = messages[-1].parts[0]
    assert msg.part_kind == 'tool-return'
    return ModelResponse(parts=[TextPart(f'The forecast is: {msg.content}')])

async deftest_forecast_future():
  conn = DatabaseConn()
  user_id = 1
  with weather_agent.override(model=FunctionModel(call_weather_forecast)): 
We use FunctionModel[](https://ai.pydantic.dev/api/models/function/#pydantic_ai.models.function.FunctionModel) to replace the agent's model with our custom function.
[](https://ai.pydantic.dev/testing-evals/#__code_2_annotation_3)
    prompt = 'What will the weather be like in London on 2032-01-01?'
    await run_weather_forecast([(prompt, user_id)], conn)
  forecast = await conn.get_forecast(user_id)
  assert forecast == 'The forecast is: Rainy with a chance of sun'

```

### Overriding model via pytest fixtures
If you're writing lots of tests that all require model to be overridden, you can use [pytest fixtures](https://docs.pytest.org/en/6.2.x/fixture.html) to override the model with [`TestModel`](https://ai.pydantic.dev/api/models/test/#pydantic_ai.models.test.TestModel) or [`FunctionModel`](https://ai.pydantic.dev/api/models/function/#pydantic_ai.models.function.FunctionModel) in a reusable way.
Here's an example of a fixture that overrides the model with `TestModel`:
tests.py```
importpytest
fromweather_appimport weather_agent
frompydantic_ai.models.testimport TestModel

@pytest.fixture
defoverride_weather_agent():
  with weather_agent.override(model=TestModel()):
    yield

async deftest_forecast(override_weather_agent: None):
  ...
  # test code here