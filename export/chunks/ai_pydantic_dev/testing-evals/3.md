---
url: https://ai.pydantic.dev/testing-evals/
session_id: pydantic_ai_docs
chunk_number: 3
title: Testing Evaluations with Pydantic AI
summary: This document discusses the setup for testing models using Pydantic AI with pytest and anyio. It includes importing necessary libraries, disabling real model requests for safety, and begins defining an asynchronous test function for running a weather forecast.
embedding: [-0.029706234112381935, -0.02165181003510952, 0.017427995800971985, -0.07630772888660431, 0.0033739786595106125, -0.0016822328325361013, 0.015246325172483921, -0.009297467768192291, 0.021474232897162437, 0.02573610097169876, 0.028184138238430023, -0.028767608106136322, -0.006595748011022806, -0.0448257178068161, -0.039041753858327866, 0.0010400987230241299, 0.0008157481206580997, 0.04020869359374046, -0.0404370091855526, 0.0398535393178463, 0.015360482037067413, -0.01634984463453293, 0.011384007520973682, -0.04865632578730583, -0.013559335842728615, -0.01850614696741104, -0.025913678109645844, 0.06423243880271912, 0.0028349030762910843, -0.015043378807604313, 0.0508633628487587, -0.022311385720968246, -0.034754518419504166, -0.033029474318027496, 0.024949684739112854, -0.007185559719800949, 0.026712778955698013, 0.020611712709069252, -0.015918584540486336, 0.013863754458725452, -0.023009013384580612, -0.06920461356639862, 0.013331021182239056, 0.003301044926047325, -0.033790525048971176, 0.022095754742622375, 0.01101616770029068, 0.055860910564661026, 0.02770214155316353, -0.0032661636359989643, 0.006684536579996347, 0.014700907282531261, -0.009684333577752113, -0.03467841446399689, 0.013736912980675697, -0.0162737388163805, -0.03805239126086235, 0.03031507134437561, 0.01429501548409462, 0.022336753085255623, -0.0007880015764385462, -0.0055207679979503155, -0.03528724983334541, 0.04175615683197975, -0.012265553697943687, -0.021537654101848602, 0.009373572655022144, -0.000539471919182688, -0.03736744821071625, 0.0008323960355482996, 0.0055207679979503155, 0.016869893297553062, 0.012151396833360195, -0.03409494087100029, -0.026078572496771812, -0.04873242974281311, 0.04335435852408409, 0.04114731773734093, 0.006009106989949942, -0.03178643062710762, -0.007629504427313805, 0.015246325172483921, -0.023173905909061432, 0.025850258767604828, -0.008568130433559418, -0.034754518419504166, -0.07092965394258499, 0.0018613961292430758, -0.03919396176934242, -0.05099020525813103, 0.005263914354145527, 0.03888954222202301, 0.0007729391800239682, 0.019990189000964165, 0.07854013890028, 0.01553806010633707, -0.03536335751414299, -0.058549948036670685, 0.0288437120616436, -0.025406314060091972, 0.05332408472895622, -0.008511051535606384, -0.06377580761909485, 0.014764327555894852, 0.05251229926943779, 0.03262358531355858, 0.02787971869111061, -0.010927378199994564, -0.046779073774814606, 0.036479558795690536, -0.0648920089006424, -0.002543168142437935, -0.04203520715236664, -0.0011130324564874172, -0.0649934858083725, 0.026814252138137817, -0.015994688495993614, -0.04792064428329468, 0.020408766344189644, -0.03927006945014, 0.002733430126681924, -0.009202336892485619, 0.022222597151994705, 0.0037196213379502296, 0.013128074817359447, -0.02136007510125637, -0.01631179265677929, -0.05246156454086304, -0.03351147100329399, -0.007813424803316593, 0.00813686940819025, -0.0060439882799983025, 0.009716044180095196, 0.010439039207994938, -0.03551556542515755, 0.011523532681167126, -0.043912459164857864, 0.0019438429735600948, -0.01845541037619114, 0.043912459164857864, 0.0022292358335107565, 0.008371526375412941, -0.027473825961351395, 0.02838708460330963, -0.026966461911797523, -0.00025943011860363185, -0.019229141995310783, -0.016679631546139717, -0.014003279618918896, 0.044419825077056885, 0.03158348426222801, 0.02005361020565033, -0.031101487576961517, 0.025761468335986137, -0.01106056198477745, 0.0030219941399991512, 0.002727088052779436, 0.029909180477261543, 0.015918584540486336, -0.035972192883491516, -0.0030711451545357704, 0.014637487009167671, -0.02477210760116577, -0.020662449300289154, -0.035211145877838135, -0.00601227767765522, -0.011764531023800373, -0.009126232005655766, -0.04617023468017578, -0.03163422271609306, -0.008694970980286598, -0.0010496118338778615, 0.015068747103214264, 0.002137275878340006, 0.01585516333580017, -0.00021721574012190104, -0.009614570997655392, -0.053628504276275635, -0.016299108043313026, -0.029959917068481445, -0.021981598809361458, -0.0035927798599004745, -0.040132589638233185, -0.014269647188484669, -0.028158769011497498, -0.022260649129748344, 0.04010722041130066, 0.04350656643509865, 0.006357920356094837, 0.029249604791402817, -0.016070792451500893, 0.01891203783452511, 0.05591164529323578, 0.02223527990281582, -0.02030729316174984, -0.04708349332213402, 0.06747957319021225, 0.025748785585165024, 0.022603120654821396, 0.03919396176934242, 0.013394441455602646, 0.03531261906027794, 0.041096583008766174, -0.028691502287983894, 0.049721792340278625, -0.011834293603897095, -0.004715325310826302, 0.02299632877111435, -0.08366452157497406, 0.0067352731712162495, 0.024645265191793442, -0.025799522176384926, 0.026966461911797523, -0.040081851184368134, -0.015487323515117168, -0.0017948044696822762, -0.06910314410924911, -0.025292156264185905, -0.01669231615960598, 0.07163996994495392, 0.007585110142827034, 0.02354174666106701, 0.03734207898378372, -0.02749919518828392, -0.03221769258379936, 0.006085211411118507, 0.023655902594327927, -0.0478445403277874, 0.0012374954530969262, 0.00922770518809557, -0.0058822655119001865, -0.028894448652863503, -0.018315885215997696, -0.003792555071413517, 0.007312401197850704, -0.04439445585012436, -0.0007658043759875, -0.0318625345826149, -0.020751237869262695, -0.012100660242140293, 0.003691081888973713, 0.03077170066535473, -0.008358841761946678, -0.00783879216760397, 0.014054016210138798, 0.020865393802523613, 0.010096567682921886, -0.042821623384952545, 0.06641411036252975, 0.03051801770925522, 0.0823453739285469, -0.06286255270242691, 0.001445990870706737, -0.018353937193751335, -0.03805239126086235, 0.006697220727801323, 0.0052258619107306, -0.003776699770241976, -0.048377275466918945, -0.01589321531355381, -0.010870300233364105, 0.0010155232157558203, -0.04974715784192085, 0.016337160021066666, 0.0017837058985605836, -0.042872361838817596, 0.008733023889362812, -0.03325778990983963, -0.00030025714659132063, -0.020751237869262695, 0.04165468364953995, 0.07965634018182755, 0.02930034138262272, -0.022907540202140808, -0.023389536887407303, -0.008517393842339516, -0.020548291504383087, 0.02935107797384262, 0.036733243614435196, -0.025672679767012596, 0.004667759872972965, -0.018531514331698418, 0.005102191586047411, -0.011574269272387028, -0.005026086699217558, 0.04312604293227196, -0.015525375492870808, -0.023364167660474777, -0.004867535084486008, -0.001621190458536148, -0.02960476092994213, -0.0035959510132670403, 0.015233640559017658, -0.020117031410336494, -0.0033169002272188663, -0.0009386256569996476, 0.030619490891695023, -0.0010702235158532858, 0.0032851898577064276, -0.00988093763589859, 0.018645672127604485, -0.015056062489748001, -0.024797474965453148, 0.006798693910241127, 0.011485479772090912, 0.0024258398916572332, 0.02139812894165516, -0.025076525285840034, 0.01435843575745821, -0.013077338226139545, -0.005422465968877077, 0.04705812409520149, -0.029503287747502327, -0.021042972803115845, 0.01714894361793995, -0.005707858595997095, 0.0202185045927763, -0.016641579568386078, 0.02468331716954708, -0.008675944991409779, -0.0564190112054348, -0.03650492802262306, 0.0038654888048768044, 0.009075495414435863, -0.022768015041947365, -0.01194210909307003, 0.010496118105947971, -0.02223527990281582, -0.011637689545750618, 0.00594885740429163, -0.05251229926943779, -0.010400987230241299, -0.03292800113558769, 0.011447427794337273, 0.020700501278042793, 0.021512284874916077, -0.02691572532057762, -0.02043413370847702, 0.027803614735603333, 0.08706387132406235, -0.026941092684864998, 0.009906305931508541, -0.05131999030709267, -0.03148201107978821, 0.022527014836668968, 0.00813686940819025, 0.043328989297151566, -0.008035396225750446, 0.008669603615999222, 0.030746331438422203, 0.03886417672038078, 0.016971366479992867, 0.02716940827667713, 0.027017198503017426, -0.014180857688188553, -0.03292800113558769, -0.018430041149258614, 0.053882185369729996, 0.007927581667900085, -0.020954184234142303, -0.00927209947258234, 0.03120296075940132, -0.013039286248385906, -0.007065060548484325, -0.01021706685423851, 0.028513925150036812, -0.024480372667312622, -0.010851273313164711, -0.06864651292562485, 0.003004553494974971, -0.003443741472437978, -0.012874392792582512, -0.04497792571783066, 0.014256962575018406, -0.01021706685423851, -0.032319165766239166, 0.017478732392191887, -0.009094521403312683, 0.0132041797041893, 0.04688054695725441, 0.04939200356602669, -0.02732161618769169, 0.019520876929163933, -0.02564731240272522, 0.01732652261853218, 0.03480525314807892, 0.0007535166223533452, -0.005051454994827509, -0.008809128776192665, -0.015969321131706238, 0.046525388956069946, -0.07996075600385666, -0.04261867702007294, -0.0017916334327310324, -0.009658965282142162, 0.02985844388604164, 0.006887482944875956, 0.04954421520233154, 0.061949294060468674, 0.018138306215405464, -0.017478732392191887, -0.008796444162726402, -0.055353544652462006, 0.022691909223794937, 0.0014689809177070856, 0.03927006945014, -0.0005672184634022415, 0.0125699732452631, 0.007420216221362352, -0.025621943175792694, 0.01311539113521576, -0.029376445338129997, 0.021880125626921654, -0.013914491049945354, -0.0043284595012664795, -0.025000421330332756, 0.02548241801559925, 0.013990595936775208, 0.019711138680577278, 0.032319165766239166, -0.06184782087802887, -0.10695258527994156, 0.019140353426337242, -0.015842478722333908, -0.022209912538528442, 0.04406467080116272, 0.03838218003511429, -0.04507939890027046, 0.037697236984968185, -0.04117268696427345, -0.04792064428329468, -0.043202146887779236, 0.0613911896944046, 0.03505893796682358, -0.0028269756585359573, -0.009367230348289013, 0.013533967547118664, -0.003440570319071412, -0.005489057395607233, 0.03523651510477066, 0.033739786595106125, -0.019952137023210526, -0.01799878105521202, 0.04591655358672142, -0.019482824951410294, -0.012677788734436035, -0.036809347569942474, -0.015297061763703823, 0.004610681440681219, 0.0075977942906320095, 0.02156302146613598, -0.021207865327596664, -0.03363831341266632, -0.024734053760766983, 0.017542151734232903, -0.010407328605651855, 0.038991015404462814, -0.001533194212242961, 0.08503440767526627, -0.0036340034566819668, 0.021765967831015587, 0.0024353531189262867, -0.027448458597064018, 0.023998374119400978, -0.006589405704289675, 0.030619490891695023, 0.06017351523041725, 0.013001233339309692, 0.0095004141330719, -0.006082040723413229, 0.01858225092291832, 0.012107002548873425, 0.045434556901454926, 0.03132980316877365, -0.013977911323308945, -0.013254916295409203, 0.026966461911797523, 0.011789899319410324, -0.0037830418441444635, -0.02775287814438343, 0.02623078227043152, -0.03145664185285568, 0.03031507134437561, 0.023275379091501236, -0.0576874241232872, 0.06834209710359573, -0.010274145752191544, -0.04827580228447914, -0.02548241801559925, 0.006142290309071541, -0.010908352211117744, 0.01078151073306799, 0.0017424824181944132, -0.013863754458725452, 0.025330208241939545, 0.002218137262389064, 0.023009013384580612, 0.04028479754924774, 0.03523651510477066, 0.01168842613697052, -0.01892472244799137, -0.011155692860484123, 0.0081115011125803, 0.051396097987890244, 0.0022704594302922487, 0.023529062047600746, 0.005203664302825928, -0.011295218020677567, 0.01221481803804636, 0.02555852197110653, -0.043912459164857864, 0.042441099882125854, -0.007610478438436985, 0.02110639400780201, -0.01634984463453293, -0.010280488058924675, 0.018239779397845268, 0.037950918078422546, 0.0029094223864376545, 0.0058759236708283424, 0.010978114791214466, 0.001989823067560792, -0.01934329979121685, 0.02909739501774311, 6.2274871197587345e-06, -0.0025812205858528614, -0.0052258619107306, -0.03442472964525223, -0.01976187527179718, -0.0128870764747262, 0.018785197287797928, 0.01605810970067978, 0.04074142873287201, -0.0362512432038784, -0.027017198503017426, -0.0004681237041950226, -0.004179420880973339, -0.013660808093845844, -0.006500616669654846, -0.012836339883506298, 0.0361497700214386, 0.020510239526629448, -0.024949684739112854, -0.030543386936187744, -0.003462767694145441, 0.04675370454788208, -0.00992533192038536, 0.028742238879203796, -0.014599434100091457, -0.005910804960876703, 0.0527152456343174, -0.04150247573852539, 0.006982613820582628, -0.016451317816972733, 0.01576637476682663, 0.022729961201548576, -0.013838386163115501, -0.028184138238430023, -0.010844931937754154, -0.01790999248623848, 0.003161519533023238, 0.017085524275898933, 0.022894855588674545, 0.013445178046822548, -0.022717278450727463, 0.03792554885149002, 0.03894028067588806, -0.015436586923897266, -0.007109455298632383, 0.04548529163002968, 0.00043284596176818013, -0.0034786227624863386, -0.05172588303685188, -0.019114984199404716, 0.014003279618918896, -0.006931877229362726, 0.01728847064077854, -0.04284699261188507, -0.024835526943206787, 0.0269918292760849, 0.002408399246633053, -0.017313838005065918, 0.007616820279508829, 0.021220549941062927, -0.03178643062710762, 0.0090628108009696, 0.00811784341931343, -0.008206631988286972, -0.0014317212626338005, -0.03384125977754593, 0.005127559881657362, -0.021245919167995453, -0.014307699166238308, 0.007857819087803364, -0.027981191873550415, 0.006402314640581608, -0.0018201727652922273, 0.007350453641265631, -0.04104584455490112, 0.009050127118825912, 0.024696001783013344, -0.02009166218340397, -0.016590842977166176, 0.012969523668289185, -0.005555649287998676, 0.002492431551218033, 0.03295337036252022, 0.021119076758623123, -0.06189855560660362, -0.04018332436680794, -0.00629449961706996, -0.03404420614242554, 0.0016164338449016213, -0.040462374687194824, -0.006684536579996347, -0.0002279179752804339, -0.021157128736376762, -0.004499695263803005, 0.06971198320388794, -0.016324475407600403, -0.018645672127604485, 0.003611806081607938, 0.022932907566428185, -0.004255525767803192, 0.013838386163115501, -0.027296248823404312, -0.014079384505748749, 0.016704998910427094, -0.0031266382429748774, 0.014548697508871555, -0.020459502935409546, 0.008276395499706268, 0.0263576228171587, -0.0018074886174872518, -0.016540106385946274, -0.0023624193854629993, 0.045510660856962204, 0.0209034476429224, -0.014193542301654816, -0.03216695412993431, 0.018100254237651825, 0.032725054770708084, 0.016540106385946274, 0.005822015926241875, -0.008352499455213547, 0.0020675132982432842, -0.027524562552571297, 0.025545839220285416, 0.028184138238430023, -0.012956839054822922, -0.02316122315824032, -0.03356220945715904, 0.011548900976777077, 0.04792064428329468, 0.018341252580285072, 0.000818126427475363, 0.011288875713944435, -0.029503287747502327, -0.01258899923413992, 0.03343536704778671, -0.028919817879796028, 0.007952949963510036, -0.008010027930140495, 0.00025586268748156726, 0.007730977609753609, 0.021677179262042046, 0.011815267615020275, 0.007388506084680557, 0.041020479053258896, -0.0028238045051693916, -0.049290530383586884, 0.0026002468075603247, 0.00491827167570591, -0.007046034559607506, 0.01794804446399212, 0.02530484087765217, 0.024911632761359215, -0.07417679578065872, -0.03191327303647995, 0.0626596063375473, -0.020281923934817314, 0.00011534630903042853, -0.05677416920661926, 0.004632878582924604, 0.043836355209350586, -0.013445178046822548, 0.023732008412480354, 0.008010027930140495, -0.027651404961943626, 0.00552710983902216, -0.011200087144970894, -0.03663177043199539, -0.03153274953365326, 0.01879788190126419, -0.0017868769355118275, 0.012500210665166378, -0.011453770101070404, 0.03216695412993431, -0.005492228548973799, -0.06326844543218613, -0.009481387212872505, -0.007813424803316593, 0.003846462583169341, -0.0014023891417309642, -0.02922423742711544, -0.0005430393503047526, 0.006408656947314739, 0.016895262524485588, 0.028818344697356224, -0.02808266505599022, -0.029630128294229507, -0.002292656572535634, -0.013648124411702156, -0.0023402220103889704, -0.030162861570715904, -0.02089076302945614, -0.0029554024804383516, 0.011872346512973309, 0.012601683847606182, -0.017212364822626114, -0.03148201107978821, 0.030010651797056198, 0.003817923367023468, 0.0053336769342422485, 0.0013302481966093183, -0.06484127789735794, -0.023440273478627205, 0.055607229471206665, 0.0007749210926704109, -0.03536335751414299, -0.013039286248385906, 0.011713794432580471, 0.034323256462812424, -0.0090628108009696, -0.013508599251508713, -0.025786837562918663, -0.0276260357350111, 0.0162230022251606, 0.004388709086924791, 0.01374959759414196, 0.006525984965264797, 0.011929424479603767, -0.015525375492870808, -0.01640058122575283, 0.0051656123250722885, -0.012855365872383118, 0.009221362881362438, 0.0575859509408474, -0.05997056886553764, 0.004873876925557852, -0.025710731744766235, 0.00954480841755867, -0.017554836347699165, -0.0044457875192165375, -0.025076525285840034, -0.014409172348678112, -0.015195588581264019, 0.02286948636174202, -0.06524717062711716, 0.04041163995862007, -0.007635846734046936, -0.02808266505599022, 0.017212364822626114, 0.0067352731712162495, -0.03716450184583664, -0.028108032420277596, 0.036809347569942474, -8.670792158227414e-05, -0.004239670466631651, -0.012132370844483376, -0.0014150732895359397, -0.02897055447101593, 0.003491306910291314, 0.0043538277968764305, 0.021842071786522865, -0.023732008412480354, 0.014269647188484669, 0.0418068952858448, 0.03599756211042404, 0.01732652261853218, 0.010863957926630974, 0.012449474073946476, -0.013863754458725452, -0.005035599693655968, 0.004981692414730787, -0.005549306981265545, -0.032014746218919754, -0.0036688847467303276, -0.03447546809911728, -0.023275379091501236, -0.01173282042145729, -0.02043413370847702, -0.004563116002827883, 0.03650492802262306, 0.057788897305727005, -0.019952137023210526, 0.0009608228574506938, -0.11131592839956284, -0.030619490891695023, 0.00022970167628955096, -0.025076525285840034, -0.033283159136772156, 0.012696814723312855, -0.024125216528773308, 0.005263914354145527, -0.03292800113558769, -0.0028539292979985476, 0.007065060548484325, 0.003217012621462345, -0.03224305808544159, -0.019203772768378258, 0.03932080417871475, -0.013356389477849007, -0.009652622975409031, 0.014028647914528847, 0.01874714531004429, -0.00832713209092617, -0.006478419527411461, 0.00550808385014534, -0.04743864759802818, 0.005035599693655968, -0.043582674115896225, -0.00124066649004817, -0.02648446522653103, 0.020167768001556396, 0.021537654101848602, -0.005152928177267313, -0.029655497521162033, -0.01503069419413805, 0.024657949805259705, -0.0012652419973164797, -0.06352212280035019, 0.05504912510514259, 0.007109455298632383, 0.046982020139694214, 0.013483230955898762, -0.014447224326431751, 0.010128278285264969, 0.009075495414435863, 0.013825702480971813, -0.0005925867008045316, 0.04028479754924774, 0.0038147522136569023, -0.01017267256975174, -0.025457050651311874, -0.04272015020251274, -0.020801974460482597, 0.01727578602731228, 0.02232407033443451, -0.003738647559657693, 0.03914322704076767, 0.02922423742711544, 0.05286745727062225, -0.03422178328037262, -0.01413012109696865, -0.02555852197110653, 0.05073652043938637, -0.007388506084680557, 0.027905087918043137, 0.0005477959057316184, -0.010680037550628185, -0.04114731773734093, 0.029021291062235832, -0.033029474318027496, 0.017123576253652573, -0.011181061156094074, -0.014180857688188553, -0.016717683523893356, 0.022260649129748344, 0.004629707429558039, -0.02543168142437935, 0.004845337942242622, -0.009303810074925423, 0.010121935978531837, 0.0006928706425242126, -0.01832856796681881, 0.003193229902535677, 0.04622097313404083, 0.015271693468093872, 0.009443335235118866, 0.02904665842652321, -0.027194775640964508, 0.028488557785749435, -0.019660402089357376, -0.009811175055801868, 0.022641172632575035, -0.002956987824290991, 0.005222690757364035, 0.02283143438398838, 0.0014436126220971346, 0.004686786327511072, -0.030720964074134827, 0.009278441779315472, -0.030619490891695023, -0.030746331438422203, 0.026687409728765488, 0.010312197729945183, -0.004680444020777941, 0.019406719133257866, -0.03855975717306137, 0.004284065216779709, -0.02673814631998539, 0.017415311187505722, -0.0009457604610361159, -0.0181256216019392, -0.002620858373120427, -0.013051969930529594, 0.03541409224271774, 0.006335723213851452, -0.012639735825359821, 0.011701110750436783, -0.02610393986105919, -0.004670931026339531, 0.0674288347363472, -0.019609665498137474, -0.018480777740478516, 0.027296248823404312, 0.015005325898528099, 0.03351147100329399, -0.004439445678144693, -0.0006088382797315717, -0.01314075943082571, 0.033866629004478455, -0.03300410881638527, -0.0016616210341453552, -0.0282602421939373, 0.007451926823705435, -0.0007467781542800367, 0.025495102629065514, 0.0027001341804862022, 0.011834293603897095, 0.01200552936643362, -0.050812628120183945, 0.02388421818614006, -0.012056265957653522, -0.009754096157848835, -0.006386459805071354, 0.004680444020777941, -0.009417966939508915, 0.01992676965892315, 0.010248777456581593, -0.010083884000778198, -0.0015871018404141068, 0.018189042806625366, 0.007185559719800949, -0.010775168426334858, 0.01921645738184452, -0.009373572655022144, -0.006817719899117947, 0.003033092711120844, 0.04140100255608559, -0.026078572496771812, 0.03280116245150566, -0.02960476092994213, -0.037139132618904114, -0.02488626353442669, -0.043455831706523895, -0.019114984199404716, 0.041477106511592865, -0.030213598161935806, -0.021727915853261948, 0.03340999782085419, -0.027296248823404312, -0.010001436807215214, 0.001074187341146171, 0.010077541694045067, 0.007375821936875582, -0.017681678757071495, 0.01983797922730446, 0.04074142873287201, -0.01845541037619114, 0.036682505160570145, 0.05449102446436882, 0.005917146801948547, -0.007122139446437359, -0.007604136131703854, 0.013013917952775955, 0.008866206742823124, 0.04548529163002968, 0.03620050847530365, -1.7849444702733308e-05, 0.03627661243081093, -0.015411218628287315, -0.010115593671798706, 0.031558115035295486, 0.014561382122337818, 0.013838386163115501, 0.0337144173681736, -0.005073652137070894, 0.0037259634118527174, 0.025659995153546333, -0.03171032667160034, 0.03881343826651573, 0.042238153517246246, 0.002643055748194456, -0.005038770847022533, -0.00021404470317065716, 0.020510239526629448, 0.022907540202140808, 0.01996482163667679, -0.020878078415989876, -0.009779464453458786, 0.0821424275636673, 0.011656715534627438, -0.05530280992388725, -0.02094149962067604, 0.016628894954919815, -0.01618495024740696, 0.00012307570432312787, 0.0072109280154109, 0.009417966939508915, -0.026433728635311127, -0.013610072433948517, -0.037570394575595856, -0.0008593498496338725, -0.029401814565062523, -0.027144039049744606, -0.03140590712428093, 0.02274264581501484, 0.011536216363310814, 0.003802068065851927, -0.009519440121948719, 0.034196414053440094, 0.004766061902046204, -0.002243505557999015, 0.04662686213850975, 0.020586343482136726, -0.028615398332476616, 0.020548291504383087, -0.03325778990983963, 0.016578158363699913, 0.023440273478627205, -0.007496321108192205, 0.0030156520660966635, -0.023351484909653664, 0.0015760031528770924, 0.008415920659899712, -0.009513097815215588, 0.024023743346333504, 0.006627458147704601, -0.014916537329554558, 0.015132167376577854, 0.04431835189461708, 0.057027850300073624, 0.029909180477261543, 0.011891372501850128, 0.005048283841460943, 0.005733226891607046, 0.030492650344967842, 0.016844525933265686, -0.01643863320350647, 0.019571613520383835, 0.0003620922798290849, 0.01525900885462761, 0.03353684023022652, -0.014307699166238308, 0.0008585570612922311, -0.005672977305948734, 0.042821623384952545, -0.008815471082925797, 0.0006334137869998813, 0.0007388506201095879, -0.043709512799978256, -0.0033708077389746904, -0.005003889556974173, 0.049341268837451935, -0.011783557012677193, -0.01429501548409462, 0.030923910439014435, 0.014497960917651653, 0.008492025546729565, 0.0075280312448740005, 0.0018043175805360079, -0.04974715784192085, -0.0059932516887784, -0.011231797747313976, -0.015271693468093872, -0.01534779742360115, 0.0071411654353141785, 0.03896564990282059, -0.009183310903608799, 0.02960476092994213, -0.00748363696038723, -0.021258601918816566, -0.009893621318042278, 6.460979057010263e-05, 0.02846318855881691, 0.009957042522728443, 0.01794804446399212, -0.0010805294150486588, -0.05035599693655968, -0.007420216221362352, -0.0029966258443892, -0.009785806760191917, 0.0033993469551205635, -0.010971772484481335, -0.023998374119400978, 0.039422277361154556, -0.00289515289478004, -0.003941593691706657, 0.013128074817359447, 0.006399143952876329, 0.008739366196095943, -0.015068747103214264, -0.04200984165072441, 0.025875626131892204, 0.02383348159492016, -0.03368905186653137, 0.00283807422965765, 0.014218910597264767, -0.011181061156094074, 0.00872668158262968, 0.0029094223864376545, -0.01490385364741087, 0.0034500835463404655, -0.008561788126826286, 0.005660293158143759, 0.0113522969186306, -0.010737116448581219, 0.004173079039901495, 0.013533967547118664, 0.02106834016740322, -0.00148959259968251, -0.005175125319510698, 0.006383288651704788, 0.01896277442574501, -0.016717683523893356, 0.04792064428329468, -0.011200087144970894, 0.033993471413850784, -0.006075698416680098, -0.038610491901636124, -0.021626442670822144, -0.0639280155301094, -0.006773325614631176, 0.006256447173655033, 0.0009116719011217356, -0.053374819457530975, -0.002123006386682391, -0.026636673137545586, 0.0045472607016563416, -0.010039489716291428, 0.016971366479992867, -0.018150990828871727, 0.018112938851118088, -0.011510848067700863, 0.0031298091635107994, 0.07011787593364716, -0.0002758798364084214, 0.00864423532038927, -0.024074479937553406, 0.026788882911205292, 0.0048009431920945644, -0.0018740802770480514, 0.017516784369945526, -0.018277831375598907, -0.015867847949266434, -0.046271707862615585, 0.004280894063413143, -0.01992676965892315, -0.0015197173925116658, 0.03901638463139534, -0.011846978217363358, 0.006817719899117947, -0.009658965282142162, -0.0021436179522424936, 0.015385850332677364, 0.009938016533851624, 0.016616210341453552, -0.005631753709167242, -0.01736457459628582, -0.00048556437832303345, 0.0016727197216823697, 0.0004669345507863909, -0.04477497935295105, 0.016375211998820305, 0.03115222416818142, -0.024670634418725967, -0.003741818480193615, -0.032978739589452744, 0.005010231398046017, 0.0013976326445117593, 0.0021515456028282642, 0.0004736729897558689, 0.0276260357350111, -0.0006468906649388373, 0.0006813756190240383, -0.019990189000964165, -0.011529874987900257, -0.022387489676475525, -0.005419294815510511, 0.003465938614681363, 0.021334707736968994, -0.019394036382436752, -0.021081024780869484, 0.012455816380679607, 0.021131761372089386, -8.423055078310426e-06, 0.0037830418441444635, 0.007496321108192205, -0.019076932221651077, -0.012557289563119411, -0.04031016677618027, 0.021537654101848602, 0.03153274953365326, 0.04104584455490112, 0.008694970980286598, 0.013521282933652401, 0.009386256337165833, -0.01345786266028881, 0.027220144867897034, -0.007908555679023266, -0.033232420682907104, 0.0156395323574543, 0.00022633245680481195, -0.014840432442724705, 0.04284699261188507, -0.029122764244675636, 0.025418996810913086, 0.01703478768467903, -0.026256149634718895, 0.025583891198039055, 0.0004736729897558689, 0.009633596986532211, -0.026636673137545586, 0.018632987514138222, 0.015233640559017658, 0.02081465721130371, -0.012982207350432873, -0.004265038762241602, -0.0007519311038777232, -0.007014323957264423, 0.006969929672777653, -0.007692925166338682, 0.0016148483846336603, -0.028412451967597008, 0.016628894954919815, 0.010984457097947598, 0.0020611712243407965, -0.03206548094749451, 0.01017267256975174, 0.031228329986333847, 0.005457347258925438, -0.004807285498827696, 0.016933314502239227, -0.014193542301654816, 0.0006560073816217482, 0.011244481429457664, -0.0024797474034130573, -0.024645265191793442, 0.05015305057168007, 0.006969929672777653, 0.03736744821071625, -0.01576637476682663, -0.022641172632575035, -0.004873876925557852, 0.020383397117257118, -0.00705237640067935, -0.017808519303798676, 0.015779057517647743, 0.011739162728190422, -0.022514332085847855, 0.0010393059346824884, -0.019749190658330917, 0.033739786595106125, 0.0014531257329508662, -0.025710731744766235, 0.006538669113069773, 0.02043413370847702, -0.027093302458524704, 0.00811784341931343, 0.001074187341146171, 0.03206548094749451, 0.014307699166238308, -0.014092069119215012, -0.024619897827506065, -0.004943639971315861, -0.006659168284386396, 0.03417104855179787, 0.0026937921065837145, -0.03640345484018326, 0.0116694001480937, -0.030873173847794533, -0.007730977609753609, -0.054896917194128036, -0.004537747707217932, 0.003329584142193198, 0.01137132290750742, 0.042238153517246246, -0.011339612305164337, -0.058803629130125046, -0.004306262359023094, 0.0018487119814381003, 0.01992676965892315, 0.0113522969186306, -0.001967625692486763, 0.03051801770925522, 0.026890356093645096, 0.01429501548409462, 0.018607620149850845, -0.019140353426337242, -0.004287235904484987, -0.016717683523893356, 0.019736507907509804, -0.057078588753938675, -0.035845354199409485, -0.016083477064967155, 0.010680037550628185, -0.008574471808969975, 0.0005949650076217949, 0.03396810218691826, 0.018785197287797928, 0.03947301581501961, 0.027905087918043137, 0.036099035292863846, 0.003402518108487129, -0.002368761459365487, -0.008016370236873627, -0.01557611208409071, 0.004271381068974733, 0.007585110142827034, 0.027067935094237328, -0.013698861002922058, 0.022856803610920906, -0.012646078132092953, 0.005913975648581982, -0.012576315551996231, 0.041223425418138504, -0.004284065216779709, -0.00013734535605181009, 0.027067935094237328, 0.0014063529670238495, 0.009132574312388897, 0.036555662751197815, -0.008942311629652977, -0.015487323515117168, 0.01761825755238533, 0.002896738238632679, 0.004388709086924791, -0.014180857688188553, 0.010058515705168247, -0.018277831375598907, 0.0012731696479022503, -0.009557492099702358, -0.019660402089357376, 0.006059843115508556, -0.015652216970920563, -0.014333067461848259, 0.015741005539894104, -0.005647609010338783, 0.0018360278336331248, -0.020624395459890366, 0.020243871957063675, -0.011174718849360943, -0.0018804223509505391, 0.01618495024740696, 0.022691909223794937, 0.001227189670316875, -0.010578564368188381, -0.007274348754435778, 0.004188933875411749, 0.03518577665090561, -0.01023609284311533, 0.027930455282330513, 0.00780074018985033, -0.011174718849360943, -0.0575859509408474, -0.020205819979310036, 0.005238546058535576, 0.04325288534164429, -0.018366621807217598, -0.007705609314143658, -0.000986191094852984, 0.05981836095452309, 0.0007761102169752121, 0.01769436150789261, 0.0276260357350111, 0.004946810659021139, -0.01429501548409462, -0.0144218560308218, -0.016159582883119583, -0.0104517238214612, 0.0015094114933162928, 0.0190008282661438, 0.00872033927589655, 0.01158061157912016, -0.014155489392578602, -0.020459502935409546, 0.046144865453243256, -0.006652826443314552, 0.010058515705168247, -0.022349437698721886, -0.0015815525548532605, 0.012855365872383118, 0.016324475407600403, 0.009728727862238884, 0.002123006386682391, 0.018696408718824387, 0.0125699732452631, -0.0004455300804693252, -0.04264404624700546, -0.011510848067700863, -0.020801974460482597, 0.014624802395701408, -0.0009782635606825352, -0.027067935094237328, -0.017833886668086052, -0.005019744858145714, -0.012360685504972935, 0.017123576253652573, -0.0003616959147620946, 0.030137494206428528, -0.012018213979899883, -0.00954480841755867, -0.04178152605891228, -0.0343993604183197, 0.012138713151216507, 0.02930034138262272, -0.01026146113872528, -0.0031821313314139843, 0.0029855272732675076, 0.01758020557463169, 0.018062202259898186, 0.0005838663782924414, 0.0009227704722434282, 0.01196113508194685, -0.02998528443276882, -0.018442725762724876, -0.025571206584572792, -0.0368347130715847, -0.021588390693068504, -0.019368667155504227, 0.03516041114926338, -0.0026367136742919683, 0.010305856354534626, -0.013216864317655563, 0.01567758433520794, 0.005799818783998489, -0.02261580526828766, 0.010515144094824791, 0.0017345548840239644, 0.02425205707550049, 0.014383804053068161, 0.0005101398564875126, 0.013356389477849007, 0.0028349030762910843, -0.010014121420681477, -0.017681678757071495, -0.024125216528773308, -0.0033422682899981737, -0.004769233055412769, 0.003058461006730795, -0.0005271841655485332, 0.02413790114223957, 0.04117268696427345, -0.06316696852445602, 0.025317523628473282, -0.005923489108681679, 0.009012075141072273, 0.01581711135804653, 0.0047089834697544575, -0.0056634643115103245, 0.019241826608777046, -0.032014746218919754, 0.016210319474339485, -0.0024385240394622087, 0.018975459039211273, -0.021727915853261948, 0.013927175663411617, 0.012963181361556053, -0.012525578960776329, 0.0010171086760237813, 0.007401190232485533, -0.007578767836093903, 0.012367026880383492, 0.013216864317655563, -0.008656919002532959, 0.010248777456581593, 0.005809331778436899, 0.010876641608774662, 0.00861886702477932, 0.03287726640701294, -0.0039479355327785015, -0.024607213214039803, 0.01707283966243267, -0.002517799846827984, 0.0036181481555104256, -0.036428824067115784, -0.0196857713162899, -0.02593904733657837, 0.008542762137949467, -0.029148131608963013, 0.035211145877838135, -0.0041603948920965195, -0.03990427404642105, -0.0067860097624361515, -0.01227823831140995, -0.020408766344189644, -0.01458675041794777, 0.04200984165072441, -0.05763668939471245, -0.06103603541851044, -0.013407126069068909, 0.0035071619786322117, 0.045383818447589874, -0.002233992563560605, -0.002620858373120427, -0.008492025546729565, 0.004601168446242809, 0.009189652279019356, 0.028691502287983894, -0.022755330428481102, 0.007255322765558958, -0.01841735653579235, -0.01522095687687397, -0.011954792775213718, -0.0021689862478524446, -0.007274348754435778, 0.014434540644288063, 0.036301981657743454, -0.0051402440294623375, -0.007439242675900459, -0.02308511734008789, -0.012493868358433247, -0.013013917952775955, -0.014117437414824963, -0.03305484354496002, 0.031380537897348404, -0.024784790351986885, 0.04155321046710014, -0.0017979755066335201, -0.003197986399754882, -0.01609616167843342, -0.009348204359412193, -0.01191674079746008, 0.00157362490426749]
metadata : {"source": "pydantic_ai_docs", "crawled_at": "2025-03-16T00:35:03.492831", "url_path": "/testing-evals/", "chunk_size": 4823}
updated_dt: 2025-03-16T00:35:03.494363
---
```
fromdatetimeimport timezone
importpytest
fromdirty_equalsimport IsNow
frompydantic_aiimport models, capture_run_messages
frompydantic_ai.models.testimport TestModel
frompydantic_ai.messagesimport (
  ModelResponse,
  SystemPromptPart,
  TextPart,
  ToolCallPart,
  ToolReturnPart,
  UserPromptPart,
  ModelRequest,
)
fromfake_databaseimport DatabaseConn
fromweather_appimport run_weather_forecast, weather_agent
pytestmark = pytest.mark.anyio 
We're using anyio[](https://anyio.readthedocs.io/en/stable/) to run async tests.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_1)
models.ALLOW_MODEL_REQUESTS = False 
This is a safety measure to make sure we don't accidentally make real requests to the LLM while testing, see ALLOW_MODEL_REQUESTS[](https://ai.pydantic.dev/api/models/base/#pydantic_ai.models.ALLOW_MODEL_REQUESTS) for more details.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_2)

async deftest_forecast():
  conn = DatabaseConn()
  user_id = 1
  with capture_run_messages() as messages:
    with weather_agent.override(model=TestModel()): 
We're using Agent.override[](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.Agent.override) to replace the agent's model with TestModel[](https://ai.pydantic.dev/api/models/test/#pydantic_ai.models.test.TestModel), the nice thing about override is that we can replace the model inside agent without needing access to the agent run* methods call site.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_3)
      prompt = 'What will the weather be like in London on 2024-11-28?'
      await run_weather_forecast([(prompt, user_id)], conn) 
Now we call the function we want to test inside the override context manager.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_4)
  forecast = await conn.get_forecast(user_id)
  assert forecast == '{"weather_forecast":"Sunny with a chance of rain"}' 
But default, TestModel will return a JSON string summarising the tools calls made, and what was returned. If you wanted to customise the response to something more closely aligned with the domain, you could add custom_result_text='Sunny'[](https://ai.pydantic.dev/api/models/test/#pydantic_ai.models.test.TestModel.custom_result_text) when defining TestModel.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_5)
  assert messages == [ 
So far we don't actually know which tools were called and with which values, we can use capture_run_messages[](https://ai.pydantic.dev/api/agent/#pydantic_ai.agent.capture_run_messages) to inspect messages from the most recent run and assert the exchange between the agent and the model occurred as expected.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_6)
    ModelRequest(
      parts=[
        SystemPromptPart(
          content='Providing a weather forecast at the locations the user provides.',
        ),
        UserPromptPart(
          content='What will the weather be like in London on 2024-11-28?',
          timestamp=IsNow(tz=timezone.utc), 
The IsNow[](https://dirty-equals.helpmanual.io/latest/types/datetime/#dirty_equals.IsNow) helper allows us to use declarative asserts even with data which will contain timestamps that change over time.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_7)
        ),
      ]
    ),
    ModelResponse(
      parts=[
        ToolCallPart(
          tool_name='weather_forecast',
          args={
            'location': 'a',
            'forecast_date': '2024-01-01', 
TestModel isn't doing anything clever to extract values from the prompt, so these values are hardcoded.
[](https://ai.pydantic.dev/testing-evals/#__code_1_annotation_8)
          },
          tool_call_id=None,
        )
      ],
      model_name='test',
      timestamp=IsNow(tz=timezone.utc),
    ),
    ModelRequest(
      parts=[
        ToolReturnPart(
          tool_name='weather_forecast',
          content='Sunny with a chance of rain',
          tool_call_id=None,
          timestamp=IsNow(tz=timezone.utc),
        ),
      ],
    ),
    ModelResponse(
      parts=[
        TextPart(
          content='{"weather_forecast":"Sunny with a chance of rain"}',
        )
      ],
      model_name='test',
      timestamp=IsNow(tz=timezone.utc),
    ),
  ]

```

### Unit testing with `FunctionModel`
The above tests are a great start, but careful readers will notice that the `WeatherService.get_forecast` is never called since `TestModel` calls `weather_forecast` with a date in the past.
To fully exercise `weather_forecast`, we need to use [`FunctionModel`](https://ai.pydantic.dev/api/models/function/#pydantic_ai.models.function.FunctionModel) to customise how the tools is called.
Here's an example of using `FunctionModel` to test the `weather_forecast` tool with custom inputs
test_weather_app2.py